
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pypath.main &#8212; pypath 0.7.97 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pypath 0.7.97 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pypath.main</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1">#</span>
<span class="c1">#  This file is part of the `pypath` python module</span>
<span class="c1">#</span>
<span class="c1">#  Copyright</span>
<span class="c1">#  2014-2018</span>
<span class="c1">#  EMBL, EMBL-EBI, Uniklinik RWTH Aachen, Heidelberg University</span>
<span class="c1">#</span>
<span class="c1">#  File author(s): Dénes Türei (turei.denes@gmail.com)</span>
<span class="c1">#</span>
<span class="c1">#  Distributed under the GPLv3 License.</span>
<span class="c1">#  See accompanying file LICENSE.txt or copy at</span>
<span class="c1">#      http://www.gnu.org/licenses/gpl-3.0.html</span>
<span class="c1">#</span>
<span class="c1">#  Website: http://www.ebi.ac.uk/~denes</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">__main__</span> <span class="c1"># XXX: Bad practice</span>

<span class="kn">from</span> <span class="nn">future.utils</span> <span class="k">import</span> <span class="n">iteritems</span>
<span class="kn">from</span> <span class="nn">past.builtins</span> <span class="k">import</span> <span class="n">xrange</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="n">reduce</span>

<span class="c1"># external modules:</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">imp</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">reduce</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cairo</span>

<span class="k">except</span><span class="p">:</span> <span class="c1"># XXX: Catching any exception like this is bad practice</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Module `cairo` not available.</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">   Some plotting functionalities won</span><span class="se">\&#39;</span><span class="s1">t be accessible.</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="p">)</span> <span class="c1"># XXX: Single/double quotes are not consistent throughout the code</span>

<span class="kn">import</span> <span class="nn">igraph</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">random</span> <span class="c1"># XXX: This and other Python built-in modules shoud be up</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">locale</span>
<span class="kn">import</span> <span class="nn">heapq</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">chain</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># XXX: Put together all import tries</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>

<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pickle</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pygraphviz</span> <span class="k">as</span> <span class="nn">graphviz</span>

<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span><span class="c1">#ModuleNotFoundError:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Module `pygraphviz` not available.</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">   You don</span><span class="se">\&#39;</span><span class="s1">t need it unless you want to export dot files.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pandas</span>

<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span><span class="c1">#ModuleNotFoundError:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Module `pandas` not available.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="c1"># from this module:</span>
<span class="kn">import</span> <span class="nn">pypath.logn</span> <span class="k">as</span> <span class="nn">logn</span>
<span class="kn">import</span> <span class="nn">pypath.data_formats</span> <span class="k">as</span> <span class="nn">data_formats</span>
<span class="kn">import</span> <span class="nn">pypath.mapping</span> <span class="k">as</span> <span class="nn">mapping</span>
<span class="kn">import</span> <span class="nn">pypath.descriptions</span> <span class="k">as</span> <span class="nn">descriptions</span>
<span class="kn">import</span> <span class="nn">pypath.chembl</span> <span class="k">as</span> <span class="nn">chembl</span>
<span class="kn">import</span> <span class="nn">pypath.mysql</span> <span class="k">as</span> <span class="nn">mysql</span>
<span class="kn">import</span> <span class="nn">pypath.dataio</span> <span class="k">as</span> <span class="nn">dataio</span>
<span class="kn">import</span> <span class="nn">pypath.uniprot_input</span> <span class="k">as</span> <span class="nn">uniprot_input</span>
<span class="kn">import</span> <span class="nn">pypath.curl</span> <span class="k">as</span> <span class="nn">curl</span>
<span class="kn">import</span> <span class="nn">pypath.intera</span> <span class="k">as</span> <span class="nn">intera</span>
<span class="kn">import</span> <span class="nn">pypath.seq</span> <span class="k">as</span> <span class="nn">se</span>
<span class="kn">import</span> <span class="nn">pypath.go</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">pypath.gsea</span> <span class="k">as</span> <span class="nn">gsea</span>
<span class="kn">import</span> <span class="nn">pypath.drawing</span> <span class="k">as</span> <span class="nn">bdrawing</span>
<span class="kn">import</span> <span class="nn">pypath.proteomicsdb</span> <span class="k">as</span> <span class="nn">proteomicsdb</span>
<span class="kn">import</span> <span class="nn">pypath.reflists</span> <span class="k">as</span> <span class="nn">reflists</span>
<span class="kn">import</span> <span class="nn">pypath.input_formats</span> <span class="k">as</span> <span class="nn">input_formats</span>
<span class="kn">import</span> <span class="nn">pypath.refs</span> <span class="k">as</span> <span class="nn">_refs</span>
<span class="kn">import</span> <span class="nn">pypath.plot</span> <span class="k">as</span> <span class="nn">plot</span>
<span class="kn">import</span> <span class="nn">pypath.ptm</span>
<span class="kn">import</span> <span class="nn">pypath.export</span> <span class="k">as</span> <span class="nn">export</span>
<span class="kn">import</span> <span class="nn">pypath.ig_drawing</span> <span class="k">as</span> <span class="nn">ig_drawing</span>
<span class="kn">import</span> <span class="nn">pypath.common</span> <span class="k">as</span> <span class="nn">common</span> <span class="c1">#</span>
<span class="kn">import</span> <span class="nn">pypath._version</span> <span class="k">as</span> <span class="nn">_version</span> <span class="c1">#</span>
<span class="kn">from</span> <span class="nn">pypath.gr_plot</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pypath.progress</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">omnipath</span> <span class="o">=</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">omnipath</span>

<span class="c1"># XXX: The following aliases are already defined in common.py</span>
<span class="k">if</span> <span class="s1">&#39;long&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">__builtins__</span><span class="p">:</span>
    <span class="n">long</span> <span class="o">=</span> <span class="nb">int</span>

<span class="k">if</span> <span class="s1">&#39;unicode&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">__builtins__</span><span class="p">:</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PyPath&#39;</span><span class="p">,</span> <span class="s1">&#39;Direction&#39;</span><span class="p">,</span> <span class="s1">&#39;__version__&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="c1"># XXX: What is this &quot;a&quot;?</span>
           <span class="s1">&#39;AttrHelper&#39;</span><span class="p">,</span> <span class="s1">&#39;ReferenceList&#39;</span><span class="p">,</span> <span class="s1">&#39;omnipath&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="Direction"><a class="viewcode-back" href="../../main.html#pypath.main.Direction">[docs]</a><span class="k">class</span> <span class="nc">Direction</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object storing directionality information of an edge. Also includes</span>
<span class="sd">    information about the reverse direction, mode of regulation and</span>
<span class="sd">    sources of that information.</span>

<span class="sd">    * Arguments:</span>
<span class="sd">        - *nameA* [str]: Name of the source node.</span>
<span class="sd">        - *nameB* [str]: Name of the target node.</span>

<span class="sd">    * Attributes:</span>
<span class="sd">        - *dirs* [dict]: Dictionary containing the presence of</span>
<span class="sd">          directionality of the given edge. Keys are *straight*,</span>
<span class="sd">          *reverse* and ``&#39;undirected&#39;`` and their values denote the</span>
<span class="sd">          presence/absence [bool].</span>
<span class="sd">        - *negative* [dict]: Dictionary contianing the presence/absence</span>
<span class="sd">          [bool] of negative interactions for both *straight* and</span>
<span class="sd">          *reverse* directions.</span>
<span class="sd">        - *negative_sources* [dict]: Contains the resource names [str]</span>
<span class="sd">          supporting a negative interaction on *straight* and *reverse*</span>
<span class="sd">          directions.</span>
<span class="sd">        - *nodes* [list]: Contains the node names [str] sorted</span>
<span class="sd">          alphabetically (*nameA*, *nameB*).</span>
<span class="sd">        - *positive* [dict]:  Dictionary contianing the presence/absence</span>
<span class="sd">          [bool] of positive interactions for both *straight* and</span>
<span class="sd">          *reverse* directions.</span>
<span class="sd">        - *positive_sources* [dict]: Contains the resource names [str]</span>
<span class="sd">          supporting a positive interaction on *straight* and *reverse*</span>
<span class="sd">          directions.</span>
<span class="sd">        - *reverse* [tuple]: Contains the node names [str] in the original</span>
<span class="sd">          order e.g. (source, target).</span>
<span class="sd">        - *sources* [dict]: Contains the resource names [str] of a given</span>
<span class="sd">          edge for each directionality (*straight*, *reverse* and</span>
<span class="sd">          ``&#39;undirected&#39;``). Values are sets containing the names of</span>
<span class="sd">          those resources supporting such directionality.</span>
<span class="sd">        - *straight* [tuple]: Contains the node names [str] in reverse</span>
<span class="sd">          order e.g. (target, source).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">,</span> <span class="s1">&#39;straight&#39;</span><span class="p">,</span> <span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;dirs&#39;</span><span class="p">,</span> <span class="s1">&#39;sources&#39;</span><span class="p">,</span> <span class="s1">&#39;positive&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;negative&#39;</span><span class="p">,</span> <span class="s1">&#39;positive_sources&#39;</span><span class="p">,</span> <span class="s1">&#39;negative_sources&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the edge object between the given nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">straight</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="s1">&#39;undirected&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="nb">set</span><span class="p">([]),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="nb">set</span><span class="p">([]),</span>
                        <span class="s1">&#39;undirected&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">([])}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">positive</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negative</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="nb">set</span><span class="p">([]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="nb">set</span><span class="p">([])}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="nb">set</span><span class="p">([]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="nb">set</span><span class="p">([])}</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom string/printing function for the object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<span class="c1"># XXX: Pretty sure this could be refactored and implemented more efficiently</span>
<span class="c1">#      like using str.format()</span>

        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;Directions and signs of interaction between </span><span class="si">%s</span><span class="s1"> and </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> ===&gt; </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> &lt;=== </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> ==== </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> =+=&gt; </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> &lt;=+= </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> =-=&gt; </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> &lt;=-= </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="Direction.reload"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reloads the object from the module level.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">fromlist</span><span class="o">=</span><span class="p">[</span><span class="n">modname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span></div>

<div class="viewcode-block" id="Direction.check_nodes"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.check_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">check_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if *nodes* is contained in the edge.</span>

<span class="sd">        * Arguments:</span>
<span class="sd">             - *nodes* [list]: Or [tuple], contains the names of the</span>
<span class="sd">               edges to be checked.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [bool]: True if all elements in *nodes* are contained in</span>
<span class="sd">              the object&#39;s node list.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">nodes</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Direction.check_param"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.check_param">[docs]</a>    <span class="k">def</span> <span class="nf">check_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">di</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if *di* is ``&#39;undirected&#39;`` or contains the nodes of</span>
<span class="sd">        the current edge. Used internally to check that *di* is a valid</span>
<span class="sd">        key for the object attributes declared on dictionaries.</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *di* [tuple]: Or [str], key to be tested for validity.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [bool]: ``True`` if *di* is ``&#39;undirected&#39;`` or a tuple</span>
<span class="sd">              of node names contained in the edge, ``False`` otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">di</span> <span class="o">==</span> <span class="s1">&#39;undirected&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">di</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Direction.set_dir"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.set_dir">[docs]</a>    <span class="k">def</span> <span class="nf">set_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds directionality information with the corresponding data</span>
<span class="sd">        source named. Modifies self attributes *dirs* and *sources*.</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *direction* [tuple]: Or [str], the directionality key for</span>
<span class="sd">              which the value on *dirs* has to be set ``True``.</span>
<span class="sd">            - *source* [set]: Contains the name(s) of the source(s) from</span>
<span class="sd">              which such information was obtained.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">addToSet</span><span class="p">(</span><span class="nb">set</span><span class="p">([]),</span> <span class="n">source</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">|</span> <span class="n">source</span></div>

<div class="viewcode-block" id="Direction.get_dir"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.get_dir">[docs]</a>    <span class="k">def</span> <span class="nf">get_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the state (or *sources* if specified) of the given</span>
<span class="sd">        *direction*.</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *direction* [tuple]: Or [str] (if ``&#39;undirected&#39;``). Pair</span>
<span class="sd">              of nodes from which direction information is to be</span>
<span class="sd">              retrieved.</span>
<span class="sd">            - *sources* [bool]: Optional, ``&#39;False&#39;`` by default.</span>
<span class="sd">              Specifies if the *sources* information of the given</span>
<span class="sd">              direction is to be retrieved instead.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [bool] or [set] (if ``sources=True``). Presence/absence of</span>
<span class="sd">              the requested direction (or the list of sources if</span>
<span class="sd">              specified). Returns ``None`` if *direction* is not valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">sources</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Direction.get_dirs"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.get_dirs">[docs]</a>    <span class="k">def</span> <span class="nf">get_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all directions with boolean values or list of sources.</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *src* [str]: Source node.</span>
<span class="sd">            - *tgt* [str]: Target node.</span>
<span class="sd">            - *sources* [bool]: Optional, ``False`` by default.</span>
<span class="sd">              Specifies whether to return the *sources* attribute</span>
<span class="sd">              instead of *dirs*.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [list]: Contains the *dirs* (or *sources* if specified) of</span>
<span class="sd">              the given edge.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<span class="c1"># XXX: What&#39;s the point of using src and tgt if in the end straigth, reverse</span>
<span class="c1">#      and undirected are returned? Also, in such case:</span>
<span class="c1">#      `return self.sources/dirs.values()` is more straightforward.</span>

        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">sources</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">query</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[(</span><span class="n">query</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">query</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">query</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[(</span><span class="n">query</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">query</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Direction.which_dirs"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.which_dirs">[docs]</a>    <span class="k">def</span> <span class="nf">which_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the pair(s) of nodes for which there is information</span>
<span class="sd">        about their directionality.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [list]: List of tuples containing the nodes for which</span>
<span class="sd">              theit attribute *dirs* is ``True``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">)</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">!=</span> <span class="s1">&#39;undirected&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.unset_dir"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.unset_dir">[docs]</a>    <span class="k">def</span> <span class="nf">unset_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes directionality and/or source information of the</span>
<span class="sd">        specified *direction*. Modifies attribute *dirs* and *sources*</span>
<span class="sd">        (or *sources* only if ``source=True``).</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *direction* [tuple]: Or [str] (if ``&#39;undirected&#39;``) the</span>
<span class="sd">              pair of nodes specifying the directionality from which the</span>
<span class="sd">              information is to be removed.</span>
<span class="sd">            - *source* [set]: Optional, ``None`` by default. If</span>
<span class="sd">              specified, determines which source(s) is(are) to be</span>
<span class="sd">              removed from *sources* attribute in the specified</span>
<span class="sd">              *direction*.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">check_param</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Direction.is_directed"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.is_directed">[docs]</a>    <span class="k">def</span> <span class="nf">is_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if edge has any directionality information.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [bool]: Returns ``True```if any of the *dirs* attribute</span>
<span class="sd">              values is ``True`` (except ``&#39;undirected&#39;``), ``False``</span>
<span class="sd">              otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;undirected&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="Direction.is_stimulation"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.is_stimulation">[docs]</a>    <span class="k">def</span> <span class="nf">is_stimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if any (or for a specific *direction*) interaction is</span>
<span class="sd">        activation (positive interaction).</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *direction* [tuple]: Optional, ``None`` by default. If</span>
<span class="sd">              specified, checks the *positive* attribute of that</span>
<span class="sd">              specific directionality. If not specified, checks both.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [bool]: ``True`` if any interaction (or the specified</span>
<span class="sd">              *direction*) is activatory (positive).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.is_inhibition"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.is_inhibition">[docs]</a>    <span class="k">def</span> <span class="nf">is_inhibition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if any (or for a specific *direction*) interaction is</span>
<span class="sd">        inhibition (negative interaction).</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *direction* [tuple]: Optional, ``None`` by default. If</span>
<span class="sd">              specified, checks the *negative* attribute of that</span>
<span class="sd">              specific directionality. If not specified, checks both.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [bool]: ``True`` if any interaction (or the specified</span>
<span class="sd">              *direction*) is inhibitory (negative).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.has_sign"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.has_sign">[docs]</a>    <span class="k">def</span> <span class="nf">has_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether the edge (or for a specific *direction*) has</span>
<span class="sd">        any signed information (about positive/negative interactions).</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *direction* [tuple]: Optional, ``None`` by default. If</span>
<span class="sd">              specified, only the information of that direction is</span>
<span class="sd">              checked for sign.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [bool]: ``True`` if there exist any information on the</span>
<span class="sd">              sign of the interaction, ``False`` otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
                    <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.set_sign"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.set_sign">[docs]</a>    <span class="k">def</span> <span class="nf">set_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets sign and source information on a given direction of the</span>
<span class="sd">        edge. Modifies the attributes *positive* and *positive_sources*</span>
<span class="sd">        or *negative* and *negative_sources* depending on the sign.</span>
<span class="sd">        Direction is also updated accordingly, which also modifies the</span>
<span class="sd">        attributes *dirs*, *sources*,</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *direction* [tuple]: Pair of edge nodes specifying the</span>
<span class="sd">              direction from which the information is to be set/updated.</span>
<span class="sd">            - *sign* [str]: Specifies the type of interaction. If</span>
<span class="sd">              ``&#39;positive&#39;``, is considered activation, otherwise, is</span>
<span class="sd">              assumed to be negative (inhibition).</span>
<span class="sd">            - *source* [set]: Contains the name(s) of the source(s) from</span>
<span class="sd">              which the information was obtained.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_dir</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">addToSet</span><span class="p">(</span><span class="nb">set</span><span class="p">([]),</span> <span class="n">source</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">|</span> <span class="n">source</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">|</span> <span class="n">source</span></div>

<div class="viewcode-block" id="Direction.get_sign"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.get_sign">[docs]</a>    <span class="k">def</span> <span class="nf">get_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the sign information of the edge in the given</span>
<span class="sd">        diretion. If specified in *sign*, only that sign&#39;s information</span>
<span class="sd">        will be retrieved. If specified in *sources*, the sources of</span>
<span class="sd">        that information will be retrieved instead.</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *direction* [tuple]: Contains the pair of nodes specifying</span>
<span class="sd">              the directionality of the edge from which th information</span>
<span class="sd">              is to be retrieved.</span>
<span class="sd">            - *sign* [str]: Optional, ``None`` by default. Denotes</span>
<span class="sd">              whether to retrieve the ``&#39;positive&#39;`` or ``&#39;negative&#39;``</span>
<span class="sd">              specific information.</span>
<span class="sd">            - *sources* [bool]: Optional, ``False`` by default.</span>
<span class="sd">              Specifies whether to return the sources instead of sign.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [list]: If ``sign=None`` containing [bool] values denoting</span>
<span class="sd">              the presence of positive and negative sign on that</span>
<span class="sd">              direction, if ``sources=True`` the [set] of sources for</span>
<span class="sd">              each of them will be returned instead. If *sign* is</span>
<span class="sd">              specified, returns [bool] or [set] (if ``sources=True``)</span>
<span class="sd">              of that specific direction and sign.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">sources</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>

                <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]]</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>

                <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]]</span></div>

<div class="viewcode-block" id="Direction.unset_sign"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.unset_sign">[docs]</a>    <span class="k">def</span> <span class="nf">unset_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes sign and/or source information of the specified</span>
<span class="sd">        *direction* and *sign*. Modifies attribute *positive* and</span>
<span class="sd">        *positive_sources* or *negative* and *negative_sources* (or</span>
<span class="sd">        *positive_sources*/*negative_sources* only if ``source=True``).</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *direction* [tuple]: The pair of nodes specifying the</span>
<span class="sd">              directionality from which the information is to be</span>
<span class="sd">              removed.</span>
<span class="sd">            - *sign* [str]: Sign from which the information is to be</span>
<span class="sd">              removed. Must be either ``&#39;positive&#39;`` or ``&#39;negative&#39;``.</span>
<span class="sd">            - *source* [set]: Optional, ``None`` by default. If</span>
<span class="sd">              specified, determines which source(s) is(are) to be</span>
<span class="sd">              removed from the sources in the specified *direction* and</span>
<span class="sd">              *sign*.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="k">try</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>

<span class="c1"># XXX: Not sure if intended or you noticed, but if undirected=True and</span>
<span class="c1">#      self.dirs[&#39;undirected&#39;]=True, the returning list includes &#39;u&#39;.</span>
<div class="viewcode-block" id="Direction.src"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.src">[docs]</a>    <span class="k">def</span> <span class="nf">src</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">undirected</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the name(s) of the source node(s) for each existing</span>
<span class="sd">        direction on the interaction.</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *undirected* [bool]: Optional, ``False`` by default.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [list]: Contains the name(s) for the source node(s). This</span>
<span class="sd">              means if the interaction is bidirectional, the list will</span>
<span class="sd">              contain both identifiers of the edge. If the interaction</span>
<span class="sd">              is undirected, an empty list will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;undirected&#39;</span> <span class="ow">or</span> <span class="n">undirected</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="p">]</span></div>

<span class="c1"># XXX: Similarly, if undirected=True and self.dirs[&#39;undirected&#39;]=True,</span>
<span class="c1">#      the returning list includes &#39;n&#39;.</span>
<div class="viewcode-block" id="Direction.tgt"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.tgt">[docs]</a>    <span class="k">def</span> <span class="nf">tgt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">undirected</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the name(s) of the target node(s) for each existing</span>
<span class="sd">        direction on the interaction.</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *undirected* [bool]: Optional, ``False`` by default.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [list]: Contains the name(s) for the target node(s). This</span>
<span class="sd">              means if the interaction is bidirectional, the list will</span>
<span class="sd">              contain both identifiers of the edge. If the interaction</span>
<span class="sd">              is undirected, an empty list will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;undirected&#39;</span> <span class="ow">or</span> <span class="n">undirected</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="p">]</span></div>

<span class="c1"># FIXME: If the intended behavior of the functions above is to include</span>
<span class="c1">#        &#39;undirected&#39; in the returned list if undirected=True and</span>
<span class="c1">#        self.dirs[&#39;undirected&#39;]=True, then change return by:</span>
<span class="c1">#</span>
<span class="c1">#        `[k[0] if k != &#39;undirected&#39; else k for k, v in iteritems(self.dirs)</span>
<span class="c1">#         if (k != &#39;undirected&#39; or undirected) and v]`</span>
<span class="c1">#</span>
<span class="c1">#        On the other hand, if the intended behavior is that returns an empty</span>
<span class="c1">#        empty list if kwarg undirected=True, then add a simple if/else return</span>

<div class="viewcode-block" id="Direction.src_by_source"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.src_by_source">[docs]</a>    <span class="k">def</span> <span class="nf">src_by_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the name(s) of the source node(s) for each existing</span>
<span class="sd">        direction on the interaction for a specific *source*.</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *source* [str]: Name of the source according to which the</span>
<span class="sd">              information is to be retrieved.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [list]: Contains the name(s) for the source node(s)</span>
<span class="sd">              according to the specified *source*. This means if the</span>
<span class="sd">              interaction is bidirectional, the list will contain both</span>
<span class="sd">              identifiers of the edge. If the specified *source* is not</span>
<span class="sd">              found or invalid, an empty list will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;undirected&#39;</span> <span class="ow">and</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.tgt_by_source"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.tgt_by_source">[docs]</a>    <span class="k">def</span> <span class="nf">tgt_by_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the name(s) of the target node(s) for each existing</span>
<span class="sd">        direction on the interaction for a specific *source*.</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *source* [str]: Name of the source according to which the</span>
<span class="sd">              information is to be retrieved.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [list]: Contains the name(s) for the target node(s)</span>
<span class="sd">              according to the specified *source*. This means if the</span>
<span class="sd">              interaction is bidirectional, the list will contain both</span>
<span class="sd">              identifiers of the edge. If the specified *source* is not</span>
<span class="sd">              found or invalid, an empty list will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;undirected&#39;</span> <span class="ow">and</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.sources_straight"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.sources_straight">[docs]</a>    <span class="k">def</span> <span class="nf">sources_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the list of sources for the straight direction.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [set]: Contains the names of the sources supporting the</span>
<span class="sd">              straight directionality of the edge.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.sources_reverse"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.sources_reverse">[docs]</a>    <span class="k">def</span> <span class="nf">sources_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the list of sources for the reverse direction.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [set]: Contains the names of the sources supporting the</span>
<span class="sd">              reverse directionality of the edge.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.sources_undirected"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.sources_undirected">[docs]</a>    <span class="k">def</span> <span class="nf">sources_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the list of sources without directed information.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [set]: Contains the names of the sources supporting the</span>
<span class="sd">              edge presence but without specific directionality</span>
<span class="sd">              information.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.positive_straight"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.positive_straight">[docs]</a>    <span class="k">def</span> <span class="nf">positive_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the straight directionality is a positive interaction.</span>

<span class="sd">        * Returns</span>
<span class="sd">            - [bool]: ``True`` if there is supporting information on the</span>
<span class="sd">              straight direction of the edge as activation. ``False``</span>
<span class="sd">              otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.positive_reverse"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.positive_reverse">[docs]</a>    <span class="k">def</span> <span class="nf">positive_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the reverse directionality is a positive interaction.</span>

<span class="sd">        * Returns</span>
<span class="sd">            - [bool]: ``True`` if there is supporting information on the</span>
<span class="sd">              reverse direction of the edge as activation. ``False``</span>
<span class="sd">              otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.negative_straight"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.negative_straight">[docs]</a>    <span class="k">def</span> <span class="nf">negative_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the straight directionality is a negative interaction.</span>

<span class="sd">        * Returns</span>
<span class="sd">            - [bool]: ``True`` if there is supporting information on the</span>
<span class="sd">              straight direction of the edge as inhibition. ``False``</span>
<span class="sd">              otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.negative_reverse"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.negative_reverse">[docs]</a>    <span class="k">def</span> <span class="nf">negative_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the reverse directionality is a negative interaction.</span>

<span class="sd">        * Returns</span>
<span class="sd">            - [bool]: ``True`` if there is supporting information on the</span>
<span class="sd">              reverse direction of the edge as inhibition. ``False``</span>
<span class="sd">              otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.negative_sources_straight"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.negative_sources_straight">[docs]</a>    <span class="k">def</span> <span class="nf">negative_sources_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the list of sources for the straight direction and</span>
<span class="sd">        negative sign.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [set]: Contains the names of the sources supporting the</span>
<span class="sd">              straight directionality of the edge with a negative sign.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.negative_sources_reverse"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.negative_sources_reverse">[docs]</a>    <span class="k">def</span> <span class="nf">negative_sources_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the list of sources for the reverse direction and</span>
<span class="sd">        negative sign.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [set]: Contains the names of the sources supporting the</span>
<span class="sd">              reverse directionality of the edge with a negative sign.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.positive_sources_straight"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.positive_sources_straight">[docs]</a>    <span class="k">def</span> <span class="nf">positive_sources_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the list of sources for the straight direction and</span>
<span class="sd">        positive sign.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [set]: Contains the names of the sources supporting the</span>
<span class="sd">              straight directionality of the edge with a positive sign.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.positive_sources_reverse"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.positive_sources_reverse">[docs]</a>    <span class="k">def</span> <span class="nf">positive_sources_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the list of sources for the reverse direction and</span>
<span class="sd">        positive sign.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [set]: Contains the names of the sources supporting the</span>
<span class="sd">              reverse directionality of the edge with a positive sign.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span></div>

<div class="viewcode-block" id="Direction.majority_dir"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.majority_dir">[docs]</a>    <span class="k">def</span> <span class="nf">majority_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Infers which is the major directionality of the edge by number</span>
<span class="sd">        of supporting sources.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [tuple]: Contains the pair of nodes denoting the consensus</span>
<span class="sd">              directionality. If the number of sources on both</span>
<span class="sd">              directions is equal, ``None`` is returned. If there is no</span>
<span class="sd">              directionality information, ``&#39;undirected&#39;``` will be</span>
<span class="sd">              returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]):</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">straight</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;undirected&#39;</span></div>

<div class="viewcode-block" id="Direction.majority_sign"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.majority_sign">[docs]</a>    <span class="k">def</span> <span class="nf">majority_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Infers which is the major sign (activation/inhibition) of the</span>
<span class="sd">        edge by number of supporting sources on both directions.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [dict]: Keys are the node tuples on both directions</span>
<span class="sd">              (straight/reverse) and values can be either ``None`` if</span>
<span class="sd">              that direction has no sign information or a list of</span>
<span class="sd">              two [bool] elements corresponding to majority of positive</span>
<span class="sd">              and majority of negative support. In case both elements of</span>
<span class="sd">              the list are ``True``, this means the number of supporting</span>
<span class="sd">              sources for both signs in that direction is equal.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dirs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{(</span><span class="n">d</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_sign</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">d</span><span class="p">):</span>
                <span class="n">p</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">d</span><span class="p">]])</span>

                <span class="n">result</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Direction.consensus_edges"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.consensus_edges">[docs]</a>    <span class="k">def</span> <span class="nf">consensus_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Infers the consensus edge(s) according to the number of</span>
<span class="sd">        supporting sources. This includes direction and sign attributes.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [list]: Contains the consensus edge(s) along with the</span>
<span class="sd">              consensus sign. If there is no major directionality, both</span>
<span class="sd">              are returned. The structure is as follows:</span>
<span class="sd">              ``[&#39;&lt;source&gt;&#39;, &#39;&lt;target&gt;&#39;, &#39;&lt;(un)directed&gt;&#39;, &#39;&lt;sign&gt;&#39;]``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">majority_dir</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">majority_sign</span><span class="p">()</span>

<span class="c1"># XXX: This case could actually return directly, would save up some time</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;undirected&#39;</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="s1">&#39;undirected&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">dirs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">d</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;directed&#39;</span><span class="p">,</span> <span class="s1">&#39;positive&#39;</span><span class="p">])</span>

<span class="c1"># XXX: Technically, if s[d] is not None, this could be an elif right?</span>
                    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;directed&#39;</span><span class="p">,</span> <span class="s1">&#39;negative&#39;</span><span class="p">])</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;directed&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Direction.merge"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merges current edge with another (if and only if they are the</span>
<span class="sd">        same class and contain the same nodes). Updates the attributes</span>
<span class="sd">        *dirs*, *sources*, *positive*, *negative*, *positive_sources*</span>
<span class="sd">        and *negative_sources*.</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *other* [pypath.main.Direction]: The new edge object to be</span>
<span class="sd">              merged with the current one.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<span class="c1"># XXX: Not best way to check the class. Probably never happens, but there</span>
<span class="c1">#      may be other class out there with the same name</span>
<span class="c1">#      &gt;  if (other.__class__.__name__ == &#39;Direction&#39; and self.check_nodes(</span>
<span class="c1">#                 other.nodes):</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">,</span> <span class="s1">&#39;undirected&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">|</span> <span class="n">other</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

<span class="c1"># XXX: Is there a reason to only update positive with straight and negative only with reverse?</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                                                <span class="o">|</span> <span class="n">other</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                                                <span class="o">|</span> <span class="n">other</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">k</span><span class="p">])</span></div>

<div class="viewcode-block" id="Direction.translate"><a class="viewcode-back" href="../../main.html#pypath.main.Direction.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translates the node names/identifiers according to the</span>
<span class="sd">        dictionary *ids*.</span>

<span class="sd">        * Arguments:</span>
<span class="sd">            - *ids* [dict]: Dictionary containing (at least) the current</span>
<span class="sd">              names of the nodes as keys and their translation as</span>
<span class="sd">              values.</span>

<span class="sd">        * Returns:</span>
<span class="sd">            - [pypath.main.Direction]: The copy of current edge object</span>
<span class="sd">              with translated node names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># new Direction object</span>
        <span class="n">newd</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">ids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

        <span class="c1"># copying directions</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">):</span>
            <span class="n">di</span> <span class="o">=</span> <span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">ids</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="n">k</span>
            <span class="n">newd</span><span class="o">.</span><span class="n">set_dir</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="c1"># copying signs</span>
        <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]:</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">neg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

            <span class="n">newd</span><span class="o">.</span><span class="n">set_sign</span><span class="p">((</span><span class="n">ids</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">ids</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
            <span class="n">newd</span><span class="o">.</span><span class="n">set_sign</span><span class="p">((</span><span class="n">ids</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">ids</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="s1">&#39;negative&#39;</span><span class="p">,</span> <span class="n">neg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">newd</span></div></div>


<span class="k">class</span> <span class="nc">AttrHelper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="n">defaults</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">instance</span><span class="p">,</span>
                 <span class="n">thisDir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">thisSign</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">thisDirSources</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">thisSources</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_thisDir</span> <span class="o">=</span> <span class="s1">&#39;directed&#39;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thisDir</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="n">thisDir</span>
        <span class="c1"># user supplied callback function:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="c1"># special cases #1: by direction/effect</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;DIRECTIONS&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_thisDir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">thisSign</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">_thisDir</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">_thisDir</span><span class="p">][</span><span class="n">thisSign</span><span class="p">]</span>
        <span class="c1"># special cases #2: by source category</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;RESOURCE_CATEGORIES&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">resource_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pathway&#39;</span><span class="p">,</span> <span class="s1">&#39;ptm&#39;</span><span class="p">,</span> <span class="s1">&#39;reaction&#39;</span><span class="p">,</span> <span class="s1">&#39;interaction&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="n">data_formats</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_resources&#39;</span> <span class="o">%</span> <span class="n">resource_type</span><span class="p">)</span> <span class="o">&amp;</span>
                        <span class="n">thisSources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="ow">and</span> \
                            <span class="n">resource_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">resource_type</span><span class="p">]</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">wrtie</span><span class="p">(</span><span class="s1">&#39;No category for </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">thisSources</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="c1"># if value is constant:</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">simpleTypes</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="c1"># if a dictionary given to map some igraph attribute to values:</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;_name&#39;</span><span class="p">]):</span>
                <span class="n">key_attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;_name&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;_name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">key_attr</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;_name&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">key_attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">key_attr</span><span class="p">]</span>
        <span class="c1"># if default value has been given for this attribute:</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="c1"># ultimately, return None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>


<span class="k">class</span> <span class="nc">_NamedVertexSeq</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;_vs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_nodNam&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_nodLab&#39;</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_vs</span><span class="p">,</span> <span class="n">_nodNam</span><span class="p">,</span> <span class="n">_nodLab</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vs</span> <span class="o">=</span> <span class="n">_vs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodNam</span> <span class="o">=</span> <span class="n">_nodNam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodLab</span> <span class="o">=</span> <span class="n">_nodLab</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vs</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">genesymbol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vs</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodLab</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">uniprot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vs</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodNam</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vs</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span>

    <span class="n">gs</span> <span class="o">=</span> <span class="n">genesymbol</span>
    <span class="n">up</span> <span class="o">=</span> <span class="n">uniprot</span>
    <span class="n">vs</span> <span class="o">=</span> <span class="fm">__iter__</span>


<div class="viewcode-block" id="PyPath"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath">[docs]</a><span class="k">class</span> <span class="nc">PyPath</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    * Attributes:</span>
<span class="sd">        - *acsn_effects* []:</span>
<span class="sd">        - *add_genesets* []:</span>
<span class="sd">        - *add_grouped_eattr* []:</span>
<span class="sd">        - *add_grouped_set_eattr* []:</span>
<span class="sd">        - *add_list_eattr* []:</span>
<span class="sd">        - *add_set_eattr* []:</span>
<span class="sd">        - *add_update_edge* []:</span>
<span class="sd">        - *add_update_vertex* []:</span>
<span class="sd">        - *affected_by* []:</span>
<span class="sd">        - *affects* []:</span>
<span class="sd">        - *all_between* []:</span>
<span class="sd">        - *all_neighbours* []:</span>
<span class="sd">        - *apply_list* []:</span>
<span class="sd">        - *apply_negative* []:</span>
<span class="sd">        - *attach_network* []:</span>
<span class="sd">        - *basic_stats* []:</span>
<span class="sd">        - *basic_stats_intergroup* []:</span>
<span class="sd">        - *cancer_drivers_list* []:</span>
<span class="sd">        - *cancer_gene_census_list* []:</span>
<span class="sd">        - *clean_graph* []:</span>
<span class="sd">        - *collapse_by_name* []:</span>
<span class="sd">        - *combine_attr* []:</span>
<span class="sd">        - *communities* []:</span>
<span class="sd">        - *complex_comembership_network* []:</span>
<span class="sd">        - *complexes* []:</span>
<span class="sd">        - *complexes_in_network* []:</span>
<span class="sd">        - *compounds_from_chembl* []:</span>
<span class="sd">        - *consistency* []:</span>
<span class="sd">        - *copy* []:</span>
<span class="sd">        - *copy_edges* []:</span>
<span class="sd">        - *count_sol* []:</span>
<span class="sd">        - *coverage* []:</span>
<span class="sd">        - *curation_effort* []:</span>
<span class="sd">        - *curation_stats* []:</span>
<span class="sd">        - *curation_tab* []:</span>
<span class="sd">        - *curators_work* []:</span>
<span class="sd">        - *databases_similarity* []:</span>
<span class="sd">        - *default_name_type* []:</span>
<span class="sd">        - *degree_dist* []:</span>
<span class="sd">        - *degree_dists* []:</span>
<span class="sd">        - *delete_by_source* []:</span>
<span class="sd">        - *delete_by_taxon* []:</span>
<span class="sd">        - *delete_unknown* []:</span>
<span class="sd">        - *delete_unmapped* []:</span>
<span class="sd">        - *dgenesymbol* []:</span>
<span class="sd">        - *dgenesymbols* []:</span>
<span class="sd">        - *dgs* []:</span>
<span class="sd">        - *dgss* []:</span>
<span class="sd">        - *disease_genes_list* []:</span>
<span class="sd">        - *dneighbors* []:</span>
<span class="sd">        - *dp* []:</span>
<span class="sd">        - *dproteins* []:</span>
<span class="sd">        - *dps* []:</span>
<span class="sd">        - *druggability_list* []:</span>
<span class="sd">        - *duniprot* []:</span>
<span class="sd">        - *duniprots* []:</span>
<span class="sd">        - *dup* []:</span>
<span class="sd">        - *dups* []:</span>
<span class="sd">        - *dv* []:</span>
<span class="sd">        - *dvs* []:</span>
<span class="sd">        - *edge_exists* []:</span>
<span class="sd">        - *edge_loc* []:</span>
<span class="sd">        - *edge_names* []:</span>
<span class="sd">        - *edges_3d* []:</span>
<span class="sd">        - *edges_expression* []:</span>
<span class="sd">        - *edges_in_comlexes* []:</span>
<span class="sd">        - *edges_ptms* []:</span>
<span class="sd">        - *edgeseq_inverse* []:</span>
<span class="sd">        - *export_dot* []:</span>
<span class="sd">        - *export_edgelist* []:</span>
<span class="sd">        - *export_graphml* []:</span>
<span class="sd">        - *export_ptms_tab* []:</span>
<span class="sd">        - *export_sif* []:</span>
<span class="sd">        - *export_struct_tab* []:</span>
<span class="sd">        - *export_tab* []:</span>
<span class="sd">        - *filters* []:</span>
<span class="sd">        - *find_all_paths* []:</span>
<span class="sd">        - *find_all_paths2* []:</span>
<span class="sd">        - *find_complex* []:</span>
<span class="sd">        - *first_neighbours* []:</span>
<span class="sd">        - *fisher_enrichment* []:</span>
<span class="sd">        - *geneset_enrichment* []:</span>
<span class="sd">        - *genesymbol* []:</span>
<span class="sd">        - *genesymbol_labels* []:</span>
<span class="sd">        - *genesymbols* []:</span>
<span class="sd">        - *get_attrs* []:</span>
<span class="sd">        - *get_directed* []:</span>
<span class="sd">        - *get_dirs_signs* []:</span>
<span class="sd">        - *get_edge* []:</span>
<span class="sd">        - *get_edges* []:</span>
<span class="sd">        - *get_function* []:</span>
<span class="sd">        - *get_giant* []:</span>
<span class="sd">        - *get_max* []:</span>
<span class="sd">        - *get_network* []:</span>
<span class="sd">        - *get_node* []:</span>
<span class="sd">        - *get_node_d* []:</span>
<span class="sd">        - *get_node_pair* []:</span>
<span class="sd">        - *get_nodes* []:</span>
<span class="sd">        - *get_nodes_d* []:</span>
<span class="sd">        - *get_pathways* []:</span>
<span class="sd">        - *get_proteomicsdb* []:</span>
<span class="sd">        - *get_sub* []:</span>
<span class="sd">        - *get_taxon* []:</span>
<span class="sd">        - *go_annotate* []:</span>
<span class="sd">        - *go_dict* []:</span>
<span class="sd">        - *go_enrichment* []:</span>
<span class="sd">        - *gs* []:</span>
<span class="sd">        - *gs_affected_by* []:</span>
<span class="sd">        - *gs_affects* []:</span>
<span class="sd">        - *gs_edge* []:</span>
<span class="sd">        - *gs_in_directed* []:</span>
<span class="sd">        - *gs_in_undirected* []:</span>
<span class="sd">        - *gs_inhibited_by* []:</span>
<span class="sd">        - *gs_inhibits* []:</span>
<span class="sd">        - *gs_neighborhood* []:</span>
<span class="sd">        - *gs_neighbors* []:</span>
<span class="sd">        - *gs_stimulated_by* []:</span>
<span class="sd">        - *gs_stimulates* []:</span>
<span class="sd">        - *gss* []:</span>
<span class="sd">        - *guide2pharma* []:</span>
<span class="sd">        - *having_attr* []:</span>
<span class="sd">        - *having_eattr* []:</span>
<span class="sd">        - *having_ptm* []:</span>
<span class="sd">        - *having_vattr* []:</span>
<span class="sd">        - *homology_translation* []:</span>
<span class="sd">        - *htp_stats* []:</span>
<span class="sd">        - *in_complex* []:</span>
<span class="sd">        - *in_directed* []:</span>
<span class="sd">        - *in_undirected* []:</span>
<span class="sd">        - *info* []:</span>
<span class="sd">        - *init_complex_attr* []:</span>
<span class="sd">        - *init_edge_attr* []:</span>
<span class="sd">        - *init_gsea* []:</span>
<span class="sd">        - *init_network* []:</span>
<span class="sd">        - *init_vertex_attr* []:</span>
<span class="sd">        - *intergroup_shortest_paths* []:</span>
<span class="sd">        - *intogen_cancer_drivers_list* []:</span>
<span class="sd">        - *jaccard_edges* []:</span>
<span class="sd">        - *jaccard_meta* []:</span>
<span class="sd">        - *kegg_directions* []:</span>
<span class="sd">        - *kegg_pathways* []:</span>
<span class="sd">        - *kinase_stats* []:</span>
<span class="sd">        - *kinases_list* []:</span>
<span class="sd">        - *label_by_go* []:</span>
<span class="sd">        - *laudanna_directions* []:</span>
<span class="sd">        - *laudanna_effects* []:</span>
<span class="sd">        - *licence* []:</span>
<span class="sd">        - *list_resources* []:</span>
<span class="sd">        - *load_3dcomplexes* []:</span>
<span class="sd">        - *load_3did_ddi* []:</span>
<span class="sd">        - *load_3did_ddi2* []:</span>
<span class="sd">        - *load_3did_dmi* []:</span>
<span class="sd">        - *load_3did_interfaces* []:</span>
<span class="sd">        - *load_all_pathways* []:</span>
<span class="sd">        - *load_compleat* []:</span>
<span class="sd">        - *load_complexportal* []:</span>
<span class="sd">        - *load_comppi* []:</span>
<span class="sd">        - *load_corum* []:</span>
<span class="sd">        - *load_dbptm* []:</span>
<span class="sd">        - *load_ddi* []:</span>
<span class="sd">        - *load_ddis* []:</span>
<span class="sd">        - *load_depod_dmi* []:</span>
<span class="sd">        - *load_disgenet* []:</span>
<span class="sd">        - *load_dmi* []:</span>
<span class="sd">        - *load_dmis* []:</span>
<span class="sd">        - *load_domino_dmi* []:</span>
<span class="sd">        - *load_elm* []:</span>
<span class="sd">        - *load_expression* []:</span>
<span class="sd">        - *load_go* []:</span>
<span class="sd">        - *load_havugimana* []:</span>
<span class="sd">        - *load_hpa* []:</span>
<span class="sd">        - *load_hprd_ptms* []:</span>
<span class="sd">        - *load_ielm* []:</span>
<span class="sd">        - *load_interfaces* []:</span>
<span class="sd">        - *load_li2012_ptms* []:</span>
<span class="sd">        - *load_ligand_receptor_network* []:</span>
<span class="sd">        - *load_list* []:</span>
<span class="sd">        - *load_lmpid* []:</span>
<span class="sd">        - *load_mappings* []:</span>
<span class="sd">        - *load_mimp_dmi* []:</span>
<span class="sd">        - *load_mutations* []:</span>
<span class="sd">        - *load_negatives* []:</span>
<span class="sd">        - *load_old_omnipath* []:</span>
<span class="sd">        - *load_omnipath* []:</span>
<span class="sd">        - *load_pathways* []:</span>
<span class="sd">        - *load_pdb* []:</span>
<span class="sd">        - *load_pepcyber* []:</span>
<span class="sd">        - *load_pfam* []:</span>
<span class="sd">        - *load_pfam2* []:</span>
<span class="sd">        - *load_pfam3* []:</span>
<span class="sd">        - *load_phospho_dmi* []:</span>
<span class="sd">        - *load_phosphoelm* []:</span>
<span class="sd">        - *load_pisa* []:</span>
<span class="sd">        - *load_pnetworks_dmi* []:</span>
<span class="sd">        - *load_psite_phos* []:</span>
<span class="sd">        - *load_psite_reg* []:</span>
<span class="sd">        - *load_ptms* []:</span>
<span class="sd">        - *load_ptms2* []:</span>
<span class="sd">        - *load_reflist* []:</span>
<span class="sd">        - *load_reflists* []:</span>
<span class="sd">        - *load_resource* []:</span>
<span class="sd">        - *load_resources* []:</span>
<span class="sd">        - *load_signor_ptms* []:</span>
<span class="sd">        - *load_tfregulons* []:</span>
<span class="sd">        - *lookup_cache* []:</span>
<span class="sd">        - *loop_edges* []:</span>
<span class="sd">        - *map_edge* []:</span>
<span class="sd">        - *map_item* []:</span>
<span class="sd">        - *map_list* []:</span>
<span class="sd">        - *mean_reference_per_interaction* []:</span>
<span class="sd">        - *merge_lists* []:</span>
<span class="sd">        - *merge_nodes* []:</span>
<span class="sd">        - *mimp_directions* []:</span>
<span class="sd">        - *mutated_edges* []:</span>
<span class="sd">        - *names2vids* []:</span>
<span class="sd">        - *negative_report* []:</span>
<span class="sd">        - *neighborhood* []:</span>
<span class="sd">        - *neighbors* []:</span>
<span class="sd">        - *neighbourhood_network* []:</span>
<span class="sd">        - *network_filter* []:</span>
<span class="sd">        - *network_stats* []:</span>
<span class="sd">        - *new_edges* []:</span>
<span class="sd">        - *new_nodes* []:</span>
<span class="sd">        - *node_exists* []:</span>
<span class="sd">        - *numof_directed_edges* []:</span>
<span class="sd">        - *numof_reference_interaction_pairs* []:</span>
<span class="sd">        - *numof_references* []:</span>
<span class="sd">        - *numof_undirected_edges* []:</span>
<span class="sd">        - *orthology_translation* []:</span>
<span class="sd">        - *p* []:</span>
<span class="sd">        - *pathway_attributes* []:</span>
<span class="sd">        - *pathway_members* []:</span>
<span class="sd">        - *pathway_names* []:</span>
<span class="sd">        - *pathway_similarity* []:</span>
<span class="sd">        - *pathways_table* []:</span>
<span class="sd">        - *pfam_regions* []:</span>
<span class="sd">        - *phosphonetworks_directions* []:</span>
<span class="sd">        - *phosphopoint_directions* []:</span>
<span class="sd">        - *phosphorylation_directions* []:</span>
<span class="sd">        - *phosphorylation_signs* []:</span>
<span class="sd">        - *phosphosite_directions* []:</span>
<span class="sd">        - *prdb_tissue_expr* []:</span>
<span class="sd">        - *process_direction* []:</span>
<span class="sd">        - *process_directions* []:</span>
<span class="sd">        - *process_dmi* []:</span>
<span class="sd">        - *process_sign* []:</span>
<span class="sd">        - *protein* []:</span>
<span class="sd">        - *protein_edge* []:</span>
<span class="sd">        - *proteins* []:</span>
<span class="sd">        - *proteome_list* []:</span>
<span class="sd">        - *ps* []:</span>
<span class="sd">        - *random_walk_with_return* []:</span>
<span class="sd">        - *random_walk_with_return2* []:</span>
<span class="sd">        - *read_data_file* []:</span>
<span class="sd">        - *read_from_cache* []:</span>
<span class="sd">        - *read_list_file* []:</span>
<span class="sd">        - *receptors_list* []:</span>
<span class="sd">        - *reference_edge_ratio* []:</span>
<span class="sd">        - *reference_hist* []:</span>
<span class="sd">        - *reload* []:</span>
<span class="sd">        - *remove_htp* []:</span>
<span class="sd">        - *remove_undirected* []:</span>
<span class="sd">        - *run_batch* []:</span>
<span class="sd">        - *save_network* []:</span>
<span class="sd">        - *save_session* []:</span>
<span class="sd">        - *search_attr_and* []:</span>
<span class="sd">        - *search_attr_or* []:</span>
<span class="sd">        - *second_neighbours* []:</span>
<span class="sd">        - *select_by_go* []:</span>
<span class="sd">        - *separate* []:</span>
<span class="sd">        - *separate_by_category* []:</span>
<span class="sd">        - *sequences* []:</span>
<span class="sd">        - *set_boolean_vattr* []:</span>
<span class="sd">        - *set_categories* []:</span>
<span class="sd">        - *set_chembl_mysql* []:</span>
<span class="sd">        - *set_disease_genes* []:</span>
<span class="sd">        - *set_druggability* []:</span>
<span class="sd">        - *set_drugtargets* []:</span>
<span class="sd">        - *set_kinases* []:</span>
<span class="sd">        - *set_receptors* []:</span>
<span class="sd">        - *set_signaling_proteins* []:</span>
<span class="sd">        - *set_tfs* []:</span>
<span class="sd">        - *set_transcription_factors* []:</span>
<span class="sd">        - *shortest_path_dist* []:</span>
<span class="sd">        - *signaling_proteins_list* []:</span>
<span class="sd">        - *signor_pathways* []:</span>
<span class="sd">        - *similarity_groups* []:</span>
<span class="sd">        - *small_plot* []:</span>
<span class="sd">        - *sorensen_pathways* []:</span>
<span class="sd">        - *source_diagram* []:</span>
<span class="sd">        - *source_network* []:</span>
<span class="sd">        - *source_similarity* []:</span>
<span class="sd">        - *source_stats* []:</span>
<span class="sd">        - *sources_hist* []:</span>
<span class="sd">        - *sources_overlap* []:</span>
<span class="sd">        - *sources_venn_data* []:</span>
<span class="sd">        - *straight_between* []:</span>
<span class="sd">        - *string_effects* []:</span>
<span class="sd">        - *sum_in_complex* []:</span>
<span class="sd">        - *table_latex* []:</span>
<span class="sd">        - *tfs_list* []:</span>
<span class="sd">        - *third_source_directions* []:</span>
<span class="sd">        - *tissue_network* []:</span>
<span class="sd">        - *transcription_factors* []:</span>
<span class="sd">        - *translate_refsdir* []:</span>
<span class="sd">        - *uniprot* []:</span>
<span class="sd">        - *uniprots* []:</span>
<span class="sd">        - *uniq_node_list* []:</span>
<span class="sd">        - *uniq_ptm* []:</span>
<span class="sd">        - *uniq_ptms* []:</span>
<span class="sd">        - *up* []:</span>
<span class="sd">        - *up_affected_by* []:</span>
<span class="sd">        - *up_affects* []:</span>
<span class="sd">        - *up_edge* []:</span>
<span class="sd">        - *up_in_directed* []:</span>
<span class="sd">        - *up_in_undirected* []:</span>
<span class="sd">        - *up_inhibited_by* []:</span>
<span class="sd">        - *up_inhibits* []:</span>
<span class="sd">        - *up_neighborhood* []:</span>
<span class="sd">        - *up_neighbors* []:</span>
<span class="sd">        - *up_stimulated_by* []:</span>
<span class="sd">        - *up_stimulates* []:</span>
<span class="sd">        - *update_adjlist* []:</span>
<span class="sd">        - *update_attrs* []:</span>
<span class="sd">        - *update_cats* []:</span>
<span class="sd">        - *update_db_dict* []:</span>
<span class="sd">        - *update_pathway_types* []:</span>
<span class="sd">        - *update_pathways* []:</span>
<span class="sd">        - *update_sources* []:</span>
<span class="sd">        - *update_vertex_sources* []:</span>
<span class="sd">        - *update_vindex* []:</span>
<span class="sd">        - *update_vname* []:</span>
<span class="sd">        - *ups* []:</span>
<span class="sd">        - *v* []:</span>
<span class="sd">        - *vertex_pathways* []:</span>
<span class="sd">        - *vs* []:</span>
<span class="sd">        - *vsgs* []:</span>
<span class="sd">        - *vsup* []:</span>
<span class="sd">        - *wang_effects* []:</span>
<span class="sd">        - *write_table* []:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">###</span>
    <span class="c1"># main network object</span>
    <span class="c1">###</span>

    <span class="n">default_name_type</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;protein&#39;</span><span class="p">:</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mirna&#39;</span><span class="p">:</span> <span class="s1">&#39;mirbase&#39;</span><span class="p">,</span>
        <span class="s1">&#39;drug&#39;</span><span class="p">:</span> <span class="s1">&#39;chembl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;lncrna&#39;</span><span class="p">:</span> <span class="s1">&#39;lncrna-genesymbol&#39;</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">ncbi_tax_id</span><span class="o">=</span><span class="mi">9606</span><span class="p">,</span>
                 <span class="n">default_name_type</span><span class="o">=</span><span class="n">default_name_type</span><span class="p">,</span>
                 <span class="n">copy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">mysql</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;mapping&#39;</span><span class="p">),</span>
                 <span class="n">chembl_mysql</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;chembl&#39;</span><span class="p">),</span>
                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;unnamed&#39;</span><span class="p">,</span>
                 <span class="n">outdir</span><span class="o">=</span><span class="s1">&#39;results&#39;</span><span class="p">,</span>
                 <span class="n">loglevel</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
                 <span class="n">loops</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Currently only one organism molecular interaction networks</span>
<span class="sd">        are supported. Some functions supports multi-species networks,</span>
<span class="sd">        and maybe once the whole module will support that.</span>

<span class="sd">        @ncbi_tax_id : int</span>
<span class="sd">            The ID of the organism in NCBI Taxonomy. Defaults to human</span>
<span class="sd">            (9606).</span>
<span class="sd">        @mysql</span>
<span class="sd">            The MySQL parameter used by the mapping module to load some</span>
<span class="sd">            ID conversion tables from MySQL.</span>
<span class="sd">        @default_name_type : dict</span>
<span class="sd">            Dictionary of default ID types, what all identifiers of the</span>
<span class="sd">            given molecular species should be converted to. By default,</span>
<span class="sd">            for protein it is UniProt. It could be any other, only then</span>
<span class="sd">            you need to supply the required format definitions for the</span>
<span class="sd">            ID conversion tables.</span>
<span class="sd">        @copy : BioGraph object</span>
<span class="sd">            In case you copy an other instance.</span>
<span class="sd">        @name : str</span>
<span class="sd">            This is a custom session/project name.</span>
<span class="sd">        @outdir : str</span>
<span class="sd">            The directory where you wish to create all the output files.</span>
<span class="sd">        @loglevel : str</span>
<span class="sd">            Passed to logging module.</span>
<span class="sd">        @loops : bool</span>
<span class="sd">            Whether to allow loop edges in the graph. Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__version__</span> <span class="o">=</span> <span class="n">_version</span><span class="o">.</span><span class="n">__version__</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;cache&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">copy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;entity_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;ncbi_tax_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ncbi_tax_id</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;nameType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;originalNames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;ncbi_tax_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;refs_by_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;refs_by_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;sources_by_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;negative_refs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;layout_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;layout_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;only_directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># allow loop edges in the graph</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loops</span> <span class="o">=</span> <span class="n">loops</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">failed_edges</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uniprot_mapped</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mysql_conf</span> <span class="o">=</span> <span class="n">mysql</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_chembl_mysql</span><span class="p">(</span><span class="n">chembl_mysql</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chembl_mysql</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># self.mysql = mysql.MysqlRunner(self.mysql_conf)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unmapped</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="o">=</span> <span class="n">outdir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">ncbi_tax_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">negatives</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lists</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plots</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proteomicsdb</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exp_samples</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_cats</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathway_types</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathways</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">palette</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;#6EA945&#39;</span><span class="p">,</span> <span class="s1">&#39;#007B7F&#39;</span><span class="p">,</span> <span class="s1">&#39;#FCCC06&#39;</span><span class="p">,</span> <span class="s1">&#39;#DA0025&#39;</span><span class="p">,</span> <span class="s1">&#39;#000000&#39;</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">gen_session_id</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span> <span class="o">=</span> <span class="n">loglevel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span> <span class="o">=</span> <span class="n">logn</span><span class="o">.</span><span class="n">logw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">Mapper</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span> <span class="n">mysql_conf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mysql_conf</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disclaimer</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">=== d i s c l a i m e r ===</span><span class="se">\n\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">All data coming with this module</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">either as redistributed copy or downloaded using the</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">programmatic interfaces included in the present module</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">are available under public domain, are free to use at</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">least for academic research or education purposes.</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Please be aware of the licences of all the datasets</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">you use in your analysis, and please give appropriate</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">credits for the original sources when you publish your</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">results. To find out more about data sources please</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">look at `pypath.descriptions` and</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">`pypath.data_formats.urls`.</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">licence</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;PyPath has been initialized&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Beginning session &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;\t&gt; New session started,\n\tsession ID: &#39;%s&#39;\n\tlogfile: &quot;&quot;&quot;</span>
                <span class="sd">&quot;&quot;&quot;&#39;./%s&#39;\n\tpypath version: %s\n&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">_version</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy</span><span class="p">)</span>

<div class="viewcode-block" id="PyPath.set_chembl_mysql"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.set_chembl_mysql">[docs]</a>    <span class="k">def</span> <span class="nf">set_chembl_mysql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">config_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the ChEMBL MySQL config according to</span>
<span class="sd">        `title` section in `config_file` ini style config.</span>

<span class="sd">            title (str): section title in ini file</span>
<span class="sd">            config_file (str, NoneType): config file name;</span>
<span class="sd">                if None, the `mysql_config/defaults.mysql`</span>
<span class="sd">                will be used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chembl_mysql</span> <span class="o">=</span> <span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Reinitialized&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="PyPath.init_network"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.init_network">[docs]</a>    <span class="k">def</span> <span class="nf">init_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">lst</span><span class="o">=</span><span class="n">omnipath</span><span class="p">,</span>
                     <span class="n">exclude</span><span class="o">=</span><span class="p">[],</span>
                     <span class="n">cache_files</span><span class="o">=</span><span class="p">{},</span>
                     <span class="n">pfile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">reread</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">redownload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a lazy way to start the module, load data</span>
<span class="sd">        and build the high confidence, literature curated</span>
<span class="sd">        part of the signaling network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pfile</span><span class="p">:</span>
            <span class="n">pfile</span> <span class="o">=</span> <span class="n">pfile</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pfile</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> \
                <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;default_network.pickle&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pfile</span><span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Loading igraph object from file `</span><span class="si">%s</span><span class="s1">`...&#39;</span> <span class="o">%</span> <span class="n">pfile</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">graph</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">pfile</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="p">)</span> <span class="ow">and</span> <span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="s1">&#39;</span><span class="se">\r</span><span class="si">%s</span><span class="se">\r\t</span><span class="s1">:: Network loaded from `</span><span class="si">%s</span><span class="s1">`. </span><span class="si">%u</span><span class="s1"> nodes, &#39;</span>
                        <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> edges.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">90</span><span class="p">,</span> <span class="n">pfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">()))</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_vindex</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
                    <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_reflists</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_resources</span><span class="p">(</span>
            <span class="n">lst</span><span class="o">=</span><span class="n">lst</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">reread</span><span class="o">=</span><span class="n">reread</span><span class="p">,</span> <span class="n">redownload</span><span class="o">=</span><span class="n">redownload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Saving igraph object to file `</span><span class="si">%s</span><span class="s1">`...&#39;</span> <span class="o">%</span>
                             <span class="n">pfile</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_network</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\r</span><span class="si">%s</span><span class="se">\r\t</span><span class="s1">:: Network saved successfully to file `</span><span class="si">%s</span><span class="s1">`.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                <span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">90</span><span class="p">,</span> <span class="n">pfile</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">save_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">pfile</span> <span class="o">=</span> <span class="n">pfile</span> <span class="k">if</span> <span class="n">pfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
            <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;default_network.pickle&#39;</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">pfile</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">###</span>
    <span class="c1"># functions to read networks from text files or mysql</span>
    <span class="c1">###</span>

    <span class="k">def</span> <span class="nf">get_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrList</span><span class="p">):</span>
        <span class="n">maxC</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attrList</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">maxC</span><span class="p">:</span>
                <span class="n">maxC</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">maxC</span>

    <span class="k">def</span> <span class="nf">get_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">lnum</span><span class="p">):</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># extraEdgeAttrs and extraNodeAttrs are dicts</span>
            <span class="c1"># of additional parameters assigned to edges and nodes respectively;</span>
            <span class="c1"># key is the name of the parameter, value is the col number,</span>
            <span class="c1"># or a tuple of col number and the separator,</span>
            <span class="c1"># if the column contains additional subfields e.g. (5, &quot;;&quot;)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
                        <span class="n">fieldVal</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">1</span><span class="p">](</span><span class="n">line</span><span class="p">[</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fieldVal</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fieldVal</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">]]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;Wrong column index (%s) in extra attributes?</span>
<span class="sd">                    Line #%u\n&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> <span class="n">lnum</span><span class="p">)),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">readError</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>
            <span class="n">fieldName</span> <span class="o">=</span> <span class="n">col</span>
            <span class="n">attrs</span><span class="p">[</span><span class="n">fieldName</span><span class="p">]</span> <span class="o">=</span> <span class="n">fieldVal</span>
        <span class="k">return</span> <span class="n">attrs</span>

    <span class="k">def</span> <span class="nf">get_taxon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tax_dict</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;A&#39;</span> <span class="ow">in</span> <span class="n">tax_dict</span> <span class="ow">and</span> <span class="s1">&#39;B&#39;</span> <span class="ow">in</span> <span class="n">tax_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_taxon</span><span class="p">(</span><span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_taxon</span><span class="p">(</span><span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;dict&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tax_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]])</span>
            <span class="k">elif</span> <span class="n">fields</span><span class="p">[</span><span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]]</span> <span class="ow">in</span> <span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;dict&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;dict&#39;</span><span class="p">][</span><span class="n">fields</span><span class="p">[</span><span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">numof_references</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span>
                <span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">)))))</span>

    <span class="k">def</span> <span class="nf">mean_reference_per_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">numof_reference_interaction_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span>
                     <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span>
                              <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">])),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">)))))</span>

    <span class="k">def</span> <span class="nf">curators_work</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">curation_effort</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numof_reference_interaction_pairs</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Curators worked </span><span class="si">%.01f</span><span class="s1">-</span><span class="si">%.01f</span><span class="s1"> years to accomplish &#39;</span>
            <span class="s1">&#39;what currently you have incorporated in this network!&#39;</span>
            <span class="s1">&#39;</span><span class="se">\n\n\t</span><span class="s1">Amazing, isn</span><span class="se">\&#39;</span><span class="s1">t it?</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">curation_effort</span> <span class="o">*</span> <span class="mi">15</span> <span class="o">/</span> <span class="mf">60.0</span> <span class="o">/</span> <span class="mf">2087.0</span><span class="p">,</span>
             <span class="n">curation_effort</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">/</span> <span class="mf">60.0</span> <span class="o">/</span> <span class="mf">2087.0</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reference_edge_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">numof_references</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())</span>

<div class="viewcode-block" id="PyPath.get_giant"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.get_giant">[docs]</a>    <span class="k">def</span> <span class="nf">get_giant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the giant component of the graph, or</span>
<span class="sd">        replaces the igraph object with only the giant</span>
<span class="sd">        component.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">gg</span> <span class="o">=</span> <span class="n">g</span> <span class="k">if</span> <span class="n">replace</span> <span class="k">else</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">cl</span> <span class="o">=</span> <span class="n">gg</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;WEAK&#39;</span><span class="p">)</span>
        <span class="n">cl_sizes</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">sizes</span><span class="p">()</span>
        <span class="n">giant_component_index</span> <span class="o">=</span> <span class="n">cl_sizes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cl_sizes</span><span class="p">))</span>
        <span class="n">in_giant</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">==</span> <span class="n">giant_component_index</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cl</span><span class="o">.</span><span class="n">membership</span><span class="p">]</span>
        <span class="n">common</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;:: Nodes in giant component: </span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span>
                       <span class="n">in_giant</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gg</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">in_giant</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">gg</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span>
        <span class="n">common</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;:: Giant component size: </span><span class="si">%u</span><span class="s1"> edges, </span><span class="si">%u</span><span class="s1"> nodes&#39;</span> <span class="o">%</span>
                       <span class="p">(</span><span class="n">gg</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> <span class="n">gg</span><span class="o">.</span><span class="n">vcount</span><span class="p">()))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">replace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gg</span></div>

<div class="viewcode-block" id="PyPath.update_vname"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.update_vname">[docs]</a>    <span class="k">def</span> <span class="nf">update_vname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For fast lookup of node names and indexes, these are</span>
<span class="sd">        hold in a list and a dict as well. However, every time</span>
<span class="sd">        new nodes are added, these should be updated. This</span>
<span class="sd">        function is automatically called after all operations</span>
<span class="sd">        affecting node indices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_undirected</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_already_has_directed</span><span class="p">()</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span>
        <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labDct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()),</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()),</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">dgraph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dnodInd</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">xrange</span><span class="p">(</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">xrange</span><span class="p">(</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="n">xrange</span><span class="p">(</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()),</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="n">xrange</span><span class="p">(</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()),</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]))</span></div>

    <span class="k">def</span> <span class="nf">vsgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span><span class="o">.</span><span class="n">gs</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">vsup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span><span class="o">.</span><span class="n">gs</span><span class="p">()</span>

<div class="viewcode-block" id="PyPath.update_vindex"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.update_vindex">[docs]</a>    <span class="k">def</span> <span class="nf">update_vindex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is deprecated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="PyPath.vertex_pathways"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.vertex_pathways">[docs]</a>    <span class="k">def</span> <span class="nf">vertex_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Some resources assignes interactions some others</span>
<span class="sd">        proteins to pathways.</span>
<span class="sd">        This function converts pathway annotations from</span>
<span class="sd">        edge attributes to vertex attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">eattr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">eattr</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;pathways&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">eattr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">positiveFilters</span><span class="o">=</span><span class="p">[],</span> <span class="n">negativeFilters</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">for</span> <span class="n">filtr</span> <span class="ow">in</span> <span class="n">negativeFilters</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">sep</span> <span class="o">=</span> <span class="n">filtr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">thisVal</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">filtr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisVal</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">line</span><span class="p">[</span><span class="n">filtr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>
            <span class="n">filtrVal</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">filtr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                           <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filtr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">filtr</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thisVal</span> <span class="o">&amp;</span> <span class="n">filtrVal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">filtr</span> <span class="ow">in</span> <span class="n">positiveFilters</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">sep</span> <span class="o">=</span> <span class="n">filtr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">thisVal</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">filtr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisVal</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">line</span><span class="p">[</span><span class="n">filtr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>
            <span class="n">filtrVal</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">filtr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                           <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filtr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">filtr</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thisVal</span> <span class="o">&amp;</span> <span class="n">filtrVal</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">lookup_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">cache_files</span><span class="p">,</span> <span class="n">int_cache</span><span class="p">,</span> <span class="n">edges_cache</span><span class="p">):</span>
        <span class="n">infile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">edgeListMapped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cache_file</span> <span class="o">=</span> <span class="n">cache_files</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cache_files</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">cache_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_file</span><span class="p">):</span>
            <span class="n">cache_type</span> <span class="o">=</span> <span class="n">cache_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cache_type</span> <span class="o">==</span> <span class="s1">&#39;interactions&#39;</span><span class="p">:</span>
                <span class="n">infile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_from_cache</span><span class="p">(</span><span class="n">int_cache</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cache_type</span> <span class="o">==</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span>
                <span class="n">edgeListMapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_from_cache</span><span class="p">(</span><span class="n">edges_cache</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">edges_cache</span><span class="p">):</span>
            <span class="n">edgeListMapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_from_cache</span><span class="p">(</span><span class="n">edges_cache</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">int_cache</span><span class="p">):</span>
                <span class="n">infile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_from_cache</span><span class="p">(</span><span class="n">int_cache</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">infile</span><span class="p">,</span> <span class="n">edgeListMapped</span>

    <span class="k">def</span> <span class="nf">read_from_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_file</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Reading from cache: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cache_file</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Data have been read from cache: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cache_file</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">cache_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">process_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signData</span><span class="p">,</span> <span class="n">signDef</span><span class="p">):</span>
        <span class="n">stim</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">inh</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">signSep</span> <span class="o">=</span> <span class="n">signDef</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">signDef</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">signData</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">signData</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">signSep</span><span class="p">))</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">signDef</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signDef</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">signDef</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">neg</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">signDef</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signDef</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">signDef</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">signData</span> <span class="o">&amp;</span> <span class="n">pos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stim</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">signData</span> <span class="o">&amp;</span> <span class="n">neg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inh</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">stim</span><span class="p">,</span> <span class="n">inh</span>

    <span class="k">def</span> <span class="nf">process_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">dirCol</span><span class="p">,</span> <span class="n">dirVal</span><span class="p">,</span> <span class="n">dirSep</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dirCol</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dirVal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thisDir</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">dirCol</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">dirSep</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">thisDir</span> <span class="o">&amp;</span> <span class="n">dirVal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

<div class="viewcode-block" id="PyPath.read_data_file"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.read_data_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">settings</span><span class="p">,</span>
                       <span class="n">keep_raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">cache_files</span><span class="o">=</span><span class="p">{},</span>
                       <span class="n">reread</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">redownload</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interaction data with node and edge attributes can be read</span>
<span class="sd">        from simple text based files. This function works not only</span>
<span class="sd">        with files, but with lists as well. Any other function can</span>
<span class="sd">        be written to download a preprocess data, and then give it</span>
<span class="sd">        to this function to finally attach to the network.</span>

<span class="sd">        @settings : ReadSettings instance</span>
<span class="sd">            The detailed definition of the input format. Instead of</span>
<span class="sd">            the file name you can give a function name, which will</span>
<span class="sd">            be executed, and the returned data will be used.</span>
<span class="sd">        @keep_raw : boolean</span>
<span class="sd">            To keep the raw data read by this function, in order for</span>
<span class="sd">            debugging purposes, or further use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">listLike</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">])</span>
        <span class="n">edgeList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nodeList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">edgeListMapped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">infile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">_name</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">int_cache</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.interactions.pickle&#39;</span> <span class="o">%</span> <span class="n">_name</span><span class="p">)</span>
        <span class="n">edges_cache</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.edges.pickle&#39;</span> <span class="o">%</span> <span class="n">_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">reread</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">redownload</span><span class="p">:</span>
            <span class="n">infile</span><span class="p">,</span> <span class="n">edgeListMapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup_cache</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">cache_files</span><span class="p">,</span>
                                                       <span class="n">int_cache</span><span class="p">,</span> <span class="n">edges_cache</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgeListMapped</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">infile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;ReadSettings&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span>
                        <span class="sd">&quot;&quot;&quot;No proper input file definition!\n\&#39;settings\&#39;</span>
<span class="sd">                        should be a \&#39;ReadSettings\&#39; instance\n&quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">huge</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Processing </span><span class="si">%s</span><span class="s1"> requires huge memory.</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Please hit `y` if you have at least 2G free memory,</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">or `n` to omit </span><span class="si">%s</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">After processing once, it will be saved in </span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1">, so next time can be loaded quickly.</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Process </span><span class="si">%s</span><span class="s1"> now? [y/n]</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">edges_cache</span><span class="p">,</span>
                         <span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">answer</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">None</span>
                        <span class="k">elif</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Please answer `y` or `n`:</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">inputFunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inputFunc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">):</span>
                    <span class="n">inputFunc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span>
                <span class="c1"># reading from remote or local file, or executing import</span>
                <span class="c1"># function:</span>
                <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                        <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ftp&#39;</span><span class="p">):</span>
                    <span class="n">curl_use_cache</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">redownload</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">curl</span><span class="o">.</span><span class="n">Curl</span><span class="p">(</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">,</span>
                        <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">large</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">cache</span><span class="o">=</span><span class="n">curl_use_cache</span><span class="p">)</span>
                    <span class="n">infile</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bytes</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">infile</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">infile</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;iso-8859-1&#39;</span><span class="p">)</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="n">infile</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">infile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Retrieving data from</span><span class="si">%s</span><span class="s2"> ...&quot;</span> <span class="o">%</span>
                                    <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span>
                <span class="c1"># elif hasattr(dataio, settings.inFile):</span>
                <span class="k">elif</span> <span class="n">inputFunc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Retrieving data by dataio.</span><span class="si">%s</span><span class="s2">() ...&quot;</span> <span class="o">%</span>
                                    <span class="n">inputFunc</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                    <span class="n">_store_cache</span> <span class="o">=</span> <span class="n">curl</span><span class="o">.</span><span class="n">CACHE</span>
                    <span class="n">curl</span><span class="o">.</span><span class="n">CACHE</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">redownload</span>
                    <span class="c1"># this try-except needs to be removed</span>
                    <span class="c1"># once correct exception handling will</span>
                    <span class="c1"># be implemented in every input function</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">infile</span> <span class="o">=</span> <span class="n">inputFunc</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="o">.</span><span class="n">inputArgs</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">:: Error in `pypath.dataio.</span><span class="si">%s</span><span class="s1">()`. &#39;</span>
                            <span class="s1">&#39;Skipping to next resource.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                            <span class="n">inputFunc</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">))</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">traceback</span><span class="o">.</span><span class="n">print_tb</span><span class="p">(</span>
                                <span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Failed handling exception.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">))</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                    <span class="n">curl</span><span class="o">.</span><span class="n">CACHE</span> <span class="o">=</span> <span class="n">_store_cache</span>
                <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">):</span>
                    <span class="n">infile</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> opened...&quot;</span> <span class="o">%</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">infile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: No such file or &quot;</span>
                                    <span class="s2">&quot;dataio function! :(</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                                    <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="c1"># finding the largest referred column number,</span>
            <span class="c1"># to avoid references out of range</span>
            <span class="n">isDir</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">isDirected</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">sign</span>
            <span class="n">refCol</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">refs</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> \
                <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">refs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">refs</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">refSep</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">refs</span><span class="p">,</span>
                                                    <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;;&#39;</span>
            <span class="n">sigCol</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dirCol</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">dirVal</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">dirSep</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">isDir</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">dirCol</span> <span class="o">=</span> <span class="n">isDir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">dirVal</span> <span class="o">=</span> <span class="n">isDir</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">dirSep</span> <span class="o">=</span> <span class="n">isDir</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">isDir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">dirCol</span> <span class="o">=</span> <span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">dirVal</span> <span class="o">=</span> <span class="n">sign</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">dirVal</span> <span class="o">=</span> <span class="n">dirVal</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dirVal</span><span class="p">[</span>
                    <span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">simpleTypes</span> <span class="k">else</span> <span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">(</span><span class="n">dirVal</span><span class="p">)</span>
                <span class="n">dirSep</span> <span class="o">=</span> <span class="n">sign</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">dirVal</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dirVal</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dirVal</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dirVal</span><span class="p">])</span>
            <span class="n">maxCol</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="nb">filter</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">nameColA</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameColB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_max</span><span class="p">(</span>
                            <span class="n">settings</span><span class="o">.</span><span class="n">extraEdgeAttrs</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_max</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">extraNodeAttrsA</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_max</span><span class="p">(</span>
                            <span class="n">settings</span><span class="o">.</span><span class="n">extraNodeAttrsB</span><span class="p">),</span> <span class="n">refCol</span><span class="p">,</span> <span class="n">dirCol</span><span class="p">,</span> <span class="n">sigCol</span><span class="p">,</span>
                        <span class="nb">max</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                            <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">settings</span><span class="o">.</span><span class="n">positiveFilters</span><span class="p">),</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
                        <span class="nb">max</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                            <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">settings</span><span class="o">.</span><span class="n">negativeFilters</span><span class="p">),</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="p">]))</span>
            <span class="c1"># iterating lines from input file</span>
            <span class="n">lnum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">lFiltered</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">rFiltered</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">tFiltered</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">readError</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
                <span class="n">lnum</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lnum</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">header</span><span class="p">):</span>
                    <span class="c1"># empty lines</span>
                    <span class="c1"># or header row</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">listLike</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39;decode&#39;</span><span class="p">):</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span>\
                        <span class="n">split</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">separator</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span>
                    <span class="p">]</span>
                <span class="c1"># in case line has less fields than needed</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxCol</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Line #</span><span class="si">%u</span><span class="s1"> has less than </span><span class="si">%u</span><span class="s1"> fields,&#39;</span>
                                        <span class="s1">&#39; skipping! :(</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">maxCol</span><span class="p">)),</span>
                                    <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="n">readError</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># applying filters:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">positiveFilters</span><span class="p">,</span>
                                    <span class="n">settings</span><span class="o">.</span><span class="n">negativeFilters</span><span class="p">):</span>
                        <span class="n">lFiltered</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>
                    <span class="c1"># reading names and attributes:</span>
                    <span class="k">if</span> <span class="n">isDir</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">isDir</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                        <span class="n">thisEdgeDir</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">thisEdgeDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_direction</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">dirCol</span><span class="p">,</span>
                                                             <span class="n">dirVal</span><span class="p">,</span> <span class="n">dirSep</span><span class="p">)</span>
                    <span class="n">refs</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">refCol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">refs</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">delEmpty</span><span class="p">(</span>
                            <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">refCol</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">refSep</span><span class="p">))))</span>
                    <span class="n">refs</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">only_pmids</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">must_have_references</span><span class="p">:</span>
                        <span class="n">rFiltered</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>

                    <span class="c1"># to give an easy way:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="n">taxA</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span>
                        <span class="n">taxB</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span>

                    <span class="c1"># to enable more sophisticated inputs:</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>

                        <span class="n">taxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_taxon</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">taxx</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                            <span class="n">taxA</span> <span class="o">=</span> <span class="n">taxx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">taxB</span> <span class="o">=</span> <span class="n">taxx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">taxA</span> <span class="o">=</span> <span class="n">taxB</span> <span class="o">=</span> <span class="n">taxx</span>

                        <span class="n">taxdA</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="s1">&#39;A&#39;</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span> <span class="k">else</span>
                            <span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span><span class="p">)</span>
                        <span class="n">taxdB</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="s1">&#39;B&#39;</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span> <span class="k">else</span>
                            <span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span><span class="p">)</span>

                        <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;include&#39;</span> <span class="ow">in</span> <span class="n">taxdA</span> <span class="ow">and</span>
                            <span class="n">taxA</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">taxdA</span><span class="p">[</span><span class="s1">&#39;include&#39;</span><span class="p">])</span> <span class="ow">or</span>
                            <span class="p">(</span><span class="s1">&#39;include&#39;</span> <span class="ow">in</span> <span class="n">taxdB</span> <span class="ow">and</span>
                            <span class="n">taxB</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">taxdB</span><span class="p">[</span><span class="s1">&#39;include&#39;</span><span class="p">])</span> <span class="ow">or</span>
                            <span class="p">(</span><span class="s1">&#39;exclude&#39;</span> <span class="ow">in</span> <span class="n">taxdA</span> <span class="ow">and</span>
                            <span class="n">taxA</span> <span class="ow">in</span> <span class="n">taxdA</span><span class="p">[</span><span class="s1">&#39;exclude&#39;</span><span class="p">])</span> <span class="ow">or</span>
                            <span class="p">(</span><span class="s1">&#39;exclude&#39;</span> <span class="ow">in</span> <span class="n">taxdB</span> <span class="ow">and</span>
                            <span class="n">taxB</span> <span class="ow">in</span> <span class="n">taxdB</span><span class="p">[</span><span class="s1">&#39;exclude&#39;</span><span class="p">])):</span>

                            <span class="n">tFiltered</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">continue</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">taxA</span> <span class="o">=</span> <span class="n">taxB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span>
                    <span class="k">if</span> <span class="n">taxA</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">taxB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">tFiltered</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>
                    <span class="n">stim</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">inh</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                        <span class="n">stim</span><span class="p">,</span> <span class="n">inh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_sign</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">sign</span><span class="p">)</span>
                    <span class="n">resource</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">resource</span><span class="p">]]</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="k">else</span>
                        <span class="n">line</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="k">else</span>
                        <span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">resource</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">newEdge</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;nameA&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">nameColA</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                        <span class="s2">&quot;nameB&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">nameColB</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                        <span class="s2">&quot;nameTypeA&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameTypeA</span><span class="p">,</span>
                        <span class="s2">&quot;nameTypeB&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameTypeB</span><span class="p">,</span>
                        <span class="s2">&quot;typeA&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">typeA</span><span class="p">,</span>
                        <span class="s2">&quot;typeB&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">typeB</span><span class="p">,</span>
                        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">resource</span><span class="p">,</span>
                        <span class="s2">&quot;isDirected&quot;</span><span class="p">:</span> <span class="n">thisEdgeDir</span><span class="p">,</span>
                        <span class="s2">&quot;references&quot;</span><span class="p">:</span> <span class="n">refs</span><span class="p">,</span>
                        <span class="s2">&quot;stim&quot;</span><span class="p">:</span> <span class="n">stim</span><span class="p">,</span>
                        <span class="s2">&quot;inh&quot;</span><span class="p">:</span> <span class="n">inh</span><span class="p">,</span>
                        <span class="s2">&quot;taxA&quot;</span><span class="p">:</span> <span class="n">taxA</span><span class="p">,</span>
                        <span class="s2">&quot;taxB&quot;</span><span class="p">:</span> <span class="n">taxB</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">intType</span>
                    <span class="p">}</span>
                    <span class="c1"># except:</span>
                    <span class="c1"># self.ownlog.msg(2,(&quot;&quot;&quot;Wrong name column indexes (%u and %u),</span>
                    <span class="c1"># or wrong separator (%s)? Line #%u\n&quot;&quot;&quot;</span>
                    <span class="c1">#% (</span>
                    <span class="c1">#settings.nameColA, settings.nameColB,</span>
                    <span class="c1"># settings.separator, lnum)), &#39;ERROR&#39;)</span>
                    <span class="c1">#readError = 1</span>
                    <span class="c1"># break</span>
                    <span class="c1"># getting additional edge and node attributes</span>
                    <span class="n">attrsEdge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">extraEdgeAttrs</span><span class="p">,</span>
                                               <span class="n">lnum</span><span class="p">)</span>
                    <span class="n">attrsNodeA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">extraNodeAttrsA</span><span class="p">,</span>
                                                <span class="n">lnum</span><span class="p">)</span>
                    <span class="n">attrsNodeB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">extraNodeAttrsB</span><span class="p">,</span>
                                                <span class="n">lnum</span><span class="p">)</span>
                    <span class="c1"># merging dictionaries</span>
                    <span class="n">nodeAttrs</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;attrsNodeA&quot;</span><span class="p">:</span> <span class="n">attrsNodeA</span><span class="p">,</span>
                        <span class="s2">&quot;attrsNodeB&quot;</span><span class="p">:</span> <span class="n">attrsNodeB</span><span class="p">,</span>
                        <span class="s2">&quot;attrsEdge&quot;</span><span class="p">:</span> <span class="n">attrsEdge</span>
                    <span class="p">}</span>
                    <span class="n">newEdge</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">nodeAttrs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">readError</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span>
                        <span class="s1">&#39;Errors occured, certain lines skipped.&#39;</span>
                        <span class="s1">&#39;Trying to read the remaining.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="n">readError</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">edgeList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newEdge</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span>
                <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c1">### !!!! ##</span>
            <span class="n">edgeListMapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_list</span><span class="p">(</span><span class="n">edgeList</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%u</span><span class="s2"> lines have been read from </span><span class="si">%s</span><span class="s2">,&quot;</span>
                <span class="s2">&quot;</span><span class="si">%u</span><span class="s2"> links after mapping; </span><span class="se">\n\t\t</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="si">%u</span><span class="s2"> lines filtered by filters;</span><span class="se">\n\t\t</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="si">%u</span><span class="s2"> lines filtered because lack of references;</span><span class="se">\n\t\t</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="si">%u</span><span class="s2"> lines filtered by taxon filters.&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">lnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgeListMapped</span><span class="p">),</span> <span class="n">lFiltered</span><span class="p">,</span>
                 <span class="n">rFiltered</span><span class="p">,</span> <span class="n">tFiltered</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">reread</span> <span class="ow">or</span> <span class="n">redownload</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">edgeListMapped</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">edges_cache</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                                <span class="s1">&#39;Mapped edge list saved to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">edges_cache</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">keep_raw</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">edgeListMapped</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">edgeListMapped</span></div>

    <span class="k">def</span> <span class="nf">load_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">lst</span>

<div class="viewcode-block" id="PyPath.receptors_list"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.receptors_list">[docs]</a>    <span class="k">def</span> <span class="nf">receptors_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the Human Plasma Membrane Receptome as a list.</span>
<span class="sd">        This resource is human only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;rec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span>
            <span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">([</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="mi">9606</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_hpmr</span><span class="p">()</span>
            <span class="p">]))</span></div>

<div class="viewcode-block" id="PyPath.druggability_list"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.druggability_list">[docs]</a>    <span class="k">def</span> <span class="nf">druggability_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the list of druggable proteins from DgiDB.</span>
<span class="sd">        This resource is human only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;dgb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span>
            <span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">([</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">dgb</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="mi">9606</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">dgb</span> <span class="ow">in</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_dgidb</span><span class="p">()</span>
            <span class="p">]))</span></div>

<div class="viewcode-block" id="PyPath.kinases_list"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.kinases_list">[docs]</a>    <span class="k">def</span> <span class="nf">kinases_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the list of all known kinases in the proteome from kinase.com.</span>
<span class="sd">        This resource is human only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;kin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span>
            <span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">([</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">kin</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="mi">9606</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">kin</span> <span class="ow">in</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_kinases</span><span class="p">()</span>
            <span class="p">]))</span></div>

<div class="viewcode-block" id="PyPath.tfs_list"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.tfs_list">[docs]</a>    <span class="k">def</span> <span class="nf">tfs_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the list of all known transcription factors from TF census</span>
<span class="sd">        (Vaquerizas 2009). This resource is human only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tfs</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_tfcensus</span><span class="p">()</span>
        <span class="n">utfs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="s1">&#39;ensg&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="mi">9606</span><span class="p">)</span> \
                <span class="k">for</span> <span class="n">tf</span> <span class="ow">in</span> <span class="n">tfs</span><span class="p">[</span><span class="s1">&#39;ensg&#39;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">utfs</span> <span class="o">+=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="s1">&#39;hgnc&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="mi">9606</span><span class="p">)</span> \
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">tfs</span><span class="p">[</span><span class="s1">&#39;hgnc&#39;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;tf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">(</span><span class="n">utfs</span><span class="p">))</span></div>

<div class="viewcode-block" id="PyPath.disease_genes_list"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.disease_genes_list">[docs]</a>    <span class="k">def</span> <span class="nf">disease_genes_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s1">&#39;curated&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the list of all disease related genes from DisGeNet.</span>
<span class="sd">        This resource is human only.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">diss</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_disgenet</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">)</span>
        <span class="n">dis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">diss</span><span class="p">:</span>
            <span class="n">dis</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
                <span class="n">di</span><span class="p">[</span><span class="s1">&#39;entrez&#39;</span><span class="p">],</span> <span class="s1">&#39;entrez&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="mi">9606</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">dis</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyPath.signaling_proteins_list"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.signaling_proteins_list">[docs]</a>    <span class="k">def</span> <span class="nf">signaling_proteins_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compiles a list of signaling proteins (as opposed to other proteins</span>
<span class="sd">        like metabolic enzymes, matrix proteins), by looking up a few simple</span>
<span class="sd">        keywords in short description of GO terms.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">goq</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_go_quick</span><span class="p">()</span>

        <span class="n">gosig</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>

        <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">goq</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="s1">&#39;signal&#39;</span> <span class="ow">in</span> <span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;regulat&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">gosig</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>

        <span class="n">upsig</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>

        <span class="k">if</span> <span class="s1">&#39;proteome&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proteome_list</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">up</span><span class="p">,</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">goq</span><span class="p">[</span><span class="s1">&#39;terms&#39;</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">term</span> <span class="o">&amp;</span> <span class="n">gosig</span><span class="p">):</span>
                <span class="n">upsig</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">up</span><span class="p">)</span>

        <span class="n">spsig</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">upsig</span><span class="p">:</span>
            <span class="n">spsig</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
                <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">)))</span>

        <span class="n">upsig</span> <span class="o">=</span> <span class="n">spsig</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;proteome&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;sig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">upsig</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyPath.proteome_list"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.proteome_list">[docs]</a>    <span class="k">def</span> <span class="nf">proteome_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">swissprot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the whole proteome as a list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">swissprot</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span> <span class="k">if</span> <span class="n">swissprot</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;proteome&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">dataio</span><span class="o">.</span><span class="n">all_uniprots</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span> <span class="n">swissprot</span><span class="o">=</span><span class="n">swissprot</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyPath.cancer_gene_census_list"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.cancer_gene_census_list">[docs]</a>    <span class="k">def</span> <span class="nf">cancer_gene_census_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the list of cancer driver proteins from the COSMIC Cancer</span>
<span class="sd">        Gene Census.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_list_file</span><span class="p">(</span><span class="n">data_formats</span><span class="o">.</span><span class="n">cgc</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyPath.intogen_cancer_drivers_list"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.intogen_cancer_drivers_list">[docs]</a>    <span class="k">def</span> <span class="nf">intogen_cancer_drivers_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intogen_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the list of cancer driver proteins from IntOGen data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_formats</span><span class="o">.</span><span class="n">intogen_cancer</span><span class="o">.</span><span class="n">inFile</span> <span class="o">=</span> <span class="n">intogen_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_list_file</span><span class="p">(</span><span class="n">data_formats</span><span class="o">.</span><span class="n">intogen_cancer</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">cancer_drivers_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intogen_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancer_gene_census_list</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">intogen_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">intogen_cancer_drivers_list</span><span class="p">(</span><span class="n">intogen_file</span><span class="o">=</span><span class="n">intogen_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;cdv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;cgc&#39;</span><span class="p">])</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;IntOGen&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;cdv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;cgc&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;cdv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;cdv&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="n">lst</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="nb">set</span><span class="p">)</span> \
            <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> \
            <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">lst</span><span class="p">])</span> \
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span> \
            <span class="k">else</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">lst</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">fisher_enrichment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="s1">&#39;proteome&#39;</span><span class="p">):</span>
        <span class="n">cont</span> <span class="o">=</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span>
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">ref</span><span class="p">]),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span>
                <span class="p">],</span>
                <span class="p">[</span>
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">lst</span><span class="p">]),</span>
                    <span class="nb">len</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
                <span class="p">]</span>
            <span class="p">])</span>
        <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">fisher_exact</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_list_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">_input</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;ReadList&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                            <span class="p">(</span><span class="s2">&quot;&quot;&quot;No proper input file definition!</span><span class="se">\n\&#39;</span><span class="s2">settings</span><span class="se">\&#39;</span><span class="s2"></span>
<span class="s2">                should be a </span><span class="se">\&#39;</span><span class="s2">readList</span><span class="se">\&#39;</span><span class="s2"> instance</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">):</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span>
            <span class="n">_input</span> <span class="o">=</span> <span class="n">toCall</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: No such file! :(</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">),</span>
                            <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_input</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span>
        <span class="n">originalNameType</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameType</span>
        <span class="n">defaultNameType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">typ</span><span class="p">]</span>
        <span class="n">mapTbl</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">originalNameType</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">defaultNameType</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_input</span><span class="p">)</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">charTypes</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">_input</span><span class="p">):</span>
            <span class="n">_input</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">_input</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_input</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;&quot;&quot;Could not find &#39;</span><span class="se">\</span>
<span class="s2">                &#39;file or dataio function.</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> opened...&quot;</span> <span class="o">%</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span>
        <span class="c1"># finding the largest referred column number,</span>
        <span class="c1"># to avoid references out of index</span>
        <span class="n">maxCol</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">settings</span><span class="o">.</span><span class="n">nameCol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_max</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">extraAttrs</span><span class="p">)])</span>
        <span class="c1"># iterating lines from input file</span>
        <span class="n">lnum</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">readError</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">itemList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">_input</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lnum</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">header</span><span class="p">):</span>
                <span class="c1"># empty lines</span>
                <span class="c1"># or header row</span>
                <span class="n">lnum</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">charTypes</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">separator</span><span class="p">)</span>
            <span class="c1"># in case line has less fields than needed</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxCol</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Line #</span><span class="si">%u</span><span class="s2"> has less than </span><span class="si">%u</span><span class="s2"> fields! :(</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                                    <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">maxCol</span><span class="p">)),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">readError</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># reading names and attributes</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">newItem</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">nameCol</span><span class="p">],</span>
                        <span class="s2">&quot;nameType&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameType</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">typ</span><span class="p">,</span>
                        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span>
                    <span class="p">}</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span>
                        <span class="sd">&quot;&quot;&quot;Wrong name column indexes (%u and %u),</span>
<span class="sd">                        or wrong separator (%s)? Line #%u\n&quot;&quot;&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">nameCol</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">separator</span><span class="p">,</span> <span class="n">lnum</span><span class="p">)),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="n">readError</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">break</span>
                <span class="c1"># getting additional attributes</span>
                <span class="n">attrsItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">extraAttrs</span><span class="p">,</span> <span class="n">lnum</span><span class="p">)</span>
                <span class="c1"># merging dictionaries</span>
                <span class="n">newItem</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attrsItem</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">readError</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">itemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newItem</span><span class="p">)</span>
            <span class="n">lnum</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_input</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span>
            <span class="n">_input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">itemListMapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_list</span><span class="p">(</span><span class="n">itemList</span><span class="p">,</span> <span class="n">singleList</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">itemListMapped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itemListMapped</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%u</span><span class="s2"> lines have been read from </span><span class="si">%s</span><span class="s2">, </span><span class="si">%u</span><span class="s2"> &#39;</span><span class="se">\</span>
<span class="s2">            items after mapping&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">itemListMapped</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">itemListMapped</span>

<div class="viewcode-block" id="PyPath.map_list"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.map_list">[docs]</a>    <span class="k">def</span> <span class="nf">map_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="p">,</span> <span class="n">singleList</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Only a wrapper for map_edge()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">listMapped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">singleList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
                <span class="n">listMapped</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_item</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
                <span class="n">listMapped</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">listMapped</span></div>

<div class="viewcode-block" id="PyPath.map_item"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.map_item">[docs]</a>    <span class="k">def</span> <span class="nf">map_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translates the name in item representing a molecule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: include</span>
        <span class="n">defaultNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;nameType&#39;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaultNames</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unmapped</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">defaultNames</span></div>

<div class="viewcode-block" id="PyPath.map_edge"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.map_edge">[docs]</a>    <span class="k">def</span> <span class="nf">map_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translates molecule names in dict representing an edge.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">edgeStack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">defaultNameA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;nameA&#39;</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;nameTypeA&#39;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;typeA&#39;</span><span class="p">]],</span>
            <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;taxA&#39;</span><span class="p">])</span>
        <span class="c1"># print &#39;mapped %s to %s&#39; % (str(edge[&#39;nameA&#39;]), str(defaultNameA))</span>
        <span class="n">defaultNameB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;nameB&#39;</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;nameTypeB&#39;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;typeB&#39;</span><span class="p">]],</span>
            <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;taxB&#39;</span><span class="p">])</span>
        <span class="c1"># print &#39;mapped %s to %s&#39; % (str(edge[&#39;nameB&#39;]), str(defaultNameB))</span>
        <span class="c1"># this is needed because the possibility ambigous mapping</span>
        <span class="c1"># one name can be mapped to multiple ones</span>
        <span class="c1"># this multiplies the nodes and edges</span>
        <span class="c1"># in case of proteins this does not happen too often</span>
        <span class="k">for</span> <span class="n">dnA</span> <span class="ow">in</span> <span class="n">defaultNameA</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dnB</span> <span class="ow">in</span> <span class="n">defaultNameB</span><span class="p">:</span>
                <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;defaultNameA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dnA</span>
                <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;defaultNameTypeA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span>
                    <span class="s1">&#39;typeA&#39;</span><span class="p">]]</span>
                <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;defaultNameB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dnB</span>
                <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;defaultNameTypeB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span>
                    <span class="s1">&#39;typeB&#39;</span><span class="p">]]</span>
                <span class="n">edgeStack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
                <span class="c1"># print &#39;new edge: %s&#39; % str(edge)</span>
        <span class="k">return</span> <span class="n">edgeStack</span></div>

<div class="viewcode-block" id="PyPath.combine_attr"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.combine_attr">[docs]</a>    <span class="k">def</span> <span class="nf">combine_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="p">,</span> <span class="n">num_method</span> <span class="o">=</span> <span class="nb">max</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Combines multiple attributes into one. This method attempts</span>
<span class="sd">        to find out which is the best way to combine attributes.</span>
<span class="sd">            * if there is only one value or one of them is None, then returns</span>
<span class="sd">              the one available</span>
<span class="sd">            * lists: concatenates unique values of lists</span>
<span class="sd">            * numbers: returns the greater by default</span>
<span class="sd">              or calls `num_method()` if given.</span>
<span class="sd">            * sets: returns the union</span>
<span class="sd">            * dicts: calls `common.merge_dicts()`</span>
<span class="sd">            * Direction: calls their special `merge()` method</span>
<span class="sd">        Works on more than 2 attributes recursively.</span>

<span class="sd">        :param list lst: List of one or two attribute values.</span>
<span class="sd">        :param callable num_method: Method to merge numeric attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">list_or_set</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">two</span><span class="p">,</span> <span class="nb">set</span><span class="p">))</span> <span class="ow">or</span> \
               <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">two</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="nb">set</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">one</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="n">two</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">one</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">two</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">one</span><span class="p">,</span> <span class="n">two</span>

        <span class="c1"># recursion:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">num_method</span> <span class="o">=</span> <span class="n">num_method</span><span class="p">)]</span>

        <span class="c1"># quick and simple cases:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># merge numeric values</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">numTypes</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">numTypes</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">num_method</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>

        <span class="c1"># in case one is list other is set</span>
        <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">list_or_set</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># merge lists:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># lists of hashable elements only:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c1"># if contain non-hashable elements:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># merge sets:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">set</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">common</span><span class="o">.</span><span class="n">addToSet</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">set</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">common</span><span class="o">.</span><span class="n">addToSet</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># merge dicts:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">common</span><span class="o">.</span><span class="n">merge_dicts</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># 2 different strings: return a set with both of them</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unicode</span><span class="p">))</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">unicode</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

        <span class="c1"># one attr is list, the other is simple value:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">simpleTypes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">numTypes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">common</span><span class="o">.</span><span class="n">addToList</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">simpleTypes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">numTypes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">common</span><span class="o">.</span><span class="n">addToList</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># special: merging directions</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;Direction&#39;</span> <span class="ow">and</span> \
                <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;Direction&#39;</span><span class="p">:</span>
            <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># in case the objects have `__add__()` method:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;__add__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">uniq_node_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
        <span class="n">uniqLst</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uniqLst</span><span class="p">:</span>
                <span class="n">uniqLst</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">uniqLst</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_attrs</span><span class="p">(</span><span class="n">uniqLst</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">uniqLst</span>

<div class="viewcode-block" id="PyPath.collapse_by_name"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.collapse_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">collapse_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collapses nodes with the same name with copying and merging</span>
<span class="sd">        all edges and attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>

        <span class="n">dupli</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">dupli</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
                <span class="c1"># the number of nodes might have changed</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">merge_nodes</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyPath.merge_nodes"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.merge_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">merge_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">primary</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merges all attributes and all edges of selected nodes</span>
<span class="sd">        and assigns them to the primary node</span>
<span class="sd">        (by default the one with lowest ID).</span>

<span class="sd">        :param list nodes: List of edge IDs.</span>
<span class="sd">        :param int primary: ID of the primary edge;</span>
<span class="sd">                            if None the lowest ID selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span>
                            <span class="n">n</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span> <span class="k">else</span> <span class="n">n</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)))</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">primary</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">primary</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">primary</span>
        <span class="n">primary</span> <span class="o">=</span> <span class="n">primary</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">primary</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span> <span class="k">else</span> <span class="n">primary</span>
        <span class="n">nonprimary</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">primary</span><span class="p">,</span> <span class="n">nodes</span><span class="p">))</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;id_merge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()))</span>

        <span class="c1"># combining vertex attributes:</span>
        <span class="n">vprim</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">primary</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">vprim</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="o">!=</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span>
                <span class="n">vprim</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span>
                        <span class="nb">map</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">vid</span><span class="p">:</span>
                                <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vid</span><span class="p">][</span><span class="n">attr</span><span class="p">],</span>
                            <span class="c1"># combining from all nodes</span>
                            <span class="n">nodes</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># moving edges of non primary vertices to the primary one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy_edges</span><span class="p">(</span><span class="n">nonprimary</span><span class="p">,</span> <span class="n">primary</span><span class="p">,</span> <span class="n">move</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>

        <span class="c1"># deleting non primary vertices:</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">id_merge</span> <span class="o">=</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                         <span class="n">nonprimary</span><span class="p">))</span>

        <span class="n">graph</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;id_merge&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="PyPath.copy_edges"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.copy_edges">[docs]</a>    <span class="k">def</span> <span class="nf">copy_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">move</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copies edges of one node to another,</span>
<span class="sd">        keeping attributes and directions.</span>

<span class="sd">        :param list sources: Vertex IDs to copy from.</span>
<span class="sd">        :param int target: Vertex ID to copy for.</span>
<span class="sd">        :param bool move: Whether perform copy or move, i.e. remove or keep</span>
<span class="sd">                          the source edges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;id_old&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()))</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;id_old&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">()))</span>

        <span class="c1"># preserve a permanent marker of the target vertex</span>
        <span class="n">ovidt</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;id_old&#39;</span><span class="p">]</span>

        <span class="c1"># collecting the edges of all source vertices into dict</span>
        <span class="n">ses</span> <span class="o">=</span> \
            <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span>
                        <span class="p">(</span>
                            <span class="c1"># id_old of source vertices:</span>
                            <span class="n">s</span><span class="p">,</span>
                            <span class="c1"># edges of current source node:</span>
                            <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">_source</span> <span class="o">=</span> <span class="n">s</span><span class="p">),</span>
                                                <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">_target</span> <span class="o">=</span> <span class="n">s</span><span class="p">))))</span>
                        <span class="p">),</span>
                    <span class="n">sources</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># collecting edges to be newly created</span>
        <span class="n">toAdd</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">es</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">ses</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">eid</span> <span class="ow">in</span> <span class="n">es</span><span class="p">:</span>
                <span class="c1"># the source edge:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span>
                <span class="c1"># looking up if target edge already exists:</span>
                <span class="n">vid1</span> <span class="o">=</span> <span class="n">target</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="n">s</span> <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span>
                <span class="n">vid2</span> <span class="o">=</span> <span class="n">target</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span> <span class="o">==</span> <span class="n">s</span> <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span>
                <span class="n">te</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">vid1</span><span class="p">,</span> <span class="n">vid2</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">te</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># target edge not found, needs to be added:</span>
                    <span class="n">toAdd</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">vid1</span><span class="p">,</span> <span class="n">vid2</span><span class="p">))</span>

        <span class="c1"># creating new edges</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span><span class="n">toAdd</span><span class="p">)</span>

        <span class="c1"># copying attributes:</span>
        <span class="k">for</span> <span class="n">ovids</span><span class="p">,</span> <span class="n">es</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">ses</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">oeid</span> <span class="ow">in</span> <span class="n">es</span><span class="p">:</span>
                <span class="c1"># this is the index of the current source node:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">id_old</span> <span class="o">=</span> <span class="n">ovids</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                <span class="c1"># this is the index of the current target node:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">id_old</span> <span class="o">=</span> <span class="n">ovidt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                <span class="c1"># this is the current source edge:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">id_old</span> <span class="o">=</span> <span class="n">oeid</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># looking up target edge and peer vertex:</span>
                <span class="n">vid1</span> <span class="o">=</span> <span class="n">t</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="n">s</span> <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span>
                <span class="n">vid2</span> <span class="o">=</span> <span class="n">t</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span> <span class="o">==</span> <span class="n">s</span> <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span>
                <span class="n">vid_peer</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span> <span class="o">==</span> <span class="n">s</span> <span class="k">else</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span>
                <span class="n">te</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">vid1</span><span class="p">,</span> <span class="n">vid2</span><span class="p">)]</span>

                <span class="c1"># old direction:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span>
                <span class="c1"># dict from old names to new ones</span>
                <span class="c1"># the peer does no change, only s-&gt;t</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vid_peer</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vid_peer</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="p">}</span>

                <span class="c1"># copying directions and signs:</span>
                <span class="n">te</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">te</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">])</span> \
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">te</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">],</span> <span class="n">Direction</span><span class="p">)</span> <span class="k">else</span> <span class="n">d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
                <span class="c1"># copying `refs_by_dir`</span>
                <span class="n">te</span><span class="p">[</span><span class="s1">&#39;refs_by_dir&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">translate_refsdir</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_dir&#39;</span><span class="p">],</span> <span class="n">ids</span><span class="p">)</span>
                <span class="c1"># copying further attributes:</span>
                <span class="k">for</span> <span class="n">eattr</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">eattr</span> <span class="o">!=</span> <span class="s1">&#39;dirs&#39;</span> <span class="ow">and</span> <span class="n">eattr</span> <span class="o">!=</span> <span class="s1">&#39;refs_by_dir&#39;</span><span class="p">:</span>
                        <span class="n">te</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">([</span><span class="n">te</span><span class="p">[</span><span class="n">eattr</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="n">eattr</span><span class="p">]])</span>

                <span class="c1"># in case we want to delete old edges:</span>
                <span class="n">toDel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">move</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">toDel</span><span class="p">))</span>

        <span class="c1"># removing temporary attributes</span>
        <span class="k">del</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;id_old&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;id_old&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="PyPath.delete_by_taxon"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.delete_by_taxon">[docs]</a>    <span class="k">def</span> <span class="nf">delete_by_taxon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the proteins of all organisms which are not listed.</span>

<span class="sd">        :param list tax: List of NCBI Taxonomy IDs of the organisms.</span>
<span class="sd">                         E.g. [7227, 9606]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;ncbi_tax_id&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tax</span><span class="p">:</span>
                <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_db_dict</span><span class="p">()</span></div>

<div class="viewcode-block" id="PyPath.delete_unknown"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.delete_unknown">[docs]</a>    <span class="k">def</span> <span class="nf">delete_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tax</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;protein&#39;</span><span class="p">,</span> <span class="n">defaultNameType</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes those proteins which are not in the list of all default</span>
<span class="sd">        IDs of the organisms. By default, it means to remove all protein</span>
<span class="sd">        nodes not having a human SwissProt ID.</span>

<span class="sd">        @tax : list</span>
<span class="sd">            List of NCBI Taxonomy IDs of the organisms of interest.</span>
<span class="sd">            E.g. [7227, 9606]</span>
<span class="sd">        @typ : str</span>
<span class="sd">            Molecule type. E.g. &#39;protein&#39; or &#39;mirna&#39;</span>
<span class="sd">        @defaultNameType : str</span>
<span class="sd">            The default name type of the given molecular species.</span>
<span class="sd">            For proteins it&#39;s &#39;uniprot&#39; by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">defaultNameType</span><span class="p">:</span>
            <span class="n">defaultNameType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">reflists</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tax</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">defaultNameType</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">:</span>
                <span class="n">reflists</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">lst</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;Missing reference list for </span><span class="si">%s</span><span class="s1"> (default name type: </span><span class="si">%s</span><span class="s1">), in taxon </span><span class="si">%u</span><span class="s1">&#39;</span>
                <span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; :: Comparing with reference lists...&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tax</span><span class="p">:</span>
            <span class="n">nt</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;nameType&#39;</span><span class="p">]</span>
            <span class="n">nt</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">defaultNameType</span><span class="p">]</span>
            <span class="n">ty</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
            <span class="n">ty</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ty</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">typ</span><span class="p">]</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;ncbi_tax_id&#39;</span><span class="p">]</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="nb">set</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">ty</span><span class="p">))</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">tx</span><span class="p">))</span>
            <span class="n">vn</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">]</span>
            <span class="n">toDelNames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vn</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">reflists</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
            <span class="n">toDel</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">toDelNames</span><span class="p">]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyPath.clean_graph"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.clean_graph">[docs]</a>    <span class="k">def</span> <span class="nf">clean_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes multiple edges, unknown molecules and those from wrong taxon.</span>
<span class="sd">        Multiple edges will be combined by `combine_attr()` method.</span>
<span class="sd">        Loops will be deleted unless the `loops` attribute set to `True`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Removing duplicate edges...&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">is_simple</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span>
                <span class="n">loops</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">loops</span><span class="p">,</span>
                <span class="n">multiple</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">combine_edges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_unmapped</span><span class="p">()</span>
        <span class="c1">## TODO: multiple taxons ##</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_by_taxon</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_unknown</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="n">zeroDeg</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">zeroDeg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span></div>

    <span class="c1">###</span>
    <span class="c1"># functions to integrate new data into the main igraph network object</span>
    <span class="c1">###</span>

<div class="viewcode-block" id="PyPath.count_sol"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.count_sol">[docs]</a>    <span class="k">def</span> <span class="nf">count_sol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Counts nodes with zero degree.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">s</span></div>

<div class="viewcode-block" id="PyPath.add_update_vertex"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.add_update_vertex">[docs]</a>    <span class="k">def</span> <span class="nf">add_update_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">defAttrs</span><span class="p">,</span>
                          <span class="n">originalName</span><span class="p">,</span>
                          <span class="n">originalNameType</span><span class="p">,</span>
                          <span class="n">extraAttrs</span><span class="o">=</span><span class="p">{},</span>
                          <span class="n">add</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the attributes of one node in the network.</span>
<span class="sd">        Optionally it creates a new node and sets the attributes,</span>
<span class="sd">        but it is not efficient as igraph needs to reindex vertices</span>
<span class="sd">        after this operation, so better to create new nodes and</span>
<span class="sd">        edges in batch.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">defAttrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">add</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to add some vertices&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span>
            <span class="n">g</span><span class="o">.</span><span class="n">add_vertices</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">originalNames</span> <span class="o">=</span> <span class="p">{</span><span class="n">originalName</span><span class="p">:</span> <span class="n">originalNameType</span><span class="p">}</span>
            <span class="n">thisNode</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">defAttrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thisNode</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">defAttrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">thisNode</span><span class="p">[</span><span class="s2">&quot;originalNames&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">thisNode</span><span class="p">[</span><span class="s2">&quot;originalNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">thisNode</span><span class="p">[</span><span class="s2">&quot;originalNames&quot;</span><span class="p">][</span><span class="n">originalName</span><span class="p">]</span> <span class="o">=</span> <span class="n">originalNameType</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">defAttrs</span><span class="p">):</span>
            <span class="n">thisNode</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">extraAttrs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span> \
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">thisNode</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">([</span><span class="n">thisNode</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="nf">add_update_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">nameA</span><span class="p">,</span>
                        <span class="n">nameB</span><span class="p">,</span>
                        <span class="n">source</span><span class="p">,</span>
                        <span class="n">isDir</span><span class="p">,</span>
                        <span class="n">refs</span><span class="p">,</span>
                        <span class="n">stim</span><span class="p">,</span>
                        <span class="n">inh</span><span class="p">,</span>
                        <span class="n">taxA</span><span class="p">,</span>
                        <span class="n">taxB</span><span class="p">,</span>
                        <span class="n">typ</span><span class="p">,</span>
                        <span class="n">extraAttrs</span><span class="o">=</span><span class="p">{},</span>
                        <span class="n">add</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nodDct&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span><span class="p">)</span> <span class="o">!=</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">add</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">ERROR: Failed to add some edges</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to add some edges&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">aid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span>
                <span class="n">bid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nameB</span><span class="p">]</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">aid</span><span class="p">,</span> <span class="n">bid</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">aid</span><span class="p">,</span> <span class="n">bid</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">failed_edges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">edge</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">,</span> <span class="n">aid</span><span class="p">,</span> <span class="n">bid</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">)</span>
        <span class="c1"># assigning source:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_set_eattr</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;sources&#39;</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="c1"># adding references:</span>
        <span class="c1"># if len(refs) &gt; 0:</span>
        <span class="n">refs</span> <span class="o">=</span> <span class="p">[</span><span class="n">_refs</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">pmid</span><span class="p">)</span> <span class="k">for</span> <span class="n">pmid</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_list_eattr</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;references&#39;</span><span class="p">,</span> <span class="n">refs</span><span class="p">)</span>
        <span class="c1"># updating references-by-source dict:</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="n">source</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="ow">in</span> <span class="p">{</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">list</span><span class="p">}</span> <span class="k">else</span> <span class="p">(</span><span class="n">source</span><span class="p">,)</span>
        <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_grouped_set_eattr</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;refs_by_source&#39;</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">refs</span><span class="p">)</span>
        <span class="c1"># updating refrences-by-type dict:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_grouped_set_eattr</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;refs_by_type&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">refs</span><span class="p">)</span>
        <span class="c1"># setting directions:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">(</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isDir</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_dir</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">),</span> <span class="n">source</span><span class="p">)</span>
            <span class="c1"># updating references-by-direction dict:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_grouped_set_eattr</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;refs_by_dir&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">),</span>
                                       <span class="n">refs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_grouped_set_eattr</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;refs_by_dir&#39;</span><span class="p">,</span> <span class="s1">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">refs</span><span class="p">)</span>
        <span class="c1"># setting signs:</span>
        <span class="k">if</span> <span class="n">stim</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_sign</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">),</span> <span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inh</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_sign</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">),</span> <span class="s1">&#39;negative&#39;</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="c1"># updating sources-by-type dict:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_grouped_set_eattr</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;sources_by_type&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="c1"># adding type:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_list_eattr</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span>
        <span class="c1"># adding extra attributes:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">extraAttrs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span> \
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">([</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">add_list_eattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]]</span>
        <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_set_eattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">set</span><span class="p">)</span> \
            <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> \
            <span class="k">else</span> <span class="nb">set</span><span class="p">([</span><span class="n">value</span><span class="p">])</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">set</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())</span>
            <span class="p">]</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="nb">set</span><span class="p">):</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span>
                                                 <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="nb">set</span><span class="p">([</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]])</span>
        <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_grouped_eattr</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">edge</span><span class="p">,</span>
            <span class="n">attr</span><span class="p">,</span>
            <span class="n">group</span><span class="p">,</span>
            <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">],</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">]]</span>
        <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">]</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_grouped_set_eattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">set</span><span class="p">)</span> \
            <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> \
            <span class="k">else</span> <span class="nb">set</span><span class="p">([</span><span class="n">value</span><span class="p">])</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">],</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">],</span> <span class="nb">set</span><span class="p">):</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">])</span> \
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="nb">set</span><span class="p">([</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">]])</span>
        <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="PyPath.get_directed"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.get_directed">[docs]</a>    <span class="k">def</span> <span class="nf">get_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">graph</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">conv_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">mutual</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">ret</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts ``graph`` undirected ``igraph.Graph`` object to a directed one.</span>
<span class="sd">        By default it converts the graph in ``PyPath.graph`` and places the directed</span>
<span class="sd">        instance in ``PyPath.dgraph``.</span>

<span class="sd">        @graph : igraph.Graph</span>
<span class="sd">            Undirected graph object.</span>

<span class="sd">        @conv_edges : bool</span>
<span class="sd">            Whether to convert undirected edges (those without explicit</span>
<span class="sd">            direction information) to an arbitrary direction edge or</span>
<span class="sd">            a pair of opposite edges.</span>
<span class="sd">            Otherwise those will be deleted. Default is ``False``.</span>

<span class="sd">        @mutual : bool</span>
<span class="sd">            If ``conv_edges`` is ``True``, whether to convert the</span>
<span class="sd">            undirected edges to a single, arbitrary directed edge,</span>
<span class="sd">            or a pair of opposite directed edges. Default is ``False``.</span>

<span class="sd">        @ret : bool</span>
<span class="sd">            Return the directed graph instance, or return ``None``.</span>
<span class="sd">            Default is ``False`` (returns ``None``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">graph</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">as_directed</span><span class="p">(</span><span class="n">mutual</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;directed_sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
        <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
        <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Setting directions&quot;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This works because in directed graphs get_eid() defaults to</span>
<span class="sd">            directed = True, so the source -&gt; target edge is returned.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">dir_one</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">])</span>
            <span class="n">dir_two</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">])</span>
            <span class="n">dir_edge_one</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span>
                <span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]),</span>
                <span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]))</span>
            <span class="n">dir_edge_two</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span>
                <span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]),</span>
                <span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_one</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">conv_edges</span> <span class="ow">or</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_two</span><span class="p">):</span>
                    <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dir_edge_one</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_one</span><span class="p">][</span><span class="s1">&#39;directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_one</span><span class="p">][</span><span class="s1">&#39;directed_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_one</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_one</span><span class="p">][</span><span class="s1">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_two</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">conv_edges</span> <span class="ow">or</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_one</span><span class="p">):</span>
                    <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dir_edge_two</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_two</span><span class="p">][</span><span class="s1">&#39;directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_two</span><span class="p">][</span><span class="s1">&#39;directed_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_two</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_two</span><span class="p">][</span><span class="s1">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_one</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_two</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">conv_edges</span><span class="p">:</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_one</span><span class="p">][</span><span class="s1">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                        <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mutual</span><span class="p">:</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_two</span><span class="p">][</span><span class="s1">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                            <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dir_edge_two</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">toDel</span> <span class="o">+=</span> <span class="p">[</span><span class="n">dir_edge_one</span><span class="p">,</span> <span class="n">dir_edge_two</span><span class="p">]</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">d</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">toDel</span><span class="p">)))</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">deg</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">toDel</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">graph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span> <span class="o">=</span> <span class="n">d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_undirected</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">graph</span> <span class="ow">or</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">d</span></div>

    <span class="k">def</span> <span class="nf">new_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edges</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">new_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_vertices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>

<div class="viewcode-block" id="PyPath.edge_exists"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.edge_exists">[docs]</a>    <span class="k">def</span> <span class="nf">edge_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a tuple of vertice indices if edge doesn&#39;t exists,</span>
<span class="sd">        otherwise edge id. Not sensitive to direction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nodDct&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nameA</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nameB</span><span class="p">]]</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edge</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">edge</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">nodes</span></div>

    <span class="k">def</span> <span class="nf">edge_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">node_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nodInd&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span>

    <span class="k">def</span> <span class="nf">names2vids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="n">vids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nodInd&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span><span class="p">:</span>
                <span class="n">vids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">vids</span>

    <span class="k">def</span> <span class="nf">_get_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the edge id only if there is an edge from nodes[0] to nodes[1],</span>
<span class="sd">        returns False if edge exists in opposite direction, or no edge exists</span>
<span class="sd">        between the two vertices, or any of the vertice ids doesn&#39;t exist.</span>
<span class="sd">        To find edges without regarding their direction, see edge_exists().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">e</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="PyPath.straight_between"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.straight_between">[docs]</a>    <span class="k">def</span> <span class="nf">straight_between</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This does actually the same as get_edge(), but by names</span>
<span class="sd">        instead of vertex ids.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodNm</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">])</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nodNm</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nodNm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">]</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">edge</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nodes</span></div>

<div class="viewcode-block" id="PyPath.all_between"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.all_between">[docs]</a>    <span class="k">def</span> <span class="nf">all_between</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all edges between two given vertex names. Similar to</span>
<span class="sd">        straight_between(), but checks both directions, and returns</span>
<span class="sd">        list of edge ids in [undirected, straight, reversed] format,</span>
<span class="sd">        for both nameA -&gt; nameB and nameB -&gt; nameA edges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ab&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;ba&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]}</span>
        <span class="n">eid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">):</span>
                <span class="n">edges</span><span class="p">[</span><span class="s1">&#39;ab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
                <span class="n">edges</span><span class="p">[</span><span class="s1">&#39;ba&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">)):</span>
                <span class="n">edges</span><span class="p">[</span><span class="s1">&#39;ab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
                <span class="n">edges</span><span class="p">[</span><span class="s1">&#39;ba&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">nameB</span><span class="p">,</span> <span class="n">nameA</span><span class="p">)):</span>
                <span class="n">edges</span><span class="p">[</span><span class="s1">&#39;ab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
                <span class="n">edges</span><span class="p">[</span><span class="s1">&#39;ba&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
        <span class="k">return</span> <span class="n">edges</span></div>

    <span class="k">def</span> <span class="nf">get_node_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">,</span> <span class="n">directed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nodDct&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="k">if</span> <span class="n">directed</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span>
        <span class="n">nodDct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span> <span class="k">if</span> <span class="n">directed</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">directed</span> <span class="k">else</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nodeA</span> <span class="o">=</span> <span class="n">nodDct</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">nodeB</span> <span class="o">=</span> <span class="n">nodDct</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">nodeA</span><span class="p">,</span> <span class="n">nodeB</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">update_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                                <span class="s1">&#39;Vertex attribute `</span><span class="si">%s</span><span class="s1">` has multiple types of&#39;</span>
                                <span class="s1">&#39; values: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                    <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">types</span><span class="p">])),</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Vertex attribute `</span><span class="si">%s</span><span class="s1">` has only None values&#39;</span>
                                <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">),</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">list</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">init_vertex_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;dirs&#39;</span><span class="p">])):</span>
            <span class="n">types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Edge attribute `</span><span class="si">%s</span><span class="s1">` has multiple types of&#39;</span>
                                <span class="s1">&#39; values: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                    <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">types</span><span class="p">])),</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Edge attribute `</span><span class="si">%s</span><span class="s1">` has only None values&#39;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">attr</span><span class="p">),</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">set</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span>
                <span class="k">elif</span> <span class="nb">list</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">init_edge_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

<div class="viewcode-block" id="PyPath.init_vertex_attr"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.init_vertex_attr">[docs]</a>    <span class="k">def</span> <span class="nf">init_vertex_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fills vertex attribute with its default values, creates</span>
<span class="sd">        lists if in `vertexAttrs` the attribute is registered as list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">[</span>
                    <span class="n">attr</span><span class="p">])</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">simpleTypes</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="PyPath.init_edge_attr"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.init_edge_attr">[docs]</a>    <span class="k">def</span> <span class="nf">init_edge_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fills edge attribute with its default values, creates</span>
<span class="sd">        lists if in `edgeAttrs` the attribute is registered as list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]()</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="nb">set</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">[</span>
                    <span class="n">attr</span><span class="p">])</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">simpleTypes</span><span class="p">:</span>

                <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]]</span> <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">charTypes</span> <span class="ow">or</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="nb">set</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>

                <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span></div>

<div class="viewcode-block" id="PyPath.attach_network"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.attach_network">[docs]</a>    <span class="k">def</span> <span class="nf">attach_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edgeList</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">regulator</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds edges to the network from edgeList obtained from file or</span>
<span class="sd">        other input method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">edgeList</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">edgeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;attach_network(): No data, nothing to do.&quot;</span><span class="p">,</span>
                                <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edgeList</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">edgeList</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="n">edgeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">edgeList</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;`</span><span class="si">%s</span><span class="s2">&#39; looks like a source name, but no data&quot;</span>
                                <span class="s2">&quot;available under this name.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">edgeList</span><span class="p">),</span>
                                <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># adding nodes and edges first in bunch,</span>
        <span class="c1"># to avoid multiple reindexing by igraph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">edgeList</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Processing nodes&quot;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edgeList</span><span class="p">:</span>
            <span class="n">aexists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">])</span>
            <span class="n">bexists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">aexists</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">regulator</span> <span class="ow">or</span> <span class="n">bexists</span><span class="p">):</span>
                <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bexists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">regulator</span><span class="p">:</span>
                <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">])</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_nodes</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;New nodes have been created&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">edgeList</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Processing edges&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edgeList</span><span class="p">:</span>
            <span class="n">aexists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">])</span>
            <span class="n">bexists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">aexists</span> <span class="ow">and</span> <span class="n">bexists</span><span class="p">:</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">edge</span><span class="p">))</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_edges</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">edges</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;New edges have been created&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;&quot;&quot;Introducing new node and edge attributes...&quot;&quot;&quot;</span><span class="p">),</span>
                        <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">edgeList</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Processing attributes&quot;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">nodes_updated</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edgeList</span><span class="p">:</span>
            <span class="c1"># adding new node attributes</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes_updated</span><span class="p">:</span>
                <span class="n">defAttrs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;nameType&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameTypeA&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;typeA&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;ncbi_tax_id&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;taxA&quot;</span><span class="p">]</span>
                <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_update_vertex</span><span class="p">(</span><span class="n">defAttrs</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;nameA&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;nameTypeA&quot;</span><span class="p">],</span>
                                       <span class="n">e</span><span class="p">[</span><span class="s2">&quot;attrsNodeA&quot;</span><span class="p">])</span>
                <span class="n">nodes_updated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes_updated</span><span class="p">:</span>
                <span class="n">defAttrs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;nameType&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameTypeB&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;typeB&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;ncbi_tax_id&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;taxB&quot;</span><span class="p">]</span>
                <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_update_vertex</span><span class="p">(</span><span class="n">defAttrs</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;nameB&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;nameTypeB&quot;</span><span class="p">],</span>
                                       <span class="n">e</span><span class="p">[</span><span class="s2">&quot;attrsNodeB&quot;</span><span class="p">])</span>
                <span class="n">nodes_updated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">])</span>
            <span class="c1"># adding new edge attributes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_update_edge</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">],</span>
                                 <span class="n">e</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;isDirected&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;references&quot;</span><span class="p">],</span>
                                 <span class="n">e</span><span class="p">[</span><span class="s2">&quot;stim&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;inh&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;taxA&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;taxB&quot;</span><span class="p">],</span>
                                 <span class="n">e</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;attrsEdge&quot;</span><span class="p">])</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_attrs</span><span class="p">()</span></div>

<div class="viewcode-block" id="PyPath.apply_list"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.apply_list">[docs]</a>    <span class="k">def</span> <span class="nf">apply_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">node_or_edge</span><span class="o">=</span><span class="s2">&quot;node&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates vertex or edge attribute based on a list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;&quot;&quot;No such list: </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="n">node_or_edge</span> <span class="o">==</span> <span class="s2">&quot;edge&quot;</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">node_or_edge</span> <span class="o">==</span> <span class="s2">&quot;edge&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                        <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">e</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                                                    <span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                        <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">e</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                                                    <span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">node_or_edge</span> <span class="o">==</span> <span class="s2">&quot;edge&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                        <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">e</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">e</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="PyPath.merge_lists"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.merge_lists">[docs]</a>    <span class="k">def</span> <span class="nf">merge_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">nameA</span><span class="p">,</span>
                    <span class="n">nameB</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">and_or</span><span class="o">=</span><span class="s2">&quot;and&quot;</span><span class="p">,</span>
                    <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">func</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merges two lists in `lists`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nameA</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;&quot;&quot;No such list: </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">nameA</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">nameB</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;&quot;&quot;No such list: </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">nameB</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">])</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">and_or</span> <span class="o">==</span> <span class="s2">&quot;and&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">])</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">and_or</span> <span class="o">==</span> <span class="s2">&quot;or&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">and_or</span> <span class="o">==</span> <span class="s2">&quot;and&quot;</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span>
                    <span class="p">)))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">(</span>
                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">][</span><span class="n">k</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">and_or</span> <span class="o">==</span> <span class="s2">&quot;or&quot;</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span>
                    <span class="p">)))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">][</span><span class="n">k</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]</span></div>

<div class="viewcode-block" id="PyPath.save_session"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.save_session">[docs]</a>    <span class="k">def</span> <span class="nf">save_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save current state into pickle dump.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pickleFile</span> <span class="o">=</span> <span class="s2">&quot;pypath-&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">+</span> <span class="s2">&quot;.pickle&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;&quot;&quot;Saving session to </span><span class="si">%s</span><span class="s2">... &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">pickleFile</span><span class="p">),</span>
                        <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickleFile</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>

    <span class="c1">###</span>
    <span class="c1"># functions for plotting // with custom typeface ;)</span>
    <span class="c1">###</span>

    <span class="c1">#</span>
    <span class="c1"># functions to compare networks and pathways</span>
    <span class="c1">#</span>

    <span class="k">def</span> <span class="nf">databases_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;simpson&#39;</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">s</span><span class="p">,</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]])</span>
                      <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">])</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">s</span><span class="p">,</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]])</span>
                      <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">])</span>
        <span class="n">sNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_groups</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
        <span class="n">sEdges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_groups</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="n">sNodes</span><span class="p">,</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="n">sEdges</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">similarity_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;simpson&#39;</span><span class="p">):</span>
        <span class="n">index_func</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_index&#39;</span> <span class="o">%</span> <span class="n">index</span>
        <span class="c1"># these are imported into globals() from common:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.common&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]],</span>
                   <span class="n">index_func</span><span class="p">):</span>
            <span class="n">to_call</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.common&#39;</span> <span class="o">%</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]],</span>
                              <span class="n">index_func</span><span class="p">)</span>
            <span class="n">grs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">sor</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">g</span><span class="p">,</span> <span class="p">{})</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">grs</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">g1</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">grs</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">g2</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">grs</span><span class="p">)):</span>
                    <span class="n">sor</span><span class="p">[</span><span class="n">grs</span><span class="p">[</span><span class="n">g1</span><span class="p">]][</span><span class="n">grs</span><span class="p">[</span><span class="n">g2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">to_call</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">grs</span><span class="p">[</span><span class="n">g1</span><span class="p">]],</span>
                                                    <span class="n">groups</span><span class="p">[</span><span class="n">grs</span><span class="p">[</span><span class="n">g2</span><span class="p">]])</span>
                    <span class="n">sor</span><span class="p">[</span><span class="n">grs</span><span class="p">[</span><span class="n">g2</span><span class="p">]][</span><span class="n">grs</span><span class="p">[</span><span class="n">g1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sor</span><span class="p">[</span><span class="n">grs</span><span class="p">[</span><span class="n">g1</span><span class="p">]][</span><span class="n">grs</span><span class="p">[</span><span class="n">g2</span><span class="p">]]</span>
            <span class="k">return</span> <span class="n">sor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;No such function: </span><span class="si">%s</span><span class="s1">()&#39;</span> <span class="o">%</span> <span class="n">index_func</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sorensen_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pwlist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="n">pwlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pwlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathway_types</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pwlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;No such vertex attribute: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="p">),</span>
                                <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">indA</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span>
            <span class="n">indB</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span>
            <span class="n">pwsA</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pwsB</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pwlist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">indA</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">indA</span><span class="p">][</span><span class="n">p</span><span class="p">]:</span>
                        <span class="n">thisPw</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_pathways&quot;</span><span class="p">,</span> <span class="s2">&quot;__&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pw</span>
                        <span class="k">if</span> <span class="n">thisPw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">nodes</span><span class="p">[</span><span class="n">thisPw</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">nodes</span><span class="p">[</span><span class="n">thisPw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indA</span><span class="p">)</span>
                        <span class="n">pwsA</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisPw</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">indB</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">indB</span><span class="p">][</span><span class="n">p</span><span class="p">]:</span>
                        <span class="n">thisPw</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_pathways&quot;</span><span class="p">,</span> <span class="s2">&quot;__&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pw</span>
                        <span class="k">if</span> <span class="n">thisPw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">nodes</span><span class="p">[</span><span class="n">thisPw</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">nodes</span><span class="p">[</span><span class="n">thisPw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indB</span><span class="p">)</span>
                        <span class="n">pwsB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisPw</span><span class="p">)</span>
            <span class="n">pwsE</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">pwsA</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">pwsB</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">pwsE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                    <span class="n">edges</span><span class="p">[</span><span class="n">pw</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">edges</span><span class="p">[</span><span class="n">pw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">sNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_groups</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">sEdges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_groups</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="n">sNodes</span><span class="p">,</span> <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="n">sEdges</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">write_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">tbl</span><span class="p">,</span>
                    <span class="n">outfile</span><span class="p">,</span>
                    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">cut</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">colnames</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">rownames</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">rn</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;header&quot;</span> <span class="ow">in</span> <span class="n">rn</span><span class="p">:</span>
            <span class="n">cn</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span>
            <span class="n">rn</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cn</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">rn</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))]</span>
        <span class="k">if</span> <span class="n">colnames</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rownames</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">sep</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rn</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rownames</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span>
            <span class="n">thisRow</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tbl</span><span class="p">[</span><span class="n">r</span><span class="p">]]</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">thisRow</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="o">+</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">search_attr_or</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">a</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                        <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">search_attr_and</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">a</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                        <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">!=</span> <span class="n">v</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crit</span><span class="p">,</span> <span class="n">andor</span><span class="o">=</span><span class="s2">&quot;or&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">keepV</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">delE</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">andor</span> <span class="o">==</span> <span class="s2">&quot;and&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">keepThis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_and</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">crit</span><span class="p">[</span><span class="s2">&quot;edge&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">keepThis</span><span class="p">:</span>
                    <span class="n">keepA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_and</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">],</span> <span class="n">crit</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">keepA</span><span class="p">:</span>
                        <span class="n">keepV</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]</span>
                    <span class="n">keepB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_and</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">],</span> <span class="n">crit</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">keepB</span><span class="p">:</span>
                        <span class="n">keepV</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">keepA</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">keepB</span><span class="p">:</span>
                        <span class="n">delE</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">delE</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">keepThis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_or</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">crit</span><span class="p">[</span><span class="s2">&quot;edge&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">keepThis</span><span class="p">:</span>
                    <span class="n">keepV</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">delE</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crit</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">keepA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_or</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">],</span> <span class="n">crit</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">keepA</span><span class="p">:</span>
                        <span class="n">keep</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]</span>
                    <span class="n">keepB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_or</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">],</span> <span class="n">crit</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">keepB</span><span class="p">:</span>
                        <span class="n">keep</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keepV</span><span class="p">)),</span> <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">delE</span><span class="p">))}</span>

    <span class="k">def</span> <span class="nf">edgeseq_inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
                <span class="n">inv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inv</span>

    <span class="k">def</span> <span class="nf">get_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crit</span><span class="p">,</span> <span class="n">andor</span><span class="o">=</span><span class="s2">&quot;or&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sub</span><span class="p">(</span><span class="n">crit</span><span class="p">,</span> <span class="n">andor</span><span class="o">=</span><span class="n">andor</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">g</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">new</span><span class="o">.</span><span class="n">induced_subgraph</span><span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>

<div class="viewcode-block" id="PyPath.separate"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.separate">[docs]</a>    <span class="k">def</span> <span class="nf">separate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Separates networks from different sources.</span>
<span class="sd">        Returns dict of igraph objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">({</span>
            <span class="s1">&#39;edge&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;sources&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}))</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">])</span></div>

<div class="viewcode-block" id="PyPath.separate_by_category"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.separate_by_category">[docs]</a>    <span class="k">def</span> <span class="nf">separate_by_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Separate networks based on categories.</span>
<span class="sd">        Returns dict of igraph objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cats</span> <span class="o">=</span> \
            <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span>
                            <span class="p">(</span>
                                <span class="n">c</span><span class="p">,</span>
                                <span class="nb">list</span><span class="p">(</span>
                                    <span class="nb">filter</span><span class="p">(</span>
                                        <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span>
                                            <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">,</span>
                                        <span class="nb">map</span><span class="p">(</span>
                                            <span class="k">lambda</span> <span class="n">cs</span><span class="p">:</span>
                                                <span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                            <span class="nb">filter</span><span class="p">(</span>
                                                <span class="k">lambda</span> <span class="n">cs</span><span class="p">:</span>
                                                    <span class="n">cs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">,</span>
                                                <span class="n">iteritems</span><span class="p">(</span>
                                                    <span class="n">data_formats</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>
                                                    <span class="p">)</span>
                                        <span class="p">)</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                            <span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">has_cats</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">({</span>
            <span class="s1">&#39;edge&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;sources&#39;</span><span class="p">:</span> <span class="n">s</span>
            <span class="p">},</span>
            <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}))</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">cats</span><span class="p">)])</span></div>

    <span class="k">def</span> <span class="nf">update_pathway_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">pwTyp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;_pathways&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">pwTyp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathway_types</span> <span class="o">=</span> <span class="n">pwTyp</span>

    <span class="k">def</span> <span class="nf">source_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;pwnet-&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;-sim-src&quot;</span><span class="p">])</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_databases</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span> <span class="n">outfile</span> <span class="o">+</span> <span class="s2">&quot;-nodes&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span> <span class="n">outfile</span> <span class="o">+</span> <span class="s2">&quot;-edges&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pathway_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;pwnet-&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;-sim-pw&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_pathway_types</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_pathways</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span> <span class="n">outfile</span> <span class="o">+</span> <span class="s2">&quot;-nodes&quot;</span><span class="p">,</span> <span class="n">cut</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span> <span class="n">outfile</span> <span class="o">+</span> <span class="s2">&quot;-edges&quot;</span><span class="p">,</span> <span class="n">cut</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<div class="viewcode-block" id="PyPath.update_sources"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.update_sources">[docs]</a>    <span class="k">def</span> <span class="nf">update_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes sure that the `sources` attribute is an up to date</span>
<span class="sd">        list of all sources in the current network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">src</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">+=</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">src</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_cats</span><span class="p">()</span></div>

<div class="viewcode-block" id="PyPath.update_cats"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.update_cats">[docs]</a>    <span class="k">def</span> <span class="nf">update_cats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes sure that the `has_cats` attribute is an up to date</span>
<span class="sd">        set of all categories in the current network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_cats</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="n">s</span><span class="p">],</span>
                    <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">))))</span></div>

    <span class="k">def</span> <span class="nf">update_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">pws</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_pathways&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pws</span><span class="p">:</span>
                        <span class="n">pws</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">pws</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                                <span class="n">pws</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathways</span> <span class="o">=</span> <span class="n">pws</span>

    <span class="k">def</span> <span class="nf">delete_unmapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;unmapped&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;unmapped&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_db_dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>

<div class="viewcode-block" id="PyPath.genesymbol_labels"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.genesymbol_labels">[docs]</a>    <span class="k">def</span> <span class="nf">genesymbol_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remap_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creats vertex attribute ``label`` and fills up with Gene Symbols</span>
<span class="sd">        of all proteins where the Gene Symbol can be looked up based on</span>
<span class="sd">        the default name of the protein vertex.</span>
<span class="sd">        If the attribute ``label`` had been already initialized,</span>
<span class="sd">        updates this attribute or recreates if ``remap_all``</span>
<span class="sd">        is ``True``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_already_has_directed</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span><span class="p">,</span> <span class="n">remap_all</span><span class="o">=</span><span class="n">remap_all</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">defaultNameType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="s2">&quot;protein&quot;</span><span class="p">]</span>
        <span class="n">labelNameTypes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;protein&#39;</span><span class="p">:</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;mirna&#39;</span><span class="p">:</span> <span class="s1">&#39;mir-mat-name&#39;</span><span class="p">}</span>

        <span class="k">if</span> <span class="s1">&#39;label&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">remap_all</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="n">remap_all</span> <span class="ow">or</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())):</span>

            <span class="k">if</span> <span class="n">l</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">labelNameTypes</span><span class="p">:</span>

                    <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]],</span>
                                                <span class="n">labelNameTypes</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]],</span>
                                                <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;ncbi_tax_id&#39;</span><span class="p">])</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
                    <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span></div>

<div class="viewcode-block" id="PyPath.network_stats"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.network_stats">[docs]</a>    <span class="k">def</span> <span class="nf">network_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates basic statistics for the whole network</span>
<span class="sd">        and each of sources. Writes the results in a tab file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;pwnet&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;stats&quot;</span><span class="p">])</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;vnum&quot;</span><span class="p">,</span> <span class="s2">&quot;enum&quot;</span><span class="p">,</span> <span class="s2">&quot;deg_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;diam&quot;</span><span class="p">,</span> <span class="s2">&quot;trans&quot;</span><span class="p">,</span> <span class="s2">&quot;adh&quot;</span><span class="p">,</span> <span class="s2">&quot;coh&quot;</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;All&quot;</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">({</span>
                <span class="s2">&quot;edge&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;sources&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="p">{}</span>
            <span class="p">})</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">stats</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span> <span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
                    <span class="nb">sum</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">())</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">)),</span> <span class="n">g</span><span class="o">.</span><span class="n">diameter</span><span class="p">(),</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">transitivity_undirected</span><span class="p">(),</span> <span class="n">g</span><span class="o">.</span><span class="n">adhesion</span><span class="p">(),</span> <span class="n">g</span><span class="o">.</span><span class="n">cohesion</span><span class="p">()</span>
                <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">degree_dists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dds</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">({</span><span class="s2">&quot;edge&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;sources&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">]},</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="p">{}})</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dds</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">degree_distribution</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">dds</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span> <span class="s2">&quot;pwnet-&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;-degdist-&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">bins</span><span class="p">():</span>
                <span class="n">bins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                                                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">])</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">intergroup_shortest_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupA</span><span class="p">,</span> <span class="n">groupB</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">groupA</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;No such attribute: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">groupA</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">groupB</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;No such attribute: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">groupB</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">deg_pathlen</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">rat_pathlen</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">rand_pathlen</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">diam_pathlen</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;All&quot;</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span><span class="p">,</span> <span class="n">groupA</span><span class="p">,</span> <span class="n">groupB</span><span class="p">,</span> <span class="s2">&quot;paths&quot;</span><span class="p">])</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">({</span>
                <span class="s2">&quot;edge&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;sources&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="p">{}</span>
            <span class="p">})</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">grA</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">grB</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupA</span><span class="p">]:</span>
                    <span class="n">grA</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupB</span><span class="p">]:</span>
                    <span class="n">grB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupB</span><span class="p">]:</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_shortest_paths</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">grA</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">&quot;epath&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pt</span><span class="p">:</span>
                        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">grA</span><span class="p">):</span>
                        <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;paths&quot;</span><span class="p">:</span> <span class="n">paths</span>
                <span class="p">},</span>
                <span class="n">outfile</span><span class="p">,</span>
                <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">,</span>
                <span class="n">colnames</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">rownames</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">deg</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
            <span class="n">mean_pathlen</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">))</span>
            <span class="n">deg_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_pathlen</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">deg</span><span class="p">))]</span>
            <span class="n">rat_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">mean_pathlen</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">grA</span> <span class="o">+</span> <span class="n">grB</span><span class="p">))))</span>
            <span class="p">]</span>
            <span class="n">diam_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_pathlen</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">diameter</span><span class="p">()]</span>
            <span class="k">if</span> <span class="n">random</span><span class="p">:</span>
                <span class="n">groupA_random</span> <span class="o">=</span> <span class="n">groupA</span> <span class="o">+</span> <span class="s2">&quot;_random&quot;</span>
                <span class="n">groupB_random</span> <span class="o">=</span> <span class="n">groupB</span> <span class="o">+</span> <span class="s2">&quot;_random&quot;</span>
                <span class="n">random_pathlen</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupA_random</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupA</span><span class="p">])</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupB_random</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupB</span><span class="p">])</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupA_random</span><span class="p">])</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupB_random</span><span class="p">])</span>
                    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">grA</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">grB</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupA_random</span><span class="p">]:</span>
                            <span class="n">grA</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupB_random</span><span class="p">]:</span>
                            <span class="n">grB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupB_random</span><span class="p">]:</span>
                            <span class="n">pt</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_shortest_paths</span><span class="p">(</span>
                                <span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">grA</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">&quot;epath&quot;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pt</span><span class="p">:</span>
                                <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">grA</span><span class="p">):</span>
                                <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">random_pathlen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">random_pathlen</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rand_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">mean_pathlen</span><span class="p">,</span>
                        <span class="nb">sum</span><span class="p">(</span><span class="n">random_pathlen</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">random_pathlen</span><span class="p">))</span>
                    <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rand_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_pathlen</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
        <span class="n">deg_pathlen</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;path_len&quot;</span><span class="p">,</span> <span class="s2">&quot;degree&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">deg_pathlen</span><span class="p">,</span> <span class="s2">&quot;deg_pathlen&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
        <span class="n">diam_pathlen</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;path_len&quot;</span><span class="p">,</span> <span class="s2">&quot;diam&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">diam_pathlen</span><span class="p">,</span> <span class="s2">&quot;diam_pathlen&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
        <span class="n">rat_pathlen</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;path_len&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">rat_pathlen</span><span class="p">,</span> <span class="s2">&quot;rat_pathlen&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">:</span>
            <span class="n">rand_pathlen</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;path_len&quot;</span><span class="p">,</span> <span class="s2">&quot;random&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">rand_pathlen</span><span class="p">,</span> <span class="s2">&quot;rand_pathlen&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_vertex_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">,</span> <span class="s1">&#39;references&#39;</span><span class="p">]:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">set_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;refs_by_cat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">categories</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">data_formats</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">categories</span><span class="p">:</span>
                    <span class="n">cat</span> <span class="o">=</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">cat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_cat&#39;</span><span class="p">]:</span>
                        <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_cat&#39;</span><span class="p">][</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
                    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">]:</span>
                        <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_cat&#39;</span><span class="p">][</span><span class="n">cat</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">basic_stats_intergroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupA</span><span class="p">,</span> <span class="n">groupB</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;All&quot;</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">({</span>
                <span class="s2">&quot;edge&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;sources&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="n">s</span><span class="p">])</span>
                <span class="p">},</span>
                <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="p">{}</span>
            <span class="p">})</span>
            <span class="n">deg</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
            <span class="n">bw</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">betweenness</span><span class="p">()</span>
            <span class="n">vnum</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span>
            <span class="n">enum</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ecount</span><span class="p">()</span>
            <span class="n">cancerg</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">drugt</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">cdeg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tdeg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ddeg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cbw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tbw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dbw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="n">tdeg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deg</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                <span class="n">tbw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bw</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">groupA</span><span class="p">]:</span>
                    <span class="n">cg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                    <span class="n">cancerg</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">cdeg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deg</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                    <span class="n">cbw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bw</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">groupB</span><span class="p">]:</span>
                    <span class="n">dt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                    <span class="n">drugt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">ddeg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deg</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                    <span class="n">dbw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bw</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
            <span class="n">cpct</span> <span class="o">=</span> <span class="n">cancerg</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">groupA</span><span class="p">]))</span>
            <span class="n">dpct</span> <span class="o">=</span> <span class="n">drugt</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">groupB</span><span class="p">]))</span>
            <span class="n">tdgr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tdeg</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tdeg</span><span class="p">))</span>
            <span class="n">cdgr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cdeg</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cdeg</span><span class="p">))</span>
            <span class="n">ddgr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ddeg</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ddeg</span><span class="p">))</span>
            <span class="n">tbwn</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tbw</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tbw</span><span class="p">))</span>
            <span class="n">cbwn</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cbw</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cbw</span><span class="p">))</span>
            <span class="n">dbwn</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dbw</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dbw</span><span class="p">))</span>
            <span class="n">src</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">csrc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dsrc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">src</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="n">groupA</span><span class="p">]</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="n">groupA</span><span class="p">]:</span>
                    <span class="n">csrc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="n">groupB</span><span class="p">]</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="n">groupB</span><span class="p">]:</span>
                    <span class="n">dsrc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]))</span>
            <span class="n">snum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">src</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">src</span><span class="p">))</span>
            <span class="n">csnum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">csrc</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csrc</span><span class="p">))</span>
            <span class="n">dsnum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dsrc</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dsrc</span><span class="p">))</span>
            <span class="n">result</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">vnum</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">enum</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">cancerg</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">drugt</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">cpct</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">dpct</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">tdgr</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">cdgr</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">ddgr</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">tbwn</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">cbwn</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">dbwn</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">snum</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">csnum</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">dsnum</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">groupA</span><span class="p">,</span> <span class="n">groupB</span><span class="p">,</span> <span class="s2">&quot;stats&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">colnames</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">colnames</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sources_venn_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="n">ini</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">inj</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]:</span>
                        <span class="n">ini</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]:</span>
                        <span class="n">inj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">onlyi</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ini</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">inj</span><span class="p">))))</span>
                <span class="n">onlyj</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">inj</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">ini</span><span class="p">))))</span>
                <span class="n">inter</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ini</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">inj</span><span class="p">))))</span>
                <span class="n">result</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">onlyi</span><span class="p">,</span> <span class="n">onlyj</span><span class="p">,</span> <span class="n">inter</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;sources-venn-data.csv&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sources_hist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">srcnum</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">srcnum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;srcnum&quot;</span><span class="p">:</span> <span class="n">srcnum</span>
            <span class="p">},</span>
            <span class="s2">&quot;source_num&quot;</span><span class="p">,</span>
            <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">,</span>
            <span class="n">rownames</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">colnames</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">degree_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;deg&quot;</span><span class="p">:</span> <span class="n">deg</span>
            <span class="p">},</span>
            <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;-whole-degdist&quot;</span><span class="p">,</span>
            <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">,</span>
            <span class="n">rownames</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">colnames</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Missing vertex attribute!&quot;</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">gr</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                <span class="n">dgr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">gr</span><span class="p">]:</span>
                        <span class="n">dgr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;deg&quot;</span><span class="p">:</span> <span class="n">dgr</span>
                    <span class="p">},</span>
                    <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">gr</span> <span class="o">+</span> <span class="s2">&quot;-degdist&quot;</span><span class="p">,</span>
                    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">,</span>
                    <span class="n">rownames</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">colnames</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_by_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">source</span><span class="p">,</span>
                         <span class="n">vertexAttrsToDel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">edgeAttrsToDel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">verticesToDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">source</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">verticesToDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">verticesToDel</span><span class="p">)</span>
        <span class="n">edgesToDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">source</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">edgesToDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">source</span><span class="p">])</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="n">edgesToDel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vertexAttrsToDel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vAttr</span> <span class="ow">in</span> <span class="n">vertexAttrsToDel</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">vAttr</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                    <span class="k">del</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vAttr</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">edgeAttrsToDel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">eAttr</span> <span class="ow">in</span> <span class="n">edgeAttrsToDel</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">eAttr</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                    <span class="k">del</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">eAttr</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reference_hist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">tbl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">tbl</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                        <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">])),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]))))</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">+</span> <span class="s2">&quot;-refs-hist&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tbl</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="PyPath.load_resources"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_resources">[docs]</a>    <span class="k">def</span> <span class="nf">load_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">lst</span><span class="o">=</span><span class="n">omnipath</span><span class="p">,</span>
                       <span class="n">exclude</span><span class="o">=</span><span class="p">[],</span>
                       <span class="n">cache_files</span><span class="o">=</span><span class="p">{},</span>
                       <span class="n">reread</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">redownload</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads multiple resources, and cleans up after.</span>
<span class="sd">        Looks up ID types, and loads all ID conversion</span>
<span class="sd">        tables from UniProt if necessary. This is much</span>
<span class="sd">        faster than loading the ID conversion and the</span>
<span class="sd">        resources one by one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_reflists</span><span class="p">()</span>
        <span class="n">huge</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">huge</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache_files</span><span class="p">)</span>
        <span class="n">nothuge</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">huge</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">cache_files</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="p">[</span><span class="n">huge</span><span class="p">,</span> <span class="n">nothuge</span><span class="p">]:</span>

            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">load_resource</span><span class="p">(</span>
                    <span class="n">v</span><span class="p">,</span>
                    <span class="n">clean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">cache_files</span><span class="o">=</span><span class="n">cache_files</span><span class="p">,</span>
                    <span class="n">reread</span><span class="o">=</span><span class="n">reread</span><span class="p">,</span>
                    <span class="n">redownload</span><span class="o">=</span><span class="n">redownload</span><span class="p">)</span>
                <span class="c1"># try:</span>
                <span class="c1">#    self.load_resource(v, clean = False,</span>
                <span class="c1">#        cache_files = cache_files,</span>
                <span class="c1">#        reread = reread,</span>
                <span class="c1">#        redownload = redownload)</span>
                <span class="c1"># except:</span>
                <span class="c1">#    sys.stdout.write(&#39;\t:: Could not load %s, unexpected error &#39;\</span>
                <span class="c1">#        &#39;occurred, see %s for error.\n&#39;%(k, self.ownlog.logfile))</span>
                <span class="c1">#    self.ownlog.msg(1, &#39;Error at loading %s: \n%s\n, \t%s, %s\n&#39; % \</span>
                <span class="c1">#            (k, sys.exc_info()[1],</span>
                <span class="c1">#            sys.exc_info()[2],</span>
                <span class="c1">#            sys.exc_info()[0]),</span>
                <span class="c1">#        &#39;ERROR&#39;)</span>
                <span class="c1">#    sys.stdout.flush()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean_graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;\n &gt; %u interactions between %u nodes\n from %u&quot;&quot;&quot;</span>
            <span class="sd">&quot;&quot;&quot; resources have been loaded,\n for details see the log: ./%s\n&quot;&quot;&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">),</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">logfile</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">load_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">load_mappings</span><span class="p">(</span><span class="n">maps</span><span class="o">=</span><span class="n">data_formats</span><span class="o">.</span><span class="n">mapList</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">settings</span><span class="p">,</span>
                      <span class="n">clean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">cache_files</span><span class="o">=</span><span class="p">{},</span>
                      <span class="n">reread</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">redownload</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &gt; &#39;</span> <span class="o">+</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span>
            <span class="n">settings</span><span class="p">,</span>
            <span class="n">cache_files</span><span class="o">=</span><span class="n">cache_files</span><span class="p">,</span>
            <span class="n">reread</span><span class="o">=</span><span class="n">reread</span><span class="p">,</span>
            <span class="n">redownload</span><span class="o">=</span><span class="n">redownload</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attach_network</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">clean</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_reflists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reflst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">reflst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reflst</span> <span class="o">=</span> <span class="n">reflists</span><span class="o">.</span><span class="n">get_reflists</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">rl</span> <span class="ow">in</span> <span class="n">reflst</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_reflist</span><span class="p">(</span><span class="n">rl</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_reflist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reflist</span><span class="p">):</span>
        <span class="n">reflist</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">reflist</span><span class="o">.</span><span class="n">nameType</span><span class="p">,</span> <span class="n">reflist</span><span class="o">.</span><span class="n">typ</span><span class="p">,</span> <span class="n">reflist</span><span class="o">.</span><span class="n">tax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">reflist</span>

    <span class="k">def</span> <span class="nf">load_negatives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">negative</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &gt; &#39;</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_negative</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<div class="viewcode-block" id="PyPath.load_tfregulons"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_tfregulons">[docs]</a>    <span class="k">def</span> <span class="nf">load_tfregulons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">},</span> <span class="n">only_curated</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds TF-target interactions from TF regulons to the network.</span>

<span class="sd">        :param set levels:</span>
<span class="sd">            Confidence levels to be used.</span>
<span class="sd">        :param bool only_curated:</span>
<span class="sd">            Retrieve only literature curated interactions.</span>

<span class="sd">        Details</span>
<span class="sd">        -------</span>
<span class="sd">        TF regulons is a comprehensive resource of TF-target interactions</span>
<span class="sd">        combining multiple lines of evidences: literature curated databases,</span>
<span class="sd">        ChIP-Seq data, PWM based prediction using HOCOMOCO and JASPAR matrices</span>
<span class="sd">        and prediction from GTEx expression data by ARACNe.</span>

<span class="sd">        For details see https://github.com/saezlab/DoRothEA.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import pypath</span>
<span class="sd">        &gt;&gt;&gt; pa = pypath.PyPath()</span>
<span class="sd">        &gt;&gt;&gt; pa.load_tfregulons(levels = {&#39;A&#39;})</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data_formats</span><span class="o">.</span><span class="n">transcription</span><span class="p">[</span><span class="s1">&#39;tfregulons&#39;</span><span class="p">])</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">inputArgs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;levels&#39;</span><span class="p">:</span> <span class="n">levels</span><span class="p">,</span>
            <span class="s1">&#39;only_curated&#39;</span><span class="p">:</span> <span class="n">only_curated</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_resources</span><span class="p">({</span><span class="s1">&#39;tfregulons&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="p">})</span></div>

    <span class="k">def</span> <span class="nf">list_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &gt; omnipath</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">omnipath</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &gt; good</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">good</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">descriptions</span><span class="o">.</span><span class="n">descriptions</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; :: Sorry, no description available about </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                             <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">::: </span><span class="si">%s</span><span class="s1"> :::</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span>
        <span class="k">if</span> <span class="s1">&#39;urls&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;webpages&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">]:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Webpages:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">][</span><span class="s1">&#39;webpages&#39;</span><span class="p">]:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">    &gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">w</span>
            <span class="k">if</span> <span class="s1">&#39;articles&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">]:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Articles:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">][</span><span class="s1">&#39;articles&#39;</span><span class="p">]:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">    &gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">w</span>
        <span class="k">if</span> <span class="s1">&#39;taxons&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Taxons: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;taxons&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;descriptions&#39;</span> <span class="ow">in</span> <span class="n">dd</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;descriptions&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">:: From the authors:</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;descriptions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">    &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;notes&#39;</span> <span class="ow">in</span> <span class="n">dd</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;notes&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">:: Notes:</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;notes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">    &#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># functions to make life easier</span>
    <span class="c1">#</span>

    <span class="k">def</span> <span class="nf">having_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">es_or_vs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;es&#39;</span> <span class="k">if</span> <span class="n">edges</span> <span class="k">else</span> <span class="s1">&#39;vs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">es_or_vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">es_or_vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">something</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="n">attr</span><span class="p">]):</span>
                    <span class="k">yield</span> <span class="n">i</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="n">index</span> <span class="k">else</span> <span class="n">i</span>

    <span class="k">def</span> <span class="nf">having_eattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">having_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">having_vattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">having_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">having_ptm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">having_eattr</span><span class="p">(</span><span class="s1">&#39;ptm&#39;</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">loop_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="n">index</span> <span class="k">else</span> <span class="n">e</span>

    <span class="c1">#</span>
    <span class="c1"># functions to make topological analysis on the graph</span>
    <span class="c1">#</span>

    <span class="k">def</span> <span class="nf">first_neighbours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">neighborhood</span><span class="p">(</span><span class="n">node</span><span class="p">))</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">node</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">indices</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lst</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nlst</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
                <span class="n">nlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">nlst</span>

    <span class="k">def</span> <span class="nf">second_neighbours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">with_first</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">node_i</span> <span class="o">=</span> <span class="n">node</span>
            <span class="n">node_n</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">node_i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node_i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">node_i</span> <span class="o">=</span> <span class="n">node_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                <span class="n">node_n</span> <span class="o">=</span> <span class="n">node</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span>
        <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_neighbours</span><span class="p">(</span><span class="n">node_i</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">first</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_neighbours</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">with_first</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">+=</span> <span class="n">first</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">first</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">indices</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">node_i</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">node_n</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">all_neighbours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;neighbours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Searching neighbours&quot;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="n">v</span><span class="p">[</span><span class="s1">&#39;neighbours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_neighbours</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">jaccard_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_neighbours</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">metaEdges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Calculating Jaccard-indices&quot;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()):</span>
                <span class="n">vv</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="n">vw</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
                <span class="n">ja</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vv</span><span class="p">[</span><span class="s1">&#39;neighbours&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">vw</span><span class="p">[</span><span class="s1">&#39;neighbours&#39;</span><span class="p">]))</span> <span class="o">/</span>
                      <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vv</span><span class="p">[</span><span class="s1">&#39;neighbours&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">vw</span><span class="p">[</span><span class="s1">&#39;neighbours&#39;</span><span class="p">])))</span>
                <span class="n">metaEdges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vv</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">vw</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">ja</span><span class="p">))</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">metaEdges</span>

    <span class="k">def</span> <span class="nf">jaccard_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jedges</span><span class="p">,</span> <span class="n">critical</span><span class="p">):</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">jedges</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">critical</span><span class="p">:</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">TupleList</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_negative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">negatives</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">negatives</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span>
        <span class="n">neg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">negatives</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">neg</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Matching interactions&quot;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">set</span><span class="p">([])</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span>
        <span class="p">]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;negative_refs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">set</span><span class="p">([])</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative_refs&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative_refs&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">neg</span><span class="p">:</span>
            <span class="n">aexists</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">bexists</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">aexists</span> <span class="ow">and</span> <span class="n">bexists</span><span class="p">:</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">refs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span>
                            <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">_refs</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">)),</span> <span class="n">n</span><span class="p">[</span>
                                <span class="s1">&#39;attrsEdge&#39;</span><span class="p">][</span><span class="s1">&#39;references&#39;</span><span class="p">])))</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;negative_refs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span>
                    <span class="n">matches</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%u</span><span class="s1"> matches found with negative set</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">matches</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">negative_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outFile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outFile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">+</span> <span class="s1">&#39;-negatives&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">neg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">outFile</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">])),</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">pmid</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">])),</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">]),</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative_refs&#39;</span><span class="p">])</span>
                    <span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="n">lst</span><span class="p">:</span>
                    <span class="n">neg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">neg</span>

    <span class="k">def</span> <span class="nf">export_ptms_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span>
                                   <span class="s1">&#39;network-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">+</span> <span class="s1">&#39;.tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="s1">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;UniProt_A&#39;</span><span class="p">,</span> <span class="s1">&#39;UniProt_B&#39;</span><span class="p">,</span> <span class="s1">&#39;GeneSymbol_A&#39;</span><span class="p">,</span> <span class="s1">&#39;GeneSymbol_B&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Databases&#39;</span><span class="p">,</span> <span class="s1">&#39;PubMed_IDs&#39;</span><span class="p">,</span> <span class="s1">&#39;Stimulation&#39;</span><span class="p">,</span> <span class="s1">&#39;Inhibition&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Substrate-isoform&#39;</span><span class="p">,</span> <span class="s1">&#39;Residue_number&#39;</span><span class="p">,</span> <span class="s1">&#39;Residue_letter&#39;</span><span class="p">,</span> <span class="s1">&#39;PTM_type&#39;</span>
        <span class="p">]</span>
        <span class="n">stripJson</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\[\]</span><span class="si">{}</span><span class="s1">\&quot;]&#39;</span><span class="p">)</span>
        <span class="c1"># first row is header</span>
        <span class="n">outl</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
                <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Writing table&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
            <span class="n">uniqedges</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="c1"># only directed</span>
                <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">which_dirs</span><span class="p">():</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">tgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="c1"># uniprot names</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">di</span><span class="p">)</span>
                    <span class="c1"># genesymbols</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">tgt</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]]</span>
                    <span class="c1"># sources</span>
                    <span class="n">dbs</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbs</span><span class="p">))</span>
                    <span class="c1"># references</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                        <span class="n">r</span>
                        <span class="k">for</span> <span class="n">rs</span> <span class="ow">in</span> <span class="p">[</span>
                            <span class="n">refs</span> <span class="k">for</span> <span class="n">db</span><span class="p">,</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">dbs</span>
                        <span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span>
                    <span class="p">]))</span>
                    <span class="c1"># signs</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">di</span><span class="p">)]</span>
                    <span class="c1"># domain-motif</span>
                    <span class="c1"># row.append(&#39;#&#39;.join([x.print_residues() for x in e[&#39;ptm&#39;] \</span>
                    <span class="c1">#    if x.__class__.__name__ == &#39;DomainMotif&#39;]))</span>
                    <span class="k">for</span> <span class="n">dmi</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">dmi</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;DomainMotif&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">protein</span> <span class="o">==</span> <span class="n">di</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                    <span class="n">uniqedges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                    <span class="n">r</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="p">[</span>
                                        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span>
                                        <span class="p">(</span><span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> <span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">isoform</span>
                                         <span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">number</span><span class="p">),</span>
                                        <span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span>
                                    <span class="p">]</span>
                                    <span class="c1"># here each ptm in separate row:</span>
                                    <span class="n">outl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                    <span class="c1"># row complete, appending to main list</span>
                    <span class="c1"># outl.append(row)</span>
                    <span class="c1"># tabular text from list of lists; writing to file</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">outl</span><span class="p">])</span>
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">console</span><span class="p">(</span><span class="s1">&#39;:: Data has been written to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outfile</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">uniqedges</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">export_struct_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span>
                                   <span class="s1">&#39;network-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">+</span> <span class="s1">&#39;.tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="s1">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;UniProt_A&#39;</span><span class="p">,</span> <span class="s1">&#39;UniProt_B&#39;</span><span class="p">,</span> <span class="s1">&#39;GeneSymbol_B&#39;</span><span class="p">,</span> <span class="s1">&#39;GeneSymbol_A&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Databases&#39;</span><span class="p">,</span> <span class="s1">&#39;PubMed_IDs&#39;</span><span class="p">,</span> <span class="s1">&#39;Stimulation&#39;</span><span class="p">,</span> <span class="s1">&#39;Inhibition&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Domain-domain&#39;</span><span class="p">,</span> <span class="s1">&#39;Domain-motif-PTM&#39;</span><span class="p">,</span> <span class="s1">&#39;PTM-regulation&#39;</span>
        <span class="p">]</span>
        <span class="n">stripJson</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\[\]</span><span class="si">{}</span><span class="s1">\&quot;]&#39;</span><span class="p">)</span>
        <span class="c1"># first row is header</span>
        <span class="n">outl</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
                <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Writing table&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="c1"># only directed</span>
                <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">which_dirs</span><span class="p">():</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">tgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="c1"># uniprot names</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">di</span><span class="p">)</span>
                    <span class="c1"># genesymbols</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">tgt</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]]</span>
                    <span class="c1"># sources</span>
                    <span class="n">dbs</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbs</span><span class="p">))</span>
                    <span class="c1"># references</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                        <span class="n">r</span>
                        <span class="k">for</span> <span class="n">rs</span> <span class="ow">in</span> <span class="p">[</span>
                            <span class="n">refs</span> <span class="k">for</span> <span class="n">db</span><span class="p">,</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">dbs</span>
                        <span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span>
                    <span class="p">]))</span>
                    <span class="c1"># signs</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">di</span><span class="p">)]</span>
                    <span class="c1"># domain-domain</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]]))</span>
                    <span class="c1"># domain-motif</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                        <span class="n">x</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;Ptm&#39;</span>
                    <span class="p">]))</span>
                    <span class="c1"># domain-motif</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                        <span class="n">x</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;Regulation&#39;</span>
                    <span class="p">]))</span>
                    <span class="c1"># row complete, appending to main list</span>
                    <span class="n">outl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="c1"># tabular text from list of lists; writing to file</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">outl</span><span class="p">])</span>
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">console</span><span class="p">(</span><span class="s1">&#39;:: Data has been written to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outfile</span><span class="p">)</span>

<div class="viewcode-block" id="PyPath.export_tab"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.export_tab">[docs]</a>    <span class="k">def</span> <span class="nf">export_tab</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">extra_node_attrs</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">extra_edge_attrs</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">unique_pairs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports the network in a tabular format.</span>

<span class="sd">        By default UniProt IDs, Gene Symbols, source databases, literature</span>
<span class="sd">        references, directionality and sign information and interaction type</span>
<span class="sd">        are included.</span>

<span class="sd">        Args:</span>
<span class="sd">        -----</span>
<span class="sd">        :param str outfile:</span>
<span class="sd">            Name of the output file. If `None` a file name</span>
<span class="sd">            &quot;netrowk-&lt;session id&gt;.tab&quot; is used.</span>
<span class="sd">        :param dict extra_node_attrs:</span>
<span class="sd">            Additional node attributes to be included in the exported table.</span>
<span class="sd">            Keys are column ames used in the header while values are names</span>
<span class="sd">            of vertex attributes. In the header `_A` and `_B` suffixes will</span>
<span class="sd">            be appended to the column names so the values can be assigned to</span>
<span class="sd">            A and B side interaction partners.</span>
<span class="sd">        :param dict extra_edge_attrs:</span>
<span class="sd">            Additional edge attributes to be included in the exported table.</span>
<span class="sd">            Keys are column ames used in the header while values are names</span>
<span class="sd">            of edge attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">e</span> <span class="o">=</span> <span class="n">export</span><span class="o">.</span><span class="n">Export</span><span class="p">(</span>
            <span class="n">pa</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span>
            <span class="n">extra_node_attrs</span> <span class="o">=</span> <span class="n">extra_node_attrs</span><span class="p">,</span>
            <span class="n">extra_edge_attrs</span> <span class="o">=</span> <span class="n">extra_edge_attrs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="n">e</span><span class="o">.</span><span class="n">write_tab</span><span class="p">(</span><span class="n">unique_pairs</span> <span class="o">=</span> <span class="n">unique_pairs</span><span class="p">,</span> <span class="n">outfile</span> <span class="o">=</span> <span class="n">outfile</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">export_sif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">outfile</span> <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
            <span class="k">else</span> <span class="s1">&#39;network-</span><span class="si">%s</span><span class="s1">.sif&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dirs</span><span class="p">)</span> <span class="k">if</span> <span class="n">b</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;undirected&#39;</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;undirected&#39;</span> \
                        <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([[</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                                      <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="k">if</span> <span class="n">v</span><span class="p">])</span>
                    <span class="n">dirn</span> <span class="o">=</span> <span class="s1">&#39;=&#39;</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;undirected&#39;</span> <span class="k">else</span> <span class="s1">&#39;&gt;&#39;</span>
                    <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> \
                        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;undirected&#39;</span> <span class="k">else</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> \
                        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;undirected&#39;</span> <span class="k">else</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">source</span><span class="p">,</span> <span class="n">sign</span> <span class="o">+</span> <span class="n">dirn</span><span class="p">,</span> <span class="n">target</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">export_graphml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;main&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span>
                                   <span class="s1">&#39;network-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">+</span> <span class="s1">&#39;.graphml&#39;</span><span class="p">)</span>
        <span class="n">isDir</span> <span class="o">=</span> <span class="s1">&#39;directed&#39;</span> <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;undirected&#39;</span>
        <span class="n">isDirB</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span> <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;false&#39;</span>
        <span class="n">nodeAttrs</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;UniProt&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;GeneSymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Type&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">)]</span>
        <span class="n">edgeAttrs</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Databases&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;PubMedIDs&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Undirected&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;DirectionAB&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;DirectionBA&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;StimulatoryAB&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;InhibitoryAB&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;StimulatoryBA&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;InhibitoryBA&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Category&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">)]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="s2">                    &lt;graphml xmlns=&quot;http://graphml.graphdrawing.org/xmlns&quot;</span>
<span class="s2">                    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="s2">                    xsi:schemaLocation=&quot;http://graphml.graphdrawing.org/xmlns</span>
<span class="s2">                    http://graphml.graphdrawing.org/xmlns/1.0/graphml.xsd&quot;&gt;</span><span class="se">\n\n</span><span class="s2"></span>
<span class="s2">                &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">nodeAttrs</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;key id=&quot;</span><span class="si">%s</span><span class="s1">&quot; for=&quot;node&quot; attr.name=&quot;</span><span class="si">%s</span><span class="s1">&quot; attr.type=&quot;</span><span class="si">%s</span><span class="s1">&quot; /&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">edgeAttrs</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;key id=&quot;</span><span class="si">%s</span><span class="s1">&quot; for=&quot;edge&quot; attr.name=&quot;</span><span class="si">%s</span><span class="s1">&quot; attr.type=&quot;</span><span class="si">%s</span><span class="s1">&quot; /&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&lt;graph id=&quot;</span><span class="si">%s</span><span class="s2">&quot; edgedefault=&quot;</span><span class="si">%s</span><span class="s2">&quot;</span>
<span class="s2">                        parse.nodeids=&quot;free&quot; parse.edgeids=&quot;canonical&quot;</span>
<span class="s2">                        parse.order=&quot;nodesfirst&quot;&gt;</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">isDir</span><span class="p">))</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Writing nodes&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&lt;!-- graph properties --&gt;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&lt;!-- vertices --&gt;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;node id=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;UniProt&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;GeneSymbol&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;Type&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;/node&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Writing edges&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&lt;!-- edges --&gt;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="s1">&#39;&lt;edge id=&quot;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&quot; source=&quot;</span><span class="si">%s</span><span class="s1">&quot; target=&quot;</span><span class="si">%s</span><span class="s1">&quot; directed=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                       <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">isDirB</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;Databases&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;PubMedIDs&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">pmid</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">])))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;Undirected&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs_by_source&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;DirectionAB&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs_by_source&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;DirectionBA&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs_by_source&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;StimulatoryAB&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;InhibitoryAB&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;StimulatoryBA&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;InhibitoryBA&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;InhibitoryBA&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;/edge&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&lt;/graph&gt;</span><span class="se">\n</span><span class="s1">&lt;/graphml&gt;&#39;</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">compounds_from_chembl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">chembl_mysql</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">crit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">andor</span><span class="o">=</span><span class="s2">&quot;or&quot;</span><span class="p">,</span>
                              <span class="n">assay_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">],</span>
                              <span class="n">relationship_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">],</span>
                              <span class="n">multi_query</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">chembl_mysql</span> <span class="o">=</span> <span class="n">chembl_mysql</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">chembl_mysql</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chembl</span> <span class="o">=</span> <span class="n">chembl</span><span class="o">.</span><span class="n">Chembl</span><span class="p">(</span>
            <span class="n">chembl_mysql</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span> <span class="n">mapper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">crit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sub</span><span class="p">(</span><span class="n">crit</span><span class="o">=</span><span class="n">crit</span><span class="p">,</span> <span class="n">andor</span><span class="o">=</span><span class="n">andor</span><span class="p">)</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="n">sub</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span>
        <span class="n">uniprots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;nameType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">:</span>
                <span class="n">uniprots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chembl</span><span class="o">.</span><span class="n">compounds_targets</span><span class="p">(</span>
            <span class="n">uniprots</span><span class="p">,</span>
            <span class="n">assay_types</span><span class="o">=</span><span class="n">assay_types</span><span class="p">,</span>
            <span class="n">relationship_types</span><span class="o">=</span><span class="n">relationship_types</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chembl</span><span class="o">.</span><span class="n">compounds_by_target</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;compounds_chembl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;compounds_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;compounds_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span>
                                           <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>
                                           <span class="p">]</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chembl</span><span class="o">.</span><span class="n">compounds</span><span class="p">)</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">num</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Adding compounds&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">hascomp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chembl</span><span class="o">.</span><span class="n">compounds</span><span class="p">):</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                <span class="n">hascomp</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">target</span><span class="p">)]</span>
                <span class="n">node</span><span class="p">[</span><span class="s1">&#39;compounds_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">node</span><span class="p">[</span><span class="s1">&#39;compounds_chembl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="s1">&#39;chembl&#39;</span><span class="p">])</span>
                    <span class="n">node</span><span class="p">[</span><span class="s1">&#39;compounds_names&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">comp</span><span class="p">[</span><span class="s1">&#39;compound_names&#39;</span><span class="p">]</span>
                <span class="n">node</span><span class="p">[</span><span class="s1">&#39;compounds_chembl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">node</span><span class="p">[</span>
                    <span class="s1">&#39;compounds_chembl&#39;</span><span class="p">])</span>
                <span class="n">node</span><span class="p">[</span><span class="s1">&#39;compounds_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">node</span><span class="p">[</span>
                    <span class="s1">&#39;compounds_names&#39;</span><span class="p">])</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">percent</span> <span class="o">=</span> <span class="n">hascomp</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Compounds found for </span><span class="si">%u</span><span class="s1"> targets, (</span><span class="si">%.2f%%</span><span class="s1"> of all proteins).</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">hascomp</span><span class="p">,</span> <span class="n">percent</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">))</span>

<div class="viewcode-block" id="PyPath.network_filter"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.network_filter">[docs]</a>    <span class="k">def</span> <span class="nf">network_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function aims to cut the number of edges in the network,</span>
<span class="sd">        without loosing nodes, to make the network less connected,</span>
<span class="sd">        less hairball-like, more usable for analysis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ref_freq</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">]:</span>
                            <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="n">avdeg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> <span class="s1">&#39;Calculating scores&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">rs</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">:</span>
                    <span class="n">score</span> <span class="o">+=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r</span><span class="p">]</span>
            <span class="n">mindeg</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">degree</span><span class="p">(),</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">degree</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">mindeg</span> <span class="o">&lt;</span> <span class="n">avdeg</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">*=</span> <span class="nb">pow</span><span class="p">((</span><span class="n">mindeg</span> <span class="o">-</span> <span class="n">avdeg</span><span class="p">),</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">e</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span></div>

<div class="viewcode-block" id="PyPath.shortest_path_dist"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.shortest_path_dist">[docs]</a>    <span class="k">def</span> <span class="nf">shortest_path_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        subset is a tuple of two lists if you wish to look for</span>
<span class="sd">        paths between elements of two groups, or a list if you</span>
<span class="sd">        wish to look for shortest paths within this group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">shortest_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="n">subset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span>
            <span class="n">subset</span><span class="p">,</span> <span class="n">subset</span><span class="p">)</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span> <span class="s1">&#39;Calculating paths&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">subset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">paths</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_shortest_paths</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>
                                                 <span class="n">xrange</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()),</span>
                                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">subset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span>
                            <span class="n">i</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span>
                                <span class="n">i</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">shortest_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shortest_paths</span><span class="p">])</span>
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">shortest_paths</span></div>

    <span class="k">def</span> <span class="nf">load_pdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">u_pdb</span><span class="p">,</span> <span class="n">pdb_u</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pdb</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">u_pdb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to download UniProt-PDB dictionary&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;pdb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="s1">&#39;pdb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">u_pdb</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pdb</span> <span class="ow">in</span> <span class="n">u_pdb</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]:</span>
                        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;pdb&#39;</span><span class="p">][</span><span class="n">pdb</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pdb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pdb</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;PDB IDs for proteins has been retrieved.&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_pfam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">u_pfam</span><span class="p">,</span> <span class="n">pfam_u</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pfam</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">u_pfam</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to download Pfam data from UniProt&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="s1">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">u_pfam</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">u_pfam</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Pfam domains has been retrieved.&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_pfam2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfam_regions</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to download data from Pfam&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Pfam domains has been retrieved.&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_pfam3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfam_regions</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to download data from Pfam&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;doms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pfam</span><span class="p">,</span> <span class="n">regions</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]):</span>
                        <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
                            <span class="n">v</span><span class="p">[</span><span class="s1">&#39;doms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span>
                                    <span class="n">protein</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                    <span class="n">domain</span><span class="o">=</span><span class="n">pfam</span><span class="p">,</span>
                                    <span class="n">start</span><span class="o">=</span><span class="n">region</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span>
                                    <span class="n">end</span><span class="o">=</span><span class="n">region</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span>
                                    <span class="n">isoform</span><span class="o">=</span><span class="n">region</span><span class="p">[</span><span class="s1">&#39;isoform&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Pfam domains has been retrieved.&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="PyPath.load_corum"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_corum">[docs]</a>    <span class="k">def</span> <span class="nf">load_corum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads complexes from CORUM database. Loads data into vertex attribute</span>
<span class="sd">        `graph.vs[&#39;complexes&#39;][&#39;corum&#39;]`.</span>
<span class="sd">        This resource is human only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">complexes</span><span class="p">,</span> <span class="n">members</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_corum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">complexes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to download data from CORUM&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_complex_attr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;corum&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">members</span><span class="p">):</span>
                <span class="n">sw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="mi">9606</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sw</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cs</span><span class="p">:</span>
                            <span class="n">others</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">memb</span> <span class="ow">in</span> <span class="n">complexes</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]:</span>
                                <span class="n">others</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">memb</span><span class="p">,</span>
                                                               <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                               <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                               <span class="mi">9606</span><span class="p">)</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                                <span class="n">name</span><span class="o">=</span><span class="n">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;corum&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                                    <span class="s1">&#39;full_name&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="s1">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">others</span><span class="p">,</span>
                                    <span class="s1">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">complexes</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                    <span class="s1">&#39;functions&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                    <span class="s1">&#39;diseases&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Complexes from CORUM have been retrieved.&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;INFO&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">init_complex_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;complexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]:</span>
                <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="PyPath.load_havugimana"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_havugimana">[docs]</a>    <span class="k">def</span> <span class="nf">load_havugimana</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads complexes from Havugimana 2012. Loads data into vertex attribute</span>
<span class="sd">        `graph.vs[&#39;complexes&#39;][&#39;havugimana&#39;]`.</span>
<span class="sd">        This resource is human only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">complexes</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">read_complexes_havugimana</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">complexes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to read data from Havugimana&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_complex_attr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;havugimana&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">complexes</span><span class="p">:</span>
                <span class="n">membs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">memb</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">membs</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">memb</span><span class="p">,</span>
                                                  <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                  <span class="mi">9606</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">membs</span><span class="p">:</span>
                    <span class="n">names</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">u</span><span class="p">,</span>
                                                  <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
                                                  <span class="mi">9606</span><span class="p">)</span>
                <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">membs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">u</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;havugimana&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s1">&#39;full_name&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; complex&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">membs</span><span class="p">,</span>
                                <span class="s1">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">c</span>
                            <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                    <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Complexes from Havugimana have been retrieved.&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;INFO&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyPath.load_compleat"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_compleat">[docs]</a>    <span class="k">def</span> <span class="nf">load_compleat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads complexes from Compleat. Loads data into vertex attribute</span>
<span class="sd">        `graph.vs[&#39;complexes&#39;][&#39;compleat&#39;]`.</span>
<span class="sd">        This resource is human only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">complexes</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_compleat</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">complexes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to load data from COMPLEAT&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_complex_attr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;compleat&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">complexes</span><span class="p">:</span>
                <span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">c</span><span class="p">[</span><span class="s1">&#39;gsymbols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;entrez&#39;</span><span class="p">]:</span>
                    <span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">e</span><span class="p">,</span>
                                                          <span class="s1">&#39;entrez&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                          <span class="mi">9606</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">]:</span>
                    <span class="n">c</span><span class="p">[</span><span class="s1">&#39;gsymbols&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">u</span><span class="p">,</span>
                                                          <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
                                                          <span class="mi">9606</span><span class="p">)</span>
                <span class="n">c</span><span class="p">[</span><span class="s1">&#39;gsymbols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">set</span><span class="p">([</span><span class="n">gs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">gs</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;gsymbols&#39;</span><span class="p">]]))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;gsymbols&#39;</span><span class="p">])</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                                <span class="n">name</span><span class="o">=</span><span class="n">u</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;compleat&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                    <span class="s1">&#39;full_name&#39;</span><span class="p">:</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; complex&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">],</span>
                                    <span class="s1">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;entrez&#39;</span><span class="p">],</span>
                                    <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">],</span>
                                    <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;pubmeds&#39;</span><span class="p">]</span>
                                <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Complexes from COMPLEAT have been retrieved.&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;INFO&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyPath.load_complexportal"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_complexportal">[docs]</a>    <span class="k">def</span> <span class="nf">load_complexportal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads complexes from ComplexPortal. Loads data into vertex attribute</span>
<span class="sd">        `graph.vs[&#39;complexes&#39;][&#39;complexportal&#39;]`.</span>
<span class="sd">        This resource is human only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="c1"># TODO: handling species</span>
        <span class="n">complexes</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_complexportal</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">complexes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to read data from Havugimana&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;complexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="s1">&#39;complexportal&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;complexportal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">complexes</span><span class="p">:</span>
                <span class="n">swprots</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="s1">&#39;complex recommended name&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">][</span><span class="s1">&#39;complex recommended name&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">]:</span>
                    <span class="n">swprots</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">u</span><span class="p">,</span>
                                                    <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                    <span class="mi">9606</span><span class="p">)</span>
                <span class="n">swprots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">swprots</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">sw</span> <span class="ow">in</span> <span class="n">swprots</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sw</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">sw</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;complexportal&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;full_name&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">swprots</span><span class="p">,</span>
                            <span class="s1">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;pdbs&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;pdbs&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;pubmeds&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;synonyms&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>
                        <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Complexes from Complex Portal have been retrieved.&#39;</span><span class="p">,</span>
                <span class="s1">&#39;INFO&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">load_3dcomplexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">c3d</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_3dcomplexes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">c3d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to download data from 3DComplexes and PDB&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;complexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="s1">&#39;3dcomplexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;3dcomplexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s1">&#39;3dstructure&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;3dstructure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;3dstructure&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;3dstructure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="s1">&#39;3dcomplexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;3dstructure&#39;</span><span class="p">]:</span>
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;3dstructure&#39;</span><span class="p">][</span><span class="s1">&#39;3dcomplexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">compl_names</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">compl_membs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">compl_links</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c3d</span><span class="p">),</span> <span class="s1">&#39;Processing complexes&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cname</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">c3d</span><span class="p">):</span>
                <span class="n">swprots</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">uprots</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ups</span><span class="p">,</span> <span class="n">contact</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                    <span class="n">uprots</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ups</span><span class="p">)</span>
                    <span class="n">up1s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">ups</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">up1</span> <span class="ow">in</span> <span class="n">up1s</span><span class="p">:</span>
                        <span class="n">inRefLists</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">for</span> <span class="n">tax</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">up1</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">lst</span><span class="p">:</span>
                                <span class="n">up2s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">ups</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">up2</span> <span class="ow">in</span> <span class="n">up2s</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">tax</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">):</span>
                                        <span class="k">if</span> <span class="n">up2</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">lst</span><span class="p">:</span>
                                            <span class="n">inRefLists</span> <span class="o">=</span> <span class="kc">True</span>
                                            <span class="n">thisPair</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">up1</span><span class="p">,</span> <span class="n">up2</span><span class="p">])</span>
                                            <span class="n">swprots</span> <span class="o">+=</span> <span class="n">thisPair</span>
                                            <span class="n">compl_links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                                <span class="p">(</span><span class="n">thisPair</span><span class="p">,</span> <span class="n">contact</span><span class="p">,</span> <span class="n">cname</span><span class="p">))</span>
                                            <span class="k">break</span>
                <span class="n">swprots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">swprots</span><span class="p">))</span>
                <span class="n">uprots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">uprots</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">swprots</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">swprots</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span>
                                                     <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
                                                     <span class="mi">9606</span><span class="p">)</span>
                    <span class="n">compl_names</span><span class="p">[</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; complex&#39;</span>
                    <span class="n">compl_membs</span><span class="p">[</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">swprots</span><span class="p">,</span> <span class="n">uprots</span><span class="p">)</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">compl_membs</span><span class="p">),</span> <span class="s1">&#39;Processing nodes&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cname</span><span class="p">,</span> <span class="n">uniprots</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">compl_membs</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">sp</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;3dcomplexes&#39;</span><span class="p">][</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s1">&#39;full_name&#39;</span><span class="p">:</span> <span class="n">compl_names</span><span class="p">[</span><span class="n">cname</span><span class="p">],</span>
                                <span class="s1">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="s1">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="p">}</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">compl_links</span><span class="p">),</span> <span class="s1">&#39;Processing edges&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">links</span> <span class="ow">in</span> <span class="n">compl_links</span><span class="p">:</span>
                <span class="n">one</span> <span class="o">=</span> <span class="n">links</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">two</span> <span class="o">=</span> <span class="n">links</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">two</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                    <span class="n">nodeOne</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">one</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                    <span class="n">nodeTwo</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">two</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">edge</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">_between</span><span class="o">=</span><span class="p">((</span><span class="n">nodeOne</span><span class="p">,</span> <span class="p">),</span>
                                                         <span class="p">(</span><span class="n">nodeTwo</span><span class="p">,</span> <span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;3dstructure&#39;</span><span class="p">][</span><span class="s1">&#39;3dcomplexes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;pdb&#39;</span><span class="p">:</span> <span class="n">links</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s1">&#39;numof_residues&#39;</span><span class="p">:</span> <span class="n">links</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">})</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_pisa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="s1">&#39;complexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span> \
                <span class="ow">or</span> <span class="s1">&#39;3dcomplexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_3dcomplexes</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;complexportal&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_complexportal</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="n">pdblist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;3dcomplexes&#39;</span><span class="p">]):</span>
                <span class="n">pdblist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;complexportal&#39;</span><span class="p">]):</span>
                <span class="n">pdblist</span> <span class="o">+=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pdbs&#39;</span><span class="p">]</span>
        <span class="n">pdblist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">pdblist</span><span class="p">))</span>
        <span class="n">pisa</span><span class="p">,</span> <span class="n">unmapped</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pisa</span><span class="p">(</span><span class="n">pdblist</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;interfaces&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s1">&#39;pisa&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]:</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">][</span><span class="s1">&#39;pisa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pdb</span><span class="p">,</span> <span class="n">iflist</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">pisa</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">uniprots</span><span class="p">,</span> <span class="n">intf</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">iflist</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span>
                        <span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">pdb</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;interfaces&#39;</span><span class="p">][</span><span class="s1">&#39;pisa&#39;</span><span class="p">]:</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;interfaces&#39;</span><span class="p">][</span><span class="s1">&#39;pisa&#39;</span><span class="p">][</span><span class="n">pdb</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;interfaces&#39;</span><span class="p">][</span><span class="s1">&#39;pisa&#39;</span><span class="p">][</span><span class="n">pdb</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unmapped</span>

<div class="viewcode-block" id="PyPath.find_complex"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.find_complex">[docs]</a>    <span class="k">def</span> <span class="nf">find_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds complexes by their non standard names.</span>
<span class="sd">        E.g. to find DNA polymerases you can use the search</span>
<span class="sd">        term `DNA pol` which will be tested against complex names</span>
<span class="sd">        in CORUM.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">comp</span><span class="p">,</span> <span class="n">memb</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_corum</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">cname</span><span class="p">,</span> <span class="n">cdata</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">search</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">cname</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>

                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cname</span><span class="p">,</span> <span class="n">cdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="PyPath.genesymbol"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.genesymbol">[docs]</a>    <span class="k">def</span> <span class="nf">genesymbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns ``igraph.Vertex()`` object if the GeneSymbol</span>
<span class="sd">        can be found in the default undirected network,</span>
<span class="sd">        otherwise ``None``.</span>

<span class="sd">        @genesymbol : str</span>
<span class="sd">            GeneSymbol.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_undirected</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labDct</span> <span class="k">else</span> <span class="kc">None</span></div>

    <span class="n">gs</span> <span class="o">=</span> <span class="n">genesymbol</span>

<div class="viewcode-block" id="PyPath.dgenesymbol"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.dgenesymbol">[docs]</a>    <span class="k">def</span> <span class="nf">dgenesymbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns ``igraph.Vertex()`` object if the GeneSymbol</span>
<span class="sd">        can be found in the default directed network,</span>
<span class="sd">        otherwise ``None``.</span>

<span class="sd">        @genesymbol : str</span>
<span class="sd">            GeneSymbol.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="k">else</span> <span class="kc">None</span></div>

    <span class="n">dgs</span> <span class="o">=</span> <span class="n">dgenesymbol</span>

    <span class="k">def</span> <span class="nf">genesymbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbols</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">genesymbol</span><span class="p">,</span> <span class="n">genesymbols</span><span class="p">))</span>

    <span class="n">gss</span> <span class="o">=</span> <span class="n">genesymbols</span>

    <span class="k">def</span> <span class="nf">dgenesymbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbols</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dgenesymbol</span><span class="p">,</span> <span class="n">genesymbols</span><span class="p">))</span>

    <span class="n">dgss</span> <span class="o">=</span> <span class="n">dgenesymbols</span>

<div class="viewcode-block" id="PyPath.uniprot"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.uniprot">[docs]</a>    <span class="k">def</span> <span class="nf">uniprot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns ``igraph.Vertex()`` object if the UniProt</span>
<span class="sd">        can be found in the default undirected network,</span>
<span class="sd">        otherwise ``None``.</span>

<span class="sd">        @uniprot : str</span>
<span class="sd">            UniProt ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_undirected</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span> <span class="k">else</span> <span class="kc">None</span></div>

    <span class="n">up</span> <span class="o">=</span> <span class="n">uniprot</span>

<div class="viewcode-block" id="PyPath.duniprot"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.duniprot">[docs]</a>    <span class="k">def</span> <span class="nf">duniprot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Same as ``PyPath.uniprot(), just for directed graph.</span>
<span class="sd">        Returns ``igraph.Vertex()`` object if the UniProt</span>
<span class="sd">        can be found in the default directed network,</span>
<span class="sd">        otherwise ``None``.</span>

<span class="sd">        @uniprot : str</span>
<span class="sd">            UniProt ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span> <span class="k">else</span> <span class="kc">None</span></div>

    <span class="n">dup</span> <span class="o">=</span> <span class="n">duniprot</span>

<div class="viewcode-block" id="PyPath.uniprots"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.uniprots">[docs]</a>    <span class="k">def</span> <span class="nf">uniprots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprots</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns list of ``igraph.Vertex()`` object</span>
<span class="sd">        for a list of UniProt IDs omitting those</span>
<span class="sd">        could not be found in the default</span>
<span class="sd">        undirected graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uniprot</span><span class="p">,</span> <span class="n">uniprots</span><span class="p">))</span></div>

    <span class="n">ups</span> <span class="o">=</span> <span class="n">uniprots</span>

<div class="viewcode-block" id="PyPath.duniprots"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.duniprots">[docs]</a>    <span class="k">def</span> <span class="nf">duniprots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprots</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns list of ``igraph.Vertex()`` object</span>
<span class="sd">        for a list of UniProt IDs omitting those</span>
<span class="sd">        could not be found in the default</span>
<span class="sd">        directed graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duniprot</span><span class="p">,</span> <span class="n">uniprots</span><span class="p">))</span></div>

    <span class="n">dups</span> <span class="o">=</span> <span class="n">duniprots</span>

<div class="viewcode-block" id="PyPath.get_node"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.get_node">[docs]</a>    <span class="k">def</span> <span class="nf">get_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns ``igraph.Vertex()`` object if the identifier</span>
<span class="sd">        is a valid vertex index in the default undirected graph,</span>
<span class="sd">        or a UniProt ID or GeneSymbol which can be found in the</span>
<span class="sd">        default undirected network, otherwise ``None``.</span>

<span class="sd">        @identifier : int, str</span>
<span class="sd">            Vertex index (int) or GeneSymbol (str) or UniProt ID (str).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_undirected</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> \
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">identifier</span> <span class="o">&lt;</span> <span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> \
            <span class="k">else</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">identifier</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span> <span class="k">else</span> \
            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labDct</span><span class="p">[</span><span class="n">identifier</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labDct</span> <span class="k">else</span> <span class="kc">None</span></div>

    <span class="c1"># synonyms</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">get_node</span>
    <span class="n">protein</span> <span class="o">=</span> <span class="n">get_node</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">get_node</span>

<div class="viewcode-block" id="PyPath.get_node_d"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.get_node_d">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Same as ``PyPath.get_node``, just for the directed graph.</span>
<span class="sd">        Returns ``igraph.Vertex()`` object if the identifier</span>
<span class="sd">        is a valid vertex index in the default directed graph,</span>
<span class="sd">        or a UniProt ID or GeneSymbol which can be found in the</span>
<span class="sd">        default directed network, otherwise ``None``.</span>

<span class="sd">        @identifier : int, str</span>
<span class="sd">            Vertex index (int) or GeneSymbol (str) or UniProt ID (str).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> \
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">identifier</span> <span class="o">&lt;</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> \
            <span class="k">else</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">[</span><span class="n">identifier</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span> <span class="k">else</span> \
            <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span><span class="p">[</span><span class="n">identifier</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="k">else</span> <span class="kc">None</span></div>

    <span class="c1"># synonyms</span>
    <span class="n">dv</span> <span class="o">=</span> <span class="n">get_node_d</span>
    <span class="n">dp</span> <span class="o">=</span> <span class="n">get_node_d</span>
    <span class="n">protein</span> <span class="o">=</span> <span class="n">get_node_d</span>

    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifiers</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">,</span> <span class="n">identifiers</span><span class="p">))</span>

    <span class="n">vs</span> <span class="o">=</span> <span class="n">get_nodes</span>
    <span class="n">proteins</span> <span class="o">=</span> <span class="n">get_nodes</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">get_nodes</span>

    <span class="k">def</span> <span class="nf">get_nodes_d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifiers</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_node_d</span><span class="p">,</span> <span class="n">identifiers</span><span class="p">))</span>

    <span class="c1"># these are just synonyms</span>
    <span class="n">dvs</span> <span class="o">=</span> <span class="n">get_nodes_d</span>
    <span class="n">dps</span> <span class="o">=</span> <span class="n">get_nodes_d</span>
    <span class="n">dproteins</span> <span class="o">=</span> <span class="n">get_nodes_d</span>

<div class="viewcode-block" id="PyPath.up_edge"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.up_edge">[docs]</a>    <span class="k">def</span> <span class="nf">up_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns ``igraph.Edge`` object if an edge exist between</span>
<span class="sd">        the 2 proteins, otherwise ``None``.</span>

<span class="sd">        @source : str</span>
<span class="sd">            UniProt ID</span>
<span class="sd">        @target : str</span>
<span class="sd">            UniProt ID</span>
<span class="sd">        @directed : bool</span>
<span class="sd">            To be passed to igraph.Graph.get_eid()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniprot</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">v_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniprot</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span>
                <span class="n">v_source</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">v_target</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="n">directed</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">eid</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="PyPath.gs_edge"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.gs_edge">[docs]</a>    <span class="k">def</span> <span class="nf">gs_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns ``igraph.Edge`` object if an edge exist between</span>
<span class="sd">        the 2 proteins, otherwise ``None``.</span>

<span class="sd">        @source : str</span>
<span class="sd">            GeneSymbol</span>
<span class="sd">        @target : str</span>
<span class="sd">            GeneSymbol</span>
<span class="sd">        @directed : bool</span>
<span class="sd">            To be passed to igraph.Graph.get_eid()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">v_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span>
                <span class="n">v_source</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">v_target</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="n">directed</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">eid</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="PyPath.get_edge"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.get_edge">[docs]</a>    <span class="k">def</span> <span class="nf">get_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns ``igraph.Edge`` object if an edge exist between</span>
<span class="sd">        the 2 proteins, otherwise ``None``.</span>

<span class="sd">        :param int,str source:</span>
<span class="sd">            Vertex index or UniProt ID or GeneSymbol</span>
<span class="sd">        :param int,str target:</span>
<span class="sd">            Vertex index or UniProt ID or GeneSymbol</span>
<span class="sd">        :param bool directed:</span>
<span class="sd">            To be passed to igraph.Graph.get_eid()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">v_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> \
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_d</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">v_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> \
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_d</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span>
                <span class="n">v_source</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">v_target</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="n">directed</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">eid</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1"># synonyms</span>
    <span class="n">protein_edge</span> <span class="o">=</span> <span class="n">get_edge</span>

<div class="viewcode-block" id="PyPath.get_edges"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.get_edges">[docs]</a>    <span class="k">def</span> <span class="nf">get_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a generator with all edges between source and target vertices.</span>

<span class="sd">        :param iterable sources: Source vertex IDs, names or labels.</span>
<span class="sd">        :param iterable targets: Target vertec IDs, names or labels.</span>
<span class="sd">        :param bool directed: Passed to `igraph.get_eid()`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">directed</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sources</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_has_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_directed</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_already_has_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span>

    <span class="k">def</span> <span class="nf">_get_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the directed instance of the graph.</span>
<span class="sd">        If not available, creates one at ``PyPath.dgraph``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_directed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span>

    <span class="c1"># conversion between directed and undirected vertices</span>

    <span class="k">def</span> <span class="nf">_get_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span>

    <span class="k">def</span> <span class="nf">up_in_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_directed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span> <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">up_in_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_undirected</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span> <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">gs_in_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_directed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]</span> <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">gs_in_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_undirected</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">labDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]</span> <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labDct</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">in_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_in_directed</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">in_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_in_undirected</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

    <span class="c1"># affects and affected_by</span>

    <span class="k">def</span> <span class="nf">_affected_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dgraph</span> <span class="o">!=</span> <span class="n">vertex</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
            <span class="n">vertex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_directed</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="n">vertex</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;IN&#39;</span><span class="p">)</span> \
            <span class="k">if</span> <span class="n">vertex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_affects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dgraph</span> <span class="o">!=</span> <span class="n">vertex</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
            <span class="n">vertex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_directed</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="n">vertex</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;OUT&#39;</span><span class="p">)</span> \
            <span class="k">if</span> <span class="n">vertex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">affected_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_d</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_affected_by</span><span class="p">(</span><span class="n">vrtx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">affects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_d</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_affects</span><span class="p">(</span><span class="n">vrtx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">up_affects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duniprot</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_affects</span><span class="p">(</span><span class="n">vrtx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">up_affected_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duniprot</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_affected_by</span><span class="p">(</span><span class="n">vrtx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gs_affects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgenesymbol</span><span class="p">(</span><span class="n">genesymbol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_affects</span><span class="p">(</span><span class="n">vrtx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gs_affected_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgenesymbol</span><span class="p">(</span><span class="n">genesymbol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_affected_by</span><span class="p">(</span><span class="n">vrtx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">up_stimulated_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">:</span>
            <span class="n">vid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_affected_by</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span>
                <span class="nb">filter</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dgraph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">vid</span><span class="p">)][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">uniprot</span><span class="p">],</span>
                    <span class="n">vs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">up_inhibited_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">:</span>
            <span class="n">vid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_affected_by</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span>
                <span class="nb">filter</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dgraph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">vid</span><span class="p">)][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">uniprot</span><span class="p">],</span>
                    <span class="n">vs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">up_stimulates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">:</span>
            <span class="n">vid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span>
            <span class="n">vs</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_affects</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span>
                <span class="nb">filter</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dgraph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">uniprot</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]],</span>
                    <span class="n">vs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">up_inhibits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">:</span>
            <span class="n">vid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_affects</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span>
                <span class="nb">filter</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dgraph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">uniprot</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]],</span>
                    <span class="n">vs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gs_stimulated_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="n">uniprot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_stimulated_by</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gs_stimulates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="n">uniprot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_stimulates</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gs_inhibited_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="n">uniprot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_inhibited_by</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gs_inhibits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="n">uniprot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_inhibits</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>

    <span class="c1"># neighbors variations</span>

    <span class="k">def</span> <span class="nf">up_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniprot</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span>
                <span class="n">vrtx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gs_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol</span><span class="p">(</span><span class="n">genesymbol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span>
                <span class="n">vrtx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span>
                <span class="n">vrtx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dneighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_d</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span>
                <span class="n">vrtx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>

    <span class="c1"># neighborhood variations:</span>

    <span class="k">def</span> <span class="nf">_neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">vi</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vi</span><span class="p">],</span>
                <span class="n">reduce</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">b</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">neighborhood</span><span class="p">(</span>
                        <span class="n">vs</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">),</span> <span class="p">[])),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">up_neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">uniprots</span><span class="p">)</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">simpleTypes</span><span class="p">:</span>
            <span class="n">uniprots</span> <span class="o">=</span> <span class="p">[</span><span class="n">uniprots</span><span class="p">]</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniprots</span><span class="p">(</span><span class="n">uniprots</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighborhood</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gs_neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbols</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">genesymbols</span><span class="p">)</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">simpleTypes</span><span class="p">:</span>
            <span class="n">genesymbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">genesymbols</span><span class="p">]</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genesymbols</span><span class="p">(</span><span class="n">genesymbols</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighborhood</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifiers</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">simpleTypes</span><span class="p">:</span>
            <span class="n">identifiers</span> <span class="o">=</span> <span class="p">[</span><span class="n">identifiers</span><span class="p">]</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighborhood</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

    <span class="c1"># complexes</span>

    <span class="k">def</span> <span class="nf">complexes_in_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csource</span><span class="o">=</span><span class="s1">&#39;corum&#39;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">cdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">allv</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">cdata</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="n">csource</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cdict</span><span class="p">:</span>
                    <span class="n">cdict</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cdata</span><span class="p">[</span><span class="s1">&#39;all_members&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">memb</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">cdict</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">memb</span> <span class="o">-</span> <span class="n">allv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">complex_comembership_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resources</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="n">resources</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">cnet</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="n">cdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">src</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cdict</span><span class="p">:</span>
                    <span class="n">cdict</span><span class="p">[</span><span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">cname</span><span class="p">,</span> <span class="n">cannot</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="n">src</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">cname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cdict</span><span class="p">[</span><span class="n">src</span><span class="p">]:</span>
                            <span class="n">cdict</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">cdict</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="n">cname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="PyPath.edges_in_comlexes"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.edges_in_comlexes">[docs]</a>    <span class="k">def</span> <span class="nf">edges_in_comlexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csources</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;corum&#39;</span><span class="p">],</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates edge attributes ``complexes`` and ``in_complex``.</span>
<span class="sd">        These are both dicts where the keys are complex resources.</span>
<span class="sd">        The values in ``complexes`` are the list of complex names</span>
<span class="sd">        both the source and the target vertices belong to.</span>
<span class="sd">        The values ``in_complex`` are boolean values whether there</span>
<span class="sd">        is at least one complex in the given resources both the</span>
<span class="sd">        source and the target vertex of the edge belong to.</span>

<span class="sd">        @csources : list</span>
<span class="sd">            List of complex resources. Should be already loaded.</span>
<span class="sd">        @graph : igraph.Graph()</span>
<span class="sd">            The graph object to do the calculations on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="s1">&#39;complexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;in_complex&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;in_complex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">_common_complexes</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="n">cs</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> \
                <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="n">cs</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">nul</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cs</span><span class="p">:</span>
                  <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span>
                      <span class="n">e</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">_common_complexes</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">cs</span><span class="p">)),</span>
                      <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">),</span>
                  <span class="n">csources</span><span class="p">)</span>
        <span class="n">nul</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cs</span><span class="p">:</span>
                  <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span>
                      <span class="n">e</span><span class="p">[</span><span class="s1">&#39;in_complex&#39;</span><span class="p">]</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span>
                          <span class="n">cs</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="n">cs</span><span class="p">]))),</span>
                      <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">),</span>
                  <span class="n">csources</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyPath.sum_in_complex"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.sum_in_complex">[docs]</a>    <span class="k">def</span> <span class="nf">sum_in_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csources</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;corum&#39;</span><span class="p">],</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the total number of edges in the network falling</span>
<span class="sd">        between two members of the same complex.</span>
<span class="sd">        Returns as a dict by complex resources.</span>
<span class="sd">        Calls :py:func:pypath.pypath.Pypath.edges_in_comlexes()</span>
<span class="sd">        to do the calculations.</span>

<span class="sd">        @csources : list</span>
<span class="sd">            List of complex resources. Should be already loaded.</span>
<span class="sd">        @graph : igraph.Graph()</span>
<span class="sd">            The graph object to do the calculations on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges_in_comlexes</span><span class="p">(</span><span class="n">csources</span><span class="o">=</span><span class="n">csources</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cs</span><span class="p">:</span>
                        <span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span>
                                     <span class="n">e</span><span class="p">[</span><span class="s1">&#39;in_complex&#39;</span><span class="p">][</span><span class="n">cs</span><span class="p">],</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">)</span>
                                 <span class="p">)),</span>
                        <span class="n">csources</span><span class="p">)</span>
                    <span class="p">)</span></div>

    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1">#</span>

    <span class="k">def</span> <span class="nf">get_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">fun</span>
        <span class="n">fun</span> <span class="o">=</span> <span class="n">fun</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">fun0</span> <span class="o">=</span> <span class="n">fun</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">toCall</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">fun0</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">fun0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">fun0</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">fun0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">fun0</span> <span class="o">==</span> <span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="n">__main__</span>
        <span class="k">elif</span> <span class="n">fun0</span> <span class="o">==</span> <span class="s1">&#39;self&#39;</span> <span class="ow">or</span> <span class="n">fun0</span> <span class="o">==</span> <span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">elif</span> <span class="n">fun0</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subm</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="n">subm</span><span class="p">],</span> <span class="s1">&#39;__name__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">globals</span><span class="p">(</span>
                <span class="p">)[</span><span class="n">subm</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="n">subm</span><span class="p">],</span> <span class="n">fun0</span><span class="p">):</span>
                        <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="n">subm</span><span class="p">],</span> <span class="n">fun0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">toCall</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">fun0</span> <span class="ow">in</span> <span class="n">fun</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="n">fun0</span><span class="p">):</span>
                <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="n">fun0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">toCall</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">edges_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dataio.get_instruct&#39;</span><span class="p">,</span> <span class="s1">&#39;dataio.get_i3d&#39;</span><span class="p">]):</span>
        <span class="n">all_3d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">all_3d</span> <span class="o">+=</span> <span class="n">fun</span><span class="p">()</span>
        <span class="c1"># initializing edge attributes:</span>
        <span class="k">if</span> <span class="s1">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># assigning annotations:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_3d</span><span class="p">:</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">u1</span> <span class="o">!=</span> <span class="n">u2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u2</span><span class="p">):</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">seq1</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="n">u1</span><span class="p">][</span><span class="s1">&#39;seq&#39;</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">seq2</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="n">u2</span><span class="p">][</span><span class="s1">&#39;seq&#39;</span><span class="p">]:</span>
                            <span class="n">dom1</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span>
                                <span class="n">protein</span><span class="o">=</span><span class="n">u1</span><span class="p">,</span>
                                <span class="n">domain</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="n">u1</span><span class="p">][</span><span class="s1">&#39;pfam&#39;</span><span class="p">],</span>
                                <span class="n">start</span><span class="o">=</span><span class="n">seq1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">end</span><span class="o">=</span><span class="n">seq1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">chains</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;pdb&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="n">i</span><span class="p">[</span><span class="n">u1</span><span class="p">][</span><span class="s1">&#39;chain&#39;</span><span class="p">]})</span>
                            <span class="n">dom2</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span>
                                <span class="n">protein</span><span class="o">=</span><span class="n">u2</span><span class="p">,</span>
                                <span class="n">domain</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="n">u2</span><span class="p">][</span><span class="s1">&#39;pfam&#39;</span><span class="p">],</span>
                                <span class="n">start</span><span class="o">=</span><span class="n">seq2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">end</span><span class="o">=</span><span class="n">seq2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">chains</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;pdb&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="n">i</span><span class="p">[</span><span class="n">u2</span><span class="p">][</span><span class="s1">&#39;chain&#39;</span><span class="p">]})</span>
                            <span class="n">domdom</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">DomainDomain</span><span class="p">(</span>
                                <span class="n">dom1</span><span class="p">,</span>
                                <span class="n">dom2</span><span class="p">,</span>
                                <span class="n">refs</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">],</span>
                                <span class="n">sources</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">],</span>
                                <span class="n">pdbs</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;pdb&#39;</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">domdom</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">edges_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfam_regions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pepcyber</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_psite_reg</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_ielm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_phosphoelm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_elm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_3did_dmi</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">pfam_regions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pfam_regions</span><span class="p">(</span>
                <span class="n">uniprots</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">dicts</span><span class="o">=</span><span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="n">keepfile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">complexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">methods</span><span class="o">=</span><span class="p">[</span>
                      <span class="s1">&#39;3dcomplexes&#39;</span><span class="p">,</span> <span class="s1">&#39;havugimana&#39;</span><span class="p">,</span> <span class="s1">&#39;corum&#39;</span><span class="p">,</span> <span class="s1">&#39;complexportal&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;compleat&#39;</span>
                  <span class="p">]):</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s1">&#39;load_&#39;</span> <span class="o">+</span> <span class="n">m</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
                <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
                    <span class="n">toCall</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_domino_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organism</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">organism</span> <span class="o">=</span> <span class="n">organism</span> <span class="k">if</span> <span class="n">organism</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span>
        <span class="c1">#all_unip = dataio.uniprot_input.all_uniprots(organism)</span>
        <span class="n">domi</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_domino_ptms</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">domi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to load domain-motif interaction data from DOMINO&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">domi</span><span class="p">[</span><span class="s1">&#39;dmi&#39;</span><span class="p">]),</span> <span class="s1">&#39;Loading domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dm</span> <span class="ow">in</span> <span class="n">domi</span><span class="p">[</span><span class="s1">&#39;dmi&#39;</span><span class="p">]:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">uniprot1</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">protein</span>
            <span class="n">uniprot2</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot2</span><span class="p">):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">,</span> <span class="n">uniprot2</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_3did_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dmi</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">process_3did_dmi</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dmi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to load domain-motif interaction data from 3DID&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dmi</span><span class="p">),</span> <span class="s1">&#39;Loading domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">uniprots</span><span class="p">,</span> <span class="n">dmi_list</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">dmi</span><span class="p">):</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dmi_list</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

<div class="viewcode-block" id="PyPath.load_ddi"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_ddi">[docs]</a>    <span class="k">def</span> <span class="nf">load_ddi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ddi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ddi is either a list of intera.DomainDomain objects,</span>
<span class="sd">        or a function resulting this list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ddi</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ddi</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">ddi</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ddi</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;dataio&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Function </span><span class="si">%s</span><span class="s1">() failed&#39;</span> <span class="o">%</span> <span class="n">ddi</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;Loading domain-domain interactions&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>
        <span class="n">in_network</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">uniprot1</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">protein</span>
            <span class="n">uniprot2</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">protein</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot2</span><span class="p">):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">,</span> <span class="n">uniprot2</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ddi&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">in_network</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span></div>

<div class="viewcode-block" id="PyPath.load_dmi"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_dmi">[docs]</a>    <span class="k">def</span> <span class="nf">load_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dmi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        dmi is either a list of intera.DomainMotif objects,</span>
<span class="sd">        or a function resulting this list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">dmi</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dmi</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">dmi</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dmi</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;dataio&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Function </span><span class="si">%s</span><span class="s1">() failed&#39;</span> <span class="o">%</span> <span class="n">dmi</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">run_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methods</span><span class="p">,</span> <span class="n">toCall</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">toCall</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">toCall</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
                    <span class="n">toCall</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fun</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_ddis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">methods</span><span class="o">=</span><span class="p">[</span>
                      <span class="s1">&#39;dataio.get_3dc_ddi&#39;</span><span class="p">,</span> <span class="s1">&#39;dataio.get_domino_ddi&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;self.load_3did_ddi2&#39;</span>
                  <span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_batch</span><span class="p">(</span><span class="n">methods</span><span class="p">,</span> <span class="n">toCall</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load_ddi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_dmis</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">methods</span><span class="o">=</span><span class="p">[</span>
                <span class="s1">&#39;self.pfam_regions&#39;</span><span class="p">,</span> <span class="s1">&#39;self.load_depod_dmi&#39;</span><span class="p">,</span> <span class="s1">&#39;self.load_dbptm&#39;</span><span class="p">,</span>
                <span class="s1">&#39;self.load_mimp_dmi&#39;</span><span class="p">,</span> <span class="s1">&#39;self.load_pnetworks_dmi&#39;</span><span class="p">,</span>
                <span class="s1">&#39;self.load_domino_dmi&#39;</span><span class="p">,</span> <span class="s1">&#39;self.load_pepcyber&#39;</span><span class="p">,</span>
                <span class="s1">&#39;self.load_psite_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;self.load_psite_phos&#39;</span><span class="p">,</span>
                <span class="s1">&#39;self.load_ielm&#39;</span><span class="p">,</span> <span class="s1">&#39;self.load_phosphoelm&#39;</span><span class="p">,</span> <span class="s1">&#39;self.load_elm&#39;</span><span class="p">,</span>
                <span class="s1">&#39;self.load_3did_dmi&#39;</span>
            <span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_batch</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniq_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phosphorylation_directions</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_3did_ddi2</span><span class="p">(</span><span class="n">ddi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interfaces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">unm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_pisa</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_3did_ddi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">ddi</span><span class="p">,</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_3did_ddi</span><span class="p">(</span><span class="n">residues</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ddi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">interfaces</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to load domain-domain interaction data from 3DID&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s1">&#39;3did&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]:</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">][</span><span class="s1">&#39;3did&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ddi</span><span class="p">),</span> <span class="s1">&#39;Loading domain-domain interactions&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">ddi</span><span class="p">):</span>
            <span class="n">uniprot1</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">uniprot2</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">swprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">swissprots</span><span class="p">([</span><span class="n">uniprot1</span><span class="p">,</span> <span class="n">uniprot2</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">swprot1</span> <span class="ow">in</span> <span class="n">swprots</span><span class="p">[</span><span class="n">uniprot1</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">swprot2</span> <span class="ow">in</span> <span class="n">swprots</span><span class="p">[</span><span class="n">uniprot2</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">swprot1</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">swprot2</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">swprot1</span><span class="p">,</span> <span class="n">swprot2</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">structures</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                                <span class="k">for</span> <span class="n">pdb</span><span class="p">,</span> <span class="n">pdb_uniprot_pairs</span> <span class="ow">in</span> \
                                        <span class="n">iteritems</span><span class="p">(</span><span class="n">structures</span><span class="p">[</span><span class="s1">&#39;pdbs&#39;</span><span class="p">]):</span>
                                    <span class="k">for</span> <span class="n">pdbuniprots</span> <span class="ow">in</span> <span class="n">pdb_uniprot_pairs</span><span class="p">:</span>
                                        <span class="n">pdbswprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">swissprots</span><span class="p">(</span>
                                            <span class="n">pdbuniprots</span><span class="p">)</span>
                                        <span class="k">for</span> <span class="n">pdbswprot1</span> <span class="ow">in</span> <span class="n">pdbswprots</span><span class="p">[</span>
                                                <span class="n">pdbuniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                                            <span class="k">for</span> <span class="n">pdbswprot2</span> <span class="ow">in</span> <span class="n">pdbswprots</span><span class="p">[</span>
                                                    <span class="n">pdbuniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
                                                <span class="n">this_ddi</span> <span class="o">=</span> <span class="p">{}</span>
                                                <span class="n">this_ddi</span><span class="p">[</span><span class="n">swprot1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                                    <span class="s1">&#39;pfam&#39;</span><span class="p">:</span> <span class="n">domains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                                <span class="p">}</span>
                                                <span class="n">this_ddi</span><span class="p">[</span><span class="n">swprot2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                                    <span class="s1">&#39;pfam&#39;</span><span class="p">:</span> <span class="n">domains</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                                <span class="p">}</span>
                                                <span class="n">this_ddi</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                                                    <span class="n">swprot1</span><span class="p">,</span> <span class="n">swprot2</span>
                                                <span class="p">]</span>
                                                <span class="n">this_ddi</span><span class="p">[</span>
                                                    <span class="s1">&#39;uniprots_original&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
                                                <span class="n">this_ddi</span><span class="p">[</span><span class="s1">&#39;pdb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                                    <span class="n">swprot1</span><span class="p">:</span> <span class="n">pdbswprot1</span><span class="p">,</span>
                                                    <span class="n">swprot2</span><span class="p">:</span> <span class="n">pdbswprot2</span><span class="p">,</span>
                                                    <span class="s1">&#39;pdb&#39;</span><span class="p">:</span> <span class="n">pdb</span>
                                                <span class="p">}</span>
                                                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ddi&#39;</span><span class="p">][</span><span class="s1">&#39;3did&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                                    <span class="n">this_ddi</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_3did_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_3did_ddi2</span><span class="p">(</span><span class="n">ddi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interfaces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_3did_ddi2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ddi</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interfaces</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">ddi</span><span class="p">,</span> <span class="n">intfs</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_3did</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ddi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">interfaces</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed to load domain-domain interaction data from 3DID&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># ERROR</span>
        <span class="k">if</span> <span class="n">interfaces</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;interfaces&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">intf</span> <span class="ow">in</span> <span class="n">intfs</span><span class="p">:</span>
                <span class="n">uniprot1</span> <span class="o">=</span> <span class="n">intf</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">protein</span>
                <span class="n">uniprot2</span> <span class="o">=</span> <span class="n">intf</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">protein</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot2</span><span class="p">):</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">,</span> <span class="n">uniprot2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;interfaces&#39;</span><span class="p">],</span>
                                          <span class="nb">list</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ddi</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ddi</span>

    <span class="k">def</span> <span class="nf">load_ielm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">ppi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">ppi</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
        <span class="n">ielm</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_ielm</span><span class="p">(</span><span class="n">ppi</span><span class="p">)</span>
        <span class="n">elm</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_elm_classes</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ielm</span><span class="p">),</span> <span class="s1">&#39;Processing domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="n">noelm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ielm</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">elm</span><span class="p">:</span>
                        <span class="n">noelm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">motif</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">elm</span> <span class="k">else</span> <span class="n">elm</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                    <span class="n">mot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Motif</span><span class="p">(</span>
                        <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                        <span class="n">regex</span><span class="o">=</span><span class="n">motif</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                        <span class="n">prob</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">motif</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">motif</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                        <span class="n">description</span><span class="o">=</span><span class="n">motif</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                        <span class="n">elm</span><span class="o">=</span><span class="n">motif</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">motif_name</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">dom</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span>
                        <span class="n">protein</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>
                        <span class="n">start</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">11</span><span class="p">]),</span>
                        <span class="n">end</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">]),</span>
                        <span class="n">domain</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
                        <span class="n">domain_id_type</span><span class="o">=</span><span class="s1">&#39;ielm_hmm&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">pfam</span><span class="p">,</span> <span class="n">regions</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">]]):</span>
                            <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span> <span class="o">==</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                                        <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">==</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]:</span>
                                    <span class="n">dom</span><span class="o">.</span><span class="n">pfam</span> <span class="o">=</span> <span class="n">pfam</span>
                                    <span class="n">dom</span><span class="o">.</span><span class="n">isoform</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;isoform&#39;</span><span class="p">]</span>
                    <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">protein</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="n">motif</span><span class="o">=</span><span class="n">mot</span><span class="p">,</span>
                                     <span class="n">typ</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">domMot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">DomainMotif</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">ptm</span><span class="p">,</span> <span class="s1">&#39;iELM&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">domMot</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="c1"># find deprecated elm classes:</span>
        <span class="c1"># list(set(noelm))</span>

    <span class="k">def</span> <span class="nf">load_elm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">elm</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_elm_interactions</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elm</span><span class="p">),</span> <span class="s1">&#39;Processing domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">elm</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">uniprot_elm</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">uniprot_dom</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot_elm</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span>
                        <span class="n">uniprot_dom</span><span class="p">):</span>
                    <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">uniprot_dom</span><span class="p">,</span> <span class="n">uniprot_elm</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                            <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="n">end</span>   <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

                            <span class="k">if</span> <span class="n">uniprot_elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">:</span>
                                <span class="n">inst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">uniprot_elm</span><span class="p">]</span><span class="o">.</span><span class="n">get_region</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="p">,</span>
                                                                        <span class="n">end</span> <span class="o">=</span> <span class="n">end</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">inst</span> <span class="o">=</span> <span class="kc">None</span>

                            <span class="n">mot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Motif</span><span class="p">(</span>
                                <span class="n">protein</span><span class="o">=</span><span class="n">uniprot_elm</span><span class="p">,</span>
                                <span class="n">motif_name</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                                <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
                                <span class="n">instance</span> <span class="o">=</span> <span class="n">inst</span><span class="p">)</span>
                            <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">protein</span><span class="o">=</span><span class="n">uniprot_elm</span><span class="p">,</span> <span class="n">motif</span><span class="o">=</span><span class="n">mot</span><span class="p">)</span>
                            <span class="n">dstart</span> <span class="o">=</span> <span class="n">start</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span>
                                <span class="mi">6</span><span class="p">])</span>
                            <span class="n">dend</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>

                            <span class="n">doms</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uniprot_dom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">uniprot_dom</span><span class="p">]:</span>
                                    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">uniprot_dom</span><span class="p">][</span><span class="n">l</span><span class="p">[</span>
                                            <span class="mi">1</span><span class="p">]]:</span>
                                        <span class="k">if</span> <span class="n">dstart</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dend</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
                                            <span class="p">(</span><span class="n">dstart</span> <span class="o">==</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="ow">and</span>
                                             <span class="n">dend</span> <span class="o">==</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]):</span>
                                            <span class="n">doms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                                <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span>
                                                    <span class="n">protein</span><span class="o">=</span><span class="n">uniprot_dom</span><span class="p">,</span>
                                                    <span class="n">domain</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                    <span class="n">start</span><span class="o">=</span><span class="n">region</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span>
                                                    <span class="n">end</span><span class="o">=</span><span class="n">region</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span>
                                                    <span class="n">isoform</span><span class="o">=</span><span class="n">region</span><span class="p">[</span><span class="s1">&#39;isoform&#39;</span><span class="p">]))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">doms</span> <span class="o">=</span> <span class="p">[</span>
                                    <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span>
                                        <span class="n">protein</span><span class="o">=</span><span class="n">uniprot_dom</span><span class="p">,</span>
                                        <span class="n">domain</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                    <span class="p">)</span>
                                <span class="p">]</span>
                            <span class="k">for</span> <span class="n">dom</span> <span class="ow">in</span> <span class="n">doms</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="n">intera</span><span class="o">.</span><span class="n">DomainMotif</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">ptm</span><span class="p">,</span> <span class="s1">&#39;ELM&#39;</span><span class="p">))</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_lmpid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="PyPath.process_dmi"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.process_dmi">[docs]</a>    <span class="k">def</span> <span class="nf">process_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is an universal function</span>
<span class="sd">        for loading domain-motif objects</span>
<span class="sd">        like load_phospho_dmi() for PTMs.</span>
<span class="sd">        TODO this will replace load_elm, load_ielm, etc</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">functions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LMPID&#39;</span><span class="p">:</span> <span class="s1">&#39;lmpid_dmi&#39;</span><span class="p">}</span>
        <span class="n">motif_plus</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LMPID&#39;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">functions</span><span class="p">[</span><span class="n">source</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">toCall</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">(</span><span class="n">isoforms</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;Processing domain-motif interactions from </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">source</span><span class="p">,</span>
            <span class="mi">7</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">domain_ups</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">motif_upd</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;LMPID&#39;</span><span class="p">:</span>
                <span class="n">domain_ups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;domain_protein&#39;</span><span class="p">],</span>
                                                  <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="n">motif_ups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;motif_protein&#39;</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">du</span> <span class="ow">in</span> <span class="n">domain_ups</span><span class="p">:</span>
                <span class="n">dom</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span>
                    <span class="n">du</span><span class="p">,</span>
                    <span class="n">domain</span><span class="o">=</span><span class="kc">None</span>
                    <span class="k">if</span> <span class="s1">&#39;domain_name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">else</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;domain_name&#39;</span><span class="p">],</span>
                    <span class="n">domain_id_type</span><span class="o">=</span><span class="kc">None</span>
                    <span class="k">if</span> <span class="s1">&#39;domain_name_type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">else</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;domain_name_type&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">motif_ups</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">mu</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="ow">and</span> <span class="n">mu</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span> <span class="ow">and</span> <span class="n">du</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span><span class="p">:</span>
                        <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_edge</span><span class="p">(</span>
                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">du</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">mu</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">edge</span><span class="p">:</span>
                            <span class="n">mse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">mu</span><span class="p">]</span>
                            <span class="n">isos</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">inst</span> <span class="o">=</span> <span class="n">mse</span><span class="o">.</span><span class="n">get_region</span><span class="p">(</span>
                                    <span class="n">start</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;motif_start&#39;</span><span class="p">],</span>
                                    <span class="n">end</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;motif_end&#39;</span><span class="p">],</span>
                                    <span class="n">isoform</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                                <span class="n">isos</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inst</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">iso</span> <span class="ow">in</span> <span class="n">mse</span><span class="o">.</span><span class="n">isoforms</span><span class="p">():</span>
                                <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">inst</span> <span class="o">=</span> <span class="n">mse</span><span class="o">.</span><span class="n">get_region</span><span class="p">(</span>
                                    <span class="n">start</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;motif_start&#39;</span><span class="p">],</span>
                                    <span class="n">end</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;motif_end&#39;</span><span class="p">],</span>
                                    <span class="n">isoform</span><span class="o">=</span><span class="n">iso</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">inst</span> <span class="o">==</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]:</span>
                                    <span class="n">isos</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">iso</span><span class="p">,</span> <span class="n">inst</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">iso</span> <span class="ow">in</span> <span class="n">isos</span><span class="p">:</span>
                                <span class="n">motargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                                                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">motif_plus</span><span class="p">[</span><span class="n">source</span><span class="p">]])</span>
                                <span class="n">mot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Motif</span><span class="p">(</span>
                                    <span class="n">mu</span><span class="p">,</span>
                                    <span class="n">iso</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">iso</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">isoform</span><span class="o">=</span><span class="n">iso</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                    <span class="n">instance</span><span class="o">=</span><span class="n">iso</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                    <span class="o">**</span><span class="n">motargs</span><span class="p">)</span>
                                <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span>
                                                 <span class="n">motif</span><span class="o">=</span><span class="n">mot</span><span class="p">,</span>
                                                 <span class="n">isoform</span><span class="o">=</span><span class="n">iso</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                                 <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="n">source</span><span class="p">])</span>
                                <span class="n">dommot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">DomainMotif</span><span class="p">(</span>
                                    <span class="n">domain</span><span class="o">=</span><span class="n">dom</span><span class="p">,</span>
                                    <span class="n">ptm</span><span class="o">=</span><span class="n">ptm</span><span class="p">,</span>
                                    <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="n">source</span><span class="p">],</span>
                                    <span class="n">refs</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">])</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dommot</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">load_pepcyber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">pepc</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pepcyber</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pepc</span><span class="p">),</span> <span class="s1">&#39;Processing domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">pepc</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">uniprot1</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">uniprot1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
                                                <span class="s1">&#39;refseq&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                <span class="mi">9606</span><span class="p">)</span>
            <span class="n">uniprot2</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">11</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="c1"># ptm on u2,</span>
            <span class="c1"># u1 interacts with u2 depending on ptm</span>
            <span class="k">for</span> <span class="n">u1</span> <span class="ow">in</span> <span class="n">uniprot1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">u2</span> <span class="ow">in</span> <span class="n">uniprot2</span><span class="p">:</span>
                    <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">res</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Residue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="n">l</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">u2</span><span class="p">)</span>
                            <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">protein</span><span class="o">=</span><span class="n">u2</span><span class="p">,</span>
                                             <span class="n">residue</span><span class="o">=</span><span class="n">res</span><span class="p">,</span>
                                             <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;phosphorylation&#39;</span><span class="p">)</span>
                            <span class="n">reg</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Regulation</span><span class="p">(</span>
                                <span class="n">source</span><span class="o">=</span><span class="n">u2</span><span class="p">,</span>
                                <span class="n">target</span><span class="o">=</span><span class="n">u1</span><span class="p">,</span>
                                <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PepCyber&#39;</span><span class="p">],</span>
                                <span class="n">effect</span><span class="o">=</span><span class="s1">&#39;induces&#39;</span><span class="p">,</span>
                                <span class="n">ptm</span><span class="o">=</span><span class="n">ptm</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_psite_reg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">modtyp</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="s1">&#39;phosphorylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ac&#39;</span><span class="p">:</span> <span class="s1">&#39;acetylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ub&#39;</span><span class="p">:</span> <span class="s1">&#39;ubiquitination&#39;</span><span class="p">,</span>
            <span class="s1">&#39;me&#39;</span><span class="p">:</span> <span class="s1">&#39;methylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sm&#39;</span><span class="p">:</span> <span class="s1">&#39;sumoylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ga&#39;</span><span class="p">:</span> <span class="s1">&#39;o-galnac&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gl&#39;</span><span class="p">:</span> <span class="s1">&#39;o-glcnac&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sc&#39;</span><span class="p">:</span> <span class="s1">&#39;succinylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;m3&#39;</span><span class="p">:</span> <span class="s1">&#39;tri-methylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;m1&#39;</span><span class="p">:</span> <span class="s1">&#39;mono-methylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;m2&#39;</span><span class="p">:</span> <span class="s1">&#39;di-methylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pa&#39;</span><span class="p">:</span> <span class="s1">&#39;palmitoylation&#39;</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">preg</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_psite_reg</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">preg</span><span class="p">),</span> <span class="s1">&#39;Processing regulatory effects&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">tgts</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">preg</span><span class="p">):</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="c1"># ptm on src</span>
            <span class="c1"># tgt: interactor of src, depending on ptm</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">tgt</span> <span class="ow">in</span> <span class="n">tgts</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">effect</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;induces&#39;</span><span class="p">,</span> <span class="s1">&#39;disrupts&#39;</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">tgt</span><span class="p">[</span><span class="n">effect</span><span class="p">]:</span>
                            <span class="n">uniprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
                                    <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                                        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span>
                                            <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                                        <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                            <span class="n">res</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Residue</span><span class="p">(</span>
                                                <span class="nb">int</span><span class="p">(</span><span class="n">tgt</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">]),</span> <span class="n">tgt</span><span class="p">[</span><span class="s1">&#39;aa&#39;</span><span class="p">],</span>
                                                <span class="n">src</span><span class="p">)</span>
                                            <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span>
                                                <span class="n">protein</span><span class="o">=</span><span class="n">src</span><span class="p">,</span>
                                                <span class="n">residue</span><span class="o">=</span><span class="n">res</span><span class="p">,</span>
                                                <span class="n">typ</span><span class="o">=</span><span class="n">modtyp</span><span class="p">[</span><span class="n">tgt</span><span class="p">[</span><span class="s1">&#39;modt&#39;</span><span class="p">]])</span>
                                            <span class="n">reg</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Regulation</span><span class="p">(</span>
                                                <span class="n">source</span><span class="o">=</span><span class="n">src</span><span class="p">,</span>
                                                <span class="n">target</span><span class="o">=</span><span class="n">u</span><span class="p">,</span>
                                                <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PhosphoSite&#39;</span><span class="p">],</span>
                                                <span class="n">refs</span><span class="o">=</span><span class="n">tgt</span><span class="p">[</span><span class="s1">&#39;pmids&#39;</span><span class="p">],</span>
                                                <span class="n">effect</span><span class="o">=</span><span class="n">effect</span><span class="p">,</span>
                                                <span class="n">ptm</span><span class="o">=</span><span class="n">ptm</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_comppi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;comppi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;comppi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;comppi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;comppi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">comppi</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_comppi</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comppi</span><span class="p">),</span> <span class="s1">&#39;Processing localizations&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">comppi</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">uniprots1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprot1&#39;</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="mi">9606</span><span class="p">)</span>
            <span class="n">uniprots2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprot2&#39;</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="mi">9606</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">u1</span> <span class="ow">in</span> <span class="n">uniprots1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u1</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;loc1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)]:</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">u1</span><span class="p">]]</span>\
                            <span class="p">[</span><span class="s1">&#39;comppi&#39;</span><span class="p">][</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">u2</span> <span class="ow">in</span> <span class="n">uniprots1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u2</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;loc2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)]:</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">u2</span><span class="p">]]</span>\
                            <span class="p">[</span><span class="s1">&#39;comppi&#39;</span><span class="p">][</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">u1</span> <span class="ow">in</span> <span class="n">uniprots1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">u2</span> <span class="ow">in</span> <span class="n">uniprots2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u2</span><span class="p">):</span>
                        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">e</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;comppi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;loc_score&#39;</span><span class="p">])</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">edge_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">topn</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="s1">&#39;comppi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_comppi</span><span class="p">()</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">e</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">([</span>
                    <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">heapq</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                                            <span class="n">iteritems</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span>
                                                <span class="s1">&#39;comppi&#39;</span><span class="p">]),</span>
                                            <span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">([</span>
                    <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">heapq</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                                            <span class="n">iteritems</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span>
                                                <span class="s1">&#39;comppi&#39;</span><span class="p">]),</span>
                                            <span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="p">]))</span>

    <span class="k">def</span> <span class="nf">sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isoforms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">swissprot_seq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span> <span class="n">isoforms</span><span class="p">)</span>

<div class="viewcode-block" id="PyPath.load_ptms2"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_ptms2">[docs]</a>    <span class="k">def</span> <span class="nf">load_ptms2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">input_methods</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">map_by_homology_from</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9606</span><span class="p">],</span>
        <span class="n">homology_only_swissprot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">ptm_homology_strict</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">nonhuman_direct_lookup</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">inputargs</span> <span class="o">=</span> <span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a new method which will replace `load_ptms`.</span>
<span class="sd">        It uses `pypath.ptm.PtmAggregator`, a newly introduced</span>
<span class="sd">        module for combining enzyme-substrate data from multiple</span>
<span class="sd">        resources using homology translation on users demand.</span>

<span class="sd">        :param list input_methods: Resources to collect enzyme-substrate</span>
<span class="sd">            interactions from. E.g. `[&#39;Signor&#39;, &#39;phosphoELM&#39;]`. By default</span>
<span class="sd">            it contains Signor, PhosphoSitePlus, HPRD, phosphoELM, dbPTM,</span>
<span class="sd">            PhosphoNetworks, Li2012 and MIMP.</span>
<span class="sd">        :param list map_by_homology_from: List of NCBI Taxonomy IDs of</span>
<span class="sd">            source taxons used for homology translation of enzyme-substrate</span>
<span class="sd">            interactions. If you have a human network and you add here</span>
<span class="sd">            `[10090, 10116]` then mouse and rat interactions from the source</span>
<span class="sd">            databases will be translated to human.</span>
<span class="sd">        :param bool homology_only_swissprot: `True` by default which means</span>
<span class="sd">            only SwissProt IDs are accepted at homology translateion, Trembl</span>
<span class="sd">            IDs will be dropped.</span>
<span class="sd">        :param bool ptm_homology_strict: For homology translation use</span>
<span class="sd">            PhosphoSite&#39;s PTM homology table. This guarantees that only</span>
<span class="sd">            truely homologous sites will be included. Otherwise we only</span>
<span class="sd">            check if at the same numeric offset in the homologous sequence</span>
<span class="sd">            the appropriate residue can be find.</span>
<span class="sd">        :param bool nonhuman_direct_lookup: Fetch also directly nonhuman</span>
<span class="sd">            data from the resources whereever it&#39;s available. PhosphoSite</span>
<span class="sd">            contains mouse enzyme-substrate interactions and it is possible</span>
<span class="sd">            to extract these directly beside translating the human ones</span>
<span class="sd">            to mouse.</span>
<span class="sd">        :param dict inputargs: Additional arguments passed to `PtmProcessor`.</span>
<span class="sd">            A `dict` can be supplied for each resource, e.g.</span>
<span class="sd">            `{&#39;Signor&#39;: {...}, &#39;PhosphoSite&#39;: {...}, ...}`.</span>
<span class="sd">            Those not used by `PtmProcessor` are forwarded to the</span>
<span class="sd">            `pypath.dataio` methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ptma</span> <span class="o">=</span> <span class="n">pypath</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">PtmAggregator</span><span class="p">(</span>
            <span class="n">input_methods</span> <span class="o">=</span> <span class="n">input_methods</span><span class="p">,</span>
            <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span>
            <span class="n">map_by_homology_from</span> <span class="o">=</span> <span class="n">map_by_homology_from</span><span class="p">,</span>
            <span class="c1"># here we don&#39;t share the mapper as later many</span>
            <span class="c1"># tables which we don&#39;t need any more would</span>
            <span class="c1"># just occupy memory</span>
            <span class="n">mapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">,</span>
            <span class="n">homology_only_swissprot</span> <span class="o">=</span> <span class="n">homology_only_swissprot</span><span class="p">,</span>
            <span class="n">ptm_homology_strict</span> <span class="o">=</span> <span class="n">ptm_homology_strict</span><span class="p">,</span>
            <span class="n">nonhuman_direct_lookup</span> <span class="o">=</span> <span class="n">nonhuman_direct_lookup</span><span class="p">,</span>
            <span class="n">inputargs</span> <span class="o">=</span> <span class="n">inputargs</span>
        <span class="p">)</span>

        <span class="n">ptma</span><span class="o">.</span><span class="n">assign_to_network</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="o">==</span> <span class="mi">9606</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">input_methods</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                <span class="s1">&#39;DEPOD&#39;</span> <span class="ow">in</span> <span class="n">input_methods</span>
            <span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">load_depod_dmi</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">uniq_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phosphorylation_directions</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">load_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_depod_dmi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_signor_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_li2012_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_hprd_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_mimp_dmi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pnetworks_dmi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_phosphoelm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_dbptm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_psite_phos</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniq_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phosphorylation_directions</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_mimp_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_matching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;MIMP&#39;</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>

    <span class="k">def</span> <span class="nf">load_pnetworks_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="s1">&#39;PhosphoNetworks&#39;</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>

    <span class="k">def</span> <span class="nf">load_phosphoelm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="s1">&#39;phosphoELM&#39;</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>

    <span class="k">def</span> <span class="nf">load_dbptm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_matching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;dbPTM&#39;</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>

    <span class="k">def</span> <span class="nf">load_hprd_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_matching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;HPRD&#39;</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>

    <span class="k">def</span> <span class="nf">load_li2012_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_matching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;Li2012&#39;</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>

    <span class="k">def</span> <span class="nf">load_signor_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_matching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;Signor&#39;</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>

    <span class="k">def</span> <span class="nf">load_psite_phos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="s1">&#39;PhosphoSite&#39;</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>

    <span class="k">def</span> <span class="nf">load_phospho_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">functions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Signor&#39;</span><span class="p">:</span> <span class="s1">&#39;load_signor_ptms&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MIMP&#39;</span><span class="p">:</span> <span class="s1">&#39;get_mimp&#39;</span><span class="p">,</span>
            <span class="s1">&#39;PhosphoNetworks&#39;</span><span class="p">:</span> <span class="s1">&#39;get_phosphonetworks&#39;</span><span class="p">,</span>
            <span class="s1">&#39;phosphoELM&#39;</span><span class="p">:</span> <span class="s1">&#39;get_phosphoelm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;dbPTM&#39;</span><span class="p">:</span> <span class="s1">&#39;get_dbptm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;PhosphoSite&#39;</span><span class="p">:</span> <span class="s1">&#39;get_psite_phos&#39;</span><span class="p">,</span>
            <span class="s1">&#39;HPRD&#39;</span><span class="p">:</span> <span class="s1">&#39;get_hprd_ptms&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Li2012&#39;</span><span class="p">:</span> <span class="s1">&#39;li2012_phospho&#39;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;PhosphoSite&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">taxids</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;organism&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">taxids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;strict&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;strict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mapper&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span>

        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;Signor&#39;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;organism&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span>

        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;phosphoELM&#39;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;organism&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="o">!=</span> <span class="mi">9606</span> <span class="ow">and</span> <span class="s1">&#39;ltp_only&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ltp_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;dbPTM&#39;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;organism&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="o">!=</span> <span class="mi">9606</span> <span class="ow">and</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> \
            <span class="p">[</span><span class="s1">&#39;Signor&#39;</span><span class="p">,</span> <span class="s1">&#39;PhosphoSite&#39;</span><span class="p">,</span> <span class="s1">&#39;phosphoELM&#39;</span><span class="p">,</span> <span class="s1">&#39;dbPTM&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">functions</span><span class="p">[</span><span class="n">source</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">toCall</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">(</span><span class="n">isoforms</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">nomatch</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kin_ambig</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">sub_ambig</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;Processing PTMs from </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">source</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># database specific id conversions</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;PhosphoSite&#39;</span><span class="p">,</span> <span class="s1">&#39;phosphoELM&#39;</span><span class="p">,</span> <span class="s1">&#39;Signor&#39;</span><span class="p">]:</span>
                    <span class="n">kinase_ups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                      <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">]]</span>
                    <span class="n">kinase_ups</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">i</span>
                        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">]</span>
                        <span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ii</span>
                    <span class="p">]</span>
                    <span class="n">kinase_ups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">kinase_ups</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;HLA&#39;</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;MIMP&#39;</span><span class="p">,</span> <span class="s1">&#39;PhosphoNetworks&#39;</span><span class="p">,</span> <span class="s1">&#39;Li2012&#39;</span><span class="p">]:</span>
                    <span class="n">substrate_ups_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate&#39;</span><span class="p">],</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;MIMP&#39;</span><span class="p">:</span>
                    <span class="n">substrate_ups_all</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate_refseq&#39;</span><span class="p">],</span> <span class="s1">&#39;refseq&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                    <span class="n">substrate_ups_all</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">substrate_ups_all</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;phosphoELM&#39;</span><span class="p">,</span> <span class="s1">&#39;dbPTM&#39;</span><span class="p">,</span> <span class="s1">&#39;PhosphoSite&#39;</span><span class="p">,</span> <span class="s1">&#39;Signor&#39;</span><span class="p">]:</span>
                    <span class="n">substrate_ups_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate&#39;</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;HPRD&#39;</span><span class="p">:</span>
                    <span class="n">substrate_ups_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate_refseqp&#39;</span><span class="p">],</span> <span class="s1">&#39;refseqp&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                    <span class="n">substrate_ups_all</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span><span class="n">substrate_ups_all</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kin_ambig</span><span class="p">:</span>
                        <span class="n">kin_ambig</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinase_ups</span>
                <span class="c1"># looking up sequences in all isoforms:</span>
                <span class="n">substrate_ups</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrate_ups_all</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">isof</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">isoforms</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">],</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span>
                                        <span class="n">isoform</span><span class="o">=</span><span class="n">isof</span><span class="p">):</span>
                                    <span class="n">substrate_ups</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">isof</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;resaa&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;resnum&#39;</span><span class="p">],</span> <span class="n">isoform</span><span class="o">=</span><span class="n">isof</span><span class="p">):</span>
                                    <span class="n">substrate_ups</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">isof</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sub_ambig</span><span class="p">:</span>
                    <span class="n">sub_ambig</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">substrate_ups</span>
                <span class="c1"># generating report on non matching substrates</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">substrate_ups</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrate_ups_all</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">:</span>
                            <span class="n">nomatch</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate_refseq&#39;</span><span class="p">],</span>
                                            <span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">])))</span>
                <span class="c1"># adding kinase-substrate interactions</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kinase_ups</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrate_ups</span><span class="p">:</span>
                        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">directed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">())</span>
                        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">or</span> <span class="n">return_raw</span><span class="p">:</span>
                            <span class="n">e</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span>
                                    <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">return_raw</span><span class="p">:</span>
                                <span class="n">res</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Residue</span><span class="p">(</span>
                                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;resnum&#39;</span><span class="p">],</span>
                                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;resaa&#39;</span><span class="p">],</span>
                                    <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">isoform</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">get_region</span><span class="p">(</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;resnum&#39;</span><span class="p">],</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span>
                                        <span class="n">isoform</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                    <span class="k">if</span> <span class="n">reg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                <span class="k">if</span> <span class="s1">&#39;typ&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;typ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;phosphorylation&#39;</span>
                                <span class="n">mot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Motif</span><span class="p">(</span>
                                    <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span>
                                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span>
                                    <span class="n">instance</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">],</span>
                                    <span class="n">isoform</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                 <span class="n">motif</span><span class="o">=</span><span class="n">mot</span><span class="p">,</span>
                                                 <span class="n">residue</span><span class="o">=</span><span class="n">res</span><span class="p">,</span>
                                                 <span class="n">typ</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;typ&#39;</span><span class="p">],</span>
                                                 <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="n">source</span><span class="p">],</span>
                                                 <span class="n">isoform</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="n">dom</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">protein</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                                <span class="k">if</span> <span class="s1">&#39;references&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                <span class="n">dommot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">DomainMotif</span><span class="p">(</span>
                                    <span class="n">domain</span><span class="o">=</span><span class="n">dom</span><span class="p">,</span>
                                    <span class="n">ptm</span><span class="o">=</span><span class="n">ptm</span><span class="p">,</span>
                                    <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="n">source</span><span class="p">],</span>
                                    <span class="n">refs</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;MIMP&#39;</span><span class="p">:</span>
                                    <span class="n">dommot</span><span class="o">.</span><span class="n">mimp_sources</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">p</span><span class="p">[</span>
                                        <span class="s1">&#39;databases&#39;</span><span class="p">])</span>
                                    <span class="n">dommot</span><span class="o">.</span><span class="n">npmid</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;npmid&#39;</span><span class="p">]</span>
                                <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;PhosphoNetworks&#39;</span><span class="p">:</span>
                                    <span class="n">dommot</span><span class="o">.</span><span class="n">pnetw_score</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
                                <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;dbPTM&#39;</span><span class="p">:</span>
                                    <span class="n">dommot</span><span class="o">.</span><span class="n">dbptm_sources</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]]</span>
                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dommot</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">return_raw</span><span class="p">:</span>
                                    <span class="n">raw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dommot</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;non_matching&#39;</span><span class="p">:</span> <span class="n">nomatch</span><span class="p">,</span>
                <span class="s1">&#39;kinase_ambiguousity&#39;</span><span class="p">:</span> <span class="n">kin_ambig</span><span class="p">,</span>
                <span class="s1">&#39;substrate_ambiguousity&#39;</span><span class="p">:</span> <span class="n">sub_ambig</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="n">return_raw</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">raw</span>

    <span class="k">def</span> <span class="nf">load_depod_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reres</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([A-Z][a-z]+)-([0-9]+)&#39;</span><span class="p">)</span>
        <span class="n">non_digit</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\d.-]+&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_depod</span><span class="p">()</span>
        <span class="n">aadict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">aaletters</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
                <span class="n">common</span><span class="o">.</span><span class="n">aaletters</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;Loading dephosphorylation data from DEPOD&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="n">mapp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">reslist</span> <span class="o">=</span> <span class="p">[(</span><span class="n">aadict</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="nb">int</span><span class="p">(</span><span class="n">non_digit</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
                       <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reres</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">aadict</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">enzymes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="n">substrates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="n">substrates</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrates</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">]</span>
                <span class="n">mapp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">enzymes</span><span class="p">,</span> <span class="n">substrates</span><span class="p">,</span> <span class="n">reslist</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reslist</span><span class="p">:</span>
                    <span class="n">substrates</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrates</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="p">]</span>
                <span class="n">mapp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">substrates</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">enzymes</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrates</span><span class="p">:</span>
                        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span>
                                <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reslist</span><span class="p">:</span>
                                    <span class="n">res</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Residue</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">)</span>
                                    <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">s</span><span class="p">,</span>
                                                     <span class="n">residue</span><span class="o">=</span><span class="n">res</span><span class="p">,</span>
                                                     <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;dephosphorylation&#39;</span><span class="p">,</span>
                                                     <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DEPOD&#39;</span><span class="p">])</span>
                                    <span class="n">dom</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">protein</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
                                    <span class="n">dommot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">DomainMotif</span><span class="p">(</span>
                                        <span class="n">domain</span><span class="o">=</span><span class="n">dom</span><span class="p">,</span>
                                        <span class="n">ptm</span><span class="o">=</span><span class="n">ptm</span><span class="p">,</span>
                                        <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DEPOD&#39;</span><span class="p">],</span>
                                        <span class="n">refs</span><span class="o">=</span><span class="p">[</span>
                                            <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                                        <span class="p">])</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dommot</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="c1"># return mapp</span>

    <span class="k">def</span> <span class="nf">uniq_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uniq_ptm</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span>
            <span class="p">]</span>

    <span class="k">def</span> <span class="nf">uniq_ptm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ptms</span><span class="p">):</span>
        <span class="n">ptms_uniq</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">ptms</span><span class="p">:</span>
            <span class="n">merged</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ptmu</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ptms_uniq</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ptm</span> <span class="o">==</span> <span class="n">ptmu</span><span class="p">:</span>
                    <span class="n">ptms_uniq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ptm</span><span class="p">)</span>
                    <span class="n">merged</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">merged</span><span class="p">:</span>
                <span class="n">ptms_uniq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptm</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ptms_uniq</span>

    <span class="k">def</span> <span class="nf">phosphorylation_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniq_ptms</span><span class="p">()</span>
        <span class="n">isdir</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                <span class="n">isdir</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;DomainMotif&#39;</span> <span class="ow">and</span> \
                        <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;phosphorylation&#39;</span><span class="p">,</span> <span class="s1">&#39;dephosphorylation&#39;</span><span class="p">]:</span>
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_dir</span><span class="p">((</span><span class="n">ptm</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">),</span>
                                      <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span>
        <span class="n">isdir2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                <span class="n">isdir2</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Directionality set for </span><span class="si">%u</span><span class="s1"> interactions</span><span class="se">\n</span><span class="s1">&#39;</span>
                         <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">   based on known (de)phosphorylation events.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="n">isdir2</span> <span class="o">-</span> <span class="n">isdir</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">phosphorylation_signs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">new_signs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dephos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># looking up effects of dephosphorylations:</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]:</span>
                <span class="n">sign</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;dephosphorylation&#39;</span><span class="p">:</span>
                    <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">ptm</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">)</span>
                    <span class="n">signs</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">signs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">signs</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;positive&#39;</span>
                    <span class="k">elif</span> <span class="n">signs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">signs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;negative&#39;</span>
                    <span class="k">if</span> <span class="n">sign</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dephos</span><span class="p">:</span>
                            <span class="n">dephos</span><span class="p">[</span><span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">dephos</span><span class="p">[</span><span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;protein&#39;</span><span class="p">:</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span>
                            <span class="s1">&#39;resaa&#39;</span><span class="p">:</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="s1">&#39;resnum&#39;</span><span class="p">:</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">number</span><span class="p">,</span>
                            <span class="s1">&#39;sign&#39;</span><span class="p">:</span> <span class="n">sign</span>
                        <span class="p">})</span>
        <span class="c1"># set the opposite sign for posphorylations as it is</span>
        <span class="c1"># at corresponding dephosphorylations:</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;phosphorylation&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span> <span class="ow">in</span> <span class="n">dephos</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">de</span> <span class="ow">in</span> <span class="n">dephos</span><span class="p">[</span><span class="n">protein</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">de</span><span class="p">[</span><span class="s1">&#39;resnum&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                                    <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">de</span><span class="p">[</span><span class="s1">&#39;resaa&#39;</span><span class="p">]:</span>
                                <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">ptm</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span>
                                             <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">)</span>
                                <span class="n">signs</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
                                <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;positive&#39;</span> <span class="k">if</span> <span class="n">de</span><span class="p">[</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span> \
                                    <span class="k">else</span> <span class="s1">&#39;negative&#39;</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">signs</span><span class="p">)):</span>
                                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span>
                                                       <span class="n">ptm</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span>
                                    <span class="n">new_signs</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Signes set based on phosphorylation-&#39;</span>
                         <span class="s1">&#39;dephosphorylation pairs: </span><span class="si">%u</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">new_signs</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">kinase_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">pcounts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ks_pairs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">psite_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">ks_srcs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;DomainMotif&#39;</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;phosphorylation&#39;</span><span class="p">:</span>
                    <span class="n">ks_srcs</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">sources</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">sources</span>
                    <span class="n">p_srcs</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">sources</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">sources</span>
                    <span class="n">p_srcs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">p_srcs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Swiss-Prot&#39;</span><span class="p">]))</span>
                    <span class="n">p_srcs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">p_srcs</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">p_srcs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pcounts</span><span class="p">:</span>
                        <span class="n">pcounts</span><span class="p">[</span><span class="n">p_srcs</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">pcounts</span><span class="p">[</span><span class="n">p_srcs</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">psite_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ks_srcs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ks_srcs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ks_srcs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Swiss-Prot&#39;</span><span class="p">]))</span>
                <span class="n">ks_srcs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ks_srcs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ks_srcs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
                    <span class="n">counts</span><span class="p">[</span><span class="n">ks_srcs</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">counts</span><span class="p">[</span><span class="n">ks_srcs</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">ks_pairs</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;phosphorylations&#39;</span><span class="p">:</span> <span class="n">pcounts</span><span class="p">,</span> <span class="s1">&#39;kinase_substrate&#39;</span><span class="p">:</span> <span class="n">counts</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">update_db_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sources_overlap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diagonal</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_db_dict</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;single&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="p">{}</span>
            <span class="p">},</span>
            <span class="s1">&#39;overlap&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="p">{}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">])</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">s1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">diagonal</span> <span class="ow">or</span> <span class="n">s1</span> <span class="o">!=</span> <span class="n">s2</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)]</span> <span class="o">=</span> \
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s1</span><span class="p">]</span> <span class="o">&amp;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s2</span><span class="p">])</span>
                    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)]</span> <span class="o">=</span> \
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s1</span><span class="p">]</span> <span class="o">&amp;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">source_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources_overlap</span><span class="p">()</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="n">bwness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">betweenness</span><span class="p">()</span>
        <span class="n">ebwness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">edge_betweenness</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">source_diagram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="n">outf</span> <span class="k">if</span> <span class="n">outf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;databases.pdf&#39;</span><span class="p">)</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources_overlap</span><span class="p">(</span><span class="n">diagonal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">overlaps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">]):</span>
            <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">],</span> <span class="kc">None</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">]):</span>
            <span class="n">overlaps</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">])}</span>
        <span class="n">diagram</span> <span class="o">=</span> <span class="n">bdrawing</span><span class="o">.</span><span class="n">InterSet</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">overlaps</span><span class="p">,</span> <span class="n">outf</span><span class="o">=</span><span class="n">outf</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">diagram</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_dirs_signs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">dbs</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">data_formats</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
                <span class="n">data_formats</span><span class="o">.</span><span class="n">interaction_htp</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
                <span class="n">data_formats</span><span class="o">.</span><span class="n">pathway</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
                <span class="n">data_formats</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">]:</span>
            <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">dbs</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">db</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">bool</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">isDirected</span><span class="p">),</span> <span class="nb">bool</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">sign</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="PyPath.basic_stats"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.basic_stats">[docs]</a>    <span class="k">def</span> <span class="nf">basic_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">latex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">caption</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">latex_hdr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                    <span class="n">font</span><span class="o">=</span><span class="s1">&#39;HelveticaNeueLTStd-LtCn&#39;</span><span class="p">,</span>
                    <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">header_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">row_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">by_category</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">use_cats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">],</span>
                    <span class="n">urls</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">annots</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns basic numbers about the network resources, e.g. edge and</span>
<span class="sd">        node counts.</span>

<span class="sd">        latex</span>
<span class="sd">            Return table in a LaTeX document. This can be compiled by</span>
<span class="sd">            PDFLaTeX:</span>
<span class="sd">            latex stats.tex</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_strip</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;SPIKE&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;PDZbase&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;DEPOD&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;LMPID&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;DIP&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;MPPI&#39;</span><span class="p">:</span> <span class="mi">5</span>
        <span class="p">}</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="n">fname</span> <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s1">&#39;results&#39;</span><span class="p">,</span>
            <span class="s1">&#39;databases-</span><span class="si">%s</span><span class="s1">.tex&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span> <span class="k">if</span> <span class="n">latex</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;databases-</span><span class="si">%s</span><span class="s1">.tsv&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources_overlap</span><span class="p">()</span>
        <span class="n">dirs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dirs_signs</span><span class="p">()</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Database&#39;</span><span class="p">,</span> <span class="s1">&#39;Nodes&#39;</span><span class="p">,</span> <span class="s1">&#39;Edges&#39;</span><span class="p">,</span> <span class="s1">&#39;Directions&#39;</span><span class="p">,</span> <span class="s1">&#39;Signs&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">urls</span><span class="p">:</span>
            <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;URL&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">annots</span><span class="p">:</span>
            <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Annotations&#39;</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Notes&#39;</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">]</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="n">descriptions</span><span class="o">.</span><span class="n">descriptions</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="n">desc</span><span class="p">[</span>
                <span class="s1">&#39;HPRD&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;HPRD-phos&#39;</span> <span class="k">else</span> <span class="n">desc</span><span class="p">[</span>
                <span class="s1">&#39;PhosphoSite&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;PhosphoSite_noref&#39;</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="n">annot</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;annot&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;annot&#39;</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">recom</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;recommend&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;recommend&#39;</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">][</span><span class="s1">&#39;webpages&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> \
                <span class="k">if</span> <span class="s1">&#39;urls&#39;</span> <span class="ow">in</span> <span class="n">d</span> \
                <span class="ow">and</span> <span class="s1">&#39;webpages&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">]</span> \
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">][</span><span class="s1">&#39;webpages&#39;</span><span class="p">])</span> \
                <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
                <span class="n">_url</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[:(</span><span class="mi">3</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">url_strip</span> <span class="k">else</span> <span class="n">url_strip</span><span class="p">[</span>
                    <span class="n">s</span><span class="p">])]</span>
                <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_url</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_url</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">url</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;/\-&#39;</span>
                    <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_url</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\textasciitilde &#39;</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">s</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">],</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">urls</span><span class="p">:</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">annots</span><span class="p">:</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annot</span><span class="p">)</span>
            <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recom</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">latex</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">out</span><span class="p">])</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outf</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Output written to file `</span><span class="si">%s</span><span class="s1">`</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outf</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">cats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">:</span> <span class="n">e1</span> <span class="o">|</span> <span class="n">e2</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="p">[])))</span> <span class="k">if</span> <span class="n">by_category</span> <span class="k">else</span> <span class="p">[]</span>

            <span class="n">cats</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">use_cats</span><span class="p">)</span>
            <span class="n">use_cats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cats</span><span class="p">,</span> <span class="n">use_cats</span><span class="p">))</span>

            <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">by_category</span><span class="p">:</span>
                <span class="n">row_order</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">row_order</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">use_cats</span><span class="p">:</span>
                    <span class="n">row_order</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">data_formats</span><span class="o">.</span><span class="n">catnames</span><span class="p">[</span><span class="n">cat</span><span class="p">],</span> <span class="s1">&#39;subtitle&#39;</span><span class="p">))</span>
                    <span class="n">row_order</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="nb">sorted</span><span class="p">(</span>
                            <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="n">cat</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">),</span>
                            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>

            <span class="n">texnewline</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="n">_latex_tab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span><span class="si">%s</span><span class="s2"></span>
<span class="s2">                    \begin</span><span class="si">{tabularx}</span><span class="s2">{0.95\textwidth}{</span><span class="si">%s</span><span class="s2">}</span>
<span class="s2">                    \toprule</span>
<span class="s2">                        </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">                    \midrule</span>
<span class="s2">                        </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">                    \bottomrule</span>
<span class="s2">                    \end</span><span class="si">{tabularx}%s</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="n">_latex_hdr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;\documentclass[a4paper,</span><span class="si">%u</span><span class="s2">pt]</span><span class="si">{extarticle}</span><span class="s2"></span>
<span class="s2">                    \usepackage</span><span class="si">{fontspec}</span><span class="s2"></span>
<span class="s2">                    \usepackage</span><span class="si">{xunicode}</span><span class="s2"></span>
<span class="s2">                    \usepackage</span><span class="si">{polyglossia}</span><span class="s2"></span>
<span class="s2">                    \setdefaultlanguage</span><span class="si">{english}</span><span class="s2"></span>
<span class="s2">                    \usepackage</span><span class="si">{xltxtra}</span><span class="s2"></span>
<span class="s2">                    \usepackage</span><span class="si">{microtype}</span><span class="s2"></span>
<span class="s2">                    \usepackage[margin=5pt,portrait,paperwidth=23cm,paperheight=30cm]</span><span class="si">{geometry}</span><span class="s2"></span>
<span class="s2">                    \usepackage</span><span class="si">{amsmath}</span><span class="s2"></span>
<span class="s2">                    \usepackage</span><span class="si">{amssymb}</span><span class="s2"></span>
<span class="s2">                    \usepackage</span><span class="si">{textcomp}</span><span class="s2"></span>
<span class="s2">                    \usepackage[usenames,dvipsnames,svgnames,table]</span><span class="si">{xcolor}</span><span class="s2"></span>
<span class="s2">                    \usepackage</span><span class="si">{color}</span><span class="s2"></span>
<span class="s2">                    \usepackage</span><span class="si">{booktabs}</span><span class="s2"></span>
<span class="s2">                    \usepackage</span><span class="si">{tabularx}</span><span class="s2"></span>
<span class="s2">                    \setmainfont{</span><span class="si">%s</span><span class="s2">}</span>
<span class="s2">                    \definecolor</span><span class="si">{grey875}{gray}{0.125}</span><span class="s2"></span>
<span class="s2">                    \begin</span><span class="si">{document}</span><span class="s2"></span>
<span class="s2">                    \color</span><span class="si">{grey875}</span><span class="s2"></span>
<span class="s2">                    \thispagestyle</span><span class="si">{empty}</span><span class="s2"></span>
<span class="s2">                    \vfill</span>
<span class="s2">                &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span> <span class="k">if</span> <span class="n">latex_hdr</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">_latex_end</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    \end</span><span class="si">{document}</span><span class="s2"></span>
<span class="s2">                &quot;&quot;&quot;</span> <span class="k">if</span> <span class="n">latex_hdr</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

            <span class="n">_hdr_row</span> <span class="o">=</span> <span class="s1">&#39; &amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">header_format</span> <span class="o">%</span> <span class="n">h</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\%&#39;</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">header</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">locale</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">grouping</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> \
                <span class="k">else</span> <span class="n">locale</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">grouping</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> \
                <span class="k">else</span> <span class="n">x</span>
            <span class="n">intfloat</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">_rows</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row_order</span><span class="p">):</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;subtitle&#39;</span><span class="p">:</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                        <span class="sa">r</span><span class="s1">&#39;\midrule&#39;</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\multicolumn{</span><span class="si">%u</span><span class="s1">}</span><span class="si">{l}</span><span class="s1">{</span><span class="si">%s</span><span class="s1">}</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="mi">6</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">annots</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">urls</span><span class="p">),</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="sa">r</span><span class="s1">&#39;\midrule&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
                    <span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\bigstar$&#39;</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\bigstar$&#39;</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">k0</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">r</span><span class="s1">&#39;PhosphoSite\textsubscript</span><span class="si">{noref}</span><span class="s1">&#39;</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;PhosphoSite_noref&#39;</span>
                        <span class="k">else</span> <span class="n">k</span>
                    <span class="p">)</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="s1">&#39; &amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                        <span class="n">xx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\_&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span>
                        <span class="s1">&#39;</span><span class="si">{:,}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\\\\n</span><span class="s1">&#39;</span>

                <span class="n">_rows</span> <span class="o">+=</span> <span class="n">row</span>

            <span class="n">_latex_tab</span> <span class="o">=</span> <span class="n">_latex_tab</span> <span class="o">%</span> \
                <span class="p">(</span>
                    <span class="n">_latex_hdr</span><span class="p">,</span>
                    <span class="s1">&#39;r&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;p</span><span class="si">{3.0cm}</span><span class="s1">&lt;{\raggedright}&#39;</span> <span class="k">if</span> <span class="n">urls</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span>
                    <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;p</span><span class="si">{2.7cm}</span><span class="s1">&lt;{\raggedright}&#39;</span> <span class="k">if</span> <span class="n">annots</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span>
                    <span class="sa">r</span><span class="s1">&#39;X&lt;{\raggedright}&#39;</span><span class="p">,</span>
                    <span class="n">_hdr_row</span><span class="p">,</span>
                    <span class="n">_rows</span><span class="p">,</span>
                    <span class="n">_latex_end</span>
                <span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outf</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_latex_tab</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Output written to file `</span><span class="si">%s</span><span class="s1">`</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outf</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></div>

<div class="viewcode-block" id="PyPath.source_network"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.source_network">[docs]</a>    <span class="k">def</span> <span class="nf">source_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s1">&#39;HelveticaNeueLTStd&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For EMBL branding, use Helvetica Neue Linotype Standard light</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources_overlap</span><span class="p">()</span>
        <span class="n">tupleListNodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tupleListEdges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dbs</span><span class="p">,</span> <span class="n">overlap</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">overlap</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tupleListNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dbs</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="n">overlap</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">dbs</span><span class="p">,</span> <span class="n">overlap</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">overlap</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tupleListEdges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dbs</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="n">overlap</span><span class="p">]))</span>
        <span class="n">tupleListNodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tupleListNodes</span><span class="p">))</span>
        <span class="n">tupleListEdges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tupleListEdges</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">TupleList</span><span class="p">(</span>
            <span class="n">tupleListNodes</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">TupleList</span><span class="p">(</span>
            <span class="n">tupleListEdges</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># edge widths proportional to overlaps in unique nodes/edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;edge_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">][(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])],</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">es</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;edge_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">][(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])],</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">es</span>
        <span class="p">]</span>
        <span class="c1"># node sizes proportional to number of nodes/edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;vertex_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;vertex_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span>
        <span class="p">]</span>
        <span class="c1"># numbers in vertex labels:</span>
        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">%u</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]])</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span>
        <span class="p">]</span>
        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">%u</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]])</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span>
        <span class="p">]</span>
        <span class="n">plotParamNodes</span> <span class="o">=</span> <span class="n">PlotParam</span><span class="p">(</span>
            <span class="n">graph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;db_net_nodes.pdf&#39;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;circular&#39;</span><span class="p">,</span>
            <span class="n">vertex_label_color</span><span class="o">=</span><span class="s1">&#39;#4d4d4d&#39;</span><span class="p">,</span>
            <span class="n">vertex_color</span><span class="o">=</span><span class="s1">&#39;#73b360&#39;</span><span class="p">,</span>
            <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;#006666&#39;</span><span class="p">,</span>
            <span class="n">vertex_fill_alpha</span><span class="o">=</span><span class="s1">&#39;ff&#39;</span><span class="p">,</span>
            <span class="n">vertex_label_font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span>
            <span class="n">vertex_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;vertex_size&#39;</span><span class="p">],</span>
            <span class="n">bbox</span><span class="o">=</span><span class="n">igraph</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">994</span><span class="p">,</span> <span class="mi">994</span><span class="p">),</span>
            <span class="n">dimensions</span><span class="o">=</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
        <span class="n">plotParamEdges</span> <span class="o">=</span> <span class="n">PlotParam</span><span class="p">(</span>
            <span class="n">graph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;db_net_nodes.pdf&#39;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;circular&#39;</span><span class="p">,</span>
            <span class="n">vertex_label_color</span><span class="o">=</span><span class="s1">&#39;#4d4d4d&#39;</span><span class="p">,</span>
            <span class="n">vertex_color</span><span class="o">=</span><span class="s1">&#39;#73b360&#39;</span><span class="p">,</span>
            <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;#006666&#39;</span><span class="p">,</span>
            <span class="n">vertex_fill_alpha</span><span class="o">=</span><span class="s1">&#39;ff&#39;</span><span class="p">,</span>
            <span class="n">vertex_label_font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span>
            <span class="n">vertex_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;vertex_size&#39;</span><span class="p">],</span>
            <span class="n">bbox</span><span class="o">=</span><span class="n">igraph</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">994</span><span class="p">,</span> <span class="mi">994</span><span class="p">),</span>
            <span class="n">dimensions</span><span class="o">=</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">plotParamNodes</span><span class="p">,</span> <span class="n">plotParamEdges</span></div>

    <span class="c1">#</span>
    <span class="c1"># Load data from GDSC</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="PyPath.load_mutations"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_mutations">[docs]</a>    <span class="k">def</span> <span class="nf">load_mutations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">gdsc_datadir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">mutation_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mutations are listed in vertex attributes. Mutation() objects</span>
<span class="sd">        offers methods to identify residues and look up in Ptm(), Motif()</span>
<span class="sd">        and Domain() objects, to check if those residues are</span>
<span class="sd">        modified, or are in some short motif or domain.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutation_samples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span>
            <span class="s1">&#39;Consequence&#39;</span><span class="p">,</span> <span class="s1">&#39;COSMIC_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLE_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;Tissue_TCGA&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ZYGOSITY&#39;</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">gdsc</span><span class="o">.</span><span class="n">GDSC</span><span class="p">(</span><span class="n">datadir</span><span class="o">=</span><span class="n">gdsc_datadir</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">read_mutations</span><span class="p">(</span><span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">,</span> <span class="n">infile</span><span class="o">=</span><span class="n">mutation_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;mut&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;mut&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;Processing mutations&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">uniprot</span><span class="p">,</span> <span class="n">muts</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">muts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s1">&#39;mut&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s1">&#39;mut&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">if</span> <span class="n">mu</span><span class="o">.</span><span class="n">sample</span> <span class="ow">not</span> <span class="ow">in</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s1">&#39;mut&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s1">&#39;mut&#39;</span><span class="p">]</span>\
                            <span class="p">[</span><span class="n">mu</span><span class="o">.</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s1">&#39;mut&#39;</span><span class="p">]</span>\
                        <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">sample</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mu</span><span class="o">.</span><span class="n">sample</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation_samples</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mutation_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">sample</span><span class="p">))</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="PyPath.load_expression"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_expression">[docs]</a>    <span class="k">def</span> <span class="nf">load_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expression data can be loaded into vertex attributes,</span>
<span class="sd">        or into a pandas DataFrame – the latter offers faster</span>
<span class="sd">        ways to process and use these huge matrices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">gdsc</span><span class="o">.</span><span class="n">read_transcriptomics</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;exp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;Processing transcriptomics&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">array</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">gsymb</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">up</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">gsymb</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">up</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">gsymb</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="n">gsymb</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exp</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">gsymb</span><span class="p">,</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="n">uniprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">gsymb</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">up</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">up</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">up</span><span class="p">]][</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="nb">dict</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">up</span><span class="p">]][</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span></div>

<div class="viewcode-block" id="PyPath.edges_expression"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.edges_expression">[docs]</a>    <span class="k">def</span> <span class="nf">edges_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes function `func` for each pairs of connected proteins in the</span>
<span class="sd">        network, for every expression dataset. By default, `func` simply</span>
<span class="sd">        gives the product the (normalized) expression values.</span>

<span class="sd">        func : callable</span>
<span class="sd">            Function to handle 2 vectors (pandas.Series() objects), should</span>
<span class="sd">            return one vector of the same length.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vindex</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_prod</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
                       <span class="s1">&#39;Weigh edges based on protein expression&#39;</span><span class="p">,</span> <span class="mi">37</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_names</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exp_prod</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exp_prod</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">exp_prod</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span></div>

    <span class="c1">#</span>
    <span class="c1"># Find and remove edges where mutations disrupt PTMs</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="PyPath.mutated_edges"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.mutated_edges">[docs]</a>    <span class="k">def</span> <span class="nf">mutated_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares the mutated residues and the modified residues in PTMs.</span>
<span class="sd">        Interactions are marked as mutated if the target residue in the</span>
<span class="sd">        underlying PTM is mutated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">disrupted</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">smpl</span><span class="p">,</span> <span class="n">mut</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;mut&#39;</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">smpl</span> <span class="o">==</span> <span class="n">sample</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">mut</span><span class="o">.</span><span class="n">original</span> <span class="o">==</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="p">:</span>
                                <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">disrupted</span><span class="p">:</span>
                                    <span class="n">disrupted</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> \
                                        <span class="p">{</span><span class="s1">&#39;ptms&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]),</span> <span class="s1">&#39;disr&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
                                <span class="n">disrupted</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;disr&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">toDel</span><span class="p">,</span> <span class="n">disrupted</span></div>

<div class="viewcode-block" id="PyPath.select_by_go"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.select_by_go">[docs]</a>    <span class="k">def</span> <span class="nf">select_by_go</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">go_terms</span><span class="p">,</span>
            <span class="n">go_desc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">aspects</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">),</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;ANY&#39;</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects the nodes annotated by certain GO terms.</span>

<span class="sd">        Returns set of vertex IDs.</span>

<span class="sd">        :param str method:</span>
<span class="sd">            If `ANY` nodes annotated with any of the terms returned.</span>
<span class="sd">            If `ALL` nodes annotated with all the terms returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_method</span> <span class="o">=</span> <span class="p">(</span>
            <span class="k">lambda</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span> <span class="ow">not</span> <span class="n">s2</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;ALL&#39;</span> <span class="k">else</span>
            <span class="k">lambda</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span> <span class="n">s1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">_method</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">s1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">go_desc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">go_desc</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">go_descendants_goose</span><span class="p">(</span><span class="n">aspects</span> <span class="o">=</span> <span class="n">aspects</span><span class="p">)</span>

        <span class="n">go_terms</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="n">go_terms</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">go_terms</span><span class="p">)</span> <span class="ow">in</span> <span class="p">{</span><span class="nb">set</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">}</span> <span class="k">else</span>
            <span class="p">{</span><span class="n">go_terms</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="n">all_desc</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
            <span class="o">*</span><span class="p">(</span><span class="n">go_desc</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">go_terms</span> <span class="k">if</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">go_desc</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;go&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">go_annotate</span><span class="p">(</span><span class="n">aspects</span> <span class="o">=</span> <span class="n">aspects</span><span class="p">)</span>

        <span class="n">vids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">_method</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;go&#39;</span><span class="p">][</span><span class="n">a</span><span class="p">],</span> <span class="n">all_desc</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aspects</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">vids</span></div>

<div class="viewcode-block" id="PyPath.label_by_go"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.label_by_go">[docs]</a>    <span class="k">def</span> <span class="nf">label_by_go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">go_terms</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assigns a boolean vertex attribute to nodes which tells whether</span>
<span class="sd">        the node is annotated by all or any (see ``method`` parameter of</span>
<span class="sd">        ``select_by_go``) the GO terms.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">vids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_by_go</span><span class="p">(</span><span class="n">go_terms</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>

        <span class="k">for</span> <span class="n">vid</span> <span class="ow">in</span> <span class="n">vids</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vid</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PyPath.load_ligand_receptor_network"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_ligand_receptor_network">[docs]</a>    <span class="k">def</span> <span class="nf">load_ligand_receptor_network</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">lig_rec_resources</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">inference_from_go</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">sources</span> <span class="o">=</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">pathway</span><span class="p">,</span>
            <span class="n">keep_undirected</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">keep_rec_rec</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">keep_lig_lig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a ligand-receptor network.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">CC_EXTRACELL</span>   <span class="o">=</span> <span class="s1">&#39;GO:0005576&#39;</span>
        <span class="n">CC_PLASMAMEM</span>   <span class="o">=</span> <span class="s1">&#39;GO:0005887&#39;</span>
        <span class="n">MF_RECBINDING</span>  <span class="o">=</span> <span class="s1">&#39;GO:0005102&#39;</span>
        <span class="n">MF_RECACTIVITY</span> <span class="o">=</span> <span class="s1">&#39;GO:0038023&#39;</span>

        <span class="k">if</span> <span class="n">inference_from_go</span><span class="p">:</span>

            <span class="n">go_desc</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">go_descendants_goose</span><span class="p">(</span><span class="n">aspects</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">init_network</span><span class="p">(</span><span class="n">sources</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;go&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">go_annotate</span><span class="p">()</span>

            <span class="n">vids_extracell</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_by_go</span><span class="p">(</span><span class="n">CC_EXTRACELL</span><span class="p">,</span>   <span class="n">go_desc</span><span class="p">)</span>
            <span class="n">vids_plasmamem</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_by_go</span><span class="p">(</span><span class="n">CC_PLASMAMEM</span><span class="p">,</span>   <span class="n">go_desc</span><span class="p">)</span>
            <span class="n">vids_recbinding</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_by_go</span><span class="p">(</span><span class="n">MF_RECBINDING</span><span class="p">,</span>  <span class="n">go_desc</span><span class="p">)</span>
            <span class="n">vids_recactivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_by_go</span><span class="p">(</span><span class="n">MF_RECACTIVITY</span><span class="p">,</span> <span class="n">go_desc</span><span class="p">)</span>

            <span class="n">receptors</span> <span class="o">=</span> <span class="n">vids_plasmamem</span> <span class="o">&amp;</span> <span class="n">vids_recactivity</span>
            <span class="n">ligands</span>   <span class="o">=</span> <span class="n">vids_extracell</span> <span class="o">&amp;</span> <span class="n">vids_recbinding</span>

            <span class="n">lig_with_interactions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">rec_with_interactions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">lig_rec_edges</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">lig_lig_edges</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">rec_rec_edges</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>

                <span class="n">srcs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
                    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">src</span><span class="p">(</span><span class="n">keep_undirected</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">tgts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
                    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tgt</span><span class="p">(</span><span class="n">keep_undirected</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">srcs</span> <span class="o">&amp;</span> <span class="n">ligands</span> <span class="ow">and</span> <span class="n">tgts</span> <span class="o">&amp;</span> <span class="n">receptors</span><span class="p">:</span>

                    <span class="n">lig_rec_edges</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">lig_with_interactions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">srcs</span><span class="p">)</span>
                    <span class="n">rec_with_interactions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tgts</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">keep_lig_lig</span> <span class="ow">and</span> <span class="n">srcs</span> <span class="o">&amp;</span> <span class="n">ligands</span> <span class="ow">and</span> <span class="n">tgts</span> <span class="o">&amp;</span> <span class="n">ligands</span><span class="p">:</span>

                    <span class="n">lig_lig_edges</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">keep_rec_rec</span> <span class="ow">and</span> <span class="n">srcs</span> <span class="o">&amp;</span> <span class="n">receptors</span> <span class="ow">and</span> <span class="n">tgts</span> <span class="o">&amp;</span> <span class="n">receptors</span><span class="p">:</span>

                    <span class="n">rec_rec_edges</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_boolean_vattr</span><span class="p">(</span><span class="s1">&#39;ligand_go&#39;</span><span class="p">,</span>   <span class="n">lig_with_interactions</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_boolean_vattr</span><span class="p">(</span><span class="s1">&#39;receptor_go&#39;</span><span class="p">,</span> <span class="n">rec_with_interactions</span><span class="p">)</span>

            <span class="n">edges_to_delete</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">()))</span> <span class="o">-</span>
                <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
                    <span class="n">lig_rec_edges</span><span class="p">,</span>
                    <span class="n">rec_rec_edges</span><span class="p">,</span>
                    <span class="n">lig_lig_edges</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="n">edges_to_delete</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span>
                <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">degree</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>

                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;GO_lig_rec&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">lig_rec_resources</span><span class="p">:</span>

            <span class="n">datasets</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data_formats</span><span class="o">.</span><span class="n">ligand_receptor</span><span class="p">)</span>

            <span class="n">datasets</span><span class="p">[</span><span class="s1">&#39;cellphonedb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">inputArgs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;ligand_ligand&#39;</span><span class="p">:</span>     <span class="n">keep_lig_lig</span><span class="p">,</span>
                <span class="s1">&#39;receptor_receptor&#39;</span><span class="p">:</span> <span class="n">keep_rec_rec</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">load_resources</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">set_boolean_vattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">vids</span><span class="p">,</span> <span class="n">negate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="n">vids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">vids</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">negate</span><span class="p">:</span>

            <span class="n">vids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()))</span> <span class="o">-</span> <span class="n">vids</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="ow">in</span> <span class="n">vids</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>

<div class="viewcode-block" id="PyPath.go_annotate"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.go_annotate">[docs]</a>    <span class="k">def</span> <span class="nf">go_annotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aspects</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Annotates protein nodes with GO terms. In the ``go`` vertex</span>
<span class="sd">        attribute each node is annotated by a dict of sets where keys are</span>
<span class="sd">        one letter codes of GO aspects and values are sets of GO accessions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">go</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">aspects</span> <span class="o">=</span> <span class="n">aspects</span><span class="p">)</span></div>

    <span class="c1"># old name as synonym</span>
    <span class="n">load_go</span> <span class="o">=</span> <span class="n">go_annotate</span>

    <span class="k">def</span> <span class="nf">go_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organism</span><span class="o">=</span><span class="mi">9606</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;go&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">go</span><span class="p">[</span><span class="n">organism</span><span class="p">]</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">GOAnnotation</span><span class="p">(</span><span class="n">organism</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">go_enrichment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">proteins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span>
                      <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                      <span class="n">correction_method</span><span class="o">=</span><span class="s1">&#39;hommel&#39;</span><span class="p">,</span>
                      <span class="n">all_proteins</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;go&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">go</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_dict</span><span class="p">()</span>
        <span class="n">all_proteins</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">all_proteins</span><span class="p">)</span> \
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">all_proteins</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">all_proteins</span> \
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">all_proteins</span><span class="p">,</span> <span class="nb">set</span><span class="p">)</span> <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">annotation</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">up</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">up</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">go</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">],</span>
                                                <span class="n">iteritems</span><span class="p">(</span><span class="n">aspect</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
                           <span class="k">if</span> <span class="n">up</span> <span class="ow">in</span> <span class="n">all_proteins</span><span class="p">])</span>
        <span class="n">enr</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">GOEnrichmentSet</span><span class="p">(</span>
            <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span>
            <span class="n">organism</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span>
            <span class="n">basic_set</span><span class="o">=</span><span class="n">annotation</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">correction_method</span><span class="o">=</span><span class="n">correction_method</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proteins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">enr</span><span class="o">.</span><span class="n">new_set</span><span class="p">(</span><span class="n">set_names</span><span class="o">=</span><span class="n">proteins</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">enr</span>

    <span class="k">def</span> <span class="nf">init_gsea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gsea</span> <span class="o">=</span> <span class="n">gsea</span><span class="o">.</span><span class="n">GSEA</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">mapper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> :: GSEA object initialized, use &#39;</span>
                         <span class="s1">&#39;load_genesets() to load some of the collections.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;      e.g. load_genesets([</span><span class="se">\&#39;</span><span class="s1">H</span><span class="se">\&#39;</span><span class="s1">])</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gsea</span><span class="o">.</span><span class="n">show_collections</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add_genesets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesets</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">gsetid</span> <span class="ow">in</span> <span class="n">genesets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gsetid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsea</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gsea</span><span class="o">.</span><span class="n">load_collection</span><span class="p">(</span><span class="n">gsetid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">geneset_enrichment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">proteins</span><span class="p">,</span>
                           <span class="n">all_proteins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">geneset_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                           <span class="n">correction_method</span><span class="o">=</span><span class="s1">&#39;hommel&#39;</span><span class="p">):</span>
        <span class="n">all_proteins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> \
            <span class="k">if</span> <span class="n">all_proteins</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">all_proteins</span>
        <span class="n">enr</span> <span class="o">=</span> <span class="n">gsea</span><span class="o">.</span><span class="n">GSEABinaryEnrichmentSet</span><span class="p">(</span>
            <span class="n">basic_set</span><span class="o">=</span><span class="n">all_proteins</span><span class="p">,</span>
            <span class="n">gsea</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gsea</span><span class="p">,</span>
            <span class="n">geneset_ids</span><span class="o">=</span><span class="n">geneset_ids</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">correction_method</span><span class="o">=</span><span class="n">correction_method</span><span class="p">)</span>
        <span class="n">enr</span><span class="o">.</span><span class="n">new_set</span><span class="p">(</span><span class="n">proteins</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">enr</span>

<div class="viewcode-block" id="PyPath.update_adjlist"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.update_adjlist">[docs]</a>    <span class="k">def</span> <span class="nf">update_adjlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an adjacency list in a dict of sets format.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">adjlist</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span>
                <span class="n">node</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">))</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="PyPath.find_all_paths"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.find_all_paths">[docs]</a>    <span class="k">def</span> <span class="nf">find_all_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;OUT&#39;</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                       <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds all paths up to length `maxlen` between groups of</span>
<span class="sd">        vertices. This function is needed only becaues igraph`s</span>
<span class="sd">        get_all_shortest_paths() finds only the shortest, not any</span>
<span class="sd">        path up to a defined length.</span>

<span class="sd">        @start : int or list</span>
<span class="sd">            Indices of the starting node(s) of the paths.</span>
<span class="sd">        @end : int or list</span>
<span class="sd">            Indices of the target node(s) of the paths.</span>
<span class="sd">        @mode : &#39;IN&#39;, &#39;OUT&#39;, &#39;ALL&#39;</span>
<span class="sd">            Passed to igraph.Graph.neighbors()</span>
<span class="sd">        @maxlen : int</span>
<span class="sd">            Maximum length of paths in steps, i.e. if maxlen = 3, then</span>
<span class="sd">            the longest path may consist of 3 edges and 4 nodes.</span>
<span class="sd">        @graph : igraph.Graph object</span>
<span class="sd">            The graph you want to find paths in. self.graph by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">find_all_paths_aux</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxlen</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjlist</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="n">find_all_paths_aux</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">paths</span>

        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;adjlist&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_adjlist</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">)</span>

        <span class="n">all_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">end</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">end</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">end</span><span class="p">),</span>
                <span class="s1">&#39;Looking up all paths up to length </span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">maxlen</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">start</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">end</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="n">all_paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">find_all_paths_aux</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="p">[],</span> <span class="n">maxlen</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">all_paths</span></div>

    <span class="k">def</span> <span class="nf">find_all_paths2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">graph</span><span class="p">,</span>
                        <span class="n">start</span><span class="p">,</span>
                        <span class="n">end</span><span class="p">,</span>
                        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;OUT&#39;</span><span class="p">,</span>
                        <span class="n">maxlen</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">psize</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">one_step</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">adjlist</span><span class="p">):</span>
            <span class="c1"># extends all paths by one step using all neighbors in adjacency</span>
            <span class="c1"># list</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[[</span><span class="n">s</span> <span class="o">+</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">adjlist</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
                             <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ii</span>
            <span class="p">]</span>

        <span class="k">def</span> <span class="nf">parts</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">adjlist</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">psize</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">complete_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">maxlen</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">),</span> <span class="n">psize</span><span class="p">):</span>
                    <span class="n">new_paths</span> <span class="o">=</span> <span class="n">one_step</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">psize</span><span class="p">],</span> <span class="n">adjlist</span><span class="p">)</span>
                    <span class="n">complete_paths</span> <span class="o">+=</span> <span class="n">parts</span><span class="p">(</span>
                        <span class="n">new_paths</span><span class="p">,</span>
                        <span class="n">targets</span><span class="p">,</span>
                        <span class="n">adjlist</span><span class="p">,</span>
                        <span class="n">maxlen</span><span class="p">,</span>
                        <span class="n">psize</span><span class="p">,</span>
                        <span class="n">depth</span><span class="o">=</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">90</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\t</span><span class="s1">Depth: </span><span class="si">%u</span><span class="s1"> :: Paths found: </span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span>
                                     <span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_paths</span><span class="p">)))</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">complete_paths</span>

        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">all_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">end</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">end</span><span class="p">]</span>
        <span class="n">send</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">adjlist</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span>
                <span class="n">node</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">))</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>
        <span class="p">]</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">start</span><span class="p">]</span>
        <span class="n">all_paths</span> <span class="o">=</span> <span class="n">parts</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">adjlist</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">,</span> <span class="n">psize</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_paths</span>

    <span class="k">def</span> <span class="nf">transcription_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">([</span>
            <span class="n">j</span>
            <span class="k">for</span> <span class="n">ssl</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">sl</span> <span class="ow">in</span> <span class="p">[[</span>
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">src_by_source</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources_by_type&#39;</span><span class="p">][</span><span class="s1">&#39;TF&#39;</span><span class="p">]</span>
                <span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="s1">&#39;TF&#39;</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sl</span>
            <span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ssl</span>
        <span class="p">])</span>

    <span class="k">def</span> <span class="nf">neighbourhood_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">center</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">center</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">second</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_neighbours</span><span class="p">(</span>
                <span class="n">center</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_neighbours</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">induced_subgraph</span><span class="p">(</span>
            <span class="n">nodes</span><span class="p">,</span> <span class="n">implementation</span><span class="o">=</span><span class="s1">&#39;create_from_scratch&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_proteomicsdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">tissues</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pickle</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">proteomicsdb</span> <span class="o">=</span> <span class="n">proteomicsdb</span><span class="o">.</span><span class="n">ProteomicsDB</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proteomicsdb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pfile</span><span class="o">=</span><span class="n">pickle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proteomicsdb</span><span class="o">.</span><span class="n">get_tissues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proteomicsdb</span><span class="o">.</span><span class="n">tissues_x_proteins</span><span class="p">(</span><span class="n">tissues</span><span class="o">=</span><span class="n">tissues</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteomicsdb</span><span class="o">.</span><span class="n">tissues_loaded</span>

    <span class="k">def</span> <span class="nf">prdb_tissue_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">tissue</span><span class="p">,</span>
                         <span class="n">prdb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">occurrence</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">group_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span>
                         <span class="n">na_value</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">):</span>

        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">prdb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteomicsdb</span> <span class="k">if</span> <span class="n">prdb</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">prdb</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">prdb</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">tissue</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">tissue</span> <span class="ow">in</span> <span class="n">prdb</span><span class="o">.</span><span class="n">samples</span>
            <span class="k">else</span> <span class="p">[</span><span class="n">tissue</span><span class="p">]</span> <span class="k">if</span> <span class="n">tissue</span> <span class="ow">in</span> <span class="n">prdb</span><span class="o">.</span><span class="n">expression</span>
            <span class="k">else</span> <span class="p">[]</span>
        <span class="p">)</span>

        <span class="n">nsamples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
        <span class="n">occurrence</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nsamples</span><span class="p">,</span> <span class="n">occurrence</span><span class="p">)</span> \
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">occurrence</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> \
            <span class="k">else</span> <span class="n">nsamples</span> <span class="o">*</span> <span class="n">occurrence</span>

        <span class="n">proteins_present</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span>
            <span class="n">uniprot</span>
            <span class="k">for</span> <span class="n">uniprot</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
                        <span class="n">prdb</span><span class="o">.</span><span class="n">expression</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">samples</span>
                    <span class="p">])))</span>
            <span class="k">if</span> <span class="n">cnt</span> <span class="o">&gt;=</span> <span class="n">occurrence</span>
        <span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

        <span class="n">expressions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">uniprot</span><span class="p">,</span> <span class="n">group_function</span><span class="p">([</span>
            <span class="n">prdb</span><span class="o">.</span><span class="n">expression</span><span class="p">[</span><span class="n">sample</span><span class="p">][</span><span class="n">uniprot</span><span class="p">]</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">samples</span>
            <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="n">prdb</span><span class="o">.</span><span class="n">expression</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span>
        <span class="p">]))</span> <span class="k">for</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="n">proteins_present</span><span class="p">])</span>

        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">tissue</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">na_value</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expressions</span> <span class="k">else</span> <span class="n">expressions</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span>
        <span class="p">]</span>

<div class="viewcode-block" id="PyPath.load_hpa"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_hpa">[docs]</a>    <span class="k">def</span> <span class="nf">load_hpa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">normal</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">pathology</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">cancer</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">summarize_pathology</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">tissues</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">quality</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Supported&#39;</span><span class="p">,</span> <span class="s1">&#39;Approved&#39;</span><span class="p">]),</span>
                 <span class="n">levels</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;High&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Medium&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="s1">&#39;Low&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Not detected&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                 <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">na_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads Human Protein Atlas data into vertex attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>

        <span class="n">hpa</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_proteinatlas</span><span class="p">(</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="n">normal</span><span class="p">,</span> <span class="n">pathology</span> <span class="o">=</span> <span class="n">pathology</span> <span class="ow">or</span> <span class="n">cancer</span>
        <span class="p">)</span>

        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;hpa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>

        <span class="k">if</span> <span class="n">normal</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">tissue</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">hpa</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">]):</span>

                <span class="k">if</span> <span class="n">tissues</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">tissue</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tissues</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>

                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;hpa&#39;</span><span class="p">][</span><span class="n">tissue</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">levels</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]]</span>
                        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">quality</span>
                        <span class="k">else</span> <span class="n">na_value</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">cancer</span> <span class="ow">or</span> <span class="n">pathology</span><span class="p">:</span>

            <span class="n">counts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Not detected&#39;</span><span class="p">,</span> <span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium&#39;</span><span class="p">,</span> <span class="s1">&#39;High&#39;</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">tissue</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">hpa</span><span class="p">[</span><span class="s1">&#39;pathology&#39;</span><span class="p">]):</span>

                <span class="k">if</span> <span class="n">tissues</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">tissue</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tissues</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">tissue</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">if</span> <span class="n">summarize_pathology</span> <span class="k">else</span> <span class="n">na_value</span>
                                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>

                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

                        <span class="k">if</span> <span class="n">summarize_pathology</span><span class="p">:</span>

                            <span class="n">patho_sum</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
                                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">counts</span>
                            <span class="p">))</span>

                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">patho_sum</span><span class="p">):</span>
                                <span class="n">v</span><span class="p">[</span><span class="n">tissue</span><span class="p">]</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="n">patho_sum</span><span class="o">.</span><span class="n">most_common</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

                        <span class="k">else</span><span class="p">:</span>

                            <span class="n">v</span><span class="p">[</span><span class="n">tissue</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span></div>

<div class="viewcode-block" id="PyPath.tissue_network"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.tissue_network">[docs]</a>    <span class="k">def</span> <span class="nf">tissue_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tissue</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a network which includes the proteins expressed in</span>
<span class="sd">        certain tissue according to ProteomicsDB.</span>

<span class="sd">        Args:</span>
<span class="sd">        -----</span>
<span class="sd">        :param str tissue:</span>
<span class="sd">            Tissue name as used in ProteomicsDB.</span>
<span class="sd">        :param igraph.Graph graph:</span>
<span class="sd">            A graph object, by default the `graph` attribute of</span>
<span class="sd">            the current instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="k">if</span> <span class="n">tissue</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prdb_tissue_expr</span><span class="p">(</span><span class="n">tissue</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">induced_subgraph</span><span class="p">(</span>
            <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">tissue</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">])</span></div>

<div class="viewcode-block" id="PyPath.small_plot"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.small_plot">[docs]</a>    <span class="k">def</span> <span class="nf">small_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is deprecated, do not use it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arrow_size</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">arrow_width</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">edge_color</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_directed</span><span class="p">(</span>
            <span class="n">graph</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">toDel</span><span class="p">:</span>
                <span class="n">opp</span> <span class="o">=</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">soure</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">opp</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">opp</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                    <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opp</span><span class="p">)</span>
        <span class="n">dgraph</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">toDel</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">tgt</span> <span class="o">=</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                <span class="n">edge_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#646567&#39;</span><span class="p">)</span>
                <span class="n">arrow_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0001</span><span class="p">)</span>
                <span class="n">arrow_width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0001</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_stimulation</span><span class="p">((</span><span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">)):</span>
                    <span class="n">edge_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#6EA945&#39;</span><span class="p">)</span>
                    <span class="n">arrow_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">arrow_width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_inhibition</span><span class="p">((</span><span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">)):</span>
                    <span class="n">edge_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#DA0025&#39;</span><span class="p">)</span>
                    <span class="n">arrow_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">arrow_width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">edge_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#007B7F&#39;</span><span class="p">)</span>
                    <span class="n">arrow_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">arrow_width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">bdrawing</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span>
            <span class="n">graph</span><span class="o">=</span><span class="n">dgraph</span><span class="p">,</span>
            <span class="n">edge_color</span><span class="o">=</span><span class="n">edge_color</span><span class="p">,</span>
            <span class="n">edge_arrow_size</span><span class="o">=</span><span class="n">arrow_size</span><span class="p">,</span>
            <span class="n">edge_arrow_width</span><span class="o">=</span><span class="n">arrow_width</span><span class="p">,</span>
            <span class="n">vertex_label</span><span class="o">=</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span>
            <span class="n">vertex_color</span><span class="o">=</span><span class="s1">&#39;ltp&#39;</span><span class="p">,</span>
            <span class="n">vertex_alpha</span><span class="o">=</span><span class="s1">&#39;FF&#39;</span><span class="p">,</span>
            <span class="n">edge_alpha</span><span class="o">=</span><span class="s1">&#39;FF&#39;</span><span class="p">,</span>
            <span class="n">edge_label</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">]],</span>
            <span class="n">vertex_label_family</span><span class="o">=</span><span class="s1">&#39;HelveticaNeueLT Std Lt&#39;</span><span class="p">,</span>
            <span class="n">edge_label_family</span><span class="o">=</span><span class="s1">&#39;HelveticaNeueLT Std Lt&#39;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">communities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;spinglass&#39;</span><span class="p">:</span>
            <span class="n">giant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_giant</span><span class="p">()</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="n">giant</span>
            <span class="k">if</span> <span class="s1">&#39;spins&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;spins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;fastgreedy&#39;</span><span class="p">:</span>
            <span class="n">undgr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_undirected</span><span class="p">(</span><span class="n">combine_edges</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="n">undgr</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_community&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">):</span>
            <span class="n">to_call</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_community&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">to_call</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
                <span class="n">comm</span> <span class="o">=</span> <span class="n">to_call</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;VertexDendrogram&#39;</span><span class="p">:</span>
                <span class="n">comm</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">as_clustering</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">comm</span>

<div class="viewcode-block" id="PyPath.set_receptors"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.set_receptors">[docs]</a>    <span class="k">def</span> <span class="nf">set_receptors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a vertex attribute `rec` with value *True* if</span>
<span class="sd">        the protein is a receptor, otherwise *False*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;rec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;rec&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">receptors_list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;rec&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">rec</span><span class="p">]][</span><span class="s1">&#39;rec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PyPath.set_kinases"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.set_kinases">[docs]</a>    <span class="k">def</span> <span class="nf">set_kinases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a vertex attribute `kin` with value *True* if</span>
<span class="sd">        the protein is a kinase, otherwise *False*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;kin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;kin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kinases_list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">kin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;kin&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">kin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">kin</span><span class="p">]][</span><span class="s1">&#39;kin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PyPath.set_signaling_proteins"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.set_signaling_proteins">[docs]</a>    <span class="k">def</span> <span class="nf">set_signaling_proteins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a vertex attribute `kin` with value *True* if</span>
<span class="sd">        the protein is a kinase, otherwise *False*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;sig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;kin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signaling_proteins_list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;sig&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">sig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">sig</span><span class="p">]][</span><span class="s1">&#39;sig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PyPath.set_druggability"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.set_druggability">[docs]</a>    <span class="k">def</span> <span class="nf">set_druggability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a vertex attribute `dgb` with value *True* if</span>
<span class="sd">        the protein is druggable, otherwise *False*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;dgb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;dgb&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">druggability_list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">dgb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;dgb&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">dgb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">dgb</span><span class="p">]][</span><span class="s1">&#39;dgb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PyPath.set_drugtargets"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.set_drugtargets">[docs]</a>    <span class="k">def</span> <span class="nf">set_drugtargets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pchembl</span><span class="o">=</span><span class="mf">5.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a vertex attribute `dtg` with value *True* if</span>
<span class="sd">        the protein has at least one compound binding with</span>
<span class="sd">        affinity higher than `pchembl`, otherwise *False*.</span>

<span class="sd">        Args:</span>
<span class="sd">        -----</span>
<span class="sd">        :param float pchembl:</span>
<span class="sd">            Pchembl threshold.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;dtg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;compounds_data&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compounds_from_chembl</span><span class="p">(</span><span class="n">assay_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="n">pchembl</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;compounds_data&#39;</span><span class="p">]:</span>
                <span class="n">pc</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pchembl&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pchembl</span><span class="p">:</span>
                        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;dtg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PyPath.set_transcription_factors"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.set_transcription_factors">[docs]</a>    <span class="k">def</span> <span class="nf">set_transcription_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a vertex attribute `tf` with value *True* if</span>
<span class="sd">        the protein is a transcription factor, otherwise *False*.</span>

<span class="sd">        Args:</span>
<span class="sd">        -----</span>
<span class="sd">        :param list classes:</span>
<span class="sd">            Classes to use from TF Census. Default is `[&#39;a&#39;, &#39;b&#39;, &#39;other&#39;]`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;tf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;tf&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tfs_list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;tf&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">tf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">tf</span><span class="p">]][</span><span class="s1">&#39;tf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PyPath.set_disease_genes"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.set_disease_genes">[docs]</a>    <span class="k">def</span> <span class="nf">set_disease_genes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s1">&#39;curated&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a vertex attribute named `dis` with boolean values *True*</span>
<span class="sd">        if the protein encoded by a disease related gene according to</span>
<span class="sd">        DisGeNet.</span>

<span class="sd">        Args:</span>
<span class="sd">        -----</span>
<span class="sd">        :param str dataset:</span>
<span class="sd">            Which dataset to use from DisGeNet. Default is `curated`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disease_genes_list</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">tf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">tf</span><span class="p">]][</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">get_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="n">attrname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_pathways&#39;</span> <span class="o">%</span> <span class="n">source</span>
        <span class="n">proteins_pws</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">interactions_pws</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>
            <span class="n">fun</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">attrname</span><span class="p">)</span>
            <span class="n">proteins_pws</span><span class="p">,</span> <span class="n">interactions_pws</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">mapper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">proteins_pws</span><span class="p">,</span> <span class="n">interactions_pws</span>

<div class="viewcode-block" id="PyPath.pathway_members"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.pathway_members">[docs]</a>    <span class="k">def</span> <span class="nf">pathway_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathway</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator with the members of a single pathway.</span>
<span class="sd">        Apart from the pathway name you need to supply its source</span>
<span class="sd">        database too.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_pathways&#39;</span> <span class="o">%</span> <span class="n">source</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attribute_names</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span>
                <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyPath.pathway_names"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.pathway_names">[docs]</a>    <span class="k">def</span> <span class="nf">pathway_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the names of all pathways having at least one member</span>
<span class="sd">        in the current graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>

        <span class="n">attr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_pathways&#39;</span> <span class="o">%</span> <span class="n">source</span>

        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vertex_attributes</span><span class="p">():</span>

            <span class="k">return</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="nf">load_all_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kegg_pathways</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signor_pathways</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathway_attributes</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>

<div class="viewcode-block" id="PyPath.load_pathways"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_pathways">[docs]</a>    <span class="k">def</span> <span class="nf">load_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generic method to load pathway annotations from a resource.</span>
<span class="sd">        We don&#39;t recommend calling this method but either specific</span>
<span class="sd">        methods for a single source e.g. `kegg_pathways()`</span>
<span class="sd">        or `sirnor_pathways()` or call `load_all_pathways()` to</span>
<span class="sd">        load all resources.</span>

<span class="sd">        Args:</span>
<span class="sd">        ----</span>

<span class="sd">        :param str source:</span>
<span class="sd">            Name of the source, this need to match a method in the dict</span>
<span class="sd">            in `get_pathways()` method and the edge and vertex attributes</span>
<span class="sd">            with pathway annotations will be called &quot;&lt;source&gt;_pathways&quot;.</span>
<span class="sd">        :param igraph.Graph graph:</span>
<span class="sd">            A graph, by default the default the `graph` attribute of the</span>
<span class="sd">            current instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attrname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_pathways&#39;</span> <span class="o">%</span> <span class="n">source</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">nodDct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())))</span>
        <span class="n">proteins_pws</span><span class="p">,</span> <span class="n">interactions_pws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pathways</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proteins_pws</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">pw</span><span class="p">,</span> <span class="n">proteins</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">proteins_pws</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">protein</span> <span class="ow">in</span> <span class="n">proteins</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">protein</span> <span class="ow">in</span> <span class="n">proteins</span><span class="p">:</span>
                        <span class="n">uniprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">protein</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">nodDct</span><span class="p">:</span>
                                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">nodDct</span><span class="p">[</span><span class="n">u</span><span class="p">]][</span><span class="n">attrname</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pw</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interactions_pws</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">pw</span><span class="p">,</span> <span class="n">ia</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">interactions_pws</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">ia</span><span class="p">:</span>
                    <span class="n">usrcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                    <span class="n">utgts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">usrc</span> <span class="ow">in</span> <span class="n">usrcs</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">utgt</span> <span class="ow">in</span> <span class="n">utgts</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">usrc</span> <span class="ow">in</span> <span class="n">nodDct</span> <span class="ow">and</span> <span class="n">utgt</span> <span class="ow">in</span> <span class="n">nodDct</span><span class="p">:</span>
                                <span class="n">eid</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span>
                                    <span class="n">nodDct</span><span class="p">[</span><span class="n">usrc</span><span class="p">],</span> <span class="n">nodDct</span><span class="p">[</span><span class="n">utgt</span><span class="p">],</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">eid</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="n">attrname</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pw</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">signor_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pathways</span><span class="p">(</span><span class="s1">&#39;signor&#39;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">kegg_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pathways</span><span class="p">(</span><span class="s1">&#39;kegg&#39;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pathway_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="k">if</span> <span class="s1">&#39;netpath_pathways&#39;</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;netpath_pathways&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;netpath_pathways&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;netpath_pathways&#39;</span><span class="p">]</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span>
                        <span class="n">e</span><span class="p">[</span><span class="s1">&#39;netpath_pathways&#39;</span><span class="p">])</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;netpath_pathways&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;netpath_pathways&#39;</span><span class="p">]</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span>
                        <span class="n">e</span><span class="p">[</span><span class="s1">&#39;netpath_pathways&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;slk_pathways&#39;</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;signalink_pathways&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;slk_pathways&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;atg&#39;</span><span class="p">]:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;signalink_pathways&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;autophagy&#39;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;signalink_pathways&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;signalink_pathways&#39;</span><span class="p">]</span> <span class="o">|</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;signalink_pathways&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span>
            <span class="p">]</span>

    <span class="k">def</span> <span class="nf">pathways_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;genes_pathways.list&#39;</span><span class="p">,</span>
                       <span class="n">pw_sources</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;signalink&#39;</span><span class="p">,</span> <span class="s1">&#39;signor&#39;</span><span class="p">,</span> <span class="s1">&#39;netpath&#39;</span><span class="p">,</span> <span class="s1">&#39;kegg&#39;</span><span class="p">],</span>
                       <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UniProt&#39;</span><span class="p">,</span> <span class="s1">&#39;GeneSymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;Database&#39;</span><span class="p">,</span> <span class="s1">&#39;Pathway&#39;</span><span class="p">]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">g</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">pw_sources</span><span class="p">:</span>
                <span class="n">pw_attr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_pathways&#39;</span> <span class="o">%</span> <span class="n">src</span>
                <span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="n">pw_attr</span><span class="p">]:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">src</span><span class="p">,</span> <span class="n">pw</span><span class="p">])</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hdr</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">result</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">guide2pharma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_guide2pharma</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">ulig</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">urec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;receptor_uniprot&#39;</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ligand_uniprot&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ulig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ligand_uniprot&#39;</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ligand_genesymbol&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ulig</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ligand_genesymbol&#39;</span><span class="p">],</span>
                                             <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ulig</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">urec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ur</span> <span class="ow">in</span> <span class="n">urec</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">ul</span> <span class="ow">in</span> <span class="n">ulig</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ul</span><span class="p">,</span> <span class="n">ur</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;effect&#39;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pubmed&#39;</span><span class="p">],</span> <span class="kc">True</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">set_tfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_transcription_factors</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>

<div class="viewcode-block" id="PyPath.load_disgenet"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_disgenet">[docs]</a>    <span class="k">def</span> <span class="nf">load_disgenet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s1">&#39;curated&#39;</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">umls</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">full_data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assigns DisGeNet disease-gene associations to the proteins</span>
<span class="sd">        in the network. Disease annotations will be added to the `dis`</span>
<span class="sd">        vertex attribute.</span>

<span class="sd">        :param float score: Confidence score from DisGeNet. Only associations</span>
<span class="sd">            above the score provided will be considered.</span>
<span class="sd">        :param bool ulms: By default we assign a list of disease names to</span>
<span class="sd">            each protein. To use Unified Medical Language System IDs instead</span>
<span class="sd">            set this to `True`.</span>
<span class="sd">        :param bool full_data: By default we load only disease names. Set this</span>
<span class="sd">            to `True` if you wish to load additional annotations like number</span>
<span class="sd">            of PubMed IDs, number of SNPs and original sources.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_disgenet</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">score</span><span class="p">:</span>

                <span class="n">uniprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;entrez&#39;</span><span class="p">],</span> <span class="s1">&#39;entrez&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">up</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">up</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span><span class="p">:</span>

                        <span class="k">if</span> <span class="n">full_data</span><span class="p">:</span>

                            <span class="n">_</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;entrez&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                            <span class="n">_</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">up</span><span class="p">]][</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

                        <span class="k">elif</span> <span class="n">umls</span><span class="p">:</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">up</span><span class="p">]][</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span>
                                <span class="s1">&#39;umls&#39;</span><span class="p">])</span>

                        <span class="k">else</span><span class="p">:</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">up</span><span class="p">]][</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span>
                                <span class="s1">&#39;disease&#39;</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="nf">curation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by_category</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">all_refs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span>
                <span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">([[</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]]</span>
                                 <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">])))</span>

        <span class="n">cats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">:</span> <span class="n">e1</span> <span class="o">|</span> <span class="n">e2</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span>
                <span class="p">[])))</span> <span class="k">if</span> <span class="n">by_category</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="o">+</span> <span class="n">cats</span><span class="p">:</span>

            <span class="n">sattr</span> <span class="o">=</span> <span class="s1">&#39;cat&#39;</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">catnames</span> <span class="k">else</span> <span class="s1">&#39;sources&#39;</span>
            <span class="n">rattr</span> <span class="o">=</span> <span class="s1">&#39;refs_by_cat&#39;</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">catnames</span> <span class="k">else</span> <span class="s1">&#39;refs_by_source&#39;</span>

            <span class="n">cat</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">catnames</span> \
                <span class="ow">or</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">categories</span> \
                <span class="k">else</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
            <span class="n">catmembers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data_formats</span><span class="o">.</span><span class="n">catnames</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> \
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">catnames</span> \
                <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data_formats</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> \
                <span class="k">else</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">data_formats</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span>

            <span class="n">src_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="n">sattr</span><span class="p">]])</span>
            <span class="n">cat_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> <span class="k">if</span> <span class="n">cat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span>
                <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">sattr</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">catmembers</span><span class="p">)])</span>
            <span class="n">src_nodes_pct</span> <span class="o">=</span> <span class="n">src_nodes</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">cat_nodes</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.0</span>
            <span class="n">only_src_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span>
                <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="n">sattr</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">sattr</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">catmembers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">])</span>
            <span class="n">only_src_nodes_pct</span> <span class="o">=</span> <span class="n">only_src_nodes</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">cat_nodes</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.0</span>
            <span class="n">shared_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span>
                <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="n">sattr</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">sattr</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">catmembers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="p">])</span>

            <span class="n">src_edges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="n">sattr</span><span class="p">]])</span>
            <span class="n">cat_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">()</span> <span class="k">if</span> <span class="n">cat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span>
                <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">sattr</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">catmembers</span><span class="p">)])</span>
            <span class="n">src_edges_pct</span> <span class="o">=</span> <span class="n">src_edges</span> <span class="o">/</span> \
                <span class="nb">float</span><span class="p">(</span><span class="n">cat_edges</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.0</span>
            <span class="n">only_src_edges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span>
                <span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="n">sattr</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">sattr</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">catmembers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">])</span>
            <span class="n">only_src_edges_pct</span> <span class="o">=</span> <span class="n">only_src_edges</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">cat_edges</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.0</span>
            <span class="n">shared_edges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span>
                <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="n">sattr</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">sattr</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">catmembers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="p">])</span>

            <span class="n">src_refs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                <span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">([</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">pmid</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">rattr</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="n">rattr</span><span class="p">]])</span>
                <span class="p">]))</span>
            <span class="n">other_refs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                <span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">([[</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">pmid</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">([</span>
                        <span class="n">rr</span> <span class="k">for</span> <span class="n">sr</span><span class="p">,</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">rattr</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">sr</span> <span class="o">!=</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">sr</span> <span class="ow">in</span> <span class="n">catmembers</span>
                    <span class="p">])</span>
                <span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]))</span>
            <span class="n">only_src_refs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_refs</span> <span class="o">-</span> <span class="n">other_refs</span><span class="p">)</span>
            <span class="n">only_src_refs_pct</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_refs</span> <span class="o">-</span> <span class="n">other_refs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span>
                <span class="n">all_refs</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.0</span>
            <span class="n">src_refs_pct</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_refs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">all_refs</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.0</span>
            <span class="n">shared_refs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_refs</span> <span class="o">&amp;</span> <span class="n">other_refs</span><span class="p">)</span>

            <span class="n">shared_curation_effort</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="nb">set</span><span class="p">(</span>
                        <span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">([[(</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rr</span><span class="p">]</span>
                                         <span class="k">for</span> <span class="n">sr</span><span class="p">,</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">rattr</span><span class="p">])</span>
                                         <span class="k">if</span> <span class="n">sr</span> <span class="o">!=</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">sr</span> <span class="ow">in</span> <span class="n">catmembers</span><span class="p">]))</span> <span class="o">&amp;</span>
                    <span class="nb">set</span><span class="p">([(</span><span class="n">rl</span><span class="o">.</span><span class="n">pmid</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">rl</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="n">rattr</span><span class="p">][</span><span class="n">s</span><span class="p">]])</span>
                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="n">rattr</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">])</span>

            <span class="n">src_only_curation_effort</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="nb">set</span><span class="p">([(</span><span class="n">rl</span><span class="o">.</span><span class="n">pmid</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">rl</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="n">rattr</span><span class="p">][</span><span class="n">s</span><span class="p">]])</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span>
                        <span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">([[(</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rr</span><span class="p">]</span>
                                         <span class="k">for</span> <span class="n">sr</span><span class="p">,</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">rattr</span><span class="p">])</span>
                                         <span class="k">if</span> <span class="n">sr</span> <span class="o">!=</span> <span class="n">s</span> <span class="k">if</span> <span class="n">sr</span> <span class="ow">in</span> <span class="n">catmembers</span><span class="p">]))</span>
                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="n">rattr</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">])</span>

            <span class="n">src_curation_effort</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="nb">set</span><span class="p">([(</span><span class="n">rl</span><span class="o">.</span><span class="n">pmid</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">rl</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="n">rattr</span><span class="p">][</span><span class="n">s</span><span class="p">]])</span>
                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="n">rattr</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">])</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_refs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">src_edges</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">catnames</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">catnames</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

            <span class="n">result</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;source_nodes&#39;</span><span class="p">:</span> <span class="n">src_nodes</span><span class="p">,</span>
                <span class="s1">&#39;source_nodes_percentage&#39;</span><span class="p">:</span> <span class="n">src_nodes_pct</span><span class="p">,</span>
                <span class="s1">&#39;specific_nodes&#39;</span><span class="p">:</span> <span class="n">only_src_nodes</span><span class="p">,</span>
                <span class="s1">&#39;specific_nodes_percentage&#39;</span><span class="p">:</span> <span class="n">only_src_nodes_pct</span><span class="p">,</span>
                <span class="s1">&#39;shared_nodes&#39;</span><span class="p">:</span> <span class="n">shared_nodes</span><span class="p">,</span>
                <span class="s1">&#39;source_edges&#39;</span><span class="p">:</span> <span class="n">src_edges</span><span class="p">,</span>
                <span class="s1">&#39;source_edges_percentage&#39;</span><span class="p">:</span> <span class="n">src_edges_pct</span><span class="p">,</span>
                <span class="s1">&#39;specific_edges&#39;</span><span class="p">:</span> <span class="n">only_src_edges</span><span class="p">,</span>
                <span class="s1">&#39;specific_edges_percentage&#39;</span><span class="p">:</span> <span class="n">only_src_edges_pct</span><span class="p">,</span>
                <span class="s1">&#39;shared_edges&#39;</span><span class="p">:</span> <span class="n">shared_edges</span><span class="p">,</span>
                <span class="s1">&#39;specific_refs&#39;</span><span class="p">:</span> <span class="n">only_src_refs</span><span class="p">,</span>
                <span class="s1">&#39;specific_refs_percentage&#39;</span><span class="p">:</span> <span class="n">only_src_refs_pct</span><span class="p">,</span>
                <span class="s1">&#39;source_refs&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_refs</span><span class="p">),</span>
                <span class="s1">&#39;source_refs_percentage&#39;</span><span class="p">:</span> <span class="n">src_refs_pct</span><span class="p">,</span>
                <span class="s1">&#39;shared_refs&#39;</span><span class="p">:</span> <span class="n">shared_refs</span><span class="p">,</span>
                <span class="s1">&#39;source_curation_effort&#39;</span><span class="p">:</span> <span class="n">src_curation_effort</span><span class="p">,</span>
                <span class="s1">&#39;source_specific_curation_effort&#39;</span><span class="p">:</span> <span class="n">src_only_curation_effort</span><span class="p">,</span>
                <span class="s1">&#39;shared_curation_effort&#39;</span><span class="p">:</span> <span class="n">shared_curation_effort</span><span class="p">,</span>
                <span class="s1">&#39;refs_edges_ratio&#39;</span><span class="p">:</span> <span class="n">ratio</span><span class="p">,</span>
                <span class="s1">&#39;corrected_curation_effort&#39;</span><span class="p">:</span> <span class="n">src_curation_effort</span> <span class="o">*</span> <span class="n">ratio</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">table_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">fname</span><span class="p">,</span>
                    <span class="n">header</span><span class="p">,</span>
                    <span class="n">data</span><span class="p">,</span>
                    <span class="n">sum_row</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">row_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">latex_hdr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">caption</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">font</span><span class="o">=</span><span class="s1">&#39;HelveticaNeueLTStd-LtCn&#39;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                    <span class="n">sum_label</span><span class="o">=</span><span class="s1">&#39;Total&#39;</span><span class="p">,</span>
                    <span class="n">sum_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">header_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">by_category</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">non_digit</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\d.-]+&#39;</span><span class="p">)</span>
        <span class="n">row_order</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> \
            <span class="k">if</span> <span class="n">row_order</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">row_order</span>
        <span class="n">_latex_tab</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span><span class="si">%s</span><span class="s2"></span>
<span class="s2">                \begin</span><span class="si">{tabularx}</span><span class="s2">{\textwidth}{</span><span class="si">%s</span><span class="s2">}</span>
<span class="s2">                \toprule</span>
<span class="s2">                    </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">                \midrule</span>
<span class="s2">                    </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">                </span><span class="si">%s</span><span class="s2">\bottomrule</span>
<span class="s2">                \end</span><span class="si">{tabularx}</span><span class="s2"></span>
<span class="s2">                </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">_latex_hdr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;\documentclass[a4wide,</span><span class="si">%u</span><span class="s2">pt]</span><span class="si">{extarticle}</span><span class="s2"></span>
<span class="s2">                \usepackage</span><span class="si">{fontspec}</span><span class="s2"></span>
<span class="s2">                \usepackage</span><span class="si">{xunicode}</span><span class="s2"></span>
<span class="s2">                \usepackage</span><span class="si">{polyglossia}</span><span class="s2"></span>
<span class="s2">                \setdefaultlanguage</span><span class="si">{english}</span><span class="s2"></span>
<span class="s2">                \usepackage</span><span class="si">{xltxtra}</span><span class="s2"></span>
<span class="s2">                \usepackage</span><span class="si">{microtype}</span><span class="s2"></span>
<span class="s2">                \usepackage[margin=5pt,landscape]</span><span class="si">{geometry}</span><span class="s2"></span>
<span class="s2">                \usepackage</span><span class="si">{amsmath}</span><span class="s2"></span>
<span class="s2">                \usepackage</span><span class="si">{amssymb}</span><span class="s2"></span>
<span class="s2">                \usepackage[usenames,dvipsnames,svgnames,table]</span><span class="si">{xcolor}</span><span class="s2"></span>
<span class="s2">                \usepackage</span><span class="si">{color}</span><span class="s2"></span>
<span class="s2">                \usepackage</span><span class="si">{booktabs}</span><span class="s2"></span>
<span class="s2">                \usepackage</span><span class="si">{tabularx}</span><span class="s2"></span>
<span class="s2">                \setmainfont{</span><span class="si">%s</span><span class="s2">}</span>
<span class="s2">                \definecolor</span><span class="si">{grey875}{gray}{0.125}</span><span class="s2"></span>
<span class="s2">                \begin</span><span class="si">{document}</span><span class="s2"></span>
<span class="s2">                \color</span><span class="si">{grey875}</span><span class="s2"></span>
<span class="s2">                \thispagestyle</span><span class="si">{empty}</span><span class="s2"></span>
<span class="s2">                \vfill</span>
<span class="s2">                \begin</span><span class="si">{table}</span><span class="s2">[h]</span>
<span class="s2">            &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span> <span class="k">if</span> <span class="n">latex_hdr</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">_latex_end</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                \caption{</span><span class="si">%s</span><span class="s2">}</span>
<span class="s2">                \end</span><span class="si">{table}</span><span class="s2"></span>
<span class="s2">                \end</span><span class="si">{document}</span><span class="s2"></span>
<span class="s2">            &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">caption</span> <span class="k">if</span> <span class="n">latex_hdr</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">_hdr_row</span> <span class="o">=</span> <span class="s1">&#39; &amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">header_format</span> <span class="o">%</span> <span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\%&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">header</span>
        <span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">locale</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">grouping</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> \
            <span class="k">else</span> <span class="n">locale</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">grouping</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> \
            <span class="k">else</span> <span class="n">x</span>
        <span class="n">intfloat</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">_rows</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row_order</span><span class="p">):</span>

            <span class="n">row</span> <span class="o">=</span> <span class="s1">&#39; &amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                <span class="n">formatter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">header</span>
            <span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;subtitle&#39;</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;\midrule&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\midrule&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="n">_rows</span> <span class="o">+=</span> <span class="n">row</span>

        <span class="n">sum_cols</span> <span class="o">=</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">))</span> <span class="k">if</span> <span class="n">sum_cols</span> <span class="ow">is</span> <span class="kc">None</span> \
            <span class="k">else</span> <span class="n">sum_cols</span>
        <span class="n">_sum_row</span> <span class="o">=</span> <span class="s1">&#39; &amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">sum_label</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sum_cols</span> <span class="k">else</span> <span class="n">formatter</span><span class="p">(</span>
                <span class="nb">sum</span><span class="p">([</span>
                    <span class="n">intfloat</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span>
                            <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span>
                                <span class="n">non_digit</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]])),</span> <span class="s1">&#39;0&#39;</span>
                            <span class="p">]))[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="p">]))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\\\\n</span><span class="s1">&#39;</span>
        <span class="n">_latex_tab</span> <span class="o">=</span> <span class="n">_latex_tab</span> <span class="o">%</span> <span class="p">(</span><span class="n">_latex_hdr</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span> <span class="o">+</span> <span class="s1">&#39;r&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">),</span>
                                   <span class="n">_hdr_row</span><span class="p">,</span> <span class="n">_rows</span><span class="p">,</span>
                                   <span class="sa">r</span><span class="s1">&#39;\midrule&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">_sum_row</span>
                                   <span class="k">if</span> <span class="n">sum_row</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">_latex_end</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_latex_tab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">curation_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;curation_stats.tex&#39;</span><span class="p">,</span>
                     <span class="n">by_category</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">use_cats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">],</span>
                     <span class="n">header_size</span><span class="o">=</span><span class="s1">&#39;normalsize&#39;</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">by_category</span> <span class="ow">and</span> <span class="s1">&#39;cat&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_categories</span><span class="p">()</span>

        <span class="n">cats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">:</span> <span class="n">e1</span> <span class="o">|</span> <span class="n">e2</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span>
                <span class="p">[])))</span> <span class="k">if</span> <span class="n">by_category</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="n">cats</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">use_cats</span><span class="p">)</span>
        <span class="n">use_cats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cats</span><span class="p">,</span> <span class="n">use_cats</span><span class="p">))</span>

        <span class="n">header</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;source_nodes&#39;</span><span class="p">,</span> <span class="s1">&#39;Proteins&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;source_nodes_percentage&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Proteins [%]&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;shared_nodes&#39;</span><span class="p">,</span> <span class="s1">&#39;Shared proteins&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;specific_nodes&#39;</span><span class="p">,</span> <span class="s1">&#39;Specific proteins&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;specific_nodes_percentage&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Specific proteins [%]&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;source_edges&#39;</span><span class="p">,</span> <span class="s1">&#39;Edges&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;source_edges_percentage&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Edges [%]&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;shared_edges&#39;</span><span class="p">,</span> <span class="s1">&#39;Shared edges&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;specific_edges&#39;</span><span class="p">,</span> <span class="s1">&#39;Specific edges&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;specific_edges_percentage&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Specific edges [%]&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;source_refs&#39;</span><span class="p">,</span> <span class="s1">&#39;References&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;source_refs_percentage&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;References [%]&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;shared_refs&#39;</span><span class="p">,</span> <span class="s1">&#39;Shared references&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;specific_refs&#39;</span><span class="p">,</span> <span class="s1">&#39;Specific references&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;specific_refs_percentage&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Specific references [%]&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;source_curation_effort&#39;</span><span class="p">,</span> <span class="s1">&#39;Curation effort&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;shared_curation_effort&#39;</span><span class="p">,</span> <span class="s1">&#39;Shared curation effort&#39;</span><span class="p">),</span> <span class="p">(</span>
                      <span class="s1">&#39;source_specific_curation_effort&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Specific curation effort&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;refs_edges_ratio&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;References-edges ratio&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;corrected_curation_effort&#39;</span><span class="p">,</span> <span class="s1">&#39;Corrected curation effort&#39;</span><span class="p">)]</span>
        <span class="n">header_format</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\rotatebox</span><span class="si">{90}</span><span class="s1">{\</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">header_size</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">}&#39;</span>

        <span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curation_stats</span><span class="p">(</span><span class="n">by_category</span><span class="o">=</span><span class="n">by_category</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">cs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;specific_refs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;shared_refs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;source_refs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;specific_refs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;shared_refs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;source_refs_percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;specific_refs_percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;source_curation_effort&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;shared_curation_effort&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;source_specific_curation_effort&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;refs_edges_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;corrected_curation_effort&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">use_cats</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">catnames</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">catnames</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">by_category</span><span class="p">:</span>
                    <span class="n">cs</span><span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;subtitle&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cs</span><span class="p">:</span>
                        <span class="k">del</span> <span class="n">cs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="n">row_order</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">by_category</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">use_cats</span><span class="p">:</span>
                <span class="n">row_order</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">data_formats</span><span class="o">.</span><span class="n">catnames</span><span class="p">[</span><span class="n">cat</span><span class="p">],</span> <span class="s1">&#39;subtitle&#39;</span><span class="p">))</span>
                <span class="n">row_order</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="nb">sorted</span><span class="p">(</span>
                        <span class="nb">filter</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">name</span><span class="p">:</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">categories</span> <span class="ow">and</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="n">cat</span><span class="p">,</span>
                            <span class="n">cs</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">table_latex</span><span class="p">(</span>
            <span class="n">fname</span><span class="p">,</span>
            <span class="n">header</span><span class="p">,</span>
            <span class="n">cs</span><span class="p">,</span>
            <span class="n">header_format</span><span class="o">=</span><span class="n">header_format</span><span class="p">,</span>
            <span class="n">row_order</span><span class="o">=</span><span class="n">row_order</span> <span class="k">if</span> <span class="n">by_category</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">by_category</span><span class="o">=</span><span class="n">by_category</span><span class="p">,</span>
            <span class="n">sum_row</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="PyPath.load_old_omnipath"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_old_omnipath">[docs]</a>    <span class="k">def</span> <span class="nf">load_old_omnipath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">kinase_substrate_extra</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                          <span class="n">remove_htp</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                          <span class="n">htp_threshold</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">keep_directed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                          <span class="n">min_refs_undirected</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the OmniPath network as it was before August 2016.</span>
<span class="sd">        Furthermore it gives some more options.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_omnipath</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span></div>

<div class="viewcode-block" id="PyPath.load_omnipath"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.load_omnipath">[docs]</a>    <span class="k">def</span> <span class="nf">load_omnipath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">kinase_substrate_extra</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">remove_htp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                      <span class="n">htp_threshold</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                      <span class="n">keep_directed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                      <span class="n">min_refs_undirected</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                      <span class="n">old_omnipath_resources</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the OmniPath network.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">old_omnipath_resources</span><span class="p">:</span>
            <span class="n">omnipath</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data_formats</span><span class="o">.</span><span class="n">omnipath</span><span class="p">)</span>
            <span class="n">omnipath</span><span class="p">[</span><span class="s1">&#39;biogrid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">interaction</span><span class="p">[</span><span class="s1">&#39;biogrid&#39;</span><span class="p">]</span>
            <span class="n">omnipath</span><span class="p">[</span><span class="s1">&#39;alz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">interaction</span><span class="p">[</span><span class="s1">&#39;alz&#39;</span><span class="p">]</span>
            <span class="n">omnipath</span><span class="p">[</span><span class="s1">&#39;netpath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">interaction</span><span class="p">[</span><span class="s1">&#39;netpath&#39;</span><span class="p">]</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;intact&#39;</span><span class="p">,</span> <span class="s1">&#39;hprd&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">omnipath</span> <span class="o">=</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">omnipath</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_resources</span><span class="p">(</span><span class="n">omnipath</span><span class="p">,</span> <span class="n">exclude</span> <span class="o">=</span> <span class="n">exclude</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kinase_substrate_extra</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_resources</span><span class="p">(</span><span class="n">data_formats</span><span class="o">.</span><span class="n">ptm_misc</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">third_source_directions</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">remove_htp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_htp</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">htp_threshold</span><span class="p">,</span> <span class="n">keep_directed</span><span class="o">=</span><span class="n">keep_directed</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_directed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_undirected</span><span class="p">(</span><span class="n">min_refs</span><span class="o">=</span><span class="n">min_refs_undirected</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">remove_htp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">keep_directed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">htp_stats</span><span class="p">()</span>
        <span class="n">vcount_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span>
        <span class="n">ecount_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">()</span>
        <span class="n">htedgs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">htp</span><span class="p">[</span><span class="n">threshold</span><span class="p">][</span>
                    <span class="s1">&#39;htrefs&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">keep_directed</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span>
                                         <span class="o">.</span><span class="n">is_directed</span><span class="p">())</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="n">htedgs</span><span class="p">)</span>
        <span class="n">zerodeg</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">zerodeg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Interactions with only high-throughput references &#39;</span>
            <span class="s1">&#39;have been removed.</span><span class="se">\n\t</span><span class="s1">   </span><span class="si">%u</span><span class="s1"> interactions removed.</span><span class="se">\n\t</span><span class="s1">   Number of edges &#39;</span>
            <span class="s1">&#39;decreased from </span><span class="si">%u</span><span class="s1"> to </span><span class="si">%u</span><span class="s1">, number of vertices from </span><span class="si">%u</span><span class="s1"> to </span><span class="si">%u</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">htedgs</span><span class="p">),</span> <span class="n">ecount_before</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> <span class="n">vcount_before</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">remove_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_refs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">vcount_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span>
        <span class="n">ecount_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">()</span>
        <span class="n">udedgs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">min_refs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]]))</span> <span class="o">&lt;</span> <span class="n">min_refs</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="n">udedgs</span><span class="p">)</span>
        <span class="n">zerodeg</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">zerodeg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Undirected interactions </span><span class="si">%s</span><span class="s1"> &#39;</span>
            <span class="s1">&#39;have been removed.</span><span class="se">\n\t</span><span class="s1">   </span><span class="si">%u</span><span class="s1"> interactions removed.</span><span class="se">\n\t</span><span class="s1">   Number of edges &#39;</span>
            <span class="s1">&#39;decreased from </span><span class="si">%u</span><span class="s1"> to </span><span class="si">%u</span><span class="s1">, number of vertices from </span><span class="si">%u</span><span class="s1"> to </span><span class="si">%u</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">min_refs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;with less than </span><span class="si">%u</span><span class="s1"> references&#39;</span> <span class="o">%</span>
             <span class="n">min_refs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">udedgs</span><span class="p">),</span> <span class="n">ecount_before</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
             <span class="n">vcount_before</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">numof_directed_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">numof_undirected_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span>
                <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">htp_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">htdata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">refc</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span>
            <span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">((</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">])</span>
                            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">htlim</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">201</span><span class="p">)):</span>
            <span class="n">htrefs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">refc</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">htlim</span><span class="p">])</span>
            <span class="n">htedgs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]])</span> <span class="o">-</span> <span class="n">htrefs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="p">]</span>
            <span class="n">htsrcs</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">uniqList</span><span class="p">(</span>
                <span class="n">common</span><span class="o">.</span><span class="n">flatList</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">htedgs</span><span class="p">]))</span>
            <span class="n">htdata</span><span class="p">[</span><span class="n">htlim</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;rnum&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">htrefs</span><span class="p">),</span>
                <span class="s1">&#39;enum&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">htedgs</span><span class="p">),</span>
                <span class="s1">&#39;snum&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">htsrcs</span><span class="p">),</span>
                <span class="s1">&#39;htrefs&#39;</span><span class="p">:</span> <span class="n">htrefs</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">htp</span> <span class="o">=</span> <span class="n">htdata</span>

<div class="viewcode-block" id="PyPath.third_source_directions"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.third_source_directions">[docs]</a>    <span class="k">def</span> <span class="nf">third_source_directions</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">use_string_effects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">use_laudanna_data</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method calls a series of methods to get</span>
<span class="sd">        additional direction &amp; effect information</span>
<span class="sd">        from sources having no literature curated references,</span>
<span class="sd">        but giving sufficient evidence about the directionality</span>
<span class="sd">        for interactions already supported by literature</span>
<span class="sd">        evidences from other sources.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">use_string_effects</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">string_effects</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kegg_directions</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_laudanna_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">laudanna_effects</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">laudanna_directions</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wang_effects</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acsn_effects</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phosphosite_directions</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phosphopoint_directions</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phosphonetworks_directions</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mimp_directions</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">kegg_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">keggd</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_kegg</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span>
            <span class="n">keggd</span><span class="p">,</span>
            <span class="s1">&#39;KEGG&#39;</span><span class="p">,</span>
            <span class="n">stimulation</span><span class="o">=</span><span class="s1">&#39;activation&#39;</span><span class="p">,</span>
            <span class="n">inhibition</span><span class="o">=</span><span class="s1">&#39;inhibition&#39;</span><span class="p">,</span>
            <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">phosphosite_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">psite</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">phosphosite_directions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span>
            <span class="n">psite</span><span class="p">,</span>
            <span class="s1">&#39;PhosphoSite_dir&#39;</span><span class="p">,</span>
            <span class="n">dirs_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">id_type</span><span class="o">=</span><span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
            <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">phosphopoint_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">ppoint</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">phosphopoint_directions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span>
            <span class="n">ppoint</span><span class="p">,</span>
            <span class="s1">&#39;PhosphoPoint&#39;</span><span class="p">,</span>
            <span class="n">dirs_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">id_type</span><span class="o">=</span><span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
            <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">phosphonetworks_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">pnet</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">pnetworks_interactions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span>
            <span class="n">pnet</span><span class="p">,</span>
            <span class="s1">&#39;PhosphoNetworks&#39;</span><span class="p">,</span>
            <span class="n">dirs_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">id_type</span><span class="o">=</span><span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
            <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mimp_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">mimp</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">mimp_interactions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span>
            <span class="n">mimp</span><span class="p">,</span> <span class="s1">&#39;MIMP&#39;</span><span class="p">,</span> <span class="n">dirs_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">id_type</span><span class="o">=</span><span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">laudanna_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">laud</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_laudanna_directions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span>
            <span class="n">laud</span><span class="p">,</span>
            <span class="s1">&#39;Laudanna_sigflow&#39;</span><span class="p">,</span>
            <span class="n">dirs_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">id_type</span><span class="o">=</span><span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
            <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">laudanna_effects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">laud</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_laudanna_effects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span>
            <span class="n">laud</span><span class="p">,</span>
            <span class="s1">&#39;Laudanna_effects&#39;</span><span class="p">,</span>
            <span class="n">stimulation</span><span class="o">=</span><span class="s1">&#39;activation&#39;</span><span class="p">,</span>
            <span class="n">inhibition</span><span class="o">=</span><span class="s1">&#39;inhibition&#39;</span><span class="p">,</span>
            <span class="n">directed</span><span class="o">=</span><span class="s1">&#39;docking&#39;</span><span class="p">,</span>
            <span class="n">id_type</span><span class="o">=</span><span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
            <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">string_effects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_string_effects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span>
            <span class="n">string</span><span class="p">,</span>
            <span class="s1">&#39;STRING&#39;</span><span class="p">,</span>
            <span class="n">stimulation</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
            <span class="n">inhibition</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
            <span class="n">directed</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
            <span class="n">id_type</span><span class="o">=</span><span class="s1">&#39;ensp&#39;</span><span class="p">,</span>
            <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">acsn_effects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">acsnd</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_acsn_effects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span>
            <span class="n">acsnd</span><span class="p">,</span>
            <span class="s1">&#39;ACSN&#39;</span><span class="p">,</span>
            <span class="n">stimulation</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
            <span class="n">inhibition</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
            <span class="n">directed</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
            <span class="n">id_type</span><span class="o">=</span><span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
            <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">wang_effects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">wangd</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_wang_effects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span>
            <span class="n">wangd</span><span class="p">,</span>
            <span class="s1">&#39;Wang&#39;</span><span class="p">,</span>
            <span class="n">stimulation</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
            <span class="n">inhibition</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
            <span class="n">directed</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span>
            <span class="n">id_type</span><span class="o">=</span><span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
            <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">dirs</span><span class="p">,</span>
                           <span class="n">name</span><span class="p">,</span>
                           <span class="n">directed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">stimulation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">inhibition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">id_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">dirs_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">sourcedirs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">newdirs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">newsigns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dirs_only</span> <span class="ow">or</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">stimulation</span> <span class="ow">or</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">inhibition</span> <span class="ow">or</span> <span class="n">k</span><span class="p">[</span>
                    <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">directed</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">if</span> <span class="n">id_type</span> <span class="ow">is</span> <span class="kc">None</span> \
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">id_type</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="n">tgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="n">id_type</span> <span class="ow">is</span> <span class="kc">None</span> \
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">id_type</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">src</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tgt</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">v1</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
                            <span class="n">v2</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
                            <span class="n">e</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">sourcedirs</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)):</span>
                                    <span class="n">newdirs</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="k">if</span> <span class="n">dirs_only</span> <span class="ow">or</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">directed</span><span class="p">:</span>
                                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_dir</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">stimulation</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span>
                                        <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="s1">&#39;positive&#39;</span><span class="p">):</span>
                                        <span class="n">newsigns</span> <span class="o">+=</span> <span class="mi">1</span>
                                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_sign</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span>
                                                             <span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">inhibition</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span>
                                        <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="s1">&#39;negative&#39;</span><span class="p">):</span>
                                        <span class="n">newsigns</span> <span class="o">+=</span> <span class="mi">1</span>
                                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_sign</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span>
                                                             <span class="s1">&#39;negative&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Directions and signs set for </span><span class="si">%u</span><span class="s1"> edges based on </span><span class="si">%s</span><span class="s1">,&#39;</span>
            <span class="s1">&#39; </span><span class="si">%u</span><span class="s1"> new directions, </span><span class="si">%u</span><span class="s1"> new signs.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">sourcedirs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">newdirs</span><span class="p">,</span> <span class="n">newsigns</span><span class="p">))</span>

<div class="viewcode-block" id="PyPath.curation_effort"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.curation_effort">[docs]</a>    <span class="k">def</span> <span class="nf">curation_effort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sum_by_source</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the total number of reference-interactions pairs.</span>

<span class="sd">        @sum_by_source : bool</span>
<span class="sd">            If True, counts the refrence-interaction pairs by</span>
<span class="sd">            sources, and returns the sum of these values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sum_by_source</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span>
                    <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rs</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">rs</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span>
                        <span class="s1">&#39;refs_by_source&#39;</span><span class="p">])))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="PyPath.export_dot"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.export_dot">[docs]</a>    <span class="k">def</span> <span class="nf">export_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">labels</span><span class="o">=</span><span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span>
                   <span class="n">edges_filter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                   <span class="n">nodes_filter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                   <span class="n">edge_sources</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">dir_sources</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">return_object</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">save_dot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">save_graphics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">prog</span><span class="o">=</span><span class="s1">&#39;neato&#39;</span><span class="p">,</span>
                   <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">hide</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">font</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">auto_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">hide_nodes</span><span class="o">=</span><span class="p">[],</span>
                   <span class="n">defaults</span><span class="o">=</span><span class="p">{},</span>
                   <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds a pygraphviz.AGraph() object with filtering the edges</span>
<span class="sd">        and vertices along arbitrary criteria.</span>
<span class="sd">        Returns the Agraph object if requesred, or exports the dot</span>
<span class="sd">        file, or saves the graphics.</span>

<span class="sd">        @nodes : list</span>
<span class="sd">        List of vertex ids to be included.</span>
<span class="sd">        @edges : list</span>
<span class="sd">        List of edge ids to be included.</span>
<span class="sd">        @directed : bool</span>
<span class="sd">        Create a directed or undirected graph.</span>
<span class="sd">        @labels : str</span>
<span class="sd">        Name type to be used as id/label in the dot format.</span>
<span class="sd">        @edges_filter : function</span>
<span class="sd">        Function to filter edges, accepting igraph.Edge as argument.</span>
<span class="sd">        @nodes_filter : function</span>
<span class="sd">        Function to filter vertices, accepting igraph.Vertex as argument.</span>
<span class="sd">        @edge_sources : list</span>
<span class="sd">        Sources to be included.</span>
<span class="sd">        @dir_sources : list</span>
<span class="sd">        Direction and effect sources to be included.</span>
<span class="sd">        @graph : igraph.Graph</span>
<span class="sd">        The graph object to export.</span>
<span class="sd">        @return_object : bool</span>
<span class="sd">        Whether to return the pygraphviz.AGraph object.</span>
<span class="sd">        @save_dot : str</span>
<span class="sd">        Filename to export the dot file to.</span>
<span class="sd">        @save_graphics : str</span>
<span class="sd">        Filename to export the graphics, the extension defines the format.</span>
<span class="sd">        @prog : str</span>
<span class="sd">        The graphviz layout algorithm to use.</span>
<span class="sd">        @format : str</span>
<span class="sd">        The graphics format passed to pygraphviz.AGrapg().draw().</span>
<span class="sd">        @hide : bool</span>
<span class="sd">        Hide filtered edges instead of omit them.</span>
<span class="sd">        @hide nodes : list</span>
<span class="sd">        Nodes to hide. List of vertex ids.</span>
<span class="sd">        @auto_edges : str</span>
<span class="sd">        Automatic, built-in style for edges.</span>
<span class="sd">        &#39;DIRECTIONS&#39; or &#39;RESOURCE_CATEGORIES&#39; are supported.</span>
<span class="sd">        @font : str</span>
<span class="sd">        Font to use for labels.</span>
<span class="sd">        For using more than one fonts refer to graphviz attributes with constant values</span>
<span class="sd">        or define callbacks or mapping dictionaries.</span>
<span class="sd">        @defaults : dict</span>
<span class="sd">        Default values for graphviz attributes, labeled with the entity, e.g.</span>
<span class="sd">        `{&#39;edge_penwidth&#39;: 0.2}`.</span>
<span class="sd">        @**kwargs : constant, callable or dict</span>
<span class="sd">        Graphviz attributes, labeled by the target entity. E.g. `edge_penwidth`,</span>
<span class="sd">        &#39;vertex_shape` or `graph_label`.</span>
<span class="sd">        If the value is constant, this value will be used.</span>
<span class="sd">        If the value is dict, and has `_name` as key, for every instance of the</span>
<span class="sd">        given entity, the value of the attribute defined by `_name` will be looked</span>
<span class="sd">        up in the dict, and the corresponding value will be given to the graphviz</span>
<span class="sd">        attribute. If the key `_name` is missing from the dict, igraph vertex and</span>
<span class="sd">        edge indices will be looked up among the keys.</span>
<span class="sd">        If the value is callable, it will be called with the current instance of</span>
<span class="sd">        the entity and the returned value will be used for the graphviz attribute.</span>
<span class="sd">        E.g. `edge_arrowhead(edge)` or `vertex_fillcolor(vertex)`</span>
<span class="sd">        Example:</span>
<span class="sd">            import pypath</span>
<span class="sd">            from pypath import data_formats</span>
<span class="sd">            net = pypath.PyPath()</span>
<span class="sd">            net.init_network(pfile = &#39;cache/default.pickle&#39;)</span>
<span class="sd">            #net.init_network({&#39;arn&#39;: data_formats.omnipath[&#39;arn&#39;]})</span>
<span class="sd">            tgf = [v.index for v in net.graph.vs if &#39;TGF&#39; in v[&#39;slk_pathways&#39;]]</span>
<span class="sd">            dot = net.export_dot(nodes = tgf, save_graphics = &#39;tgf_slk.pdf&#39;, prog = &#39;dot&#39;,</span>
<span class="sd">                main_title = &#39;TGF-beta pathway&#39;, return_object = True,</span>
<span class="sd">                label_font = &#39;HelveticaNeueLTStd Med Cn&#39;,</span>
<span class="sd">                edge_sources = [&#39;SignaLink3&#39;],</span>
<span class="sd">                dir_sources = [&#39;SignaLink3&#39;], hide = True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">_custom_attrs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">graph_attrs</span><span class="p">,</span> <span class="n">vertex_attrs</span><span class="p">,</span> <span class="n">edge_attrs</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_graphviz_attrs</span><span class="p">()</span>
        <span class="n">_defaults</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;edge_color&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;undirected&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;unknown&#39;</span><span class="p">:</span> <span class="s1">&#39;#CCCCCC&#39;</span>
                <span class="p">},</span>
                <span class="s1">&#39;directed&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;stimulation&#39;</span><span class="p">:</span> <span class="s1">&#39;#00AA00&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;inhibition&#39;</span><span class="p">:</span> <span class="s1">&#39;#CC0000&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;unknown&#39;</span><span class="p">:</span> <span class="s1">&#39;#0000CC&#39;</span>
                <span class="p">},</span>
                <span class="s1">&#39;pathway&#39;</span><span class="p">:</span> <span class="s1">&#39;#7AA0A177&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ptm&#39;</span><span class="p">:</span> <span class="s1">&#39;#C6909C77&#39;</span><span class="p">,</span>
                <span class="s1">&#39;reaction&#39;</span><span class="p">:</span> <span class="s1">&#39;#C5B26E77&#39;</span><span class="p">,</span>
                <span class="s1">&#39;interaction&#39;</span><span class="p">:</span> <span class="s1">&#39;#9D8BB777&#39;</span>
            <span class="p">},</span>
            <span class="s1">&#39;edge_arrowhead&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;undirected&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;unknown&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span>
                <span class="p">},</span>
                <span class="s1">&#39;directed&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;stimulation&#39;</span><span class="p">:</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;inhibition&#39;</span><span class="p">:</span> <span class="s1">&#39;tee&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;unknown&#39;</span><span class="p">:</span> <span class="s1">&#39;diamond&#39;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s1">&#39;vertex_fillcolor&#39;</span><span class="p">:</span> <span class="s1">&#39;#AAAAAA&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vertex_fontcolor&#39;</span><span class="p">:</span> <span class="s1">&#39;#000000&#39;</span>
        <span class="p">}</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">defaults</span><span class="p">):</span>
            <span class="n">_defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="c1">#</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span> <span class="k">if</span> <span class="n">labels</span> <span class="o">==</span> <span class="s1">&#39;uniprot&#39;</span> <span class="k">else</span> <span class="s1">&#39;label&#39;</span>
        <span class="n">edge_sources</span> <span class="o">=</span> <span class="n">edge_sources</span> <span class="k">if</span> <span class="n">edge_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">edge_sources</span><span class="p">)</span>
        <span class="n">dir_sources</span> <span class="o">=</span> <span class="n">dir_sources</span> <span class="k">if</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="n">dir_sources</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span> <span class="k">if</span> <span class="n">labels</span> <span class="o">==</span> <span class="s1">&#39;uniprot&#39;</span> <span class="k">else</span> <span class="n">labels</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="s1">&#39;label&#39;</span> <span class="k">if</span> <span class="n">labels</span> <span class="o">==</span> <span class="s1">&#39;genesymbol&#39;</span> <span class="k">else</span> <span class="n">labels</span>
        <span class="k">if</span> <span class="n">labels</span> <span class="o">==</span> <span class="s1">&#39;label&#39;</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">n</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">edges</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span> <span class="ow">in</span> <span class="n">nodes</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">())</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>
        <span class="n">dNodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">labels</span><span class="p">])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span>
                      <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">)</span>
        <span class="n">hide_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">hide_nodes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">font</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_custom_attrs</span><span class="p">[</span><span class="s1">&#39;graph_fontname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span>
            <span class="n">_custom_attrs</span><span class="p">[</span><span class="s1">&#39;vertex_fontname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span>
            <span class="n">_custom_attrs</span><span class="p">[</span><span class="s1">&#39;edge_fontname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span>
        <span class="c1"># attribute callbacks</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;graph&#39;</span><span class="p">,</span> <span class="s1">&#39;vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;edge&#39;</span><span class="p">]:</span>
            <span class="n">callbacks_dict</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_callbacks&#39;</span> <span class="o">%</span> <span class="n">entity</span>
            <span class="n">_attrs</span><span class="p">[</span><span class="n">callbacks_dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">callbacks</span> <span class="o">=</span> <span class="n">_attrs</span><span class="p">[</span><span class="n">callbacks_dict</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entity</span> <span class="o">==</span> <span class="s1">&#39;edge&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">auto_edges</span> <span class="o">==</span> <span class="s1">&#39;RESOURCE_CATEGORIES&#39;</span> <span class="ow">or</span>
                        <span class="n">auto_edges</span> <span class="o">==</span> <span class="s1">&#39;DIRECTIONS&#39;</span><span class="p">)</span> \
                        <span class="ow">and</span> <span class="s1">&#39;edge_color&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_custom_attrs</span> \
                        <span class="ow">and</span> <span class="s1">&#39;edge_arrowhead&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_custom_attrs</span><span class="p">:</span>
                    <span class="n">callbacks</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">AttrHelper</span><span class="p">(</span><span class="n">auto_edges</span><span class="p">,</span> <span class="s1">&#39;edge_color&#39;</span><span class="p">,</span> <span class="n">_defaults</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">auto_edges</span> <span class="o">==</span> <span class="s1">&#39;DIRECTIONS&#39;</span><span class="p">:</span>
                        <span class="n">callbacks</span><span class="p">[</span><span class="s1">&#39;arrowhead&#39;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">AttrHelper</span><span class="p">(</span><span class="n">auto_edges</span><span class="p">,</span> <span class="s1">&#39;edge_arrowhead&#39;</span><span class="p">,</span> <span class="n">_defaults</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">callbacks</span><span class="p">[</span><span class="s1">&#39;arrowhead&#39;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">AttrHelper</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;edge_arrowhead&#39;</span><span class="p">,</span> <span class="n">_defaults</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_attrs&#39;</span> <span class="o">%</span> <span class="n">entity</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">callback_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">callback_name</span> <span class="ow">in</span> <span class="n">_custom_attrs</span><span class="p">:</span>
                    <span class="n">callback_value</span> <span class="o">=</span> <span class="n">_custom_attrs</span><span class="p">[</span><span class="n">callback_name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback_value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="k">if</span> <span class="s1">&#39;_name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">callback_value</span><span class="p">:</span>
                            <span class="n">callback_value</span><span class="p">[</span><span class="s1">&#39;_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span>
                    <span class="n">callbacks</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">AttrHelper</span><span class="p">(</span>
                        <span class="n">value</span><span class="o">=</span><span class="n">callback_value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">attr</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="n">_defaults</span><span class="p">)</span>
        <span class="c1"># graph</span>
        <span class="n">dot</span> <span class="o">=</span> <span class="n">graphviz</span><span class="o">.</span><span class="n">AGraph</span><span class="p">(</span><span class="n">directed</span><span class="o">=</span><span class="n">directed</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">gattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">_attrs</span><span class="p">[</span><span class="s1">&#39;graph_callbacks&#39;</span><span class="p">]):</span>
            <span class="n">attrs</span><span class="p">[</span><span class="n">gattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">cleanDict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">gattr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">attrs</span><span class="p">):</span>
            <span class="n">dot</span><span class="o">.</span><span class="n">graph_attr</span><span class="p">[</span><span class="n">gattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1"># vertices</span>
        <span class="k">for</span> <span class="n">vid</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">dNodes</span><span class="p">):</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">vattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">_attrs</span><span class="p">[</span><span class="s1">&#39;vertex_callbacks&#39;</span><span class="p">]):</span>
                <span class="n">attrs</span><span class="p">[</span><span class="n">vattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vid</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">vid</span> <span class="ow">in</span> <span class="n">hide_nodes</span><span class="p">:</span>
                <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;invis&#39;</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">cleanDict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
            <span class="n">dot</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
        <span class="c1"># edges</span>
        <span class="n">edge_callbacks</span> <span class="o">=</span> <span class="n">_attrs</span><span class="p">[</span><span class="s1">&#39;edge_callbacks&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">eid</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span><span class="o">.</span><span class="n">source</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span><span class="o">.</span><span class="n">target</span>
            <span class="n">sn</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">tn</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">sl</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">labels</span><span class="p">]</span>
            <span class="n">tl</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">labels</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span>
            <span class="c1"># this edge should be visible at all?</span>
            <span class="n">evis</span> <span class="o">=</span> <span class="n">edges_filter</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">])</span> <span class="ow">and</span> \
                <span class="n">nodes_filter</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="ow">and</span> <span class="n">nodes_filter</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="n">edge_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">edge_sources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span><span class="o">.</span><span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hide_nodes</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span>
                    <span class="n">eid</span><span class="p">]</span><span class="o">.</span><span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hide_nodes</span>
            <span class="k">if</span> <span class="n">evis</span> <span class="ow">or</span> <span class="n">hide</span><span class="p">:</span>
                <span class="n">drawn_directed</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
                <span class="n">thisDir</span> <span class="o">=</span> <span class="s1">&#39;undirected&#39;</span>
                <span class="n">thisSources</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
                <span class="k">if</span> <span class="n">directed</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">sn</span><span class="p">,</span> <span class="n">tn</span><span class="p">)):</span>
                        <span class="n">sdir</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">sn</span><span class="p">,</span> <span class="n">tn</span><span class="p">),</span> <span class="n">sources</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">thisDir</span> <span class="o">=</span> <span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
                        <span class="n">vis</span> <span class="o">=</span> <span class="p">(</span><span class="n">dir_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                               <span class="nb">len</span><span class="p">(</span><span class="n">sdir</span> <span class="o">&amp;</span> <span class="n">dir_sources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">evis</span>
                        <span class="k">if</span> <span class="n">vis</span> <span class="ow">or</span> <span class="n">hide</span><span class="p">:</span>
                            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="n">sign</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_sign</span><span class="p">((</span><span class="n">sn</span><span class="p">,</span> <span class="n">tn</span><span class="p">))</span>
                            <span class="n">ssign</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_sign</span><span class="p">((</span><span class="n">sn</span><span class="p">,</span> <span class="n">tn</span><span class="p">),</span> <span class="n">sources</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="n">drawn_directed</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="n">vis</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                                        <span class="n">dir_sources</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                        <span class="nb">len</span><span class="p">(</span><span class="n">ssign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;stimulation&#39;</span>
                                <span class="n">thisSources</span> <span class="o">=</span> <span class="n">ssign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> \
                                    <span class="n">ssign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span>
                                <span class="k">for</span> <span class="n">eattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">edge_callbacks</span><span class="p">):</span>
                                    <span class="n">attrs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">],</span> <span class="n">thisDir</span><span class="p">,</span>
                                                       <span class="n">thisSign</span><span class="p">,</span> <span class="n">thisSources</span><span class="p">,</span>
                                                       <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">vis</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                                          <span class="n">dir_sources</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                          <span class="nb">len</span><span class="p">(</span><span class="n">ssign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;inhibition&#39;</span>
                                <span class="n">thisSoures</span> <span class="o">=</span> <span class="n">ssign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> \
                                    <span class="n">ssign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span>
                                <span class="k">for</span> <span class="n">eattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">edge_callbacks</span><span class="p">):</span>
                                    <span class="n">attrs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">],</span> <span class="n">thisDir</span><span class="p">,</span>
                                                       <span class="n">thisSign</span><span class="p">,</span> <span class="n">thisSources</span><span class="p">,</span>
                                                       <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">vis</span><span class="p">:</span>
                                <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
                                <span class="n">thisSources</span> <span class="o">=</span> <span class="n">sdir</span>
                                <span class="k">for</span> <span class="n">eattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">edge_callbacks</span><span class="p">):</span>
                                    <span class="n">attrs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">],</span> <span class="n">thisDir</span><span class="p">,</span>
                                                       <span class="n">thisSign</span><span class="p">,</span> <span class="n">thisSources</span><span class="p">,</span>
                                                       <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;invis&#39;</span>
                                <span class="n">drawn_directed</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">attrs</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">cleanDict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
                            <span class="n">dot</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">tl</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">tn</span><span class="p">,</span> <span class="n">sn</span><span class="p">)):</span>
                        <span class="n">sdir</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">tn</span><span class="p">,</span> <span class="n">sn</span><span class="p">),</span> <span class="n">sources</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">thisDir</span> <span class="o">=</span> <span class="p">(</span><span class="n">tn</span><span class="p">,</span> <span class="n">sn</span><span class="p">)</span>
                        <span class="n">vis</span> <span class="o">=</span> <span class="p">(</span><span class="n">dir_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                               <span class="nb">len</span><span class="p">(</span><span class="n">sdir</span> <span class="o">&amp;</span> <span class="n">dir_sources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">evis</span>
                        <span class="k">if</span> <span class="n">vis</span> <span class="ow">or</span> <span class="n">hide</span><span class="p">:</span>
                            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="n">sign</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_sign</span><span class="p">((</span><span class="n">tn</span><span class="p">,</span> <span class="n">sn</span><span class="p">))</span>
                            <span class="n">ssign</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_sign</span><span class="p">((</span><span class="n">tn</span><span class="p">,</span> <span class="n">sn</span><span class="p">),</span> <span class="n">sources</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="n">drawn_directed</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="n">vis</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                                        <span class="n">dir_sources</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                        <span class="nb">len</span><span class="p">(</span><span class="n">ssign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;stimulation&#39;</span>
                                <span class="n">thisSources</span> <span class="o">=</span> <span class="n">ssign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> \
                                    <span class="n">ssign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span>
                                <span class="k">for</span> <span class="n">eattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">edge_callbacks</span><span class="p">):</span>
                                    <span class="n">attrs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">],</span> <span class="n">thisDir</span><span class="p">,</span>
                                                       <span class="n">thisSign</span><span class="p">,</span> <span class="n">thisSources</span><span class="p">,</span>
                                                       <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">]))</span>
                            <span class="k">elif</span> <span class="n">vis</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                                          <span class="n">dir_sources</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                                          <span class="nb">len</span><span class="p">(</span><span class="n">ssign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;inhibition&#39;</span>
                                <span class="n">thisSources</span> <span class="o">=</span> <span class="n">ssign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> \
                                    <span class="n">ssign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span>
                                <span class="k">for</span> <span class="n">eattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">edge_callbacks</span><span class="p">):</span>
                                    <span class="n">attrs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">],</span> <span class="n">thisDir</span><span class="p">,</span>
                                                       <span class="n">thisSign</span><span class="p">,</span> <span class="n">thisSources</span><span class="p">,</span>
                                                       <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">vis</span><span class="p">:</span>
                                <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
                                <span class="n">thisSources</span> <span class="o">=</span> <span class="n">sdir</span>
                                <span class="k">for</span> <span class="n">eattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">edge_callbacks</span><span class="p">):</span>
                                    <span class="n">attrs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">],</span> <span class="n">thisDir</span><span class="p">,</span>
                                                       <span class="n">thisSign</span><span class="p">,</span> <span class="n">thisSources</span><span class="p">,</span>
                                                       <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;invis&#39;</span>
                                <span class="n">drawn_directed</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">attrs</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">cleanDict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
                            <span class="n">dot</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">tl</span><span class="p">,</span> <span class="n">sl</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">directed</span> <span class="ow">or</span> <span class="n">d</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">):</span>
                    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">thisDir</span> <span class="o">=</span> <span class="s1">&#39;undirected&#39;</span>
                    <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
                    <span class="n">thisSources</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">eattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">edge_callbacks</span><span class="p">):</span>
                        <span class="n">attrs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">],</span> <span class="n">thisDir</span><span class="p">,</span> <span class="n">thisSign</span><span class="p">,</span>
                                           <span class="n">thisSources</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">evis</span> <span class="ow">and</span> <span class="n">hide</span><span class="p">)</span> <span class="ow">or</span> <span class="n">drawn_directed</span><span class="p">:</span>
                        <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;invis&#39;</span>
                    <span class="k">if</span> <span class="n">dot</span><span class="o">.</span><span class="n">has_neighbor</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">tl</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">dot</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">tl</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                                <span class="s1">&#39;invis&#39;</span> <span class="ow">in</span> <span class="n">dot</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">tl</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]:</span>
                            <span class="n">dot</span><span class="o">.</span><span class="n">delete_edge</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">tl</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">dot</span><span class="o">.</span><span class="n">has_neighbor</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">tl</span><span class="p">):</span>
                        <span class="n">attrs</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">cleanDict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
                        <span class="n">dot</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">sl</span><span class="p">,</span> <span class="n">tl</span><span class="p">),</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">save_dot</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">]):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_dot</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dot</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">save_graphics</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">]):</span>
            <span class="n">dot</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">save_graphics</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="n">prog</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_object</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dot</span></div>

    <span class="k">def</span> <span class="nf">consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">con</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="p">((</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">set</span><span class="p">([])</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;edges&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">),</span>
                        <span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="s1">&#39;major&#39;</span><span class="p">])))</span>
                <span class="k">for</span> <span class="n">s1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="k">for</span> <span class="n">s2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)),</span>
                <span class="p">[</span><span class="s1">&#39;directions&#39;</span><span class="p">,</span> <span class="s1">&#39;directions_edges&#39;</span><span class="p">,</span> <span class="s1">&#39;signs&#39;</span><span class="p">,</span> <span class="s1">&#39;signs_edges&#39;</span><span class="p">]))),</span>
            <span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">,</span> <span class="s1">&#39;inconsistency&#39;</span><span class="p">]))</span>
        <span class="c1"># inconsistency #</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Counting inconsistency&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="n">s12</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">()</span> <span class="ow">and</span> \
                            <span class="n">s1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">()</span> <span class="ow">and</span> \
                            <span class="n">s2</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">()</span> <span class="ow">and</span> \
                            <span class="n">s2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">()</span> <span class="ow">or</span> \
                            <span class="n">s2</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">()</span> <span class="ow">and</span> \
                            <span class="n">s2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">()</span> <span class="ow">and</span> \
                            <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">()</span> <span class="ow">and</span> \
                            <span class="n">s1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span>
                                                            <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span>
                            <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">()</span> <span class="ow">and</span> <span class="n">s1</span> <span class="o">!=</span> <span class="n">s2</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span>
                                    <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">()):</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="o">&lt;</span> \
                                    <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">()):</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
                                    <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">()</span> <span class="ow">and</span> \
                            <span class="n">s2</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">()</span> <span class="ow">or</span> \
                            <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">()</span> <span class="ow">and</span> \
                            <span class="n">s2</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                            <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">():</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="o">&gt;</span> \
                                    <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">()):</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="o">&lt;</span> \
                                    <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">()):</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
                                    <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">()</span> <span class="ow">and</span> \
                            <span class="n">s2</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">()</span> <span class="ow">or</span> \
                            <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">()</span> <span class="ow">and</span> \
                            <span class="n">s2</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                            <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">():</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="o">&gt;</span> \
                                    <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">()):</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="o">&lt;</span> \
                                    <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">()):</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
                                    <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                    <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="c1"># consistency #</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Counting consistency&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="n">s12</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">s12</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span>
                                                          <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span>
                            <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">(</span>
                        <span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">())</span> <span class="ow">and</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s12</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span>
                                                          <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span>
                            <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">())</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">(</span>
                        <span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="ow">and</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s12</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                            <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span>
                                <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span>
                                    <span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="ow">and</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s12</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                            <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">())</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span>
                                <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">())</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span>
                                    <span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">())</span> <span class="ow">and</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s12</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                            <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span>
                                <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span>
                                    <span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="ow">and</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s12</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                            <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">())</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span>
                                <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">())</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span>
                                    <span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">())</span> <span class="ow">and</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span>
                                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">con</span>

<div class="viewcode-block" id="PyPath.export_edgelist"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.export_edgelist">[docs]</a>    <span class="k">def</span> <span class="nf">export_edgelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">fname</span><span class="p">,</span>
                        <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                        <span class="n">edge_attributes</span><span class="o">=</span><span class="p">[],</span>
                        <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Write edge list to text file with attributes</span>

<span class="sd">            @param fname: the name of the file or a stream to read from.</span>
<span class="sd">            @param graph: the igraph object containing the network</span>
<span class="sd">            @param names: list with the vertex attribute names to be printed</span>
<span class="sd">                for source and target vertices</span>
<span class="sd">            @param edge_attributes: list with the edge attribute names</span>
<span class="sd">                to be printed</span>
<span class="sd">            @param sep: string used to separate columns</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="c1"># from Luis Tobalina</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="c1"># check that input &#39;names&#39; and &#39;edge_attributes&#39; exist</span>
        <span class="n">names</span> <span class="o">=</span> \
            <span class="nb">filter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">name</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attribute_names</span><span class="p">(),</span>
                <span class="n">names</span>
            <span class="p">)</span>
        <span class="n">edge_attributes</span> <span class="o">=</span> \
            <span class="nb">filter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">attr</span><span class="p">:</span>
                    <span class="n">attr</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attribute_names</span><span class="p">(),</span>
                <span class="n">edge_attributes</span>
            <span class="p">)</span>
        <span class="c1"># write file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="c1"># write header</span>
            <span class="k">for</span> <span class="n">iname</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">iname</span><span class="p">)</span> <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">)</span>
                <span class="p">]),</span> <span class="n">sep</span><span class="p">))</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">eattr</span> <span class="k">for</span> <span class="n">eattr</span> <span class="ow">in</span> <span class="n">edge_attributes</span><span class="p">))</span>
            <span class="c1"># write data</span>
            <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">iname</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="n">iname</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">edge</span><span class="o">.</span><span class="n">tuple</span><span class="p">]),</span> <span class="n">sep</span><span class="p">))</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="n">eattr</span><span class="p">])</span> <span class="k">for</span> <span class="n">eattr</span> <span class="ow">in</span> <span class="n">edge_attributes</span><span class="p">]))</span></div>

    <span class="k">def</span> <span class="nf">in_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csources</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;corum&#39;</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;in_complex&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">[</span><span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="n">cs</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span>
                      <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="n">cs</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">csources</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>

    <span class="c1">#</span>
    <span class="c1"># Methods for translating network to other organism</span>
    <span class="c1">#</span>

    <span class="k">def</span> <span class="nf">translate_refsdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">ids</span><span class="p">):</span>
        <span class="n">new_refsdir</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">rd</span><span class="p">):</span>
            <span class="n">di</span> <span class="o">=</span> <span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">ids</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="n">k</span>
            <span class="n">new_refsdir</span><span class="p">[</span><span class="n">di</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

            <span class="k">return</span> <span class="n">new_refsdir</span>

<div class="viewcode-block" id="PyPath.orthology_translation"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.orthology_translation">[docs]</a>    <span class="k">def</span> <span class="nf">orthology_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                              <span class="n">only_swissprot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                              <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translates the current object to another organism by orthology.</span>
<span class="sd">        Proteins without known ortholog will be deleted.</span>

<span class="sd">        :param int target: NCBI Taxonomy ID of the target organism.</span>
<span class="sd">            E.g. 10090 for mouse.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">return_graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">source</span>
        <span class="n">orto</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">homologene_uniprot_dict</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span>
                                              <span class="n">only_swissprot</span> <span class="o">=</span> <span class="n">only_swissprot</span><span class="p">,</span>
                                              <span class="n">mapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">)</span>

        <span class="n">vcount_before</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span>
        <span class="n">ecount_before</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">()</span>

        <span class="c1"># nodes could not be mapped are to be deleted</span>
        <span class="n">vids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])))</span>

        <span class="n">orto</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">vids</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                           <span class="n">iteritems</span><span class="p">(</span><span class="n">orto</span><span class="p">)))</span>

        <span class="c1"># print(list(iteritems(vdict))[:10])</span>

        <span class="n">toDel</span> <span class="o">=</span> \
            <span class="nb">list</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span>
                        <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="nb">filter</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span>
                            <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">orto</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">orto</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span> <span class="ow">and</span> \
                            <span class="c1"># nodes of other species or compounds ignored</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;ncbi_tax_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">source</span><span class="p">,</span>
                        <span class="n">iteritems</span><span class="p">(</span><span class="n">vids</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">ndel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span>

        <span class="c1"># this for permanent identification of nodes:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;id_old&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()))</span>
        <span class="c1"># a dict of these permanent ids and the orthologs:</span>
        <span class="n">ovid_orto</span> <span class="o">=</span> \
            <span class="nb">dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;id_old&#39;</span><span class="p">],</span> <span class="n">orto</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]),</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">))</span>

        <span class="c1"># renaming vertices</span>
        <span class="n">newnames</span> <span class="o">=</span> \
            <span class="nb">list</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span>
                        <span class="n">orto</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> \
                            <span class="c1"># nodes of other species or compounds ignored</span>
                            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;ncbi_tax_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">source</span> \
                            <span class="k">else</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">vs</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newnames</span>

        <span class="c1"># the new nodes to be added because of ambiguous mapping</span>
        <span class="n">toAdd</span> <span class="o">=</span> \
            <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span>
                    <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                        <span class="o">*</span><span class="nb">map</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span>
                                <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                            <span class="n">orto</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="c1"># except those already exist:</span>
                <span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="p">)</span>

        <span class="n">graph</span> <span class="o">+=</span> <span class="n">toAdd</span>

        <span class="c1"># this for permanent identification of nodes:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;id_new&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()))</span>

        <span class="c1"># this is a dict of vertices to be multiplied:</span>
        <span class="n">vmul</span> <span class="o">=</span> \
            <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span>
                        <span class="p">(</span>
                            <span class="c1"># key is id_new</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">id_old</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id_new&#39;</span><span class="p">],</span>
                            <span class="c1"># id_new of all new orthologs</span>
                            <span class="nb">list</span><span class="p">(</span>
                                <span class="nb">map</span><span class="p">(</span>
                                    <span class="k">lambda</span> <span class="n">vv</span><span class="p">:</span>
                                        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">vv</span><span class="p">)[</span>
                                            <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id_new&#39;</span><span class="p">],</span>
                                    <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">),</span>
                    <span class="n">iteritems</span><span class="p">(</span><span class="n">ovid_orto</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># compiling a dict of new edges to be added due to ambigous mapping</span>

        <span class="c1"># this is for unambiguously identify edges both at directed and</span>
        <span class="c1"># undirected graphs after reindexing at adding new edges:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;id_old&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">()))</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;s_t_old&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="nb">list</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span>
                        <span class="p">(</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;id_new&#39;</span><span class="p">],</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;id_new&#39;</span><span class="p">]</span>
                        <span class="p">),</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">es</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;u_old&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="nb">list</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span>
                        <span class="p">(</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                        <span class="p">),</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">es</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">edgesToAdd</span> <span class="o">=</span> \
            <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">epar</span><span class="p">:</span>
                        <span class="p">(</span>
                            <span class="c1"># the parent edge original id as key</span>
                            <span class="n">epar</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="nb">list</span><span class="p">(</span>
                                <span class="nb">filter</span><span class="p">(</span>
                                    <span class="k">lambda</span> <span class="n">enew</span><span class="p">:</span>
                                        <span class="c1"># removing the parent edge itself</span>
                                        <span class="n">enew</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">epar</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> \
                                        <span class="n">enew</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">epar</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
                                        <span class="n">vmul</span><span class="p">[</span><span class="n">epar</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                        <span class="n">vmul</span><span class="p">[</span><span class="n">epar</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">),</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span>
                            <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;id_old&#39;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;s_t_old&#39;</span><span class="p">]),</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">es</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># translating the dict values to vertex indices</span>
        <span class="n">edgesToAddVids</span> <span class="o">=</span> \
            <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span>
                        <span class="p">(</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">id_new</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">id_new</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                        <span class="p">),</span>
                    <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                        <span class="o">*</span><span class="n">edgesToAdd</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">))</span>

        <span class="c1"># creating new edges</span>
        <span class="n">graph</span> <span class="o">+=</span> <span class="n">edgesToAddVids</span>

        <span class="c1"># id_new &gt; current index</span>
        <span class="n">vids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;id_new&#39;</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">))</span>
        <span class="c1"># id_new &gt; uniprot</span>
        <span class="n">vnms</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;id_new&#39;</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]),</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">))</span>

        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> <span class="s1">&#39;Translating network by homology&#39;</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
        <span class="c1"># setting attributes on old and new edges:</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>

            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

            <span class="n">d</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span>

            <span class="c1"># this lookup is appropriate as old node names are certainly</span>
            <span class="c1"># unique; for newly added edges `dirs` will be None</span>
            <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">orto</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">orto</span><span class="p">:</span>

                <span class="c1"># translation of direction object attached to original edges</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">orto</span><span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">orto</span><span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">}</span>

                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_dir&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">translate_refsdir</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_dir&#39;</span><span class="p">],</span> <span class="n">ids</span><span class="p">)</span>

                <span class="c1"># if new edges have been introduced</span>
                <span class="c1"># based on this specific edge</span>
                <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;id_old&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">edgesToAdd</span><span class="p">:</span>

                    <span class="c1"># iterating new edges between orthologs</span>
                    <span class="k">for</span> <span class="n">enew</span> <span class="ow">in</span> <span class="n">edgesToAdd</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;id_old&#39;</span><span class="p">]]:</span>

                        <span class="n">vid1</span> <span class="o">=</span> <span class="n">vids</span><span class="p">[</span><span class="n">enew</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                        <span class="n">vid2</span> <span class="o">=</span> <span class="n">vids</span><span class="p">[</span><span class="n">enew</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                        <span class="c1"># in case of directed graphs this will be correct:</span>
                        <span class="n">es</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">_source</span> <span class="o">=</span> <span class="n">vid1</span><span class="p">,</span>
                                             <span class="n">_target</span> <span class="o">=</span> <span class="n">vid2</span><span class="p">)</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
                            <span class="c1"># at undirected graphs</span>
                            <span class="c1"># source/target might be opposite:</span>
                            <span class="n">es</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">_source</span> <span class="o">=</span> <span class="n">vid2</span><span class="p">,</span>
                                                 <span class="n">_target</span> <span class="o">=</span> <span class="n">vid1</span><span class="p">)</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Could not find edge &#39;</span>\
                                             <span class="s1">&#39;between </span><span class="si">%s</span><span class="s1"> and </span><span class="si">%s</span><span class="s1">!</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                                <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vid1</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                                <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vid2</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                                                <span class="p">))</span>
                            <span class="k">continue</span>

                        <span class="c1"># this is a new edge between orthologs</span>
                        <span class="n">eenew</span> <span class="o">=</span> <span class="n">es</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                        <span class="n">ids</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="n">e</span><span class="p">[</span><span class="s1">&#39;u_old&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vid1</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                            <span class="n">e</span><span class="p">[</span><span class="s1">&#39;u_old&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vid2</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                        <span class="p">}</span>

                        <span class="n">eenew</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
                        <span class="n">eenew</span><span class="p">[</span><span class="s1">&#39;refs_by_dir&#39;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">translate_refsdir</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_dir&#39;</span><span class="p">],</span> <span class="n">ids</span><span class="p">)</span>

                        <span class="c1"># copying the remaining attributes</span>
                        <span class="k">for</span> <span class="n">eattr</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">eattr</span> <span class="o">!=</span> <span class="s1">&#39;dirs&#39;</span> <span class="ow">and</span> <span class="n">eattr</span> <span class="o">!=</span> <span class="s1">&#39;refs_by_dir&#39;</span><span class="p">:</span>
                                <span class="n">eenew</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">eattr</span><span class="p">])</span>

        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="c1"># id_new &gt; current index</span>
        <span class="n">vids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;id_new&#39;</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">))</span>

        <span class="c1"># setting attributes of vertices</span>
        <span class="k">for</span> <span class="n">vn0</span><span class="p">,</span> <span class="n">vns</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">vmul</span><span class="p">):</span>
            <span class="c1"># the first ortholog:</span>
            <span class="n">v0</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vids</span><span class="p">[</span><span class="n">vn0</span><span class="p">]]</span>
            <span class="c1"># now setting its taxon to the target:</span>
            <span class="n">v0</span><span class="p">[</span><span class="s1">&#39;ncbi_tax_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
            <span class="k">for</span> <span class="n">vn</span> <span class="ow">in</span> <span class="n">vns</span><span class="p">:</span>
                <span class="c1"># iterating further orthologs:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vids</span><span class="p">[</span><span class="n">vn</span><span class="p">]]</span>
                <span class="c1"># copying attributes:</span>
                <span class="k">for</span> <span class="n">vattr</span> <span class="ow">in</span> <span class="n">v0</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">vattr</span> <span class="o">!=</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">vattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">v0</span><span class="p">[</span><span class="n">vattr</span><span class="p">])</span>

        <span class="c1"># removing temporary edge attributes</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;id_old&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;id_old&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;id_new&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;s_t_old&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;u_old&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">collapse_by_name</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_graph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">target</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vindex</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">(</span><span class="n">remap_all</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">refl</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                <span class="s1">&#39;protein&#39;</span><span class="p">,</span>
                <span class="n">target</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">refl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_reflists</span><span class="p">([</span>
                    <span class="n">reflists</span><span class="o">.</span><span class="n">ReferenceList</span><span class="p">(</span><span class="o">*</span><span class="n">refl</span><span class="p">,</span> <span class="n">inFile</span> <span class="o">=</span> <span class="s1">&#39;all_uniprots&#39;</span><span class="p">)])</span>

            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">clean_graph</span><span class="p">()</span>

        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &gt; Network successfully translated from `</span><span class="si">%u</span><span class="s1">` to&#39;</span>\
            <span class="s1">&#39; `</span><span class="si">%u</span><span class="s1">`.</span><span class="se">\n</span><span class="s1">   Nodes before: </span><span class="si">%u</span><span class="s1">, after: </span><span class="si">%u</span><span class="se">\n</span><span class="s1">   Edges before: </span><span class="si">%u</span><span class="s1">,&#39;</span>\
            <span class="s1">&#39; after </span><span class="si">%u</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">vcount_before</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span>
                            <span class="n">ecount_before</span><span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">()))</span>

        <span class="k">if</span> <span class="n">return_graph</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">graph</span></div>

    <span class="n">homology_translation</span> <span class="o">=</span> <span class="n">orthology_translation</span>

<div class="viewcode-block" id="PyPath.random_walk_with_return"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.random_walk_with_return">[docs]</a>    <span class="k">def</span> <span class="nf">random_walk_with_return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">niter</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Random walk with return (RWR) starting from one or more query nodes.</span>
<span class="sd">        Returns affinity (probability) vector of all nodes in the graph.</span>

<span class="sd">        Args:</span>
<span class="sd">        -----</span>
<span class="sd">            :param int,list q:</span>
<span class="sd">                Vertex IDs of query nodes.</span>
<span class="sd">            :param igraph.Graph graph:</span>
<span class="sd">                An `igraph.Graph` object.</span>
<span class="sd">            :param float c:</span>
<span class="sd">                Probability of restart.</span>
<span class="sd">            :param int niter:</span>
<span class="sd">                Number of iterations.</span>

<span class="sd">        Example:</span>
<span class="sd">        --------</span>
<span class="sd">            &gt;&gt;&gt; import igraph</span>
<span class="sd">            &gt;&gt;&gt; import pypath</span>
<span class="sd">            &gt;&gt;&gt; pa = pypath.PyPath()</span>
<span class="sd">            &gt;&gt;&gt; pa.init_network({</span>
<span class="sd">                    &#39;signor&#39;: pypath.data_formats.pathway[&#39;signor&#39;]</span>
<span class="sd">                })</span>
<span class="sd">            &gt;&gt;&gt; q = [</span>
<span class="sd">                    pa.gs(&#39;EGFR&#39;).index,</span>
<span class="sd">                    pa.gs(&#39;ATG4B&#39;).index</span>
<span class="sd">                ]</span>
<span class="sd">            &gt;&gt;&gt; rwr = pa.random_walk_with_return(q = q)</span>
<span class="sd">            &gt;&gt;&gt; palette = igraph.RainbowPalette(n = 100)</span>
<span class="sd">            &gt;&gt;&gt; colors  = [palette.get(int(round(i))) for i in rwr / max(rwr) * 99]</span>
<span class="sd">            &gt;&gt;&gt; igraph.plot(pa.graph, vertex_color = colors)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>

            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Warning: undirected graph provided</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># making q a set of vertex IDs</span>
        <span class="n">q</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">q</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">set</span> <span class="k">else</span>
            <span class="nb">set</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span>
            <span class="p">{</span><span class="n">q</span><span class="p">}</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="k">else</span>
            <span class="kc">None</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">q</span><span class="p">:</span>

            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Warning: no starting node(s)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>

        <span class="c1"># probability per start node</span>
        <span class="n">cp</span> <span class="o">=</span> <span class="n">c</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="c1"># vector with restarting at starting nodes and 0 at all other nodes</span>
        <span class="n">_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cp</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">q</span> <span class="k">else</span> <span class="o">.</span><span class="mi">0</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())])</span>

        <span class="c1"># vector of probabilities;</span>
        <span class="c1"># this will be subject of iteration</span>
        <span class="c1"># and its final state will be the result</span>
        <span class="n">_p</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">_q</span><span class="p">)</span>

        <span class="c1"># transition matrix</span>
        <span class="n">__A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">get_adjacency</span><span class="p">()),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">__A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">__A</span> <span class="o">/</span> <span class="n">__A</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1">#return __A, _p, _q</span>

        <span class="c1"># iteration converges to affinity vector</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>

            <span class="n">_p</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="n">__A</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">_p</span><span class="p">)</span> <span class="o">+</span> <span class="n">_q</span>

        <span class="k">return</span> <span class="n">_p</span></div>

<div class="viewcode-block" id="PyPath.random_walk_with_return2"><a class="viewcode-back" href="../../main.html#pypath.main.PyPath.random_walk_with_return2">[docs]</a>    <span class="k">def</span> <span class="nf">random_walk_with_return2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">niter</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Literally does random walks.</span>
<span class="sd">        Only for testing of the other method, to be deleted later.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># making q a set of vertex IDs</span>
        <span class="n">q</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">q</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">set</span> <span class="k">else</span>
            <span class="nb">set</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span>
            <span class="p">{</span><span class="n">q</span><span class="p">}</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="k">else</span>
            <span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">qq</span> <span class="ow">in</span> <span class="n">q</span><span class="p">:</span>

            <span class="n">current</span> <span class="o">=</span> <span class="n">qq</span>

            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>

                <span class="n">p</span><span class="p">[</span><span class="n">current</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">:</span>

                    <span class="n">current</span> <span class="o">=</span> <span class="n">qq</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="n">successors</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">successors</span><span class="p">:</span>

                        <span class="n">current</span> <span class="o">=</span> <span class="n">qq</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="n">current</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">successors</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">p</span></div>

    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">fromlist</span><span class="o">=</span><span class="p">[</span><span class="n">modname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_disclaimer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disclaimer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">licence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disclaimer</span><span class="p">()</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pypath 0.7.97 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Dénes Türei.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>