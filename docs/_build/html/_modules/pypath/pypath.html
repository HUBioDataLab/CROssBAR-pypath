

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pypath.pypath &mdash; pypath 0.1.72 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="pypath 0.1.72 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> pypath
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <!-- Local TOC -->
                <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">pypath</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>pypath.pypath</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pypath.pypath</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python2</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1">#</span>
<span class="c1">#  This file is part of the `pypath` python module</span>
<span class="c1">#</span>
<span class="c1">#  Copyright (c) 2014-2016 - EMBL-EBI</span>
<span class="c1">#</span>
<span class="c1">#  File author(s): Dénes Türei (denes@ebi.ac.uk)</span>
<span class="c1">#</span>
<span class="c1">#  Distributed under the GPLv3 License.</span>
<span class="c1">#  See accompanying file LICENSE.txt or copy at</span>
<span class="c1">#      http://www.gnu.org/licenses/gpl-3.0.html</span>
<span class="c1">#</span>
<span class="c1">#  Website: http://www.ebi.ac.uk/~denes</span>
<span class="c1">#</span>

<span class="c1"># import main</span>
<span class="kn">import</span> <span class="nn">__main__</span>

<span class="c1"># external modules:</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">igraph</span>
<span class="kn">import</span> <span class="nn">cairo</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">locale</span>
<span class="kn">import</span> <span class="nn">heapq</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">cPickle</span> <span class="kn">as</span> <span class="nn">pickle</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pygraphviz</span> <span class="kn">as</span> <span class="nn">graphviz</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Module `pygraphviz` not found.</span><span class="se">\n</span><span class="s1">&#39;</span>\
        <span class="s1">&#39;You don</span><span class="se">\&#39;</span><span class="s1">t need it unless you want to export dot files.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="c1"># from this module:</span>
<span class="kn">import</span> <span class="nn">logn</span>
<span class="kn">import</span> <span class="nn">data_formats</span>
<span class="kn">import</span> <span class="nn">mapping</span>
<span class="kn">import</span> <span class="nn">descriptions</span>
<span class="kn">import</span> <span class="nn">chembl</span>
<span class="kn">import</span> <span class="nn">gdsc</span>
<span class="kn">import</span> <span class="nn">mysql</span>
<span class="kn">import</span> <span class="nn">dataio</span>
<span class="kn">import</span> <span class="nn">intera</span>
<span class="kn">import</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">drawing</span> <span class="kn">as</span> <span class="nn">bdrawing</span>
<span class="kn">import</span> <span class="nn">proteomicsdb</span>
<span class="kn">from</span> <span class="nn">ig_drawing</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">common</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">common</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">__version__</span>
<span class="kn">from</span> <span class="nn">colorgen</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">gr_plot</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">progress</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">data_formats</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PyPath&#39;</span><span class="p">,</span> <span class="s1">&#39;Direction&#39;</span><span class="p">,</span> <span class="s1">&#39;Reference&#39;</span><span class="p">,</span> <span class="s1">&#39;__version__&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;AttrHelper&#39;</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Reference</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pmid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pmid</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="n">Reference</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmid</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">pmid</span>
    
    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmid</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dataio</span><span class="o">.</span><span class="n">open_pubmed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmid</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmid</span>
    
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pubmeds</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">pmid</span><span class="p">])</span>

<div class="viewcode-block" id="Direction"><a class="viewcode-back" href="../../index.html#pypath.pypath.Direction">[docs]</a><span class="k">class</span> <span class="nc">Direction</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">straight</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s1">&#39;undirected&#39;</span><span class="p">:</span> <span class="bp">False</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="nb">set</span><span class="p">([]),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="nb">set</span><span class="p">([]),</span>
            <span class="s1">&#39;undirected&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positive</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negative</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="nb">set</span><span class="p">([]),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="nb">set</span><span class="p">([]),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mechanisms</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">methods</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;Directions and signs of interaction between </span><span class="si">%s</span><span class="s1"> and </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> ===&gt; </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> &lt;=== </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> ==== </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> =+=&gt; </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> \
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> &lt;=+= </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> \
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> =-=&gt; </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> \
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> &lt;=-= </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> \
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">s</span>
    
    <span class="k">def</span> <span class="nf">check_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">nodes</span><span class="p">)))</span>
    
    <span class="k">def</span> <span class="nf">check_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">di</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">di</span> <span class="o">==</span> <span class="s1">&#39;undirected&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">di</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">di</span><span class="p">)))</span>
    
<div class="viewcode-block" id="Direction.set_dir"><a class="viewcode-back" href="../../index.html#pypath.pypath.Direction.set_dir">[docs]</a>    <span class="k">def</span> <span class="nf">set_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds directionality information with </span>
<span class="sd">        the corresponding data source named.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">source</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="nb">set</span><span class="p">([</span><span class="n">source</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">|</span> <span class="n">source</span></div>
    
<div class="viewcode-block" id="Direction.get_dir"><a class="viewcode-back" href="../../index.html#pypath.pypath.Direction.get_dir">[docs]</a>    <span class="k">def</span> <span class="nf">get_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns boolean or list of sources</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sources</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span></div>
    
<div class="viewcode-block" id="Direction.get_dirs"><a class="viewcode-back" href="../../index.html#pypath.pypath.Direction.get_dirs">[docs]</a>    <span class="k">def</span> <span class="nf">get_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns all directions with boolean values</span>
<span class="sd">        or list of sources.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">tgt</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sources</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">query</span><span class="p">],</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[(</span><span class="n">query</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">query</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">query</span><span class="p">],</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[(</span><span class="n">query</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">query</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span></div>
    
    <span class="k">def</span> <span class="nf">which_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">!=</span> <span class="s1">&#39;undirected&#39;</span><span class="p">]</span>
    
<div class="viewcode-block" id="Direction.unset_dir"><a class="viewcode-back" href="../../index.html#pypath.pypath.Direction.unset_dir">[docs]</a>    <span class="k">def</span> <span class="nf">unset_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Removes directionality information,</span>
<span class="sd">        or single source.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">check_param</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span></div>
    
    <span class="k">def</span> <span class="nf">is_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;undirected&#39;</span><span class="p">]))</span>
    
    <span class="k">def</span> <span class="nf">is_stimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">is_inhibition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">has_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">postive</span><span class="p">[</span><span class="n">direction</span><span class="p">]))</span>
    
    <span class="k">def</span> <span class="nf">set_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_dir</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">sign</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sources</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]]</span>
    
    <span class="k">def</span> <span class="nf">unset_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
    
<div class="viewcode-block" id="Direction.src"><a class="viewcode-back" href="../../index.html#pypath.pypath.Direction.src">[docs]</a>    <span class="k">def</span> <span class="nf">src</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the IDs of effector molecules in this directed </span>
<span class="sd">        interaction. If the interaction is bidirectional, the </span>
<span class="sd">        list will contain 2 IDs. If the interaction is undirec-</span>
<span class="sd">        ted, an empty list will be returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;undirected&#39;</span> <span class="ow">and</span> <span class="n">v</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="Direction.tgt"><a class="viewcode-back" href="../../index.html#pypath.pypath.Direction.tgt">[docs]</a>    <span class="k">def</span> <span class="nf">tgt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the IDs of the target moleculess in the inter-</span>
<span class="sd">        action. Same behaviour as `Direction.src()`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;undirected&#39;</span> <span class="ow">and</span> <span class="n">v</span><span class="p">]</span></div>
    
    <span class="k">def</span> <span class="nf">src_by_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> \
            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;undirected&#39;</span> <span class="ow">and</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">tgt_by_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> \
            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;undirected&#39;</span> <span class="ow">and</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">sources_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">sources_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">sources_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">positive_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">positive_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverese</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">negative_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">negative_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverese</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">negative_sources_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">negative_sources_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">positive_sources_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">positive_sources_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;Direction&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="o">|</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="o">|</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]</span> <span class="o">|</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;undirected&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">uniqList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">uniqList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="o">+</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">])</span></div>

<span class="k">class</span> <span class="nc">AttrHelper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">defaults</span> <span class="o">=</span> <span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="n">defaults</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">thisDir</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">thisSign</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">thisDirSources</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">thisSources</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">_thisDir</span> <span class="o">=</span> <span class="s1">&#39;directed&#39;</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">thisDir</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="n">thisDir</span>
        <span class="c1"># user supplied callback function:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="c1"># special cases #1: by direction/effect</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;DIRECTIONS&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_thisDir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">thisSign</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">_thisDir</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">_thisDir</span><span class="p">][</span><span class="n">thisSign</span><span class="p">]</span>
        <span class="c1"># special cases #2: by source category</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;RESOURCE_CATEGORIES&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">resource_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pathway&#39;</span><span class="p">,</span> <span class="s1">&#39;ptm&#39;</span><span class="p">,</span> <span class="s1">&#39;reaction&#39;</span><span class="p">,</span> <span class="s1">&#39;interaction&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">data_formats</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_resources&#39;</span><span class="o">%</span><span class="n">resource_type</span><span class="p">)</span> <span class="o">&amp;</span> \
                    <span class="n">thisSources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="ow">and</span> \
                        <span class="n">resource_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">resource_type</span><span class="p">]</span>
            <span class="k">print</span> <span class="s1">&#39;No category for </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">thisSources</span>
        <span class="c1"># if value is constant:</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">simpleTypes</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="c1"># if a dictionary given to map some igraph attribute to values:</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;_name&#39;</span><span class="p">]):</span>
                <span class="n">key_attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;_name&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;_name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">key_attr</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;_name&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">key_attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">key_attr</span><span class="p">]</span>
        <span class="c1"># if default value has been given for this attribute:</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="c1"># ultimately, return None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

<span class="k">class</span> <span class="nc">_NamedVertexSeq</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_vs</span><span class="p">,</span> <span class="n">_nodNam</span><span class="p">,</span> <span class="n">_nodLab</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vs</span> <span class="o">=</span> <span class="n">_vs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodNam</span> <span class="o">=</span> <span class="n">_nodNam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodLab</span> <span class="o">=</span> <span class="n">_nodLab</span>
    
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vs</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">v</span>
    
    <span class="k">def</span> <span class="nf">gs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vs</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodLab</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vs</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodNam</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vs</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span>
    
    <span class="n">genesymbol</span> <span class="o">=</span> <span class="n">gs</span>
    <span class="n">uniprot</span> <span class="o">=</span> <span class="n">up</span>
    <span class="n">vs</span> <span class="o">=</span> <span class="n">__iter__</span>

<div class="viewcode-block" id="PyPath"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath">[docs]</a><span class="k">class</span> <span class="nc">PyPath</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="c1">###</span>
    <span class="c1">### main network object</span>
    <span class="c1">###</span>
    
    <span class="n">default_name_type</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;protein&#39;</span><span class="p">:</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;mirna&#39;</span><span class="p">:</span> <span class="s1">&#39;mirbase&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;drug&#39;</span><span class="p">:</span> <span class="s1">&#39;chembl&#39;</span>
    <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="mi">9606</span><span class="p">,</span> <span class="n">default_name_type</span> <span class="o">=</span> <span class="n">default_name_type</span><span class="p">,</span>
                 <span class="n">copy</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">mysql</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;mapping&#39;</span><span class="p">),</span> 
                 <span class="n">chembl_mysql</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;chembl&#39;</span><span class="p">),</span>
                 <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;unnamed&#39;</span><span class="p">,</span> 
                 <span class="n">outdir</span> <span class="o">=</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="n">loglevel</span> <span class="o">=</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span> <span class="n">loops</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Currently only one organism molecular interaction networks</span>
<span class="sd">        are supported. Some functions supports multi-species networks,</span>
<span class="sd">        and maybe once the whole module will support that.</span>
<span class="sd">        </span>
<span class="sd">        @ncbi_tax_id : int</span>
<span class="sd">            The ID of the organism in NCBI Taxonomy. Defaults to human </span>
<span class="sd">            (9606).</span>
<span class="sd">        @mysql</span>
<span class="sd">            The MySQL parameter used by the mapping module to load some</span>
<span class="sd">            ID conversion tables from MySQL. </span>
<span class="sd">        @default_name_type : dict</span>
<span class="sd">            Dictionary of default ID types, what all identifiers of the</span>
<span class="sd">            given molecular species should be converted to. By default, </span>
<span class="sd">            for protein it is UniProt. It could be any other, only then</span>
<span class="sd">            you need to supply the required format definitions for the </span>
<span class="sd">            ID conversion tables.</span>
<span class="sd">        @copy : BioGraph object</span>
<span class="sd">            In case you copy an other instance.</span>
<span class="sd">        @name : str</span>
<span class="sd">            This is a custom session/project name.</span>
<span class="sd">        @outdir : str</span>
<span class="sd">            The directory where you wish to create all the output files.</span>
<span class="sd">        @loglevel : str</span>
<span class="sd">            Passed to logging module.</span>
<span class="sd">        @loops : bool</span>
<span class="sd">            Whether to allow loop edges in the graph. Default is False.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__version__</span> <span class="o">=</span> <span class="n">__version__</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;cache&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">copy</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;entity_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;ncbi_tax_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ncbi_tax_id</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;nameType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;originalNames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;ncbi_tax_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;refs_by_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;sources_by_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;negative_refs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;layout_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;layout_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">g</span><span class="p">[</span><span class="s1">&#39;only_directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="c1"># allow loop edges in the graph</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loops</span> <span class="o">=</span> <span class="n">loops</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">failed_edges</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uniprot_mapped</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mysql_conf</span> <span class="o">=</span> <span class="n">mysql</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_chembl_mysql</span><span class="p">(</span><span class="n">chembl_mysql</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chembl_mysql</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># self.mysql = mysql.MysqlRunner(self.mysql_conf)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unmapped</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="o">=</span> <span class="n">outdir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">ncbi_tax_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">negatives</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lists</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plots</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proteomicsdb</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exp_samples</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathway_types</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathways</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">palette</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#6EA945&#39;</span><span class="p">,</span> <span class="s1">&#39;#007B7F&#39;</span><span class="p">,</span> <span class="s1">&#39;#FCCC06&#39;</span><span class="p">,</span> <span class="s1">&#39;#DA0025&#39;</span><span class="p">,</span> <span class="s1">&#39;#000000&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">gen_session_id</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span> <span class="o">=</span> <span class="n">loglevel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span> <span class="o">=</span> <span class="n">logn</span><span class="o">.</span><span class="n">logw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">Mapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span> 
                <span class="n">mysql_conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mysql_conf</span><span class="p">,</span> <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disclaimer</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n\t</span><span class="s1">=== d i s c l a i m e r ===</span><span class="se">\n\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">All data coming with this module</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">either as redistributed copy or downloaded using the</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">programmatic interfaces included in the present module</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">are available under public domain, are free to use at</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">least for academic research or education purposes.</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Please be aware of the licences of all the datasets</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">you use in your analysis, and please give appropriate</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">credits for the original sources when you publish your</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">results. To find out more about data sources please</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">look at `pypath.descriptions` and</span><span class="se">\n</span><span class="s1">&#39;</span>\
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">`pypath.data_formats.urls`.</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">licence</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;PyPath has been initialized&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Beginning session &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;\t» New session started,\n\tsession ID: &#39;%s&#39;\n\tlogfile:&quot;&quot;&quot;</span>\
                <span class="sd">&quot;&quot;&quot;&#39;./%s&#39;.\n&quot;&quot;&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">logfile</span><span class="p">))</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy</span><span class="p">)</span>
    
<div class="viewcode-block" id="PyPath.set_chembl_mysql"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.set_chembl_mysql">[docs]</a>    <span class="k">def</span> <span class="nf">set_chembl_mysql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">config_file</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sets the ChEMBL MySQL config according to</span>
<span class="sd">        `title` section in `config_file` ini style config.</span>
<span class="sd">            </span>
<span class="sd">            title (str): section title in ini file</span>
<span class="sd">            config_file (str, NoneType): config file name; </span>
<span class="sd">                if None, the `mysql_config/defaults.mysql`</span>
<span class="sd">                will be used</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chembl_mysql</span> <span class="o">=</span> <span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">__dict__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Reinitialized&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
    
<div class="viewcode-block" id="PyPath.init_network"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.init_network">[docs]</a>    <span class="k">def</span> <span class="nf">init_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">omnipath</span><span class="p">,</span> <span class="n">exclude</span> <span class="o">=</span> <span class="p">[],</span> 
        <span class="n">cache_files</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">pfile</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This is a lazy way to start the module, load data </span>
<span class="sd">        and build the high confidence, literature curated</span>
<span class="sd">        part of the signaling network.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">pfile</span><span class="p">:</span>
            <span class="n">pfile</span> <span class="o">=</span> <span class="n">pfile</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pfile</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span> \
                <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;default_network.pickle&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pfile</span><span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Loading igraph object from file `</span><span class="si">%s</span><span class="s1">`...&#39;</span> <span class="o">%</span> <span class="n">pfile</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">graph</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">pfile</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span> <span class="ow">is</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span> <span class="ow">and</span> <span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="si">%s</span><span class="se">\r\t</span><span class="s1">:: Network loaded from `</span><span class="si">%s</span><span class="s1">`. </span><span class="si">%u</span><span class="s1"> nodes, &#39;</span>\
                        <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> edges.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">90</span><span class="p">,</span> <span class="n">pfile</span><span class="p">,</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">()))</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_vindex</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
                    <span class="k">return</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_reflists</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_resources</span><span class="p">(</span><span class="n">lst</span> <span class="o">=</span> <span class="n">lst</span><span class="p">,</span> <span class="n">exclude</span> <span class="o">=</span> <span class="n">exclude</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Saving igraph object to file `</span><span class="si">%s</span><span class="s1">`...&#39;</span> <span class="o">%</span> <span class="n">pfile</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_network</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="si">%s</span><span class="se">\r\t</span><span class="s1">:: Network saved successfully to file `</span><span class="si">%s</span><span class="s1">`.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">90</span><span class="p">,</span> <span class="n">pfile</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></div>
    
    <span class="k">def</span> <span class="nf">save_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pfile</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">pfile</span> <span class="o">=</span> <span class="n">pfile</span> <span class="k">if</span> <span class="n">pfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> \
            <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;default_network.pickle&#39;</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">pfile</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>
    <span class="c1">###</span>
    <span class="c1">### functions to read networks from text files or mysql</span>
    <span class="c1">###</span>
    
    <span class="k">def</span> <span class="nf">get_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrList</span><span class="p">):</span>
        <span class="n">maxC</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attrList</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">maxC</span><span class="p">:</span>
                <span class="n">maxC</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">maxC</span>
    
    <span class="k">def</span> <span class="nf">get_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">line</span><span class="p">,</span><span class="n">spec</span><span class="p">,</span><span class="n">lnum</span><span class="p">):</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
            <span class="c1"># extraEdgeAttrs and extraNodeAttrs are dicts </span>
            <span class="c1"># of additional parameters assigned to edges and nodes respectively;</span>
            <span class="c1"># key is the name of the parameter, value is the col number, </span>
            <span class="c1"># or a tuple of col number and the separator, </span>
            <span class="c1"># if the column contains additional subfields e.g. (5, &quot;;&quot;)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                    <span class="n">fieldVal</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fieldVal</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">]]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s2">&quot;&quot;&quot;Wrong column index (</span><span class="si">%s</span><span class="s2">) in extra attributes? </span>
<span class="s2">                    Line #</span><span class="si">%u</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> <span class="n">lnum</span><span class="p">)),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">readError</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>
            <span class="n">fieldName</span> <span class="o">=</span> <span class="n">col</span>
            <span class="n">attrs</span><span class="p">[</span><span class="n">fieldName</span><span class="p">]</span> <span class="o">=</span> <span class="n">fieldVal</span>
        <span class="k">return</span> <span class="n">attrs</span>
    
    <span class="k">def</span> <span class="nf">get_taxon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tax_dict</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;A&#39;</span> <span class="ow">in</span> <span class="n">tax_dict</span> <span class="ow">and</span> <span class="s1">&#39;B&#39;</span> <span class="ow">in</span> <span class="n">tax_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_taxon</span><span class="p">(</span><span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">),</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_taxon</span><span class="p">(</span><span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fields</span><span class="p">[</span><span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]]</span> <span class="ow">in</span> <span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;dict&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;dict&#39;</span><span class="p">][</span><span class="n">fields</span><span class="p">[</span><span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
    
<div class="viewcode-block" id="PyPath.get_giant"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.get_giant">[docs]</a>    <span class="k">def</span> <span class="nf">get_giant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the giant component of the graph, or </span>
<span class="sd">        replaces the igraph object with only the giant </span>
<span class="sd">        component.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">gg</span> <span class="o">=</span> <span class="n">g</span> <span class="k">if</span> <span class="n">replace</span> <span class="k">else</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">cl</span> <span class="o">=</span> <span class="n">gg</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;WEAK&#39;</span><span class="p">)</span>
        <span class="n">cl_sizes</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">sizes</span><span class="p">()</span>
        <span class="n">giant_component_index</span> <span class="o">=</span> <span class="n">cl_sizes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cl_sizes</span><span class="p">))</span>
        <span class="n">in_giant</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">==</span> <span class="n">giant_component_index</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cl</span><span class="o">.</span><span class="n">membership</span><span class="p">]</span>
        <span class="n">console</span><span class="p">(</span><span class="s1">&#39;:: Nodes in giant component: </span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">in_giant</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gg</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">in_giant</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">gg</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span>
        <span class="n">console</span><span class="p">(</span><span class="s1">&#39;:: Giant component size: </span><span class="si">%u</span><span class="s1"> edges, </span><span class="si">%u</span><span class="s1"> nodes&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="n">gg</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> <span class="n">gg</span><span class="o">.</span><span class="n">vcount</span><span class="p">()))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">replace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gg</span></div>
    
<div class="viewcode-block" id="PyPath.update_vname"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.update_vname">[docs]</a>    <span class="k">def</span> <span class="nf">update_vname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        For fast lookup of node names and indexes, these are </span>
<span class="sd">        hold in a list and a dict as well. However, every time</span>
<span class="sd">        new nodes are added, these should be updated. This </span>
<span class="sd">        function is automatically called after all operations</span>
<span class="sd">        affecting node indices.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_undirected</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_already_has_directed</span><span class="p">()</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span>
        <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labDct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()),</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()),</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">dgraph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dnodInd</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()),</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dgraph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()),</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]))</span></div>
    
<div class="viewcode-block" id="PyPath.update_vindex"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.update_vindex">[docs]</a>    <span class="k">def</span> <span class="nf">update_vindex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This is deprecated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()),</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span></div>
    
<div class="viewcode-block" id="PyPath.vertex_pathways"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.vertex_pathways">[docs]</a>    <span class="k">def</span> <span class="nf">vertex_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Some resources assignes interactions some others </span>
<span class="sd">        proteins to pathways.</span>
<span class="sd">        This function converts pathway annotations from </span>
<span class="sd">        edge attributes to vertex attributes.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">eattr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">eattr</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;pathways&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">eattr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span></div>
    
    <span class="k">def</span> <span class="nf">filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">positiveFilters</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">negativeFilters</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="k">for</span> <span class="n">filtr</span> <span class="ow">in</span> <span class="n">negativeFilters</span><span class="p">:</span>
            <span class="c1"># print &#39;Negative filter:&#39;</span>
            <span class="n">sep</span> <span class="o">=</span> <span class="n">filtr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="bp">None</span>
            <span class="n">thisVal</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">filtr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">))</span>
            <span class="n">filtrVal</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">filtr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filtr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">filtr</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="c1"># print &#39;\tthisVal: &#39;, thisVal</span>
            <span class="c1"># print &#39;\tfiltrVal: &#39;, filtrVal</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thisVal</span> <span class="o">&amp;</span> <span class="n">filtrVal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># print &#39;\tNegative filter matched, filter = True (skip this record)&#39;</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">filtr</span> <span class="ow">in</span> <span class="n">positiveFilters</span><span class="p">:</span>
            <span class="c1"># print &#39;Positive filter:&#39;</span>
            <span class="n">sep</span> <span class="o">=</span> <span class="n">filtr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="bp">None</span>
            <span class="n">thisVal</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">filtr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">))</span>
            <span class="n">filtrVal</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">filtr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filtr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">filtr</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="c1"># print &#39;\tthisVal: &#39;, thisVal</span>
            <span class="c1"># print &#39;\tfiltrVal: &#39;, filtrVal</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thisVal</span> <span class="o">&amp;</span> <span class="n">filtrVal</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># print &#39;\tPositive filter matched, filter = True (skip this record)&#39;</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="c1"># print &#39;\tNo filter matched, filter = False (process this record)&#39;</span>
        <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">lookup_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">cache_files</span><span class="p">,</span> <span class="n">int_cache</span><span class="p">,</span> <span class="n">edges_cache</span><span class="p">):</span>
        <span class="n">infile</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">edgeListMapped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cache_file</span> <span class="o">=</span> <span class="n">cache_files</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cache_files</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">cache_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_file</span><span class="p">):</span>
            <span class="n">cache_type</span> <span class="o">=</span> <span class="n">cache_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cache_type</span> <span class="o">==</span> <span class="s1">&#39;interactions&#39;</span><span class="p">:</span>
                <span class="n">infile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_from_cache</span><span class="p">(</span><span class="n">int_cache</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cache_type</span> <span class="o">==</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span>
                <span class="n">edgeListMapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_from_cache</span><span class="p">(</span><span class="n">edges_cache</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">edges_cache</span><span class="p">):</span>
            <span class="n">edgeListMapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_from_cache</span><span class="p">(</span><span class="n">edges_cache</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">int_cache</span><span class="p">):</span>
                <span class="n">infile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_from_cache</span><span class="p">(</span><span class="n">int_cache</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">infile</span><span class="p">,</span> <span class="n">edgeListMapped</span>
    
    <span class="k">def</span> <span class="nf">read_from_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_file</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Reading from cache: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">cache_file</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Data have been read from cache: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">cache_file</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">cache_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">process_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signData</span><span class="p">,</span> <span class="n">signDef</span><span class="p">):</span>
        <span class="n">stim</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">inh</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">signSep</span> <span class="o">=</span> <span class="n">signDef</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">signDef</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="n">signData</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">signData</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">signSep</span><span class="p">))</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">signDef</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">signDef</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">signDef</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">neg</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">signDef</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">signDef</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">signDef</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">signData</span> <span class="o">&amp;</span> <span class="n">pos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stim</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">signData</span> <span class="o">&amp;</span> <span class="n">neg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inh</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="n">stim</span><span class="p">,</span> <span class="n">inh</span>
    
    <span class="k">def</span> <span class="nf">process_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">dirCol</span><span class="p">,</span> <span class="n">dirVal</span><span class="p">,</span> <span class="n">dirSep</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dirCol</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">dirVal</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thisDir</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">dirCol</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">dirSep</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">thisDir</span> <span class="o">&amp;</span> <span class="n">dirVal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    
<div class="viewcode-block" id="PyPath.read_data_file"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.read_data_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">keep_raw</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">cache_files</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">cache</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Interaction data with node and edge attributes can be read </span>
<span class="sd">        from simple text based files. This function works not only</span>
<span class="sd">        with files, but with lists as well. Any other function can </span>
<span class="sd">        be written to download a preprocess data, and then give it</span>
<span class="sd">        to this function to finally attach to the network.</span>
<span class="sd">        </span>
<span class="sd">        @settings : ReadSettings instance</span>
<span class="sd">            The detailed definition of the input format. Instead of </span>
<span class="sd">            the file name you can give a function name, which will </span>
<span class="sd">            be executed, and the returned data will be used.</span>
<span class="sd">        @keep_raw : boolean</span>
<span class="sd">            To keep the raw data read by this function, in order for</span>
<span class="sd">            debugging purposes, or further use.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">listLike</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">])</span>
        <span class="n">edgeList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nodeList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">edgeListMapped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">infile</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">_name</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">int_cache</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.interactions.pickle&#39;</span> <span class="o">%</span> <span class="n">_name</span><span class="p">)</span>
        <span class="n">edges_cache</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.edges.pickle&#39;</span> <span class="o">%</span> <span class="n">_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cache</span><span class="p">:</span>
            <span class="n">infile</span><span class="p">,</span> <span class="n">edgeListMapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup_cache</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> 
                <span class="n">cache_files</span><span class="p">,</span> <span class="n">int_cache</span><span class="p">,</span> <span class="n">edges_cache</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgeListMapped</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">infile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">huge</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Processing </span><span class="si">%s</span><span class="s1"> requires huge memory.</span><span class="se">\n</span><span class="s1">&#39;</span>\
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Please hit `y` if you have at least 2G free memory,</span><span class="se">\n</span><span class="s1">&#39;</span>\
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">or `n` to omit </span><span class="si">%s</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span>\
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">After processing once, it will be saved in </span><span class="se">\n</span><span class="s1">&#39;</span>\
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1">, so next time can be loaded quickly.</span><span class="se">\n\n</span><span class="s1">&#39;</span>\
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Process </span><span class="si">%s</span><span class="s1"> now? [y/n]</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
                        <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">edges_cache</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                        <span class="n">answer</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
                            <span class="k">return</span> <span class="bp">None</span>
                        <span class="k">elif</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Please answer `y` or `n`:</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">inputFunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inputFunc</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">):</span>
                    <span class="n">inputFunc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s2">&quot;ReadSettings&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s2">&quot;&quot;&quot;No proper input file definition!</span><span class="se">\n\&#39;</span><span class="s2">settings</span><span class="se">\&#39;</span><span class="s2"></span>
<span class="s2">                        should be a </span><span class="se">\&#39;</span><span class="s2">ReadSettings</span><span class="se">\&#39;</span><span class="s2"> instance</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">None</span>
                <span class="c1"># reading from remote or local file, or executing import function:</span>
                <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ftp&#39;</span><span class="p">):</span>
                    <span class="n">infile</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">curl</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">,</span> <span class="n">silent</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                    <span class="n">infile</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">infile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Retrieving data from</span><span class="si">%s</span><span class="s2"> ...&quot;</span> <span class="o">%</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span>
                <span class="c1"># elif hasattr(dataio, settings.inFile):</span>
                <span class="k">elif</span> <span class="n">inputFunc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">infile</span> <span class="o">=</span> <span class="n">inputFunc</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="o">.</span><span class="n">inputArgs</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Retrieving data by dataio.</span><span class="si">%s</span><span class="s2">() ...&quot;</span> <span class="o">%</span> \
                        <span class="n">inputFunc</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">):</span>
                    <span class="n">infile</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> opened...&quot;</span> <span class="o">%</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: No such file or dataio function! :(</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> \
                    <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">None</span>
            <span class="c1"># finding the largest referred column number, </span>
            <span class="c1"># to avoid references out of range</span>
            <span class="n">isDir</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">isDirected</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">sign</span>
            <span class="n">refCol</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">refs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">refs</span> \
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">refs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">None</span>
            <span class="n">refSep</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">refs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="s1">&#39;;&#39;</span>
            <span class="n">sigCol</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dirCol</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">dirVal</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">dirSep</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">isDir</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                <span class="n">dirCol</span> <span class="o">=</span> <span class="n">isDir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">dirVal</span> <span class="o">=</span> <span class="n">isDir</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">dirSep</span> <span class="o">=</span> <span class="n">isDir</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">isDir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="bp">None</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                <span class="n">dirCol</span> <span class="o">=</span> <span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">dirVal</span> <span class="o">=</span> <span class="n">sign</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">dirVal</span> <span class="o">=</span> <span class="n">dirVal</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dirVal</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="n">simpleTypes</span> <span class="k">else</span> <span class="n">flatList</span><span class="p">(</span><span class="n">dirVal</span><span class="p">)</span>
                <span class="n">dirSep</span> <span class="o">=</span> <span class="n">sign</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="bp">None</span>
            <span class="n">dirVal</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dirVal</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dirVal</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">dirVal</span><span class="p">])</span>
            <span class="n">maxCol</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="p">[</span> 
                    <span class="n">settings</span><span class="o">.</span><span class="n">nameColA</span><span class="p">,</span> 
                    <span class="n">settings</span><span class="o">.</span><span class="n">nameColB</span><span class="p">,</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_max</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">extraEdgeAttrs</span><span class="p">),</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_max</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">extraNodeAttrsA</span><span class="p">),</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_max</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">extraNodeAttrsB</span><span class="p">),</span>
                    <span class="n">refCol</span><span class="p">,</span><span class="n">dirCol</span><span class="p">,</span><span class="n">sigCol</span>
                <span class="p">])</span>
            <span class="c1"># iterating lines from input file</span>
            <span class="n">lnum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">lFiltered</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">rFiltered</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">tFiltered</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">readError</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
                <span class="n">lnum</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lnum</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">header</span><span class="p">):</span>
                    <span class="c1"># empty lines</span>
                    <span class="c1"># or header row</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">listLike</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span>\
                    <span class="n">split</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">separator</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> \
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="n">charTypes</span> <span class="k">else</span> <span class="n">x</span> 
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>
                <span class="c1"># in case line has less fields than needed</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxCol</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span>
                        <span class="s2">&quot;Line #</span><span class="si">%u</span><span class="s2"> has less than </span><span class="si">%u</span><span class="s2"> fields! :(</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">maxCol</span><span class="p">)),</span>
                        <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="n">readError</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># applying filters:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">positiveFilters</span><span class="p">,</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">negativeFilters</span><span class="p">):</span>
                        <span class="n">lFiltered</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>
                    <span class="c1"># reading names and attributes:</span>
                    <span class="k">if</span> <span class="n">isDir</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">isDir</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span><span class="p">:</span>
                        <span class="n">thisEdgeDir</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">thisEdgeDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_direction</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">dirCol</span><span class="p">,</span> 
                            <span class="n">dirVal</span><span class="p">,</span> <span class="n">dirSep</span><span class="p">)</span>
                    <span class="n">refs</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">refCol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">refs</span> <span class="o">=</span> <span class="n">delEmpty</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">refCol</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">refSep</span><span class="p">))))</span>
                    <span class="n">refs</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">only_pmids</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">must_have_references</span><span class="p">:</span>
                        <span class="n">rFiltered</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>
                    <span class="c1"># to give an easy way:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                        <span class="n">taxA</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span>
                        <span class="n">taxB</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span>
                    <span class="c1"># to enable more sophisticated inputs:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                        <span class="n">taxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_taxon</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">taxx</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                            <span class="n">taxA</span> <span class="o">=</span> <span class="n">taxx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">taxB</span> <span class="o">=</span> <span class="n">taxx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">taxA</span> <span class="o">=</span> <span class="n">taxB</span> <span class="o">=</span> <span class="n">taxx</span>
                    <span class="k">if</span> <span class="n">taxA</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">taxB</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">tFiltered</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>
                    <span class="n">stim</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">inh</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                        <span class="n">stim</span><span class="p">,</span> <span class="n">inh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_sign</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">sign</span><span class="p">)</span>
                    <span class="n">newEdge</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;nameA&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">nameColA</span><span class="p">],</span> 
                        <span class="s2">&quot;nameB&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">nameColB</span><span class="p">],</span> 
                        <span class="s2">&quot;nameTypeA&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameTypeA</span><span class="p">,</span> 
                        <span class="s2">&quot;nameTypeB&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameTypeB</span><span class="p">,</span> 
                        <span class="s2">&quot;typeA&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">typeA</span><span class="p">,</span> 
                        <span class="s2">&quot;typeB&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">typeB</span><span class="p">,</span> 
                        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
                        <span class="s2">&quot;isDirected&quot;</span><span class="p">:</span> <span class="n">thisEdgeDir</span><span class="p">,</span>
                        <span class="s2">&quot;references&quot;</span><span class="p">:</span> <span class="n">refs</span><span class="p">,</span>
                        <span class="s2">&quot;stim&quot;</span><span class="p">:</span> <span class="n">stim</span><span class="p">,</span>
                        <span class="s2">&quot;inh&quot;</span><span class="p">:</span> <span class="n">inh</span><span class="p">,</span>
                        <span class="s2">&quot;taxA&quot;</span><span class="p">:</span> <span class="n">taxA</span><span class="p">,</span>
                        <span class="s2">&quot;taxB&quot;</span><span class="p">:</span> <span class="n">taxB</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">intType</span><span class="p">}</span>
                    <span class="c1">#except:</span>
                        <span class="c1">#self.ownlog.msg(2,(&quot;&quot;&quot;Wrong name column indexes (%u and %u), </span>
                            <span class="c1">#or wrong separator (%s)? Line #%u\n&quot;&quot;&quot; </span>
                            <span class="c1">#% (</span>
                                <span class="c1">#settings.nameColA, settings.nameColB, </span>
                                <span class="c1">#settings.separator, lnum)), &#39;ERROR&#39;)</span>
                        <span class="c1">#readError = 1</span>
                        <span class="c1">#break</span>
                    <span class="c1"># getting additional edge and node attributes</span>
                    <span class="n">attrsEdge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">extraEdgeAttrs</span><span class="p">,</span> <span class="n">lnum</span><span class="p">)</span>
                    <span class="n">attrsNodeA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">extraNodeAttrsA</span><span class="p">,</span> <span class="n">lnum</span><span class="p">)</span>
                    <span class="n">attrsNodeB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">extraNodeAttrsB</span><span class="p">,</span> <span class="n">lnum</span><span class="p">)</span>
                    <span class="c1"># merging dictionaries</span>
                    <span class="n">nodeAttrs</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;attrsNodeA&quot;</span><span class="p">:</span> <span class="n">attrsNodeA</span><span class="p">,</span> 
                        <span class="s2">&quot;attrsNodeB&quot;</span><span class="p">:</span> <span class="n">attrsNodeB</span><span class="p">,</span> 
                        <span class="s2">&quot;attrsEdge&quot;</span><span class="p">:</span> <span class="n">attrsEdge</span><span class="p">}</span>
                    <span class="n">newEdge</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="n">newEdge</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(),</span> <span class="n">nodeAttrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="p">))</span>
                <span class="k">if</span> <span class="n">readError</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">edgeList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newEdge</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">file</span><span class="p">:</span>
                <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c1">### !!!! ##</span>
            <span class="n">edgeListMapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_list</span><span class="p">(</span><span class="n">edgeList</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%u</span><span class="s2"> lines have been read from </span><span class="si">%s</span><span class="s2">,&quot;</span>\
            <span class="s2">&quot;</span><span class="si">%u</span><span class="s2"> links after mapping; </span><span class="se">\n\t\t</span><span class="s2">&quot;</span>\
            <span class="s2">&quot;</span><span class="si">%u</span><span class="s2"> lines filtered by filters;</span><span class="se">\n\t\t</span><span class="s2">&quot;</span>\
            <span class="s2">&quot;</span><span class="si">%u</span><span class="s2"> lines filtered because lack of references;</span><span class="se">\n\t\t</span><span class="s2">&quot;</span>\
            <span class="s2">&quot;</span><span class="si">%u</span><span class="s2"> lines filtered by taxon filters.&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="n">lnum</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgeListMapped</span><span class="p">),</span> 
                <span class="n">lFiltered</span><span class="p">,</span> <span class="n">rFiltered</span><span class="p">,</span> <span class="n">tFiltered</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">cache</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">edgeListMapped</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">edges_cache</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Mapped edge list saved to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">edges_cache</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">keep_raw</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">edgeListMapped</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">edgeListMapped</span></div>
    
    <span class="k">def</span> <span class="nf">read_list_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s2">&quot;ReadList&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s2">&quot;&quot;&quot;No proper input file definition!</span><span class="se">\n\&#39;</span><span class="s2">settings</span><span class="se">\&#39;</span><span class="s2"></span>
<span class="s2">                should be a </span><span class="se">\&#39;</span><span class="s2">readList</span><span class="se">\&#39;</span><span class="s2"> instance</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">):</span>
            <span class="n">_input</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span>
            <span class="n">infile</span> <span class="o">=</span> <span class="n">_input</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: No such file! :(</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">originalNameType</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameType</span>
        <span class="n">defaultNameType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">typ</span><span class="p">]</span>
        <span class="n">mapTbl</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">originalNameType</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="n">defaultNameType</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_input</span><span class="p">)</span> <span class="ow">in</span> <span class="n">charTypes</span><span class="p">:</span>
            <span class="n">infile</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> opened...&quot;</span> <span class="o">%</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span>
        <span class="c1"># finding the largest referred column number, </span>
        <span class="c1"># to avoid references out of index</span>
        <span class="n">maxCol</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="p">[</span>   <span class="n">settings</span><span class="o">.</span><span class="n">nameCol</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">get_max</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">extraAttrs</span><span class="p">)</span> <span class="p">])</span>
        <span class="c1"># iterating lines from input file</span>
        <span class="n">lnum</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">readError</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">itemList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lnum</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">header</span><span class="p">):</span>
                <span class="c1"># empty lines</span>
                <span class="c1"># or header row</span>
                <span class="n">lnum</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">in</span> <span class="n">charTypes</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">separator</span><span class="p">)</span>
            <span class="c1"># in case line has less fields than needed</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxCol</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span>
                    <span class="s2">&quot;Line #</span><span class="si">%u</span><span class="s2"> has less than </span><span class="si">%u</span><span class="s2"> fields! :(</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> \
                        <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">maxCol</span><span class="p">)),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">readError</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># reading names and attributes</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">newItem</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">nameCol</span><span class="p">],</span> 
                        <span class="s2">&quot;nameType&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameType</span><span class="p">,</span> 
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">typ</span><span class="p">,</span> 
                        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">}</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s2">&quot;&quot;&quot;Wrong name column indexes (</span><span class="si">%u</span><span class="s2"> and </span><span class="si">%u</span><span class="s2">), </span>
<span class="s2">                        or wrong separator (</span><span class="si">%s</span><span class="s2">)? Line #</span><span class="si">%u</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> 
                        <span class="o">%</span> <span class="p">(</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameCol</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">separator</span><span class="p">,</span> <span class="n">lnum</span><span class="p">)),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="n">readError</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">break</span>
                <span class="c1"># getting additional attributes</span>
                <span class="n">attrsItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">extraAttrs</span><span class="p">,</span> <span class="n">lnum</span><span class="p">)</span>
                <span class="c1"># merging dictionaries</span>
                <span class="n">newItem</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="n">newItem</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(),</span> <span class="n">attrsItem</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="p">))</span>
            <span class="k">if</span> <span class="n">readError</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">itemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newItem</span><span class="p">)</span>
            <span class="n">lnum</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">itemListMapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_list</span><span class="p">(</span><span class="n">itemList</span><span class="p">,</span><span class="n">singleList</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">itemListMapped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itemListMapped</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%u</span><span class="s2"> lines have been read from </span><span class="si">%s</span><span class="s2">, </span><span class="si">%u</span><span class="s2"> &#39;</span><span class="se">\</span>
<span class="s2">            items after mapping&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">itemListMapped</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">itemListMapped</span>
    
<div class="viewcode-block" id="PyPath.map_list"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.map_list">[docs]</a>    <span class="k">def</span> <span class="nf">map_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lst</span><span class="p">,</span><span class="n">singleList</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Only a wrapper for map_edge()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">listMapped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">singleList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
                <span class="n">listMapped</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_item</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
                <span class="n">listMapped</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">listMapped</span></div>
    
    <span class="k">def</span> <span class="nf">map_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
        <span class="n">defaultNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;nameType&#39;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaultNames</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unmapped</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">defaultNames</span>
    
    <span class="k">def</span> <span class="nf">map_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">):</span>
        <span class="n">edgeStack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">defaultNameA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;nameA&#39;</span><span class="p">],</span> 
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;nameTypeA&#39;</span><span class="p">],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;typeA&#39;</span><span class="p">]])</span>
        <span class="c1"># print &#39;mapped %s to %s&#39; % (str(edge[&#39;nameA&#39;]), str(defaultNameA))</span>
        <span class="n">defaultNameB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;nameB&#39;</span><span class="p">],</span> 
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;nameTypeB&#39;</span><span class="p">],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;typeB&#39;</span><span class="p">]])</span>
        <span class="c1"># print &#39;mapped %s to %s&#39; % (str(edge[&#39;nameB&#39;]), str(defaultNameB))</span>
        <span class="c1"># this is needed because the possibility ambigous mapping</span>
        <span class="c1"># one name can be mapped to multiple ones</span>
        <span class="c1"># this multiplies the nodes and edges</span>
        <span class="c1"># in case of proteins this does not happen too often</span>
        <span class="k">for</span> <span class="n">dnA</span> <span class="ow">in</span> <span class="n">defaultNameA</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dnB</span> <span class="ow">in</span> <span class="n">defaultNameB</span><span class="p">:</span>
                <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;defaultNameA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dnA</span>
                <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;defaultNameTypeA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;typeA&#39;</span><span class="p">]]</span>
                <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;defaultNameB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dnB</span>
                <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;defaultNameTypeB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;typeB&#39;</span><span class="p">]]</span>
                <span class="n">edgeStack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
                <span class="c1"># print &#39;new edge: %s&#39; % str(edge)</span>
        <span class="k">return</span> <span class="n">edgeStack</span>
    
    <span class="k">def</span> <span class="nf">merge_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">exc</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;signs&#39;</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_signs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;directions&#39;</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_dirs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;dirs_by_source&#39;</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_dirsrc</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">([</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">val</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">combine_signs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigA</span><span class="p">,</span><span class="n">sigB</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">inn</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">sigA</span><span class="p">[</span><span class="n">out</span><span class="p">][</span><span class="n">inn</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="n">sigA</span><span class="p">[</span><span class="n">out</span><span class="p">][</span><span class="n">inn</span><span class="p">]</span><span class="o">+</span><span class="n">sigB</span><span class="p">[</span><span class="n">out</span><span class="p">][</span><span class="n">inn</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">sigA</span>
    
    <span class="k">def</span> <span class="nf">combine_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dirA</span><span class="p">,</span><span class="n">dirB</span><span class="p">):</span>
        <span class="n">newDir</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">newDir</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dirA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="n">dirB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">newDir</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">combine_dirsrc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dirsA</span><span class="p">,</span><span class="n">dirsB</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">dirsA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="n">dirsA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">dirsB</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">dirsA</span>
    
    <span class="k">def</span> <span class="nf">combine_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lst</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> 
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">))):</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">unicode</span><span class="p">)</span> 
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">unicode</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="n">simpleTypes</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">addToList</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="n">simpleTypes</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">addToList</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;Direction&#39;</span> <span class="ow">and</span> \
            <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;Direction&#39;</span><span class="p">:</span>
            <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">uniq_node_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lst</span><span class="p">):</span>
        <span class="n">uniqLst</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uniqLst</span><span class="p">:</span>
                <span class="n">uniqLst</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">uniqLst</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_attrs</span><span class="p">(</span><span class="n">uniqLst</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">uniqLst</span>
    
<div class="viewcode-block" id="PyPath.map_network"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.map_network">[docs]</a>    <span class="k">def</span> <span class="nf">map_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;trembl&#39;</span><span class="p">,</span> <span class="s1">&#39;swissprot&#39;</span><span class="p">)):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function is not needed any more, will be removed soon.</span>
<span class="sd">        </span>
<span class="sd">        In the whole network changes every uniprot id to primary.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;Mapping network by </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">mapping</span><span class="p">,</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s2">&quot;Num of edges: </span><span class="si">%u</span><span class="s2">, num of vertices: </span><span class="si">%u</span><span class="s2">&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())),</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="n">fun</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mapping</span><span class="p">)</span>
        <span class="n">primNodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">secNodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">delNodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Mapping nodes&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;protein&quot;</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;nameType&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;uniprot&quot;</span><span class="p">:</span>
                <span class="n">prim</span> <span class="o">=</span> <span class="n">fun</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prim</span><span class="p">:</span>
                    <span class="n">delNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">prim</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">u</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">primNodes</span><span class="p">:</span>
                            <span class="n">primNodes</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">primNodes</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">secNodes</span><span class="p">:</span>
                            <span class="n">secNodes</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">secNodes</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">newNodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">primNodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_nodes</span><span class="p">(</span><span class="n">newNodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;New nodes have been created (</span><span class="si">%u</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">newNodes</span><span class="p">),</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="n">primEdges</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">newEdges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Processing edges&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">uA</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">uB</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">uA</span> <span class="ow">in</span> <span class="n">secNodes</span> <span class="ow">or</span> <span class="n">uB</span> <span class="ow">in</span> <span class="n">secNodes</span><span class="p">:</span>
                <span class="n">uAlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">uA</span><span class="p">]</span> <span class="k">if</span> <span class="n">uA</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">secNodes</span> <span class="k">else</span> <span class="n">secNodes</span><span class="p">[</span><span class="n">uA</span><span class="p">]</span>
                <span class="n">uBlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">uB</span><span class="p">]</span> <span class="k">if</span> <span class="n">uB</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">secNodes</span> <span class="k">else</span> <span class="n">secNodes</span><span class="p">[</span><span class="n">uB</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">uAlist</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">uBlist</span><span class="p">:</span>
                        <span class="n">ab</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>
                        <span class="n">ab</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">primEdges</span><span class="p">:</span>
                            <span class="n">primEdges</span><span class="p">[</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">if</span> <span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">primEdges</span><span class="p">[</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                            <span class="n">primEdges</span><span class="p">[</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">primEdges</span><span class="p">[</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">uA</span><span class="p">,</span><span class="n">uB</span><span class="p">))</span>
                        <span class="n">abEdge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">abEdge</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                            <span class="n">newEdges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">abEdge</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">newEdges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">newEdges</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_edges</span><span class="p">(</span><span class="n">newEdges</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;New edges have been created (</span><span class="si">%u</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">newEdges</span><span class="p">),</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="c1"># copying node attributes</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">primNodes</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Processing node attributes&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">primNodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">prim</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">sec</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">merge_attrs</span><span class="p">(</span><span class="n">prim</span><span class="p">,</span><span class="n">sec</span><span class="p">,</span><span class="n">exc</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="c1"># copying edge attributes</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">primEdges</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Processing edge attributes&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">bdict</span> <span class="ow">in</span> <span class="n">primEdges</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">primA</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
            <span class="k">for</span> <span class="n">b</span><span class="p">,</span><span class="n">originals</span> <span class="ow">in</span> <span class="n">bdict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">primB</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
                <span class="n">prim</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">_between</span><span class="o">=</span><span class="p">((</span><span class="n">primA</span><span class="p">,),(</span><span class="n">primB</span><span class="p">,)))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">originals</span><span class="p">:</span>
                    <span class="n">secA</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">index</span>
                    <span class="n">secB</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">index</span>
                    <span class="n">sec</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">_between</span><span class="o">=</span><span class="p">((</span><span class="n">secA</span><span class="p">,),(</span><span class="n">secB</span><span class="p">,)))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">merge_attrs</span><span class="p">(</span><span class="n">prim</span><span class="p">,</span><span class="n">sec</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="c1"># deleting old nodes</span>
        <span class="n">delNodeInd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">delNodes</span><span class="p">:</span>
            <span class="n">delNodeInd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;Removing old nodes (</span><span class="si">%u</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">delNodeInd</span><span class="p">),</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">delNodeInd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">delNodeInd</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean_graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;Network has been mapped.&quot;</span><span class="p">,</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s2">&quot;Num of edges: </span><span class="si">%u</span><span class="s2">, num of vertices: </span><span class="si">%u</span><span class="s2">&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())),</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="PyPath.delete_by_taxon"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.delete_by_taxon">[docs]</a>    <span class="k">def</span> <span class="nf">delete_by_taxon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tax</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Removes the proteins of all organisms which are not listed.</span>
<span class="sd">        </span>
<span class="sd">        @tax : list</span>
<span class="sd">            List of NCBI Taxonomy IDs of the organisms of interest.</span>
<span class="sd">            E.g. [7227, 9606]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;ncbi_tax_id&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tax</span><span class="p">:</span>
                <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_db_dict</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="PyPath.delete_unknown"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.delete_unknown">[docs]</a>    <span class="k">def</span> <span class="nf">delete_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tax</span><span class="p">,</span> <span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;protein&#39;</span><span class="p">,</span> <span class="n">defaultNameType</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Removes those proteins which are not in the list of all default</span>
<span class="sd">        IDs of the organisms. By default, it means to remove all protein </span>
<span class="sd">        nodes not having a human SwissProt ID. </span>
<span class="sd">        </span>
<span class="sd">        @tax : list</span>
<span class="sd">            List of NCBI Taxonomy IDs of the organisms of interest.</span>
<span class="sd">            E.g. [7227, 9606]</span>
<span class="sd">        @typ : str</span>
<span class="sd">            Molecule type. E.g. &#39;protein&#39; or &#39;mirna&#39;</span>
<span class="sd">        @defaultNameType : str</span>
<span class="sd">            The default name type of the given molecular species.</span>
<span class="sd">            For proteins it&#39;s &#39;uniprot&#39; by default.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">defaultNameType</span><span class="p">:</span>
            <span class="n">defaultNameType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">reflists</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tax</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">defaultNameType</span><span class="p">,</span><span class="n">typ</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">:</span>
                <span class="n">reflists</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">lst</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Missing reference list for </span><span class="si">%s</span><span class="s1"> (default name type: </span><span class="si">%s</span><span class="s1">), in taxon </span><span class="si">%u</span><span class="s1">&#39;</span>
                    <span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">t</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; :: Comparing with reference lists...&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tax</span><span class="p">:</span>
            <span class="n">nt</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;nameType&#39;</span><span class="p">]</span>
            <span class="n">nt</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">defaultNameType</span><span class="p">]</span>
            <span class="n">ty</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
            <span class="n">ty</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ty</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">typ</span><span class="p">]</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;ncbi_tax_id&#39;</span><span class="p">]</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="nb">set</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">ty</span><span class="p">))</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">tx</span><span class="p">))</span>
            <span class="n">vn</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">]</span>
            <span class="n">toDelNames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vn</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">reflists</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
            <span class="n">toDel</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">toDelNames</span><span class="p">]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">clean_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;Removing duplicate edges...&quot;</span><span class="p">,</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">is_simple</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">loops</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">loops</span><span class="p">,</span> <span class="n">multiple</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">combine_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_unmapped</span><span class="p">()</span>
        <span class="c1">## TODO: multiple taxons ##</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_by_taxon</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_unknown</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="n">zeroDeg</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">zeroDeg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
    
    <span class="c1">###</span>
    <span class="c1">### functions to integrate new data into the main igraph network object</span>
    <span class="c1">###</span>
    
<div class="viewcode-block" id="PyPath.count_sol"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.count_sol">[docs]</a>    <span class="k">def</span> <span class="nf">count_sol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Counts nodes with zero degree.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">s</span></div>
    
<div class="viewcode-block" id="PyPath.add_update_vertex"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.add_update_vertex">[docs]</a>    <span class="k">def</span> <span class="nf">add_update_vertex</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">defAttrs</span><span class="p">,</span> <span class="n">originalName</span><span class="p">,</span> 
            <span class="n">originalNameType</span><span class="p">,</span> <span class="n">extraAttrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">add</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Updates the attributes of one node in the network.</span>
<span class="sd">        Optionally it creates a new node and sets the attributes,</span>
<span class="sd">        but it is not efficient as igraph needs to reindex vertices </span>
<span class="sd">        after this operation, so better to create new nodes and </span>
<span class="sd">        edges in batch.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">defAttrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">add</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Failed to add some vertices&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span>
            <span class="n">g</span><span class="o">.</span><span class="n">add_vertices</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">originalNames</span> <span class="o">=</span> <span class="p">{</span><span class="n">originalName</span><span class="p">:</span> <span class="n">originalNameType</span><span class="p">}</span>
            <span class="n">thisNode</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">defAttrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thisNode</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">defAttrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">thisNode</span><span class="p">[</span><span class="s2">&quot;originalNames&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">thisNode</span><span class="p">[</span><span class="s2">&quot;originalNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">thisNode</span><span class="p">[</span><span class="s2">&quot;originalNames&quot;</span><span class="p">][</span><span class="n">originalName</span><span class="p">]</span> <span class="o">=</span> <span class="n">originalNameType</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defAttrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">thisNode</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">extraAttrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span> \
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">thisNode</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">([</span><span class="n">thisNode</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">value</span><span class="p">])</span></div>
    
    <span class="k">def</span> <span class="nf">add_update_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> 
                        <span class="n">isDir</span><span class="p">,</span> <span class="n">refs</span><span class="p">,</span> <span class="n">stim</span><span class="p">,</span> <span class="n">inh</span><span class="p">,</span> <span class="n">taxA</span><span class="p">,</span> <span class="n">taxB</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span>
                        <span class="n">extraAttrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">add</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nodDct&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span><span class="p">)</span> <span class="o">!=</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">add</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">ERROR: Failed to add some edges</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Failed to add some edges&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">aid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span>
                <span class="n">bid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nameB</span><span class="p">]</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">aid</span><span class="p">,</span><span class="n">bid</span><span class="p">,</span><span class="n">error</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">aid</span><span class="p">,</span><span class="n">bid</span><span class="p">,</span><span class="n">error</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">failed_edges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">edge</span><span class="p">,</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">bid</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">])</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">)</span>
        <span class="c1"># assigning source:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_list_eattr</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;sources&#39;</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="c1"># adding references:</span>
        <span class="c1"># if len(refs) &gt; 0:</span>
        <span class="n">refs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Reference</span><span class="p">(</span><span class="n">pmid</span><span class="p">)</span> <span class="k">for</span> <span class="n">pmid</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_list_eattr</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;references&#39;</span><span class="p">,</span> <span class="n">refs</span><span class="p">)</span>
        <span class="c1"># updating references-by-source dict:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_grouped_eattr</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;refs_by_source&#39;</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">refs</span><span class="p">)</span>
        <span class="c1"># updating refrences-by-type dict:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_grouped_eattr</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;refs_by_type&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">refs</span><span class="p">)</span>
        <span class="c1"># setting directions:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">(</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isDir</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_dir</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">),</span><span class="n">source</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">,</span><span class="n">source</span><span class="p">)</span>
        <span class="c1"># setting signs:</span>
        <span class="k">if</span> <span class="n">stim</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_sign</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">),</span><span class="s1">&#39;positive&#39;</span><span class="p">,</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inh</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_sign</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">),</span><span class="s1">&#39;negative&#39;</span><span class="p">,</span><span class="n">source</span><span class="p">)</span>
        <span class="c1"># updating sources-by-type dict:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_grouped_eattr</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;sources_by_type&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="c1"># adding type:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_list_eattr</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span>
        <span class="c1"># adding extra attributes:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">extraAttrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span> \
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">([</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">add_list_eattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]]</span>
        <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">add_grouped_eattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span>  <span class="n">group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">])</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">]]</span>
        <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">][</span><span class="n">group</span><span class="p">]</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">conv_edges</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">mutual</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">graph</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">as_directed</span><span class="p">(</span><span class="n">mutual</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;directed_sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
        <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
        <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Setting directions&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            This works because in directed graphs get_eid() defaults to </span>
<span class="sd">            directed = True, so the source -&gt; target edge is returned.</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">dir_one</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">])</span>
            <span class="n">dir_two</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">])</span>
            <span class="n">dir_edge_one</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]),</span>
                                 <span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]))</span>
            <span class="n">dir_edge_two</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]),</span>
                                 <span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_one</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">conv_edges</span> <span class="ow">or</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_two</span><span class="p">):</span>
                    <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dir_edge_one</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_one</span><span class="p">][</span><span class="s1">&#39;directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_one</span><span class="p">][</span><span class="s1">&#39;directed_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_one</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_one</span><span class="p">][</span><span class="s1">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_two</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">conv_edges</span> <span class="ow">or</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_one</span><span class="p">):</span>
                    <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dir_edge_two</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_two</span><span class="p">][</span><span class="s1">&#39;directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_two</span><span class="p">][</span><span class="s1">&#39;directed_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_two</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_two</span><span class="p">][</span><span class="s1">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_one</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_two</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">conv_edges</span><span class="p">:</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_one</span><span class="p">][</span><span class="s1">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                        <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mutual</span><span class="p">:</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_two</span><span class="p">][</span><span class="s1">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                            <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dir_edge_two</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">toDel</span> <span class="o">+=</span> <span class="p">[</span><span class="n">dir_edge_one</span><span class="p">,</span> <span class="n">dir_edge_two</span><span class="p">]</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">d</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">toDel</span><span class="p">)))</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">deg</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">toDel</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">graph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span> <span class="o">=</span> <span class="n">d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_undirected</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">graph</span> <span class="ow">or</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">d</span>
    
    <span class="k">def</span> <span class="nf">new_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edges</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">new_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_vertices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
    
<div class="viewcode-block" id="PyPath.edge_exists"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.edge_exists">[docs]</a>    <span class="k">def</span> <span class="nf">edge_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a tuple of vertice indices if edge doesn&#39;t exists, </span>
<span class="sd">        otherwise edge id. Not sensitive to direction.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nodDct&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nameA</span><span class="p">],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nameB</span><span class="p">]]</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edge</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">edge</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">nodes</span></div>
    
    <span class="k">def</span> <span class="nf">edge_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">node_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nodInd&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span>
    
    <span class="k">def</span> <span class="nf">names2vids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="n">vids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nodInd&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span><span class="p">:</span>
                <span class="n">vids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">vids</span>
    
<div class="viewcode-block" id="PyPath.get_edge"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.get_edge">[docs]</a>    <span class="k">def</span> <span class="nf">get_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the edge id only if there is an edge from nodes[0] to nodes[1],</span>
<span class="sd">        returns False if edge exists in opposite direction, or no edge exists </span>
<span class="sd">        between the two vertices, or any of the vertice ids doesn&#39;t exist.</span>
<span class="sd">        To find edges without regarding their direction, see edge_exists().</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">e</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span></div>
    
<div class="viewcode-block" id="PyPath.straight_between"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.straight_between">[docs]</a>    <span class="k">def</span> <span class="nf">straight_between</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This does actually the same as get_edge(), but by names</span>
<span class="sd">        instead of vertex ids.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nodNm</span> <span class="o">=</span> <span class="p">[</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">]</span>
        <span class="n">nodNm</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nodNm</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nodNm</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">edge</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nodes</span></div>
    
<div class="viewcode-block" id="PyPath.all_between"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.all_between">[docs]</a>    <span class="k">def</span> <span class="nf">all_between</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns all edges between two given vertex names. Similar to </span>
<span class="sd">        straight_between(), but checks both directions, and returns </span>
<span class="sd">        list of edge ids in [undirected, straight, reveresed] format,</span>
<span class="sd">        for both nameA -&gt; nameB and nameB -&gt; nameA edges.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ab&#39;</span><span class="p">:</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span> <span class="s1">&#39;ba&#39;</span><span class="p">:</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]}</span>
        <span class="n">eid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">eid</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">):</span>
                <span class="n">edges</span><span class="p">[</span><span class="s1">&#39;ab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
                <span class="n">edges</span><span class="p">[</span><span class="s1">&#39;ba&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">)):</span>
                <span class="n">edges</span><span class="p">[</span><span class="s1">&#39;ab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
                <span class="n">edges</span><span class="p">[</span><span class="s1">&#39;ba&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">nameB</span><span class="p">,</span><span class="n">nameA</span><span class="p">)):</span>
                <span class="n">edges</span><span class="p">[</span><span class="s1">&#39;ab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
                <span class="n">edges</span><span class="p">[</span><span class="s1">&#39;ba&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
        <span class="k">return</span> <span class="n">edges</span></div>
     
    <span class="k">def</span> <span class="nf">get_node_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nodDct&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">]</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nodeA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">nodeB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">nodeA</span><span class="p">,</span> <span class="n">nodeB</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">update_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Vertex attribute `</span><span class="si">%s</span><span class="s1">` has multiple types of&#39;</span>\
                    <span class="s1">&#39; values: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">types</span><span class="p">])),</span>
                    <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Vertex attribute `</span><span class="si">%s</span><span class="s1">` has only None values&#39;</span>\
                <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">),</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">list</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">init_vertex_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;dirs&#39;</span><span class="p">])):</span>
            <span class="n">types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Edge attribute `</span><span class="si">%s</span><span class="s1">` has multiple types of&#39;</span>\
                    <span class="s1">&#39; values: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">types</span><span class="p">])),</span>
                    <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Edge attribute `</span><span class="si">%s</span><span class="s1">` has only None values&#39;</span>\
                <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">),</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">list</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">init_edge_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">init_vertex_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="ow">in</span> <span class="n">simpleTypes</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">init_edge_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="ow">in</span> <span class="n">simpleTypes</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">attach_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edgeList</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">regulator</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">edgeList</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">edgeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;attach_network(): No data, nothing to do.&quot;</span><span class="p">,</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edgeList</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">edgeList</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="n">edgeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">edgeList</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                    <span class="s2">&quot;`</span><span class="si">%s</span><span class="s2">&#39; looks like a source name, but no data&quot;</span>\
                    <span class="s2">&quot;available under this name.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">edgeList</span><span class="p">),</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># adding nodes and edges first in bunch, </span>
        <span class="c1"># to avoid multiple reindexing by igraph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">edgeList</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Processing nodes&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edgeList</span><span class="p">:</span>
            <span class="n">aexists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">])</span>
            <span class="n">bexists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">aexists</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">regulator</span> <span class="ow">or</span> <span class="n">bexists</span><span class="p">):</span>
                <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bexists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">regulator</span><span class="p">:</span>
                <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">])</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_nodes</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;New nodes have been created&#39;</span><span class="p">,</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">edgeList</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Processing edges&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edgeList</span><span class="p">:</span>
            <span class="n">aexists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">])</span>
            <span class="n">bexists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">aexists</span> <span class="ow">and</span> <span class="n">bexists</span><span class="p">:</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">edge</span><span class="p">))</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_edges</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">edges</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;New edges have been created&quot;</span><span class="p">,</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s2">&quot;&quot;&quot;Introducing new node and edge attributes...&quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">edgeList</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Processing attributes&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">nodes_updated</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edgeList</span><span class="p">:</span>
            <span class="c1"># adding new node attributes</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes_updated</span><span class="p">:</span>
                <span class="n">defAttrs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">],</span> 
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">],</span> 
                    <span class="s2">&quot;nameType&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameTypeA&quot;</span><span class="p">],</span> 
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;typeA&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;ncbi_tax_id&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;taxA&quot;</span><span class="p">]}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_update_vertex</span><span class="p">(</span>
                    <span class="n">defAttrs</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;nameA&quot;</span><span class="p">],</span> 
                    <span class="n">e</span><span class="p">[</span><span class="s2">&quot;nameTypeA&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;attrsNodeA&quot;</span><span class="p">])</span>
                <span class="n">nodes_updated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes_updated</span><span class="p">:</span>
                <span class="n">defAttrs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">],</span> 
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">],</span> 
                    <span class="s2">&quot;nameType&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameTypeB&quot;</span><span class="p">],</span> 
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;typeB&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;ncbi_tax_id&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;taxB&quot;</span><span class="p">]}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_update_vertex</span><span class="p">(</span>
                    <span class="n">defAttrs</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;nameB&quot;</span><span class="p">],</span> 
                    <span class="n">e</span><span class="p">[</span><span class="s2">&quot;nameTypeB&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;attrsNodeB&quot;</span><span class="p">])</span>
                <span class="n">nodes_updated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">])</span>
            <span class="c1"># adding new edge attributes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_update_edge</span><span class="p">(</span>
                <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">],</span> 
                <span class="n">e</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;isDirected&quot;</span><span class="p">],</span> 
                <span class="n">e</span><span class="p">[</span><span class="s2">&quot;references&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;stim&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;inh&quot;</span><span class="p">],</span> 
                <span class="n">e</span><span class="p">[</span><span class="s2">&quot;taxA&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;taxB&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;attrsEdge&quot;</span><span class="p">])</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_attrs</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">apply_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">node_or_edge</span><span class="o">=</span><span class="s2">&quot;node&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="s2">&quot;&quot;&quot;No such list: </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="n">node_or_edge</span> <span class="o">==</span> <span class="s2">&quot;edge&quot;</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node_or_edge</span> <span class="o">==</span> <span class="s2">&quot;edge&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">e</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">e</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node_or_edge</span> <span class="o">==</span> <span class="s2">&quot;edge&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">e</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">e</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">merge_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">and_or</span><span class="o">=</span><span class="s2">&quot;and&quot;</span><span class="p">,</span><span class="n">delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">func</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nameA</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="s2">&quot;&quot;&quot;No such list: </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">nameA</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">nameB</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="s2">&quot;&quot;&quot;No such list: </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">nameB</span><span class="p">),</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">])</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">name</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">and_or</span> <span class="o">==</span> <span class="s2">&quot;and&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">])</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">and_or</span> <span class="o">==</span> <span class="s2">&quot;or&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">and_or</span> <span class="o">==</span> <span class="s2">&quot;and&quot;</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">][</span><span class="n">k</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">and_or</span> <span class="o">==</span> <span class="s2">&quot;or&quot;</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">][</span><span class="n">k</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">save_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pickleFile</span> <span class="o">=</span> <span class="s2">&quot;pwnet-&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">+</span><span class="s2">&quot;.pickle&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="s2">&quot;&quot;&quot;Saving session to </span><span class="si">%s</span><span class="s2">... &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">pickleFile</span><span class="p">),</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">pickleFile</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    
    <span class="c1">###</span>
    <span class="c1">### functions for plotting // with custom typeface ;)</span>
    <span class="c1">###</span>
    
    <span class="c1">#</span>
    <span class="c1"># functions to compare networks and pathways</span>
    <span class="c1">#</span>
    
    <span class="k">def</span> <span class="nf">databases_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;simpson&#39;</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">s</span><span class="p">,</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]])</span> \
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">])</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">s</span><span class="p">,</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]])</span> \
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">])</span>
        <span class="n">sNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_groups</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">sEdges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_groups</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="n">sNodes</span><span class="p">,</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="n">sEdges</span><span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">similarity_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;simpson&#39;</span><span class="p">):</span>
        <span class="n">index_func</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_index&#39;</span><span class="o">%</span><span class="n">index</span>
        <span class="c1"># these are imported into globals() from common:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.common&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">index_func</span><span class="p">):</span>
            <span class="n">to_call</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.common&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]],</span>
                <span class="n">index_func</span><span class="p">)</span>
            <span class="n">grs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">sor</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">g</span><span class="p">,</span> <span class="p">{})</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">grs</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">g1</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">grs</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">g2</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">grs</span><span class="p">)):</span>
                    <span class="n">sor</span><span class="p">[</span><span class="n">grs</span><span class="p">[</span><span class="n">g1</span><span class="p">]][</span><span class="n">grs</span><span class="p">[</span><span class="n">g2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">to_call</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">grs</span><span class="p">[</span><span class="n">g1</span><span class="p">]],</span>
                        <span class="n">groups</span><span class="p">[</span><span class="n">grs</span><span class="p">[</span><span class="n">g2</span><span class="p">]])</span>
                    <span class="n">sor</span><span class="p">[</span><span class="n">grs</span><span class="p">[</span><span class="n">g2</span><span class="p">]][</span><span class="n">grs</span><span class="p">[</span><span class="n">g1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sor</span><span class="p">[</span><span class="n">grs</span><span class="p">[</span><span class="n">g1</span><span class="p">]][</span><span class="n">grs</span><span class="p">[</span><span class="n">g2</span><span class="p">]]</span>
            <span class="k">return</span> <span class="n">sor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;No such function: </span><span class="si">%s</span><span class="s1">()&#39;</span><span class="o">%</span><span class="n">index_func</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">sorensen_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pwlist</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="n">pwlist</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pwlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathway_types</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pwlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s2">&quot;No such vertex attribute: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="p">),</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">indA</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span>
            <span class="n">indB</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span>
            <span class="n">pwsA</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pwsB</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pwlist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">indA</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">indA</span><span class="p">][</span><span class="n">p</span><span class="p">]:</span>
                        <span class="n">thisPw</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_pathways&quot;</span><span class="p">,</span><span class="s2">&quot;__&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pw</span>
                        <span class="k">if</span> <span class="n">thisPw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">nodes</span><span class="p">[</span><span class="n">thisPw</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">nodes</span><span class="p">[</span><span class="n">thisPw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indA</span><span class="p">)</span>
                        <span class="n">pwsA</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisPw</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">indB</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">indB</span><span class="p">][</span><span class="n">p</span><span class="p">]:</span>
                        <span class="n">thisPw</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_pathways&quot;</span><span class="p">,</span><span class="s2">&quot;__&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pw</span>
                        <span class="k">if</span> <span class="n">thisPw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">nodes</span><span class="p">[</span><span class="n">thisPw</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">nodes</span><span class="p">[</span><span class="n">thisPw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indB</span><span class="p">)</span>
                        <span class="n">pwsB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisPw</span><span class="p">)</span>
            <span class="n">pwsE</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">pwsA</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">pwsB</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">pwsE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                    <span class="n">edges</span><span class="p">[</span><span class="n">pw</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">edges</span><span class="p">[</span><span class="n">pw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">sNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_groups</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">sEdges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_groups</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="n">sNodes</span><span class="p">,</span> <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="n">sEdges</span><span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">write_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tbl</span><span class="p">,</span><span class="n">outfile</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">cut</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">colnames</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">rownames</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">rn</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;header&quot;</span> <span class="ow">in</span> <span class="n">rn</span><span class="p">:</span>
            <span class="n">cn</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span>
            <span class="n">rn</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cn</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">rn</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))]</span>
        <span class="k">if</span> <span class="n">colnames</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rownames</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">sep</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rn</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rownames</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span>
            <span class="n">thisRow</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tbl</span><span class="p">[</span><span class="n">r</span><span class="p">]]</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">thisRow</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="o">+</span><span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">search_attr_or</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">lst</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">a</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span> <span class="ow">and</span> <span class="n">obj</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">search_attr_and</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">lst</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">a</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span> <span class="ow">and</span> <span class="n">obj</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">!=</span> <span class="n">v</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
    
    <span class="k">def</span> <span class="nf">get_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crit</span><span class="p">,</span> <span class="n">andor</span><span class="o">=</span><span class="s2">&quot;or&quot;</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">keepV</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">delE</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">andor</span> <span class="o">==</span> <span class="s2">&quot;and&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">keepThis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_and</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">crit</span><span class="p">[</span><span class="s2">&quot;edge&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">keepThis</span><span class="p">:</span>
                    <span class="n">keepA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_and</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">],</span><span class="n">crit</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">keepA</span><span class="p">:</span>
                        <span class="n">keepV</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]</span>
                    <span class="n">keepB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_and</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">],</span><span class="n">crit</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">keepB</span><span class="p">:</span>
                        <span class="n">keepV</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">keepA</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">keepB</span><span class="p">:</span>
                        <span class="n">delE</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">delE</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">keepThis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_or</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">crit</span><span class="p">[</span><span class="s2">&quot;edge&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">keepThis</span><span class="p">:</span>
                    <span class="n">keepV</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">delE</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crit</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">keepA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_or</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">],</span><span class="n">crit</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">keepA</span><span class="p">:</span>
                        <span class="n">keep</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]</span>
                    <span class="n">keepB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_or</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">],</span><span class="n">crit</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">keepB</span><span class="p">:</span>
                        <span class="n">keep</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keepV</span><span class="p">)),</span> <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">delE</span><span class="p">))}</span>
    
    <span class="k">def</span> <span class="nf">edgeseq_inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">edges</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
                <span class="n">inv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inv</span>
    
    <span class="k">def</span> <span class="nf">get_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crit</span><span class="p">,</span> <span class="n">andor</span><span class="o">=</span><span class="s2">&quot;or&quot;</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sub</span><span class="p">(</span><span class="n">crit</span><span class="p">,</span> <span class="n">andor</span> <span class="o">=</span> <span class="n">andor</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">g</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">new</span><span class="o">.</span><span class="n">induced_subgraph</span><span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">separate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">({</span><span class="s1">&#39;edge&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sources&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">]},</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="p">{}}))</span> \
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">update_pathway_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">pwTyp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;_pathways&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">pwTyp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathway_types</span> <span class="o">=</span> <span class="n">pwTyp</span>
    
    <span class="k">def</span> <span class="nf">source_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outfile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;pwnet-&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span><span class="s2">&quot;-sim-src&quot;</span><span class="p">])</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_databases</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span><span class="n">outfile</span><span class="o">+</span><span class="s2">&quot;-nodes&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span><span class="n">outfile</span><span class="o">+</span><span class="s2">&quot;-edges&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">pathway_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outfile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;pwnet-&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span><span class="s2">&quot;-sim-pw&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_pathway_types</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_pathways</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span><span class="n">outfile</span><span class="o">+</span><span class="s2">&quot;-nodes&quot;</span><span class="p">,</span><span class="n">cut</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span><span class="n">outfile</span><span class="o">+</span><span class="s2">&quot;-edges&quot;</span><span class="p">,</span><span class="n">cut</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">update_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">src</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">+=</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">src</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">update_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">pws</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_pathways&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pws</span><span class="p">:</span>
                        <span class="n">pws</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">pws</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                                <span class="n">pws</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathways</span> <span class="o">=</span> <span class="n">pws</span>
    
    <span class="k">def</span> <span class="nf">delete_unmapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;unmapped&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;unmapped&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_db_dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
    
<div class="viewcode-block" id="PyPath.genesymbol_labels"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.genesymbol_labels">[docs]</a>    <span class="k">def</span> <span class="nf">genesymbol_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">remap_all</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creats vertex attribute ``label`` and fills up with Gene Symbols</span>
<span class="sd">        of all proteins where the Gene Symbol can be looked up based on</span>
<span class="sd">        the default name of the protein vertex.</span>
<span class="sd">        If the attribute ``label`` had been already initialized, </span>
<span class="sd">        updates this attribute or recreates if ``remap_all`` </span>
<span class="sd">        is ``True``.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_already_has_directed</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span><span class="p">,</span> <span class="n">remap_all</span> <span class="o">=</span> <span class="n">remap_all</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">defaultNameType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="s2">&quot;protein&quot;</span><span class="p">]</span>
        <span class="n">geneSymbol</span> <span class="o">=</span> <span class="s2">&quot;genesymbol&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;label&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">remap_all</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">if</span> <span class="n">remap_all</span> <span class="ow">or</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())):</span>
            <span class="k">if</span> <span class="n">l</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;protein&#39;</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">defaultNameType</span><span class="p">,</span> <span class="n">geneSymbol</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span></div>
    
<div class="viewcode-block" id="PyPath.network_stats"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.network_stats">[docs]</a>    <span class="k">def</span> <span class="nf">network_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates basic statistics for the whole network </span>
<span class="sd">        and each of sources. Writes the results in a tab file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;pwnet&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span><span class="s2">&quot;stats&quot;</span><span class="p">])</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;vnum&quot;</span><span class="p">,</span> <span class="s2">&quot;enum&quot;</span><span class="p">,</span> <span class="s2">&quot;deg_avg&quot;</span><span class="p">,</span> <span class="s2">&quot;diam&quot;</span><span class="p">,</span> 
                           <span class="s2">&quot;trans&quot;</span><span class="p">,</span> <span class="s2">&quot;adh&quot;</span><span class="p">,</span> <span class="s2">&quot;coh&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;All&quot;</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">({</span>
                <span class="s2">&quot;edge&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;sources&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">]},</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="p">{}})</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">stats</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span> <span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
                    <span class="nb">sum</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">())</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">)),</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">diameter</span><span class="p">(),</span> <span class="n">g</span><span class="o">.</span><span class="n">transitivity_undirected</span><span class="p">(),</span> <span class="n">g</span><span class="o">.</span><span class="n">adhesion</span><span class="p">(),</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">cohesion</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">degree_dists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dds</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">({</span><span class="s2">&quot;edge&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;sources&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">]},</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="p">{}})</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dds</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">degree_distribution</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">dds</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s2">&quot;pwnet-&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span><span class="s2">&quot;-degdist-&quot;</span><span class="p">,</span><span class="n">k</span><span class="p">])</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">bins</span><span class="p">():</span>
                <span class="n">bins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">),</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                           <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">),</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">])</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">intergroup_shortest_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">groupA</span><span class="p">,</span><span class="n">groupB</span><span class="p">,</span><span class="n">random</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">groupA</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s2">&quot;No such attribute: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">groupA</span><span class="p">),</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">groupB</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s2">&quot;No such attribute: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">groupB</span><span class="p">),</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">deg_pathlen</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">rat_pathlen</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">rand_pathlen</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">diam_pathlen</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;All&quot;</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span><span class="p">,</span><span class="n">groupA</span><span class="p">,</span><span class="n">groupB</span><span class="p">,</span><span class="s2">&quot;paths&quot;</span><span class="p">])</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">({</span>
                <span class="s2">&quot;edge&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;sources&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">]},</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="p">{}})</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">grA</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">grB</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupA</span><span class="p">]:</span>
                    <span class="n">grA</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupB</span><span class="p">]:</span>
                    <span class="n">grB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupB</span><span class="p">]:</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_shortest_paths</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">grA</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s2">&quot;epath&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pt</span><span class="p">:</span>
                        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> 
                        <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">grA</span><span class="p">):</span>
                        <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">({</span><span class="s2">&quot;paths&quot;</span><span class="p">:</span> <span class="n">paths</span><span class="p">},</span> <span class="n">outfile</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">,</span><span class="n">colnames</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">rownames</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">deg</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
            <span class="n">mean_pathlen</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">))</span>
            <span class="n">deg_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_pathlen</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">deg</span><span class="p">))]</span>
            <span class="n">rat_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_pathlen</span><span class="p">,</span>
                                <span class="n">f</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">grA</span><span class="o">+</span><span class="n">grB</span><span class="p">))))]</span>
            <span class="n">diam_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_pathlen</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">diameter</span><span class="p">()]</span>
            <span class="k">if</span> <span class="n">random</span><span class="p">:</span>
                <span class="n">groupA_random</span> <span class="o">=</span> <span class="n">groupA</span><span class="o">+</span><span class="s2">&quot;_random&quot;</span>
                <span class="n">groupB_random</span> <span class="o">=</span> <span class="n">groupB</span><span class="o">+</span><span class="s2">&quot;_random&quot;</span>
                <span class="n">random_pathlen</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupA_random</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupA</span><span class="p">])</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupB_random</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupB</span><span class="p">])</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupA_random</span><span class="p">])</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupB_random</span><span class="p">])</span>
                    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">grA</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">grB</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupA_random</span><span class="p">]:</span>
                            <span class="n">grA</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupB_random</span><span class="p">]:</span>
                            <span class="n">grB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupB_random</span><span class="p">]:</span>
                            <span class="n">pt</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_shortest_paths</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">grA</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s2">&quot;epath&quot;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pt</span><span class="p">:</span>
                                <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> 
                                <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">grA</span><span class="p">):</span>
                                <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">random_pathlen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">random_pathlen</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rand_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_pathlen</span><span class="p">,</span>
                                        <span class="nb">sum</span><span class="p">(</span><span class="n">random_pathlen</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">random_pathlen</span><span class="p">))]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rand_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_pathlen</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
        <span class="n">deg_pathlen</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;path_len&quot;</span><span class="p">,</span><span class="s2">&quot;degree&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">deg_pathlen</span><span class="p">,</span><span class="s2">&quot;deg_pathlen&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
        <span class="n">diam_pathlen</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;path_len&quot;</span><span class="p">,</span><span class="s2">&quot;diam&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">diam_pathlen</span><span class="p">,</span><span class="s2">&quot;diam_pathlen&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
        <span class="n">rat_pathlen</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;path_len&quot;</span><span class="p">,</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">rat_pathlen</span><span class="p">,</span><span class="s2">&quot;rat_pathlen&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">:</span>
            <span class="n">rand_pathlen</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;path_len&quot;</span><span class="p">,</span><span class="s2">&quot;random&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">rand_pathlen</span><span class="p">,</span><span class="s2">&quot;rand_pathlen&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">update_vertex_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">,</span> <span class="s1">&#39;references&#39;</span><span class="p">]:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span> <span class="o">+=</span> <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span> <span class="o">+=</span> <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">basic_stats_intergroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">groupA</span><span class="p">,</span><span class="n">groupB</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;All&quot;</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;edge&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;sources&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">]},</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="p">{}})</span>
            <span class="n">deg</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
            <span class="n">bw</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">betweenness</span><span class="p">()</span>
            <span class="n">vnum</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span>
            <span class="n">enum</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ecount</span><span class="p">()</span>
            <span class="n">cancerg</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">drugt</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">cdeg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tdeg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ddeg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cbw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tbw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dbw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="n">tdeg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deg</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                <span class="n">tbw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bw</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">groupA</span><span class="p">]:</span>
                    <span class="n">cg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                    <span class="n">cancerg</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">cdeg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deg</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                    <span class="n">cbw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bw</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">groupB</span><span class="p">]:</span>
                    <span class="n">dt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                    <span class="n">drugt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">ddeg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deg</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                    <span class="n">dbw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bw</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
            <span class="n">cpct</span> <span class="o">=</span> <span class="n">cancerg</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">groupA</span><span class="p">]))</span>
            <span class="n">dpct</span> <span class="o">=</span> <span class="n">drugt</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">groupB</span><span class="p">]))</span>
            <span class="n">tdgr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tdeg</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tdeg</span><span class="p">))</span>
            <span class="n">cdgr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cdeg</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cdeg</span><span class="p">))</span>
            <span class="n">ddgr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ddeg</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ddeg</span><span class="p">))</span>
            <span class="n">tbwn</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tbw</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tbw</span><span class="p">))</span>
            <span class="n">cbwn</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cbw</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cbw</span><span class="p">))</span>
            <span class="n">dbwn</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dbw</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dbw</span><span class="p">))</span>
            <span class="n">src</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">csrc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dsrc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">src</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="n">groupA</span><span class="p">]</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="n">groupA</span><span class="p">]:</span>
                    <span class="n">csrc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="n">groupB</span><span class="p">]</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="n">groupB</span><span class="p">]:</span>
                    <span class="n">dsrc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]))</span>
            <span class="n">snum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">src</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">src</span><span class="p">))</span>
            <span class="n">csnum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">csrc</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csrc</span><span class="p">))</span>
            <span class="n">dsnum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dsrc</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dsrc</span><span class="p">))</span>
            <span class="n">result</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">vnum</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">enum</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">cancerg</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">drugt</span><span class="p">),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">cpct</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">dpct</span><span class="p">),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">tdgr</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">cdgr</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">ddgr</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">tbwn</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">cbwn</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">dbwn</span><span class="p">),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">snum</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">csnum</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">dsnum</span><span class="p">)]</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">groupA</span><span class="p">,</span><span class="n">groupB</span><span class="p">,</span><span class="s2">&quot;stats&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">header</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">outfile</span><span class="p">,</span><span class="n">colnames</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">outfile</span><span class="p">,</span><span class="n">colnames</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">sources_venn_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="n">ini</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">inj</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]:</span>
                        <span class="n">ini</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]:</span>
                        <span class="n">inj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">onlyi</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ini</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">inj</span><span class="p">))))</span>
                <span class="n">onlyj</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">inj</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">ini</span><span class="p">))))</span>
                <span class="n">inter</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ini</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">inj</span><span class="p">))))</span>
                <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">onlyi</span><span class="p">,</span><span class="n">onlyj</span><span class="p">,</span><span class="n">inter</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="s2">&quot;sources-venn-data.csv&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">sources_hist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">srcnum</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">srcnum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;srcnum&quot;</span><span class="p">:</span> <span class="n">srcnum</span><span class="p">},</span><span class="s2">&quot;source_num&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">,</span><span class="n">rownames</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">colnames</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">degree_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">group</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">({</span><span class="s2">&quot;deg&quot;</span><span class="p">:</span> <span class="n">deg</span><span class="p">},</span> <span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;-whole-degdist&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">,</span>
                         <span class="n">rownames</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">colnames</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">group</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s2">&quot;Missing vertex attribute!&quot;</span><span class="p">),</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">gr</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                <span class="n">dgr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">gr</span><span class="p">]:</span>
                        <span class="n">dgr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">({</span><span class="s2">&quot;deg&quot;</span><span class="p">:</span> <span class="n">dgr</span><span class="p">},</span> <span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="n">gr</span><span class="o">+</span><span class="s2">&quot;-degdist&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">,</span>
                                 <span class="n">rownames</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">colnames</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">delete_by_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">source</span><span class="p">,</span><span class="n">vertexAttrsToDel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">edgeAttrsToDel</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">verticesToDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">source</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">verticesToDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">verticesToDel</span><span class="p">)</span>
        <span class="n">edgesToDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">source</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">edgesToDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">source</span><span class="p">]))</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="n">edgesToDel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vertexAttrsToDel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vAttr</span> <span class="ow">in</span> <span class="n">vertexAttrsToDel</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">vAttr</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                    <span class="k">del</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vAttr</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">edgeAttrsToDel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">eAttr</span> <span class="ow">in</span> <span class="n">edgeAttrsToDel</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">eAttr</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                    <span class="k">del</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">eAttr</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">reference_hist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">tbl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">tbl</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">])),</span>
                <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]))</span>
            <span class="p">))</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">+</span><span class="s2">&quot;-refs-hist&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tbl</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
<div class="viewcode-block" id="PyPath.load_resources"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.load_resources">[docs]</a>    <span class="k">def</span> <span class="nf">load_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">omnipath</span><span class="p">,</span> <span class="n">exclude</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">cache_files</span> <span class="o">=</span> <span class="p">{}):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Loads multiple resources, and cleans up after. </span>
<span class="sd">        Looks up ID types, and loads all ID conversion </span>
<span class="sd">        tables from UniProt if necessary. This is much</span>
<span class="sd">        faster than loading the ID conversion and the </span>
<span class="sd">        resources one by one.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_reflists</span><span class="p">()</span>
        <span class="n">huge</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> \
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">huge</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache_files</span><span class="p">)</span>
        <span class="n">nothuge</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> \
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">huge</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">cache_files</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="p">[</span><span class="n">huge</span><span class="p">,</span> <span class="n">nothuge</span><span class="p">]:</span>
            <span class="n">ac_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">nameTypeA</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">ac_types</span> <span class="o">=</span> <span class="n">ac_types</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">nameTypeA</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ac_types</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">nameTypeA</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">nameTypeB</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">ac_types</span> <span class="o">=</span> <span class="n">ac_types</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">nameTypeB</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ac_types</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">nameTypeB</span><span class="p">)</span>
            <span class="n">table_loaded</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">ids</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">ids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">:</span>
                    <span class="n">table_loaded</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">load_uniprot_mappings</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ac_types</span> <span class="o">-</span> <span class="n">table_loaded</span> <span class="o">&amp;</span> \
                <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">name_types</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load_resource</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">clean</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">cache_files</span> <span class="o">=</span> <span class="n">cache_files</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Could not load </span><span class="si">%s</span><span class="s1">, unexpected error &#39;</span>\
                        <span class="s1">&#39;occurred, see </span><span class="si">%s</span><span class="s1"> for error.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">logfile</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;Error at loading </span><span class="si">%s</span><span class="s1">: </span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s1">, </span><span class="se">\t</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
                        <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean_graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="sd">&#39;&#39;&#39;\n » %u interactions between %u nodes\n from %u&#39;&#39;&#39;</span>\
            <span class="sd">&#39;&#39;&#39; resources have been loaded,\n for details see the log: ./%s\n&#39;&#39;&#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span> 
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">logfile</span><span class="p">))</span></div>
    
    <span class="k">def</span> <span class="nf">load_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">load_mappings</span><span class="p">(</span><span class="n">maps</span><span class="o">=</span><span class="n">data_formats</span><span class="o">.</span><span class="n">mapList</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">clean</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">cache_files</span> <span class="o">=</span> <span class="p">{}):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; » &#39;</span><span class="o">+</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">cache_files</span> <span class="o">=</span> <span class="n">cache_files</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attach_network</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">clean</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_reflists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reflists</span> <span class="o">=</span> <span class="n">refLists</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rl</span> <span class="ow">in</span> <span class="n">reflists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_reflist</span><span class="p">(</span><span class="n">rl</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_reflist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reflist</span><span class="p">):</span>
        <span class="n">reflist</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">reflist</span><span class="o">.</span><span class="n">nameType</span><span class="p">,</span><span class="n">reflist</span><span class="o">.</span><span class="n">typ</span><span class="p">,</span><span class="n">reflist</span><span class="o">.</span><span class="n">tax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">reflist</span>
    
    <span class="k">def</span> <span class="nf">load_negatives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">negative</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; » &#39;</span><span class="o">+</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_negative</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">list_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; » omnipath</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">omnipath</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; » good</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">good</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">descriptions</span><span class="o">.</span><span class="n">descriptions</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; :: Sorry, no description available about </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">::: </span><span class="si">%s</span><span class="s1"> :::</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span>
        <span class="k">if</span> <span class="s1">&#39;urls&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;webpages&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">]:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Webpages:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">][</span><span class="s1">&#39;webpages&#39;</span><span class="p">]:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">    » </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">w</span>
            <span class="k">if</span> <span class="s1">&#39;articles&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">]:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Articles:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">][</span><span class="s1">&#39;articles&#39;</span><span class="p">]:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">    » </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">w</span>
        <span class="k">if</span> <span class="s1">&#39;taxons&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Taxons: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;taxons&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;descriptions&#39;</span> <span class="ow">in</span> <span class="n">dd</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;descriptions&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">:: From the authors:</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;descriptions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">    &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;notes&#39;</span> <span class="ow">in</span> <span class="n">dd</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;notes&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">:: Notes:</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;notes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">    &#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    
    <span class="c1">#</span>
    <span class="c1"># functions to make life easier</span>
    <span class="c1">#</span>
    
    <span class="k">def</span> <span class="nf">having_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">es_or_vs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;es&#39;</span> <span class="k">if</span> <span class="n">edges</span> <span class="k">else</span> <span class="s1">&#39;vs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">es_or_vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">es_or_vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">something</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="n">attr</span><span class="p">]):</span>
                    <span class="k">yield</span> <span class="n">i</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="n">index</span> <span class="k">else</span> <span class="n">i</span>
    
    <span class="k">def</span> <span class="nf">having_eattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">having_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">having_vattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">having_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">having_ptm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">having_eattr</span><span class="p">(</span><span class="s1">&#39;ptm&#39;</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">loop_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="n">index</span> <span class="k">else</span> <span class="n">e</span>
    
    <span class="c1">#</span>
    <span class="c1"># functions to make topological analysis on the graph</span>
    <span class="c1">#</span>
    
    <span class="k">def</span> <span class="nf">first_neighbours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">neighborhood</span><span class="p">(</span><span class="n">node</span><span class="p">))</span><span class="o">-</span><span class="nb">set</span><span class="p">([</span><span class="n">node</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">indices</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lst</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nlst</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
                <span class="n">nlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">nlst</span>
    
    <span class="k">def</span> <span class="nf">second_neighbours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">with_first</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">node_i</span> <span class="o">=</span> <span class="n">node</span> 
            <span class="n">node_n</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">node_i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node_i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">node_i</span> <span class="o">=</span> <span class="n">node_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                <span class="n">node_n</span> <span class="o">=</span> <span class="n">node</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span>
        <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_neighbours</span><span class="p">(</span><span class="n">node_i</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">first</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_neighbours</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">with_first</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">+=</span> <span class="n">first</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">first</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">indices</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">([</span><span class="n">node_i</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">([</span><span class="n">node_n</span><span class="p">]))</span>
    
    <span class="k">def</span> <span class="nf">all_neighbours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;neighbours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Searching neighbours&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="n">v</span><span class="p">[</span><span class="s1">&#39;neighbours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_neighbours</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">jaccard_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_neighbours</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">metaEdges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Calculating Jaccard-indices&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()):</span>
                <span class="n">vv</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="n">vw</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
                <span class="n">ja</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vv</span><span class="p">[</span><span class="s1">&#39;neighbours&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">vw</span><span class="p">[</span><span class="s1">&#39;neighbours&#39;</span><span class="p">]))</span>
                <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vv</span><span class="p">[</span><span class="s1">&#39;neighbours&#39;</span><span class="p">])</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">vw</span><span class="p">[</span><span class="s1">&#39;neighbours&#39;</span><span class="p">])))</span>
                <span class="n">metaEdges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vv</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="n">vw</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="n">ja</span><span class="p">))</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">metaEdges</span>
    
    <span class="k">def</span> <span class="nf">jaccard_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">jedges</span><span class="p">,</span><span class="n">critical</span><span class="p">):</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">jedges</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">critical</span><span class="p">:</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">TupleList</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">apply_negative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">settings</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">negatives</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">negatives</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span>
        <span class="n">neg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">negatives</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
        <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">neg</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Matching interactions&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span>
            <span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative_refs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative_refs&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative_refs&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">neg</span><span class="p">:</span>
            <span class="n">aexists</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">bexists</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">aexists</span> <span class="ow">and</span> <span class="n">bexists</span><span class="p">:</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="s2">&quot;defaultNameA&quot;</span><span class="p">],</span><span class="n">n</span><span class="p">[</span><span class="s2">&quot;defaultNameB&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;negative&#39;</span><span class="p">]:</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;negative_refs&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">n</span><span class="p">[</span><span class="s1">&#39;attrsEdge&#39;</span><span class="p">][</span><span class="s1">&#39;references&#39;</span><span class="p">]</span>
                    <span class="n">matches</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%u</span><span class="s1"> matches found with negative set</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">matches</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">negative_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lst</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">outFile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outFile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">+</span> <span class="s1">&#39;-negatives&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">neg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">outFile</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">],</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]),</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]),</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">]),</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;negative_refs&#39;</span><span class="p">])])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="n">lst</span><span class="p">:</span>
                    <span class="n">neg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">neg</span>
    
    <span class="k">def</span> <span class="nf">export_ptms_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;network-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">+</span><span class="s1">&#39;.tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="s1">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UniProt_A&#39;</span><span class="p">,</span> <span class="s1">&#39;UniProt_B&#39;</span><span class="p">,</span> <span class="s1">&#39;GeneSymbol_B&#39;</span><span class="p">,</span> <span class="s1">&#39;GeneSymbol_A&#39;</span><span class="p">,</span> <span class="s1">&#39;Databases&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;PubMed_IDs&#39;</span><span class="p">,</span> <span class="s1">&#39;Stimulation&#39;</span><span class="p">,</span> <span class="s1">&#39;Inhibition&#39;</span><span class="p">,</span> <span class="s1">&#39;Substrate-isoform&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;Residue_number&#39;</span><span class="p">,</span> <span class="s1">&#39;Residue_letter&#39;</span><span class="p">,</span> <span class="s1">&#39;PTM_type&#39;</span><span class="p">]</span>
        <span class="n">stripJson</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;[\[\]{}\&quot;]&#39;</span><span class="p">)</span>
        <span class="c1"># first row is header</span>
        <span class="n">outl</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Writing table&#39;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
            <span class="n">uniqedges</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="c1"># only directed</span>
                <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">which_dirs</span><span class="p">():</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">tgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="c1"># uniprot names</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">di</span><span class="p">)</span>
                    <span class="c1"># genesymbols</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">tgt</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]]</span>
                    <span class="c1"># sources</span>
                    <span class="n">dbs</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbs</span><span class="p">))</span>
                    <span class="c1"># references</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">rs</span> <span class="ow">in</span> \
                        <span class="p">[</span><span class="n">refs</span> <span class="k">for</span> <span class="n">db</span><span class="p">,</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> \
                            <span class="k">if</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">dbs</span><span class="p">]</span> \
                        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">]))</span>
                    <span class="c1"># signs</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">di</span><span class="p">)]</span>
                    <span class="c1"># domain-motif</span>
                    <span class="c1"># row.append(&#39;#&#39;.join([x.print_residues() for x in e[&#39;ptm&#39;] \</span>
                    <span class="c1">#    if x.__class__.__name__ == &#39;DomainMotif&#39;]))</span>
                    <span class="k">for</span> <span class="n">dmi</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">dmi</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;DomainMotif&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">protein</span> <span class="o">==</span> <span class="n">di</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                    <span class="n">uniqedges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                    <span class="n">r</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="p">[</span>
                                        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> 
                                            <span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">isoform</span><span class="p">),</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">number</span><span class="p">),</span>
                                        <span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
                                        <span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span><span class="p">]</span>
                                    <span class="c1"># here each ptm in separate row:</span>
                                    <span class="n">outl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                    <span class="c1"># row complete, appending to main list</span>
                    <span class="c1"># outl.append(row)</span>
            <span class="c1"># tabular text from list of lists; writing to file</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">outl</span><span class="p">])</span>
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">console</span><span class="p">(</span><span class="s1">&#39;:: Data has been written to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">outfile</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">uniqedges</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">export_struct_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;network-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">+</span><span class="s1">&#39;.tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="s1">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UniProt_A&#39;</span><span class="p">,</span> <span class="s1">&#39;UniProt_B&#39;</span><span class="p">,</span> <span class="s1">&#39;GeneSymbol_B&#39;</span><span class="p">,</span> <span class="s1">&#39;GeneSymbol_A&#39;</span><span class="p">,</span> <span class="s1">&#39;Databases&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;PubMed_IDs&#39;</span><span class="p">,</span> <span class="s1">&#39;Stimulation&#39;</span><span class="p">,</span> <span class="s1">&#39;Inhibition&#39;</span><span class="p">,</span> <span class="s1">&#39;Domain-domain&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;Domain-motif-PTM&#39;</span><span class="p">,</span> <span class="s1">&#39;PTM-regulation&#39;</span><span class="p">]</span>
        <span class="n">stripJson</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;[\[\]{}\&quot;]&#39;</span><span class="p">)</span>
        <span class="c1"># first row is header</span>
        <span class="n">outl</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Writing table&#39;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="c1"># only directed</span>
                <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">which_dirs</span><span class="p">():</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">tgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="c1"># uniprot names</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">di</span><span class="p">)</span>
                    <span class="c1"># genesymbols</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">tgt</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]]</span>
                    <span class="c1"># sources</span>
                    <span class="n">dbs</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbs</span><span class="p">))</span>
                    <span class="c1"># references</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">rs</span> <span class="ow">in</span> \
                        <span class="p">[</span><span class="n">refs</span> <span class="k">for</span> <span class="n">db</span><span class="p">,</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> \
                            <span class="k">if</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">dbs</span><span class="p">]</span> \
                        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">]))</span>
                    <span class="c1"># signs</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">di</span><span class="p">)]</span>
                    <span class="c1"># domain-domain</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]]))</span>
                    <span class="c1"># domain-motif</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> \
                        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;Ptm&#39;</span><span class="p">]))</span>
                    <span class="c1"># domain-motif</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> \
                        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;Regulation&#39;</span><span class="p">]))</span>
                    <span class="c1"># row complete, appending to main list</span>
                    <span class="n">outl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="c1"># tabular text from list of lists; writing to file</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">outl</span><span class="p">])</span>
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">console</span><span class="p">(</span><span class="s1">&#39;:: Data has been written to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">outfile</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">export_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">extraNodeAttrs</span><span class="o">=</span><span class="p">{},</span><span class="n">extraEdgeAttrs</span><span class="o">=</span><span class="p">{},</span><span class="n">outfile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;network-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">+</span><span class="s1">&#39;.tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UniProt_A&#39;</span><span class="p">,</span><span class="s1">&#39;GeneSymbol_A&#39;</span><span class="p">,</span><span class="s1">&#39;UniProt_B&#39;</span><span class="p">,</span><span class="s1">&#39;GeneSymbol_B&#39;</span><span class="p">,</span><span class="s1">&#39;Databases&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;PubMed_IDs&#39;</span><span class="p">,</span><span class="s1">&#39;Undirected&#39;</span><span class="p">,</span><span class="s1">&#39;Direction_A-B&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;Direction_B-A&#39;</span><span class="p">,</span> <span class="s1">&#39;Stimulatory_A-B&#39;</span><span class="p">,</span><span class="s1">&#39;Inhibitory_A-B&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;Stimulatory_B-A&#39;</span><span class="p">,</span><span class="s1">&#39;Inhibitory_B-A&#39;</span><span class="p">,</span><span class="s1">&#39;Category&#39;</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="n">extraEdgeAttrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;_A&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">extraNodeAttrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;_B&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">extraNodeAttrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">stripJson</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;[\[\]{}\&quot;]&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Writing table&#39;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">nameA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">nameB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">thisEdge</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">thisEdge</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nameA</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)]</span>
                <span class="n">thisEdge</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nameB</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]]</span>
                <span class="n">thisEdge</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">])),</span>
                             <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]))]</span>
                <span class="n">thisEdge</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">,</span><span class="n">sources</span><span class="o">=</span><span class="bp">True</span><span class="p">)),</span>
                             <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">),</span><span class="n">sources</span><span class="o">=</span><span class="bp">True</span><span class="p">)),</span>
                             <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">nameB</span><span class="p">,</span><span class="n">nameA</span><span class="p">),</span><span class="n">sources</span><span class="o">=</span><span class="bp">True</span><span class="p">))]</span>
                <span class="n">thisEdge</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> \
                            <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">),</span><span class="n">sources</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">((</span><span class="n">nameB</span><span class="p">,</span><span class="n">nameA</span><span class="p">),</span><span class="n">sources</span><span class="o">=</span><span class="bp">True</span><span class="p">)]</span>
                <span class="n">thisEdge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">extraEdgeAttrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">thisEdge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> 
                            <span class="n">stripJson</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">v</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)])</span>
                    <span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">extraNodeAttrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">thisEdge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> 
                            <span class="n">stripJson</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="n">v</span><span class="p">])</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)])</span>
                    <span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">extraNodeAttrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">thisEdge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> 
                            <span class="n">stripJson</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="n">v</span><span class="p">])</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)])</span>
                    <span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">thisEdge</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">export_sif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">outfile</span> <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> \
            <span class="k">else</span> <span class="s1">&#39;network-</span><span class="si">%s</span><span class="s1">.sif&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">b</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;undirected&#39;</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;undirected&#39;</span> \
                        <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([[</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> \
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="k">if</span> <span class="n">v</span><span class="p">])</span>
                    <span class="n">dirn</span> <span class="o">=</span> <span class="s1">&#39;=&#39;</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;undirected&#39;</span> <span class="k">else</span> <span class="s1">&#39;&gt;&#39;</span>
                    <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> \
                        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;undirected&#39;</span> <span class="k">else</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> \
                        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;undirected&#39;</span> <span class="k">else</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">source</span><span class="p">,</span> <span class="n">sign</span> <span class="o">+</span> <span class="n">dirn</span><span class="p">,</span> <span class="n">target</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">export_graphml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;main&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s1">&#39;network-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">+</span><span class="s1">&#39;.graphml&#39;</span><span class="p">)</span>
        <span class="n">isDir</span> <span class="o">=</span> <span class="s1">&#39;directed&#39;</span> <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;undirected&#39;</span>
        <span class="n">isDirB</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span> <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;false&#39;</span>
        <span class="n">nodeAttrs</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;UniProt&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;GeneSymbol&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Type&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">)]</span>
        <span class="n">edgeAttrs</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Databases&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;PubMedIDs&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Undirected&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;DirectionAB&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;DirectionBA&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;StimulatoryAB&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;InhibitoryAB&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;StimulatoryBA&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;InhibitoryBA&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Category&#39;</span><span class="p">,</span><span class="s1">&#39;string&#39;</span><span class="p">)]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="s1">                    &lt;graphml xmlns=&quot;http://graphml.graphdrawing.org/xmlns&quot; </span>
<span class="s1">                    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="s1">                    xsi:schemaLocation=&quot;http://graphml.graphdrawing.org/xmlns </span>
<span class="s1">                    http://graphml.graphdrawing.org/xmlns/1.0/graphml.xsd&quot;&gt;</span><span class="se">\n\n</span><span class="s1"></span>
<span class="s1">                &#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">nodeAttrs</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;key id=&quot;</span><span class="si">%s</span><span class="s1">&quot; for=&quot;node&quot; attr.name=&quot;</span><span class="si">%s</span><span class="s1">&quot; attr.type=&quot;</span><span class="si">%s</span><span class="s1">&quot; /&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">edgeAttrs</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;key id=&quot;</span><span class="si">%s</span><span class="s1">&quot; for=&quot;edge&quot; attr.name=&quot;</span><span class="si">%s</span><span class="s1">&quot; attr.type=&quot;</span><span class="si">%s</span><span class="s1">&quot; /&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\n</span><span class="s1">&lt;graph id=&quot;</span><span class="si">%s</span><span class="s1">&quot; edgedefault=&quot;</span><span class="si">%s</span><span class="s1">&quot; </span>
<span class="s1">                        parse.nodeids=&quot;free&quot; parse.edgeids=&quot;canonical&quot; </span>
<span class="s1">                        parse.order=&quot;nodesfirst&quot;&gt;</span><span class="se">\n\n</span><span class="s1">&#39;&#39;&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">isDir</span><span class="p">))</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span>
                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Writing nodes&#39;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&lt;!-- graph properties --&gt;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&lt;!-- vertices --&gt;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;node id=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;UniProt&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;GeneSymbol&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;Type&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;/node&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Writing edges&#39;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&lt;!-- edges --&gt;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;edge id=&quot;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&quot; source=&quot;</span><span class="si">%s</span><span class="s1">&quot; target=&quot;</span><span class="si">%s</span><span class="s1">&quot; directed=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> \
                    <span class="o">%</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                       <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                       <span class="n">isDirB</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;Databases&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;PubMedIDs&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;Undirected&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs_by_source&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;DirectionAB&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs_by_source&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;DirectionBA&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs_by_source&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;StimulatoryAB&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;InhibitoryAB&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;StimulatoryBA&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;InhibitoryBA&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;data key=&quot;InhibitoryBA&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/data&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">e</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;/edge&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&lt;/graph&gt;</span><span class="se">\n</span><span class="s1">&lt;/graphml&gt;&#39;</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">compounds_from_chembl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chembl_mysql</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">crit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">andor</span><span class="o">=</span><span class="s2">&quot;or&quot;</span><span class="p">,</span>
                              <span class="n">assay_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">],</span> <span class="n">relationship_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">],</span>
                              <span class="n">multi_query</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">chembl_mysql</span> <span class="o">=</span> <span class="n">chembl_mysql</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">chembl_mysql</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chembl</span> <span class="o">=</span> <span class="n">chembl</span><span class="o">.</span><span class="n">Chembl</span><span class="p">(</span><span class="n">chembl_mysql</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span><span class="n">mapper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">crit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sub</span><span class="p">(</span><span class="n">crit</span><span class="o">=</span><span class="n">crit</span><span class="p">,</span><span class="n">andor</span><span class="o">=</span><span class="n">andor</span><span class="p">)</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="n">sub</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span>
        <span class="n">uniprots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;nameType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">:</span>
                <span class="n">uniprots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chembl</span><span class="o">.</span><span class="n">compounds_targets</span><span class="p">(</span><span class="n">uniprots</span><span class="p">,</span><span class="n">assay_types</span><span class="o">=</span><span class="n">assay_types</span><span class="p">,</span>
                            <span class="n">relationship_types</span><span class="o">=</span><span class="n">relationship_types</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chembl</span><span class="o">.</span><span class="n">compounds_by_target</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;compounds_chembl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;compounds_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;compounds_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chembl</span><span class="o">.</span><span class="n">compounds</span><span class="p">)</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">num</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Adding compounds&#39;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">hascomp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">target</span><span class="p">,</span><span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chembl</span><span class="o">.</span><span class="n">compounds</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                <span class="n">hascomp</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">target</span><span class="p">)]</span>
                <span class="n">node</span><span class="p">[</span><span class="s1">&#39;compounds_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">node</span><span class="p">[</span><span class="s1">&#39;compounds_chembl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="s1">&#39;chembl&#39;</span><span class="p">])</span>
                    <span class="n">node</span><span class="p">[</span><span class="s1">&#39;compounds_names&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">comp</span><span class="p">[</span><span class="s1">&#39;compound_names&#39;</span><span class="p">]</span>
                <span class="n">node</span><span class="p">[</span><span class="s1">&#39;compounds_chembl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;compounds_chembl&#39;</span><span class="p">])</span>
                <span class="n">node</span><span class="p">[</span><span class="s1">&#39;compounds_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;compounds_names&#39;</span><span class="p">])</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">percent</span> <span class="o">=</span> <span class="n">hascomp</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Compounds found for </span><span class="si">%u</span><span class="s1"> targets, (</span><span class="si">%.2f%%</span><span class="s1"> of all proteins).</span><span class="se">\n\n</span><span class="s1">&#39;</span>\
            <span class="o">%</span> <span class="p">(</span><span class="n">hascomp</span><span class="p">,</span><span class="n">percent</span><span class="o">*</span><span class="mf">100.0</span><span class="p">))</span>
    
<div class="viewcode-block" id="PyPath.network_filter"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.network_filter">[docs]</a>    <span class="k">def</span> <span class="nf">network_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function aims to cut the number of edges in the network, </span>
<span class="sd">        without loosing nodes, to make the network less connected, </span>
<span class="sd">        less hairball-like, more usable for analysis.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ref_freq</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">]:</span>
                            <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="n">avdeg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span><span class="s1">&#39;Calculating scores&#39;</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">rs</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">:</span>
                    <span class="n">score</span> <span class="o">+=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r</span><span class="p">]</span>
            <span class="n">mindeg</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">degree</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">degree</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">mindeg</span> <span class="o">&lt;</span> <span class="n">avdeg</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">*=</span> <span class="nb">pow</span><span class="p">((</span><span class="n">mindeg</span> <span class="o">-</span> <span class="n">avdeg</span><span class="p">),</span><span class="n">p</span><span class="p">)</span>
            <span class="n">e</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="PyPath.shortest_path_dist"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.shortest_path_dist">[docs]</a>    <span class="k">def</span> <span class="nf">shortest_path_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">subset</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">outfile</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        subset is a tuple of two lists if you wish to look for</span>
<span class="sd">        paths between elements of two groups, or a list if you </span>
<span class="sd">        wish to look for shortest paths within this group</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">shortest_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="ow">or</span> <span class="n">subset</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">subset</span><span class="p">,</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span><span class="s1">&#39;Calculating paths&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">subset</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">paths</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_shortest_paths</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">subset</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> \
                                            <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">shortest_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shortest_paths</span><span class="p">])</span>
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">shortest_paths</span></div>
    
    <span class="k">def</span> <span class="nf">load_pdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">u_pdb</span><span class="p">,</span><span class="n">pdb_u</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pdb</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">u_pdb</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Failed to download UniProt-PDB dictionary&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;pdb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="s1">&#39;pdb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">u_pdb</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pdb</span> <span class="ow">in</span> <span class="n">u_pdb</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]:</span>
                        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;pdb&#39;</span><span class="p">][</span><span class="n">pdb</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pdb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pdb</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;PDB IDs for proteins has been retrieved.&#39;</span><span class="p">,</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_pfam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">u_pfam</span><span class="p">,</span> <span class="n">pfam_u</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pfam</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">u_pfam</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Failed to download Pfam data from UniProt&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="s1">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">u_pfam</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">u_pfam</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Pfam domains has been retrieved.&#39;</span><span class="p">,</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_pfam2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfam_regions</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Failed to download data from Pfam&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Pfam domains has been retrieved.&#39;</span><span class="p">,</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_pfam3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfam_regions</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Failed to download data from Pfam&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;doms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pfam</span><span class="p">,</span> <span class="n">regions</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
                            <span class="n">v</span><span class="p">[</span><span class="s1">&#39;doms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> 
                                <span class="n">domain</span> <span class="o">=</span> <span class="n">pfam</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span> 
                                <span class="n">end</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;isoform&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Pfam domains has been retrieved.&#39;</span><span class="p">,</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_corum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">complexes</span><span class="p">,</span><span class="n">members</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_corum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">complexes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Failed to download data from CORUM&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_complex_attr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="s1">&#39;corum&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">cs</span> <span class="ow">in</span> <span class="n">members</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">sw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="s1">&#39;uniprot&#39;</span><span class="p">,</span><span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sw</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cs</span><span class="p">:</span>
                            <span class="n">others</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">memb</span> <span class="ow">in</span> <span class="n">complexes</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]:</span>
                                <span class="n">others</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">memb</span><span class="p">,</span><span class="s1">&#39;uniprot&#39;</span><span class="p">,</span><span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;corum&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s1">&#39;full_name&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="s1">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">others</span><span class="p">,</span>
                                <span class="s1">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">complexes</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                                <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                <span class="s1">&#39;functions&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                <span class="s1">&#39;diseases&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Complexes from CORUM have been retrieved.&#39;</span><span class="p">,</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">init_complex_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;complexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]:</span>
                <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">load_havugimana</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">complexes</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">read_complexes_havugimana</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">complexes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Failed to read data from Havugimana&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_complex_attr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="s1">&#39;havugimana&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">complexes</span><span class="p">:</span>
                <span class="n">membs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">memb</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">membs</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">memb</span><span class="p">,</span><span class="s1">&#39;uniprot&#39;</span><span class="p">,</span><span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">membs</span><span class="p">:</span>
                    <span class="n">names</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="s1">&#39;uniprot&#39;</span><span class="p">,</span><span class="s1">&#39;genesymbol&#39;</span><span class="p">)</span>
                <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
                <span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">membs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">u</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;havugimana&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;full_name&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; complex&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">membs</span><span class="p">,</span>
                            <span class="s1">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">c</span>
                        <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Complexes from Havugimana have been retrieved.&#39;</span><span class="p">,</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_compleat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">complexes</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_compleat</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">complexes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Failed to load data from COMPLEAT&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_complex_attr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="s1">&#39;compleat&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">complexes</span><span class="p">:</span>
                <span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">c</span><span class="p">[</span><span class="s1">&#39;gsymbols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;entrez&#39;</span><span class="p">]:</span>
                    <span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="s1">&#39;entrez&#39;</span><span class="p">,</span><span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">]:</span>
                    <span class="n">c</span><span class="p">[</span><span class="s1">&#39;gsymbols&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="s1">&#39;uniprot&#39;</span><span class="p">,</span><span class="s1">&#39;genesymbol&#39;</span><span class="p">)</span>
                <span class="n">c</span><span class="p">[</span><span class="s1">&#39;gsymbols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">gs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">gs</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;gsymbols&#39;</span><span class="p">]]))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;gsymbols&#39;</span><span class="p">])</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">u</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;compleat&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;full_name&#39;</span><span class="p">:</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; complex&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;entrez&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;pubmeds&#39;</span><span class="p">]</span>
                        <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Complexes from COMPLEAT have been retrieved.&#39;</span><span class="p">,</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_complexportal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="c1">## TODO: handling species</span>
        <span class="n">complexes</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_complexportal</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">complexes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Failed to read data from Havugimana&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;complexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="s1">&#39;complexportal&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;complexportal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">complexes</span><span class="p">:</span>
                <span class="n">swprots</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="s1">&#39;complex recommended name&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">][</span><span class="s1">&#39;complex recommended name&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">]:</span>
                    <span class="n">swprots</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="s1">&#39;uniprot&#39;</span><span class="p">,</span><span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="n">swprots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">swprots</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">sw</span> <span class="ow">in</span> <span class="n">swprots</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sw</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">sw</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;complexportal&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;full_name&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">swprots</span><span class="p">,</span>
                            <span class="s1">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;pdbs&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;pdbs&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;pubmeds&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;synonyms&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>
                        <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Complexes from Complex Portal have been retrieved.&#39;</span><span class="p">,</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_3dcomplexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">c3d</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_3dcomplexes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">c3d</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Failed to download data from 3DComplexes and PDB&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;complexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="s1">&#39;3dcomplexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;3dcomplexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s1">&#39;3dstructure&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;3dstructure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;3dstructure&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;3dstructure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="s1">&#39;3dcomplexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;3dstructure&#39;</span><span class="p">]:</span>
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;3dstructure&#39;</span><span class="p">][</span><span class="s1">&#39;3dcomplexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">compl_names</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">compl_membs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">compl_links</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c3d</span><span class="p">),</span><span class="s1">&#39;Processing complexes&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cname</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">c3d</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">swprots</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">uprots</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ups</span><span class="p">,</span><span class="n">contact</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">uprots</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ups</span><span class="p">)</span>
                    <span class="n">up1s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">ups</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;uniprot&#39;</span><span class="p">,</span><span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">up1</span> <span class="ow">in</span> <span class="n">up1s</span><span class="p">:</span>
                        <span class="n">inRefLists</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">for</span> <span class="n">tax</span><span class="p">,</span><span class="n">lst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">up1</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">lst</span><span class="p">:</span>
                                <span class="n">up2s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">ups</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;uniprot&#39;</span><span class="p">,</span><span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">up2</span> <span class="ow">in</span> <span class="n">up2s</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">tax</span><span class="p">,</span><span class="n">lst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                        <span class="k">if</span> <span class="n">up2</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">lst</span><span class="p">:</span>
                                            <span class="n">inRefLists</span> <span class="o">=</span> <span class="bp">True</span>
                                            <span class="n">thisPair</span> <span class="o">=</span> <span class="p">[</span><span class="n">up1</span><span class="p">,</span><span class="n">up2</span><span class="p">]</span>
                                            <span class="n">thisPair</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                                            <span class="n">swprots</span> <span class="o">+=</span> <span class="n">thisPair</span>
                                            <span class="n">compl_links</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
                                                <span class="n">thisPair</span><span class="p">,</span>
                                                <span class="n">contact</span><span class="p">,</span>
                                                <span class="n">cname</span>
                                                <span class="p">))</span>
                                            <span class="k">break</span>
                <span class="n">swprots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">swprots</span><span class="p">))</span>
                <span class="n">uprots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">uprots</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">swprots</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">swprots</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span><span class="s1">&#39;uniprot&#39;</span><span class="p">,</span><span class="s1">&#39;genesymbol&#39;</span><span class="p">)</span>
                    <span class="n">compl_names</span><span class="p">[</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; complex&#39;</span>
                    <span class="n">compl_membs</span><span class="p">[</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">swprots</span><span class="p">,</span><span class="n">uprots</span><span class="p">)</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">compl_membs</span><span class="p">),</span><span class="s1">&#39;Processing nodes&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cname</span><span class="p">,</span><span class="n">uniprots</span> <span class="ow">in</span> <span class="n">compl_membs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">sp</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;3dcomplexes&#39;</span><span class="p">][</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;full_name&#39;</span><span class="p">:</span> <span class="n">compl_names</span><span class="p">[</span><span class="n">cname</span><span class="p">],</span>
                            <span class="s1">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s1">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">}</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">compl_links</span><span class="p">),</span><span class="s1">&#39;Processing edges&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">links</span> <span class="ow">in</span> <span class="n">compl_links</span><span class="p">:</span>
                <span class="n">one</span> <span class="o">=</span> <span class="n">links</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">two</span> <span class="o">=</span> <span class="n">links</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">two</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                    <span class="n">nodeOne</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">one</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                    <span class="n">nodeTwo</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">two</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">edge</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">_between</span><span class="o">=</span><span class="p">((</span><span class="n">nodeOne</span><span class="p">,),(</span><span class="n">nodeTwo</span><span class="p">,)))[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;3dstructure&#39;</span><span class="p">][</span><span class="s1">&#39;3dcomplexes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;pdb&#39;</span><span class="p">:</span> <span class="n">links</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s1">&#39;numof_residues&#39;</span><span class="p">:</span> <span class="n">links</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="p">})</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_pisa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="s1">&#39;complexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span> \
            <span class="ow">or</span> <span class="s1">&#39;3dcomplexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_3dcomplexes</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;complexportal&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_complexportal</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="n">pdblist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;3dcomplexes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">pdblist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="s1">&#39;complexportal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">pdblist</span> <span class="o">+=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pdbs&#39;</span><span class="p">]</span>
        <span class="n">pdblist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">pdblist</span><span class="p">))</span>
        <span class="n">pisa</span><span class="p">,</span> <span class="n">unmapped</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pisa</span><span class="p">(</span><span class="n">pdblist</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;interfaces&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s1">&#39;pisa&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]:</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">][</span><span class="s1">&#39;pisa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pdb</span><span class="p">,</span><span class="n">iflist</span> <span class="ow">in</span> <span class="n">pisa</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">uniprots</span><span class="p">,</span><span class="n">intf</span> <span class="ow">in</span> <span class="n">iflist</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">pdb</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;interfaces&#39;</span><span class="p">][</span><span class="s1">&#39;pisa&#39;</span><span class="p">]:</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;interfaces&#39;</span><span class="p">][</span><span class="s1">&#39;pisa&#39;</span><span class="p">][</span><span class="n">pdb</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;interfaces&#39;</span><span class="p">][</span><span class="s1">&#39;pisa&#39;</span><span class="p">][</span><span class="n">pdb</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unmapped</span>
    
    <span class="c1">#</span>
    <span class="c1"># methods with biological meaning</span>
    <span class="c1">#</span>
    
<div class="viewcode-block" id="PyPath.genesymbol"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.genesymbol">[docs]</a>    <span class="k">def</span> <span class="nf">genesymbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns ``igraph.Vertex()`` object if the GeneSymbol</span>
<span class="sd">        can be found in the default undirected network, </span>
<span class="sd">        otherwise ``None``.</span>
<span class="sd">        </span>
<span class="sd">        @genesymbol : str</span>
<span class="sd">            GeneSymbol.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_undirected</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labDct</span> <span class="k">else</span> <span class="bp">None</span></div>
    
    <span class="n">gs</span> <span class="o">=</span> <span class="n">genesymbol</span>
    
<div class="viewcode-block" id="PyPath.dgenesymbol"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.dgenesymbol">[docs]</a>    <span class="k">def</span> <span class="nf">dgenesymbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns ``igraph.Vertex()`` object if the GeneSymbol</span>
<span class="sd">        can be found in the default directed network, </span>
<span class="sd">        otherwise ``None``.</span>
<span class="sd">        </span>
<span class="sd">        @genesymbol : str</span>
<span class="sd">            GeneSymbol.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="k">else</span> <span class="bp">None</span></div>
    
    <span class="n">dgs</span> <span class="o">=</span> <span class="n">dgenesymbol</span>
    
    <span class="k">def</span> <span class="nf">genesymbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbols</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> 
            <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">genesymbol</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span> <span class="k">for</span> <span class="n">gs</span> <span class="ow">in</span> <span class="n">genesymbols</span><span class="p">))</span>
    
    <span class="n">gss</span> <span class="o">=</span> <span class="n">genesymbols</span>
    
    <span class="k">def</span> <span class="nf">dgenesymbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbols</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> 
            <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dgenesymbol</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span> <span class="k">for</span> <span class="n">gs</span> <span class="ow">in</span> <span class="n">genesymbols</span><span class="p">))</span>
    
    <span class="n">dgss</span> <span class="o">=</span> <span class="n">dgenesymbols</span>
    
<div class="viewcode-block" id="PyPath.uniprot"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.uniprot">[docs]</a>    <span class="k">def</span> <span class="nf">uniprot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns ``igraph.Vertex()`` object if the UniProt</span>
<span class="sd">        can be found in the default undirected network, </span>
<span class="sd">        otherwise ``None``.</span>
<span class="sd">        </span>
<span class="sd">        @uniprot : str</span>
<span class="sd">            UniProt ID.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_undirected</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span> <span class="k">else</span> <span class="bp">None</span></div>
    
    <span class="n">up</span> <span class="o">=</span> <span class="n">uniprot</span>
    
<div class="viewcode-block" id="PyPath.duniprot"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.duniprot">[docs]</a>    <span class="k">def</span> <span class="nf">duniprot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Same as ``PyPath.uniprot(), just for directed graph.</span>
<span class="sd">        Returns ``igraph.Vertex()`` object if the UniProt</span>
<span class="sd">        can be found in the default directed network, </span>
<span class="sd">        otherwise ``None``.</span>
<span class="sd">        </span>
<span class="sd">        @uniprot : str</span>
<span class="sd">            UniProt ID.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span> <span class="k">else</span> <span class="bp">None</span></div>
    
    <span class="n">dup</span> <span class="o">=</span> <span class="n">duniprot</span>
    
<div class="viewcode-block" id="PyPath.uniprots"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.uniprots">[docs]</a>    <span class="k">def</span> <span class="nf">uniprots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprots</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns list of ``igraph.Vertex()`` object</span>
<span class="sd">        for a list of UniProt IDs omitting those</span>
<span class="sd">        could not be found in the default</span>
<span class="sd">        undirected graph.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> 
            <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uniprot</span><span class="p">(</span><span class="n">up</span><span class="p">)</span> <span class="k">for</span> <span class="n">up</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">))</span></div>
    
    <span class="n">ups</span> <span class="o">=</span> <span class="n">uniprots</span>
    
<div class="viewcode-block" id="PyPath.duniprots"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.duniprots">[docs]</a>    <span class="k">def</span> <span class="nf">duniprots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprots</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns list of ``igraph.Vertex()`` object</span>
<span class="sd">        for a list of UniProt IDs omitting those</span>
<span class="sd">        could not be found in the default</span>
<span class="sd">        directed graph.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> 
            <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duniprot</span><span class="p">(</span><span class="n">up</span><span class="p">)</span> <span class="k">for</span> <span class="n">up</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">))</span></div>
    
    <span class="n">dups</span> <span class="o">=</span> <span class="n">duniprots</span>
    
<div class="viewcode-block" id="PyPath.protein"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.protein">[docs]</a>    <span class="k">def</span> <span class="nf">protein</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns ``igraph.Vertex()`` object if the identifier</span>
<span class="sd">        is a valid vertex index in the default undirected graph,</span>
<span class="sd">        or a UniProt ID or GeneSymbol which can be found in the</span>
<span class="sd">        default undirected network, otherwise ``None``.</span>
<span class="sd">        </span>
<span class="sd">        @identifier : int, str</span>
<span class="sd">            Vertex index (int) or GeneSymbol (str) or UniProt ID (str).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_undirected</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> \
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">and</span> <span class="n">identifier</span> <span class="o">&lt;</span> <span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> \
            <span class="k">else</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">identifier</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span> <span class="k">else</span> \
            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labDct</span><span class="p">[</span><span class="n">identifier</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labDct</span> <span class="k">else</span> <span class="bp">None</span></div>
    
    <span class="n">p</span> <span class="o">=</span> <span class="n">protein</span>
    
<div class="viewcode-block" id="PyPath.dprotein"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.dprotein">[docs]</a>    <span class="k">def</span> <span class="nf">dprotein</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Same as ``PyPath.protein``, just for the directed graph.</span>
<span class="sd">        Returns ``igraph.Vertex()`` object if the identifier</span>
<span class="sd">        is a valid vertex index in the default directed graph,</span>
<span class="sd">        or a UniProt ID or GeneSymbol which can be found in the</span>
<span class="sd">        default directed network, otherwise ``None``.</span>
<span class="sd">        </span>
<span class="sd">        @identifier : int, str</span>
<span class="sd">            Vertex index (int) or GeneSymbol (str) or UniProt ID (str).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> \
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">and</span> <span class="n">identifier</span> <span class="o">&lt;</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> \
            <span class="k">else</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">[</span><span class="n">identifier</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span> <span class="k">else</span> \
            <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span><span class="p">[</span><span class="n">identifier</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="k">else</span> <span class="bp">None</span></div>
    
    <span class="n">dp</span> <span class="o">=</span> <span class="n">dprotein</span>
    
    <span class="k">def</span> <span class="nf">proteins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proteins</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> 
            <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protein</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">proteins</span><span class="p">))</span>
    
    <span class="n">ps</span> <span class="o">=</span> <span class="n">proteins</span>
    
    <span class="k">def</span> <span class="nf">dproteins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proteins</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> 
            <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dprotein</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">proteins</span><span class="p">))</span>
    
    <span class="n">dps</span> <span class="o">=</span> <span class="n">dproteins</span>
    
<div class="viewcode-block" id="PyPath.up_edge"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.up_edge">[docs]</a>    <span class="k">def</span> <span class="nf">up_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">directed</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns ``igraph.Edge`` object if an edge exist between</span>
<span class="sd">        the 2 proteins, otherwise ``None``.</span>
<span class="sd">        </span>
<span class="sd">        @source : str</span>
<span class="sd">            UniProt ID</span>
<span class="sd">        @target : str</span>
<span class="sd">            UniProt ID</span>
<span class="sd">        @directed : bool</span>
<span class="sd">            To be passed to igraph.Graph.get_eid()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">v_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniprot</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">v_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniprot</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">v_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">eid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">v_source</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">v_target</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                <span class="n">directed</span> <span class="o">=</span> <span class="n">directed</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">eid</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">None</span></div>
    
<div class="viewcode-block" id="PyPath.gs_edge"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.gs_edge">[docs]</a>    <span class="k">def</span> <span class="nf">gs_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">directed</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns ``igraph.Edge`` object if an edge exist between</span>
<span class="sd">        the 2 proteins, otherwise ``None``.</span>
<span class="sd">        </span>
<span class="sd">        @source : str</span>
<span class="sd">            GeneSymbol</span>
<span class="sd">        @target : str</span>
<span class="sd">            GeneSymbol</span>
<span class="sd">        @directed : bool</span>
<span class="sd">            To be passed to igraph.Graph.get_eid()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">v_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">v_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">v_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">eid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">v_source</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">v_target</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                <span class="n">directed</span> <span class="o">=</span> <span class="n">directed</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">eid</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">None</span></div>
    
<div class="viewcode-block" id="PyPath.protein_edge"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.protein_edge">[docs]</a>    <span class="k">def</span> <span class="nf">protein_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">directed</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns ``igraph.Edge`` object if an edge exist between</span>
<span class="sd">        the 2 proteins, otherwise ``None``.</span>
<span class="sd">        </span>
<span class="sd">        @source : int, str</span>
<span class="sd">            Vertex index or UniProt ID or GeneSymbol</span>
<span class="sd">        @target : int, str</span>
<span class="sd">            Vertex index or UniProt ID or GeneSymbol</span>
<span class="sd">        @directed : bool</span>
<span class="sd">            To be passed to igraph.Graph.get_eid()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">v_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">v_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">v_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">eid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">v_source</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">v_target</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                <span class="n">directed</span> <span class="o">=</span> <span class="n">directed</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">eid</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">None</span></div>
    
    <span class="k">def</span> <span class="nf">_has_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_directed</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_already_has_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span>
    
    <span class="k">def</span> <span class="nf">_get_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the directed instance of the graph.</span>
<span class="sd">        If not available, creates one at ``PyPath.dgraph``.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_directed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span>
    
    <span class="c1"># conversion between directed and undirected vertices</span>
    
    <span class="k">def</span> <span class="nf">_get_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span>
    
    <span class="k">def</span> <span class="nf">up_in_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_directed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span> <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span> <span class="k">else</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">up_in_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_undirected</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span> <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span> <span class="k">else</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">gs_in_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_directed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]</span> <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="k">else</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">gs_in_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_undirected</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">labDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]</span> <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labDct</span> <span class="k">else</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">in_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_in_directed</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">in_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_in_undirected</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
    
    <span class="c1"># affects and affected_by</span>
    
    <span class="k">def</span> <span class="nf">_affected_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dgraph</span> <span class="o">!=</span> <span class="n">vertex</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
            <span class="n">vertex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_directed</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="n">vertex</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;IN&#39;</span><span class="p">)</span> \
            <span class="k">if</span> <span class="n">vertex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_affects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dgraph</span> <span class="o">!=</span> <span class="n">vertex</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
            <span class="n">vertex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_directed</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="n">vertex</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;OUT&#39;</span><span class="p">)</span> \
            <span class="k">if</span> <span class="n">vertex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">affected_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dprotein</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_affected_by</span><span class="p">(</span><span class="n">vrtx</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">affects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dprotein</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_affects</span><span class="p">(</span><span class="n">vrtx</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">up_affects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duniprot</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_affects</span><span class="p">(</span><span class="n">vrtx</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">up_affected_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duniprot</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_affected_by</span><span class="p">(</span><span class="n">vrtx</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">gs_affects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgenesymbol</span><span class="p">(</span><span class="n">genesymbol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_affects</span><span class="p">(</span><span class="n">vrtx</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">gs_affected_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dgenesymbol</span><span class="p">(</span><span class="n">genesymbol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_affected_by</span><span class="p">(</span><span class="n">vrtx</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">up_stimulated_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">:</span>
            <span class="n">vid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_affected_by</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> \
                <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dgraph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">vid</span><span class="p">)]</span>\
                    <span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">uniprot</span><span class="p">],</span> 
                <span class="n">vs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">up_inhibited_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">:</span>
            <span class="n">vid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_affected_by</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> \
                <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dgraph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">vid</span><span class="p">)]</span>\
                    <span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">uniprot</span><span class="p">],</span> 
                <span class="n">vs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">up_stimulates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">:</span>
            <span class="n">vid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_affects</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> \
                <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dgraph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>\
                    <span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">uniprot</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]],</span> 
                <span class="n">vs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">up_inhibits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">:</span>
            <span class="n">vid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_affects</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> \
                <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dgraph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>\
                    <span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">uniprot</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]],</span> 
                <span class="n">vs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodLab</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">gs_stimulated_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="n">uniprot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_stimulated_by</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">gs_stimulates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="n">uniprot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_stimulates</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">gs_inhibited_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="n">uniprot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_inhibited_by</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">gs_inhibits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbol</span><span class="p">):</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_directed</span><span class="p">()</span>
        <span class="n">uniprot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnodNam</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span><span class="p">[</span><span class="n">genesymbol</span><span class="p">]]</span> \
            <span class="k">if</span> <span class="n">genesymbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabDct</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">up_inhibits</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
    
    <span class="c1"># meighbors variations</span>
    
    <span class="k">def</span> <span class="nf">up_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniprot</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span><span class="n">vrtx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">),</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labDct</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">gs_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniprot</span><span class="p">(</span><span class="n">uniprot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span><span class="n">vrtx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">),</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labDct</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="n">vrtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vrtx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span><span class="n">vrtx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">),</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labDct</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span>
    
    <span class="c1"># neighborhood variations:</span>
    
    <span class="k">def</span> <span class="nf">_neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_NamedVertexSeq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">neighborhood</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> 
                <span class="n">order</span> <span class="o">=</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">),</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">nodNam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodLab</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">up_neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">uniprots</span><span class="p">)</span> <span class="ow">in</span> <span class="n">simpleTypes</span><span class="p">:</span>
            <span class="n">uniprots</span> <span class="o">=</span> <span class="p">[</span><span class="n">uniprots</span><span class="p">]</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniprots</span><span class="p">(</span><span class="n">uniprots</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighborhood</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">gs_neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genesymbols</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">genesymbols</span><span class="p">)</span> <span class="ow">in</span> <span class="n">simpleTypes</span><span class="p">:</span>
            <span class="n">genesymbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">genesymbols</span><span class="p">]</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genesymbols</span><span class="p">(</span><span class="n">genesymbols</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighborhood</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifiers</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span> <span class="ow">in</span> <span class="n">simpleTypes</span><span class="p">:</span>
            <span class="n">identifiers</span> <span class="o">=</span> <span class="p">[</span><span class="n">identifiers</span><span class="p">]</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteins</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighborhood</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">)</span>
    
    <span class="c1"># compexes</span>
    
    <span class="k">def</span> <span class="nf">complex_comembership_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">resources</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="n">resources</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">cnet</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="n">cdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">src</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cdict</span><span class="p">:</span>
                    <span class="n">cdict</span><span class="p">[</span><span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">cname</span><span class="p">,</span><span class="n">cannot</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="n">src</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">cname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cdict</span><span class="p">[</span><span class="n">src</span><span class="p">]:</span>
                            <span class="n">cdict</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">cdict</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="n">cname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">pass</span>
    
<div class="viewcode-block" id="PyPath.edges_in_comlexes"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.edges_in_comlexes">[docs]</a>    <span class="k">def</span> <span class="nf">edges_in_comlexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csources</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;corum&#39;</span><span class="p">],</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates edge attributes ``complexes`` and ``in_complex``.</span>
<span class="sd">        These are both dicts where the keys are complex resources.</span>
<span class="sd">        The values in ``complexes`` are the list of complex names</span>
<span class="sd">        both the source and the target vertices belong to.</span>
<span class="sd">        The values ``in_complex`` are boolean values whether there</span>
<span class="sd">        is at least one complex in the given resources both the</span>
<span class="sd">        source and the target vertex of the edge belong to.</span>
<span class="sd">        </span>
<span class="sd">        @csources : list</span>
<span class="sd">            List of complex resources. Should be already loaded.</span>
<span class="sd">        @graph : igraph.Graph()</span>
<span class="sd">            The graph object to do the calculations on.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="s1">&#39;complexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;in_complex&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;in_complex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">_common_complexes</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="n">cs</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> \
                <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="n">cs</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">nul</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cs</span><span class="p">:</span> \
            <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> \
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">_common_complexes</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">cs</span><span class="p">)),</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">),</span>
            <span class="n">csources</span><span class="p">)</span>
        <span class="n">nul</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cs</span><span class="p">:</span> \
            <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> \
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;in_complex&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;complexes&#39;</span><span class="p">][</span><span class="n">cs</span><span class="p">]))),</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">),</span>
            <span class="n">csources</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="PyPath.sum_in_complex"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.sum_in_complex">[docs]</a>    <span class="k">def</span> <span class="nf">sum_in_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csources</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;corum&#39;</span><span class="p">],</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the total number of edges in the network falling</span>
<span class="sd">        between two members of the same complex.</span>
<span class="sd">        Returns as a dict by complex resources.</span>
<span class="sd">        Calls :py:func:pypath.pypath.Pypath.edges_in_comlexes()</span>
<span class="sd">        to do the calculations.</span>
<span class="sd">        </span>
<span class="sd">        @csources : list</span>
<span class="sd">            List of complex resources. Should be already loaded.</span>
<span class="sd">        @graph : igraph.Graph()</span>
<span class="sd">            The graph object to do the calculations on.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges_in_comlexes</span><span class="p">(</span><span class="n">csources</span> <span class="o">=</span> <span class="n">csources</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cs</span><span class="p">:</span> 
            <span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> 
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;in_complex&#39;</span><span class="p">][</span><span class="n">cs</span><span class="p">],</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">)</span>
            <span class="p">)),</span> 
            <span class="n">csources</span><span class="p">)</span>
        <span class="p">)</span></div>
    
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    
    <span class="k">def</span> <span class="nf">get_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">fun</span>
        <span class="n">fun</span> <span class="o">=</span> <span class="n">fun</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">fun0</span> <span class="o">=</span> <span class="n">fun</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">toCall</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">fun0</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">fun0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">fun0</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">fun0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">fun0</span> <span class="o">==</span> <span class="n">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="n">__main__</span>
        <span class="k">elif</span> <span class="n">fun0</span> <span class="o">==</span> <span class="s1">&#39;self&#39;</span> <span class="ow">or</span> <span class="n">fun0</span> <span class="o">==</span> <span class="n">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">elif</span> <span class="n">fun0</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subm</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="n">subm</span><span class="p">],</span> <span class="s1">&#39;__name__&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="nb">globals</span><span class="p">()[</span><span class="n">subm</span><span class="p">]</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="n">subm</span><span class="p">],</span> <span class="n">fun0</span><span class="p">):</span>
                        <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="n">subm</span><span class="p">],</span> <span class="n">fun0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">toCall</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">fun0</span> <span class="ow">in</span> <span class="n">fun</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="n">fun0</span><span class="p">):</span>
                <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="n">fun0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">toCall</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">edges_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dataio.get_instruct&#39;</span><span class="p">,</span> <span class="s1">&#39;dataio.get_i3d&#39;</span><span class="p">]):</span>
        <span class="n">all_3d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">all_3d</span> <span class="o">+=</span> <span class="n">fun</span><span class="p">()</span>
        <span class="c1"># initializing edge attributes:</span>
        <span class="k">if</span> <span class="s1">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># assigning annotations:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_3d</span><span class="p">:</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">u1</span> <span class="o">!=</span> <span class="n">u2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u2</span><span class="p">):</span>
                    <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">seq1</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="n">u1</span><span class="p">][</span><span class="s1">&#39;seq&#39;</span><span class="p">]:</span>
                            <span class="k">for</span> <span class="n">seq2</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="n">u2</span><span class="p">][</span><span class="s1">&#39;seq&#39;</span><span class="p">]:</span>
                                <span class="n">dom1</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">u1</span><span class="p">,</span> 
                                    <span class="n">domain</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">u1</span><span class="p">][</span><span class="s1">&#39;pfam&#39;</span><span class="p">],</span> 
                                    <span class="n">start</span> <span class="o">=</span> <span class="n">seq1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                    <span class="n">end</span> <span class="o">=</span> <span class="n">seq1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                    <span class="n">chains</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;pdb&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="n">i</span><span class="p">[</span><span class="n">u1</span><span class="p">][</span><span class="s1">&#39;chain&#39;</span><span class="p">]})</span>
                                <span class="n">dom2</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">u2</span><span class="p">,</span> 
                                    <span class="n">domain</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">u2</span><span class="p">][</span><span class="s1">&#39;pfam&#39;</span><span class="p">],</span> 
                                    <span class="n">start</span> <span class="o">=</span> <span class="n">seq2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">end</span> <span class="o">=</span> <span class="n">seq2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">chains</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;pdb&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="n">i</span><span class="p">[</span><span class="n">u2</span><span class="p">][</span><span class="s1">&#39;chain&#39;</span><span class="p">]})</span>
                                <span class="n">domdom</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">DomainDomain</span><span class="p">(</span><span class="n">dom1</span><span class="p">,</span> <span class="n">dom2</span><span class="p">,</span> 
                                    <span class="n">refs</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">],</span> 
                                    <span class="n">sources</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">],</span> <span class="n">pdbs</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;pdb&#39;</span><span class="p">])</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">domdom</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">edges_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfam_regions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pepcyber</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_psite_reg</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_ielm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_phosphoelm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_elm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_3did_dmi</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">pfam_regions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pfam_regions</span><span class="p">(</span>
                <span class="n">uniprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> 
                <span class="n">dicts</span> <span class="o">=</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span>
                <span class="n">keepfile</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">complexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;3dcomplexes&#39;</span><span class="p">,</span> <span class="s1">&#39;havugimana&#39;</span><span class="p">,</span> <span class="s1">&#39;corum&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;complexportal&#39;</span><span class="p">,</span><span class="s1">&#39;compleat&#39;</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s1">&#39;load_&#39;</span> <span class="o">+</span> <span class="n">m</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
                <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
                    <span class="n">toCall</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_domino_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organism</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">organism</span> <span class="o">=</span> <span class="n">organism</span> <span class="k">if</span> <span class="n">organism</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span>
        <span class="c1">#all_unip = dataio.all_uniprots(organism)</span>
        <span class="n">domi</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_domino_ptms</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">domi</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                <span class="s1">&#39;Failed to load domain-motif interaction data from DOMINO&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">domi</span><span class="p">[</span><span class="s1">&#39;dmi&#39;</span><span class="p">]),</span> <span class="s1">&#39;Loading domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dm</span> <span class="ow">in</span> <span class="n">domi</span><span class="p">[</span><span class="s1">&#39;dmi&#39;</span><span class="p">]:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">uniprot1</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">protein</span>
            <span class="n">uniprot2</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot2</span><span class="p">):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">,</span> <span class="n">uniprot2</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_3did_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dmi</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">process_3did_dmi</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dmi</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                <span class="s1">&#39;Failed to load domain-motif interaction data from 3DID&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dmi</span><span class="p">),</span> <span class="s1">&#39;Loading domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">uniprots</span><span class="p">,</span> <span class="n">dmi_list</span> <span class="ow">in</span> <span class="n">dmi</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dmi_list</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
<div class="viewcode-block" id="PyPath.load_ddi"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.load_ddi">[docs]</a>    <span class="k">def</span> <span class="nf">load_ddi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ddi</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        ddi is either a list of intera.DomainDomain objects, </span>
<span class="sd">        or a function resulting this list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ddi</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ddi</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">ddi</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ddi</span><span class="o">.</span><span class="n">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;dataio&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                    <span class="s1">&#39;Function </span><span class="si">%s</span><span class="s1">() failed&#39;</span><span class="o">%</span><span class="n">ddi</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s1">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;Loading domain-domain interactions&#39;</span><span class="p">,</span><span class="mi">99</span><span class="p">)</span>
        <span class="n">in_network</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">uniprot1</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">protein</span>
            <span class="n">uniprot2</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">protein</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot2</span><span class="p">):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">,</span> <span class="n">uniprot2</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ddi&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">in_network</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="PyPath.load_dmi"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.load_dmi">[docs]</a>    <span class="k">def</span> <span class="nf">load_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dmi</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        dmi is either a list of intera.DomainMotif objects, </span>
<span class="sd">        or a function resulting this list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">dmi</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dmi</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">dmi</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dmi</span><span class="o">.</span><span class="n">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;dataio&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                    <span class="s1">&#39;Function </span><span class="si">%s</span><span class="s1">() failed&#39;</span><span class="o">%</span><span class="n">dmi</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span></div>
    
    <span class="k">def</span> <span class="nf">run_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methods</span><span class="p">,</span> <span class="n">toCall</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">toCall</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">toCall</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
                    <span class="n">toCall</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fun</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_ddis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dataio.get_3dc_ddi&#39;</span><span class="p">,</span> <span class="s1">&#39;dataio.get_domino_ddi&#39;</span><span class="p">,</span>
            <span class="s1">&#39;self.load_3did_ddi2&#39;</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_batch</span><span class="p">(</span><span class="n">methods</span><span class="p">,</span> <span class="n">toCall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_ddi</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_dmis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
        <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;self.pfam_regions&#39;</span><span class="p">,</span>
        <span class="s1">&#39;self.load_depod_dmi&#39;</span><span class="p">,</span>
        <span class="s1">&#39;self.load_dbptm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;self.load_mimp_dmi&#39;</span><span class="p">,</span>
        <span class="s1">&#39;self.load_pnetworks_dmi&#39;</span><span class="p">,</span>
        <span class="s1">&#39;self.load_domino_dmi&#39;</span><span class="p">,</span>
        <span class="s1">&#39;self.load_pepcyber&#39;</span><span class="p">,</span>
        <span class="s1">&#39;self.load_psite_reg&#39;</span><span class="p">,</span>
        <span class="s1">&#39;self.load_psite_phos&#39;</span><span class="p">,</span>
        <span class="s1">&#39;self.load_ielm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;self.load_phosphoelm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;self.load_elm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;self.load_3did_dmi&#39;</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_batch</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniq_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phosphorylation_directions</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_3did_ddi2</span><span class="p">(</span><span class="n">ddi</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">unm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_pisa</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_3did_ddi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">ddi</span><span class="p">,</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_3did_ddi</span><span class="p">(</span><span class="n">residues</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ddi</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">interfaces</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                <span class="s1">&#39;Failed to load domain-domain interaction data from 3DID&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s1">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s1">&#39;3did&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">]:</span>
                <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ddi&#39;</span><span class="p">][</span><span class="s1">&#39;3did&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ddi</span><span class="p">),</span><span class="s1">&#39;Loading domain-domain interactions&#39;</span><span class="p">,</span><span class="mi">99</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">ddi</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">uniprot1</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">uniprot2</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">swprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">swissprots</span><span class="p">([</span><span class="n">uniprot1</span><span class="p">,</span><span class="n">uniprot2</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">swprot1</span> <span class="ow">in</span> <span class="n">swprots</span><span class="p">[</span><span class="n">uniprot1</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">swprot2</span> <span class="ow">in</span> <span class="n">swprots</span><span class="p">[</span><span class="n">uniprot2</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">swprot1</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">swprot2</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">swprot1</span><span class="p">,</span><span class="n">swprot2</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span><span class="n">structures</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                <span class="k">for</span> <span class="n">pdb</span><span class="p">,</span><span class="n">pdb_uniprot_pairs</span> <span class="ow">in</span> \
                                        <span class="n">structures</span><span class="p">[</span><span class="s1">&#39;pdbs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                    <span class="k">for</span> <span class="n">pdbuniprots</span> <span class="ow">in</span> <span class="n">pdb_uniprot_pairs</span><span class="p">:</span>
                                        <span class="n">pdbswprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">swissprots</span><span class="p">(</span><span class="n">pdbuniprots</span><span class="p">)</span>
                                        <span class="k">for</span> <span class="n">pdbswprot1</span> <span class="ow">in</span> <span class="n">pdbswprots</span><span class="p">[</span><span class="n">pdbuniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                                            <span class="k">for</span> <span class="n">pdbswprot2</span> <span class="ow">in</span> <span class="n">pdbswprots</span><span class="p">[</span><span class="n">pdbuniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
                                                <span class="n">this_ddi</span> <span class="o">=</span> <span class="p">{}</span>
                                                <span class="n">this_ddi</span><span class="p">[</span><span class="n">swprot1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                                    <span class="s1">&#39;pfam&#39;</span><span class="p">:</span> <span class="n">domains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                                <span class="p">}</span>
                                                <span class="n">this_ddi</span><span class="p">[</span><span class="n">swprot2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                                    <span class="s1">&#39;pfam&#39;</span><span class="p">:</span> <span class="n">domains</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                                <span class="p">}</span>
                                                <span class="n">this_ddi</span><span class="p">[</span><span class="s1">&#39;uniprots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">swprot1</span><span class="p">,</span><span class="n">swprot2</span><span class="p">]</span>
                                                <span class="n">this_ddi</span><span class="p">[</span><span class="s1">&#39;uniprots_original&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
                                                <span class="n">this_ddi</span><span class="p">[</span><span class="s1">&#39;pdb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                                    <span class="n">swprot1</span><span class="p">:</span> <span class="n">pdbswprot1</span><span class="p">,</span>
                                                    <span class="n">swprot2</span><span class="p">:</span> <span class="n">pdbswprot2</span><span class="p">,</span>
                                                    <span class="s1">&#39;pdb&#39;</span><span class="p">:</span> <span class="n">pdb</span>
                                                <span class="p">}</span>
                                                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ddi&#39;</span><span class="p">][</span><span class="s1">&#39;3did&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_ddi</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_3did_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_3did_ddi2</span><span class="p">(</span><span class="n">ddi</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_3did_ddi2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ddi</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">ddi</span><span class="p">,</span> <span class="n">intfs</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_3did</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ddi</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">interfaces</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                <span class="s1">&#39;Failed to load domain-domain interaction data from 3DID&#39;</span><span class="p">,</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="c1">#### ERROR</span>
        <span class="k">if</span> <span class="n">interfaces</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;interfaces&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">intf</span> <span class="ow">in</span> <span class="n">intfs</span><span class="p">:</span>
                <span class="n">uniprot1</span> <span class="o">=</span> <span class="n">intf</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">protein</span>
                <span class="n">uniprot2</span> <span class="o">=</span> <span class="n">intf</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">protein</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot2</span><span class="p">):</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">,</span> <span class="n">uniprot2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;interfaces&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ddi</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ddi</span>
    
    <span class="k">def</span> <span class="nf">load_ielm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">ppi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">ppi</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
        <span class="n">ielm</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_ielm</span><span class="p">(</span><span class="n">ppi</span><span class="p">)</span>
        <span class="n">elm</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_elm_classes</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ielm</span><span class="p">),</span> <span class="s1">&#39;Processing domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="n">noelm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ielm</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">elm</span><span class="p">:</span>
                        <span class="n">noelm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">motif</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">elm</span> <span class="k">else</span> <span class="n">elm</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                    <span class="n">mot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Motif</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="n">regex</span> <span class="o">=</span> <span class="n">motif</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> 
                        <span class="n">prob</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">motif</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">motif</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> 
                        <span class="n">description</span> <span class="o">=</span> <span class="n">motif</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">elm</span> <span class="o">=</span> <span class="n">motif</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">motif_name</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">dom</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">11</span><span class="p">]),</span> 
                        <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">]),</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">domain_id_type</span> <span class="o">=</span> <span class="s1">&#39;ielm_hmm&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">pfam</span><span class="p">,</span> <span class="n">regions</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">]]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span> <span class="o">==</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                                    <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">==</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]:</span>
                                    <span class="n">dom</span><span class="o">.</span><span class="n">pfam</span> <span class="o">=</span> <span class="n">pfam</span>
                                    <span class="n">dom</span><span class="o">.</span><span class="n">isoform</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;isoform&#39;</span><span class="p">]</span>
                    <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">motif</span> <span class="o">=</span> <span class="n">mot</span><span class="p">,</span> 
                        <span class="n">typ</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">domMot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">DomainMotif</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">ptm</span><span class="p">,</span> <span class="s1">&#39;iELM&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">domMot</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="c1"># find deprecated elm classes:</span>
        <span class="c1"># list(set(noelm))</span>
    
    <span class="k">def</span> <span class="nf">load_elm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">elm</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_elm_interactions</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elm</span><span class="p">),</span> <span class="s1">&#39;Processing domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">elm</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">uniprot_elm</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">uniprot_dom</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot_elm</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot_dom</span><span class="p">):</span>
                    <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">mot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Motif</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">uniprot_elm</span><span class="p">,</span> <span class="n">motif_name</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
                            <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">uniprot_elm</span><span class="p">,</span> <span class="n">motif</span> <span class="o">=</span> <span class="n">mot</span><span class="p">)</span>
                            <span class="n">dstart</span> <span class="o">=</span> <span class="n">start</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                            <span class="n">dend</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">uniprot_dom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">uniprot_dom</span><span class="p">]:</span>
                                    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">uniprot_dom</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
                                        <span class="k">if</span> <span class="n">dstart</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">dend</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                                            <span class="p">(</span><span class="n">dstart</span> <span class="o">==</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                                            <span class="n">dend</span> <span class="o">==</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]):</span>
                                            <span class="n">doms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                                <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span>
                                                    <span class="n">protein</span> <span class="o">=</span> <span class="n">uniprot_dom</span><span class="p">,</span> 
                                                    <span class="n">domain</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                                    <span class="n">start</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span> 
                                                    <span class="n">end</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span>
                                                    <span class="n">isoform</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;isoform&#39;</span><span class="p">]</span>
                                                <span class="p">)</span>
                                            <span class="p">)</span>
                            <span class="k">for</span> <span class="n">dom</span> <span class="ow">in</span> <span class="n">doms</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="n">intera</span><span class="o">.</span><span class="n">DomainMotif</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">ptm</span><span class="p">,</span> <span class="s1">&#39;ELM&#39;</span><span class="p">))</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_lmpid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="k">pass</span>
    
<div class="viewcode-block" id="PyPath.process_dmi"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.process_dmi">[docs]</a>    <span class="k">def</span> <span class="nf">process_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This is an universal function </span>
<span class="sd">        for loading domain-motif objects</span>
<span class="sd">        like load_phospho_dmi() for PTMs.</span>
<span class="sd">        TODO this will replace load_elm, load_ielm, etc</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">functions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;LMPID&#39;</span><span class="p">:</span> <span class="s1">&#39;lmpid_dmi&#39;</span>
        <span class="p">}</span>
        <span class="n">motif_plus</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;LMPID&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">functions</span><span class="p">[</span><span class="n">source</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">toCall</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">(</span><span class="n">isoforms</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;Processing domain-motif interactions from </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">source</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">domain_ups</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">motif_upd</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;LMPID&#39;</span><span class="p">:</span>
                <span class="n">domain_ups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;domain_protein&#39;</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="n">motif_ups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;motif_protein&#39;</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">du</span> <span class="ow">in</span> <span class="n">domain_ups</span><span class="p">:</span>
                <span class="n">dom</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">du</span><span class="p">,</span> 
                    <span class="n">domain</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="s1">&#39;domain_name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">else</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;domain_name&#39;</span><span class="p">],</span> 
                    <span class="n">domain_id_type</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="s1">&#39;domain_name_type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">else</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;domain_name_type&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">motif_ups</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">mu</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="ow">and</span> <span class="n">mu</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span> <span class="ow">and</span> <span class="n">du</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span><span class="p">:</span>
                        <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">du</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">mu</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">edge</span><span class="p">:</span>
                            <span class="n">mse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">mu</span><span class="p">]</span>
                            <span class="n">isos</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">inst</span> <span class="o">=</span> <span class="n">mse</span><span class="o">.</span><span class="n">get_region</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;motif_start&#39;</span><span class="p">],</span> 
                                    <span class="n">end</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;motif_end&#39;</span><span class="p">],</span> <span class="n">isoform</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                                <span class="n">isos</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inst</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">iso</span> <span class="ow">in</span> <span class="n">mse</span><span class="o">.</span><span class="n">isoforms</span><span class="p">():</span>
                                <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">inst</span> <span class="o">=</span> <span class="n">mse</span><span class="o">.</span><span class="n">get_region</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;motif_start&#39;</span><span class="p">],</span> 
                                    <span class="n">end</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;motif_end&#39;</span><span class="p">],</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">iso</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">inst</span> <span class="o">==</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]:</span>
                                    <span class="n">isos</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">iso</span><span class="p">,</span> <span class="n">inst</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">iso</span> <span class="ow">in</span> <span class="n">isos</span><span class="p">:</span>
                                <span class="n">motargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">motif_plus</span><span class="p">[</span><span class="n">source</span><span class="p">]])</span>
                                <span class="n">mot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Motif</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">iso</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iso</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">iso</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
                                    <span class="n">instance</span> <span class="o">=</span> <span class="n">iso</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">motargs</span><span class="p">)</span>
                                <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">motif</span> <span class="o">=</span> <span class="n">mot</span><span class="p">,</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">iso</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">])</span>
                                <span class="n">dommot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">DomainMotif</span><span class="p">(</span><span class="n">domain</span> <span class="o">=</span> <span class="n">dom</span><span class="p">,</span> <span class="n">ptm</span> <span class="o">=</span> <span class="n">ptm</span><span class="p">,</span> 
                                    <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">],</span> <span class="n">refs</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">])</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dommot</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span></div>
    
    <span class="k">def</span> <span class="nf">load_pepcyber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">pepc</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pepcyber</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pepc</span><span class="p">),</span> <span class="s1">&#39;Processing domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">pepc</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">uniprot1</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">uniprot1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;refseq&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="n">uniprot2</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">11</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="c1"># ptm on u2, </span>
            <span class="c1"># u1 interacts with u2 depending on ptm</span>
            <span class="k">for</span> <span class="n">u1</span> <span class="ow">in</span> <span class="n">uniprot1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">u2</span> <span class="ow">in</span> <span class="n">uniprot2</span><span class="p">:</span>
                    <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">res</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Residue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="n">l</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">u2</span><span class="p">)</span>
                            <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">u2</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="n">res</span><span class="p">,</span> 
                                <span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;phosphorylation&#39;</span><span class="p">)</span>
                            <span class="n">reg</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Regulation</span><span class="p">(</span>
                                <span class="n">source</span> <span class="o">=</span> <span class="n">u2</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">u1</span><span class="p">,</span> 
                                <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PepCyber&#39;</span><span class="p">],</span>
                                <span class="n">effect</span> <span class="o">=</span> <span class="s1">&#39;induces&#39;</span><span class="p">,</span> <span class="n">ptm</span> <span class="o">=</span> <span class="n">ptm</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_psite_reg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">modtyp</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="s1">&#39;phosphorylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ac&#39;</span><span class="p">:</span> <span class="s1">&#39;acetylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ub&#39;</span><span class="p">:</span> <span class="s1">&#39;ubiquitination&#39;</span><span class="p">,</span>
            <span class="s1">&#39;me&#39;</span><span class="p">:</span> <span class="s1">&#39;methylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sm&#39;</span><span class="p">:</span> <span class="s1">&#39;sumoylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ga&#39;</span><span class="p">:</span> <span class="s1">&#39;o-galnac&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gl&#39;</span><span class="p">:</span> <span class="s1">&#39;o-glcnac&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sc&#39;</span><span class="p">:</span> <span class="s1">&#39;succinylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;m3&#39;</span><span class="p">:</span> <span class="s1">&#39;tri-methylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;m1&#39;</span><span class="p">:</span> <span class="s1">&#39;mono-methylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;m2&#39;</span><span class="p">:</span> <span class="s1">&#39;di-methylation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pa&#39;</span><span class="p">:</span> <span class="s1">&#39;palmitoylation&#39;</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">preg</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_psite_reg</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">preg</span><span class="p">),</span> <span class="s1">&#39;Processing regulatory effects&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">tgts</span> <span class="ow">in</span> <span class="n">preg</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="c1"># ptm on src</span>
            <span class="c1"># tgt: interactor of src, depending on ptm</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">tgt</span> <span class="ow">in</span> <span class="n">tgts</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">effect</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;induces&#39;</span><span class="p">,</span> <span class="s1">&#39;disrupts&#39;</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">tgt</span><span class="p">[</span><span class="n">effect</span><span class="p">]:</span>
                            <span class="n">uniprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
                                    <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                                        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                            <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                                        <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                            <span class="n">res</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Residue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tgt</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">]),</span> 
                                                <span class="n">tgt</span><span class="p">[</span><span class="s1">&#39;aa&#39;</span><span class="p">],</span> <span class="n">src</span><span class="p">)</span>
                                            <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">src</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="n">res</span><span class="p">,</span> 
                                                <span class="n">typ</span> <span class="o">=</span> <span class="n">modtyp</span><span class="p">[</span><span class="n">tgt</span><span class="p">[</span><span class="s1">&#39;modt&#39;</span><span class="p">]])</span>
                                            <span class="n">reg</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Regulation</span><span class="p">(</span>
                                                <span class="n">source</span> <span class="o">=</span> <span class="n">src</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span> 
                                                <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PhosphoSite&#39;</span><span class="p">],</span> 
                                                <span class="n">refs</span> <span class="o">=</span> <span class="n">tgt</span><span class="p">[</span><span class="s1">&#39;pmids&#39;</span><span class="p">],</span>
                                                <span class="n">effect</span> <span class="o">=</span> <span class="n">effect</span><span class="p">,</span> <span class="n">ptm</span> <span class="o">=</span> <span class="n">ptm</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_comppi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;comppi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;comppi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;comppi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;comppi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">comppi</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_comppi</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comppi</span><span class="p">),</span> <span class="s1">&#39;Processing localizations&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">comppi</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">uniprots1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprot1&#39;</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="n">uniprots2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;uniprot2&#39;</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">u1</span> <span class="ow">in</span> <span class="n">uniprots1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u1</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;loc1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)]:</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">u1</span><span class="p">]]</span>\
                            <span class="p">[</span><span class="s1">&#39;comppi&#39;</span><span class="p">][</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">u2</span> <span class="ow">in</span> <span class="n">uniprots1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u2</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;loc2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)]:</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">u2</span><span class="p">]]</span>\
                            <span class="p">[</span><span class="s1">&#39;comppi&#39;</span><span class="p">][</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">u1</span> <span class="ow">in</span> <span class="n">uniprots1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">u2</span> <span class="ow">in</span> <span class="n">uniprots2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u2</span><span class="p">):</span>
                        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">e</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;comppi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;loc_score&#39;</span><span class="p">])</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">edge_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">topn</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="s1">&#39;comppi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_comppi</span><span class="p">()</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">e</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> \
                <span class="n">heapq</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">2</span> <span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;comppi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(),</span> 
                <span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> \
                <span class="n">heapq</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">2</span> <span class="p">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;comppi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(),</span> 
                <span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="p">]))</span>
    
    <span class="k">def</span> <span class="nf">sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isoforms</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">swissprot_seq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span> <span class="n">isoforms</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_depod_dmi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_signor_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_li2012_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_hprd_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_mimp_dmi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pnetworks_dmi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_phosphoelm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_dbptm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_psite_phos</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniq_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phosphorylation_directions</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_mimp_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_matching</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;MIMP&#39;</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>
    
    <span class="k">def</span> <span class="nf">load_pnetworks_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;PhosphoNetworks&#39;</span><span class="p">,</span> 
            <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>
    
    <span class="k">def</span> <span class="nf">load_phosphoelm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">ltp_only</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;phosphoELM&#39;</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="p">,</span> 
            <span class="n">ltp_only</span> <span class="o">=</span> <span class="n">ltp_only</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>
    
    <span class="k">def</span> <span class="nf">load_dbptm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_matching</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;dbPTM&#39;</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>
    
    <span class="k">def</span> <span class="nf">load_hprd_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_matching</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;HPRD&#39;</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>
    
    <span class="k">def</span> <span class="nf">load_li2012_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_matching</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;Li2012&#39;</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>
    
    <span class="k">def</span> <span class="nf">load_signor_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_matching</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;Signor&#39;</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>
    
    <span class="k">def</span> <span class="nf">load_psite_phos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;PhosphoSite&#39;</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>
    
    <span class="k">def</span> <span class="nf">load_phospho_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">return_raw</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">functions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Signor&#39;</span><span class="p">:</span> <span class="s1">&#39;load_signor_ptms&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MIMP&#39;</span><span class="p">:</span> <span class="s1">&#39;get_mimp&#39;</span><span class="p">,</span>
            <span class="s1">&#39;PhosphoNetworks&#39;</span><span class="p">:</span> <span class="s1">&#39;get_phosphonetworks&#39;</span><span class="p">,</span>
            <span class="s1">&#39;phosphoELM&#39;</span><span class="p">:</span> <span class="s1">&#39;get_phosphoelm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;dbPTM&#39;</span><span class="p">:</span> <span class="s1">&#39;get_dbptm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;PhosphoSite&#39;</span><span class="p">:</span> <span class="s1">&#39;get_psite_phos&#39;</span><span class="p">,</span>
            <span class="s1">&#39;HPRD&#39;</span><span class="p">:</span> <span class="s1">&#39;get_hprd_ptms&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Li2012&#39;</span><span class="p">:</span> <span class="s1">&#39;li2012_phospho&#39;</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">functions</span><span class="p">[</span><span class="n">source</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">toCall</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">(</span><span class="n">isoforms</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">nomatch</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kin_ambig</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">sub_ambig</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;Processing PTMs from </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">source</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># database specific id conversions</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;PhosphoSite&#39;</span><span class="p">,</span> <span class="s1">&#39;phosphoELM&#39;</span><span class="p">,</span> <span class="s1">&#39;Signor&#39;</span><span class="p">]:</span>
                    <span class="n">kinase_ups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">]]</span>
                    <span class="n">kinase_ups</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> \
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span> \
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ii</span><span class="p">]</span>
                    <span class="n">kinase_ups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">kinase_ups</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;HLA&#39;</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;MIMP&#39;</span><span class="p">,</span> <span class="s1">&#39;PhosphoNetworks&#39;</span><span class="p">,</span> <span class="s1">&#39;Li2012&#39;</span><span class="p">]:</span>
                    <span class="n">substrate_ups_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate&#39;</span><span class="p">],</span> 
                        <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;MIMP&#39;</span><span class="p">:</span>
                    <span class="n">substrate_ups_all</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate_refseq&#39;</span><span class="p">],</span> 
                        <span class="s1">&#39;refseq&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                    <span class="n">substrate_ups_all</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">substrate_ups_all</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;phosphoELM&#39;</span><span class="p">,</span> <span class="s1">&#39;dbPTM&#39;</span><span class="p">,</span> <span class="s1">&#39;PhosphoSite&#39;</span><span class="p">,</span> <span class="s1">&#39;Signor&#39;</span><span class="p">]:</span>
                    <span class="n">substrate_ups_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate&#39;</span><span class="p">],</span> 
                        <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;HPRD&#39;</span><span class="p">:</span>
                    <span class="n">substrate_ups_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate_refseqp&#39;</span><span class="p">],</span> 
                        <span class="s1">&#39;refseqp&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                    <span class="n">substrate_ups_all</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="n">substrate_ups_all</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;kinase&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kin_ambig</span><span class="p">:</span>
                        <span class="n">kin_ambig</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinase_ups</span>
                <span class="c1"># looking up sequences in all isoforms:</span>
                <span class="n">substrate_ups</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrate_ups_all</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">isof</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">isoforms</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span> 
                                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">isof</span><span class="p">):</span>
                                    <span class="n">substrate_ups</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">isof</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;resaa&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;resnum&#39;</span><span class="p">],</span> 
                                    <span class="n">isoform</span> <span class="o">=</span> <span class="n">isof</span><span class="p">):</span>
                                    <span class="n">substrate_ups</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">isof</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sub_ambig</span><span class="p">:</span>
                    <span class="n">sub_ambig</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">substrate_ups</span>
                <span class="c1"># generating report on non matching substrates</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">substrate_ups</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrate_ups_all</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">:</span>
                            <span class="n">nomatch</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;substrate_refseq&#39;</span><span class="p">],</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">])))</span>
                <span class="c1"># adding kinase-substrate interactions</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kinase_ups</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrate_ups</span><span class="p">:</span>
                        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">or</span> <span class="n">return_raw</span><span class="p">:</span>
                            <span class="n">e</span> <span class="o">=</span> <span class="bp">None</span>
                            <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                    <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">return_raw</span><span class="p">:</span>
                                <span class="n">res</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Residue</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;resnum&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;resaa&#39;</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                    <span class="n">isoform</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                                    <span class="n">reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">get_region</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;resnum&#39;</span><span class="p">],</span> 
                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                    <span class="k">if</span> <span class="n">reg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                <span class="k">if</span> <span class="s1">&#39;typ&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;typ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;phosphorylation&#39;</span>
                                <span class="n">mot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Motif</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span> 
                                    <span class="n">instance</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">],</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">motif</span> <span class="o">=</span> <span class="n">mot</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="n">res</span><span class="p">,</span> 
                                    <span class="n">typ</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;typ&#39;</span><span class="p">],</span> <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">],</span> 
                                    <span class="n">isoform</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="n">dom</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">k</span><span class="p">)</span>
                                <span class="k">if</span> <span class="s1">&#39;references&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                <span class="n">dommot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">DomainMotif</span><span class="p">(</span><span class="n">domain</span> <span class="o">=</span> <span class="n">dom</span><span class="p">,</span> <span class="n">ptm</span> <span class="o">=</span> <span class="n">ptm</span><span class="p">,</span> 
                                    <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">],</span> <span class="n">refs</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;MIMP&#39;</span><span class="p">:</span>
                                    <span class="n">dommot</span><span class="o">.</span><span class="n">mimp_sources</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;databases&#39;</span><span class="p">])</span>
                                    <span class="n">dommot</span><span class="o">.</span><span class="n">npmid</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;npmid&#39;</span><span class="p">]</span>
                                <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;PhosphoNetworks&#39;</span><span class="p">:</span>
                                    <span class="n">dommot</span><span class="o">.</span><span class="n">pnetw_score</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
                                <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;dbPTM&#39;</span><span class="p">:</span>
                                    <span class="n">dommot</span><span class="o">.</span><span class="n">dbptm_sources</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]]</span>
                                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dommot</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">return_raw</span><span class="p">:</span>
                                    <span class="n">raw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dommot</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;non_matching&#39;</span><span class="p">:</span> <span class="n">nomatch</span><span class="p">,</span> <span class="s1">&#39;kinase_ambiguousity&#39;</span><span class="p">:</span> <span class="n">kin_ambig</span><span class="p">,</span>
                <span class="s1">&#39;substrate_ambiguousity&#39;</span><span class="p">:</span> <span class="n">sub_ambig</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">return_raw</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">raw</span>
    
    <span class="k">def</span> <span class="nf">load_depod_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reres</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;([A-Z][a-z]+)-([0-9]+)&#39;</span><span class="p">)</span>
        <span class="n">non_digit</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;[^\d.-]+&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_depod</span><span class="p">()</span>
        <span class="n">aadict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aaletters</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
            <span class="n">aaletters</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;Loading dephosphorylation data from DEPOD&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="n">mapp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">reslist</span> <span class="o">=</span> <span class="p">[(</span><span class="n">aadict</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="nb">int</span><span class="p">(</span><span class="n">non_digit</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span> \
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reres</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> \
                <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">aadict</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">enzymes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="n">substrates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="n">substrates</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrates</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">]</span>
                <span class="n">mapp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">enzymes</span><span class="p">,</span> <span class="n">substrates</span><span class="p">,</span> <span class="n">reslist</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reslist</span><span class="p">:</span>
                    <span class="n">substrates</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrates</span> \
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                <span class="n">mapp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">substrates</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">enzymes</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrates</span><span class="p">:</span>
                        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reslist</span><span class="p">:</span>
                                    <span class="n">res</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Residue</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">)</span>
                                    <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="n">res</span><span class="p">,</span> 
                                        <span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;dephosphorylation&#39;</span><span class="p">,</span> 
                                        <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DEPOD&#39;</span><span class="p">])</span>
                                    <span class="n">dom</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">d</span><span class="p">)</span>
                                    <span class="n">dommot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">DomainMotif</span><span class="p">(</span><span class="n">domain</span> <span class="o">=</span> <span class="n">dom</span><span class="p">,</span> <span class="n">ptm</span> <span class="o">=</span> <span class="n">ptm</span><span class="p">,</span> 
                                        <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DEPOD&#39;</span><span class="p">],</span> 
                                        <span class="n">refs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)])</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dommot</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="c1"># return mapp</span>
    
    <span class="k">def</span> <span class="nf">uniq_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;ptm&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uniq_ptm</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">uniq_ptm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ptms</span><span class="p">):</span>
        <span class="n">ptms_uniq</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">ptms</span><span class="p">:</span>
            <span class="n">merged</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ptmu</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ptms_uniq</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ptm</span> <span class="o">==</span> <span class="n">ptmu</span><span class="p">:</span>
                    <span class="n">ptms_uniq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ptm</span><span class="p">)</span>
                    <span class="n">merged</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">merged</span><span class="p">:</span>
                <span class="n">ptms_uniq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptm</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ptms_uniq</span>
    
    <span class="k">def</span> <span class="nf">phosphorylation_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniq_ptms</span><span class="p">()</span>
        <span class="n">isdir</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                <span class="n">isdir</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;DomainMotif&#39;</span> <span class="ow">and</span> \
                    <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;phosphorylation&#39;</span><span class="p">,</span> <span class="s1">&#39;dephosphorylation&#39;</span><span class="p">]:</span>
                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_dir</span><span class="p">((</span><span class="n">ptm</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">),</span> 
                        <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span>
        <span class="n">isdir2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                <span class="n">isdir2</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Directionality set for </span><span class="si">%u</span><span class="s1"> interactions</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">   based on known (de)phosphorylation events.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">isdir2</span> <span class="o">-</span> <span class="n">isdir</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">phosphorylation_signs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">new_signs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dephos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># looking up effects of dephosphorylations:</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]:</span>
                <span class="n">sign</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;dephosphorylation&#39;</span><span class="p">:</span>
                    <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">ptm</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">)</span>
                    <span class="n">signs</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">signs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">signs</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;positive&#39;</span>
                    <span class="k">elif</span> <span class="n">signs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">signs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;negative&#39;</span>
                    <span class="k">if</span> <span class="n">sign</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dephos</span><span class="p">:</span>
                            <span class="n">dephos</span><span class="p">[</span><span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">dephos</span><span class="p">[</span><span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;protein&#39;</span><span class="p">:</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span>
                            <span class="s1">&#39;resaa&#39;</span><span class="p">:</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="s1">&#39;resnum&#39;</span><span class="p">:</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">number</span><span class="p">,</span>
                            <span class="s1">&#39;sign&#39;</span><span class="p">:</span> <span class="n">sign</span><span class="p">})</span>
        <span class="c1"># set the opposite sign for posphorylations as it is </span>
        <span class="c1"># at corresponding dephosphorylations:</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;phosphorylation&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span> <span class="ow">in</span> <span class="n">dephos</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">de</span> <span class="ow">in</span> <span class="n">dephos</span><span class="p">[</span><span class="n">protein</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">de</span><span class="p">[</span><span class="s1">&#39;resnum&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                                <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">de</span><span class="p">[</span><span class="s1">&#39;resaa&#39;</span><span class="p">]:</span>
                                <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">ptm</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">)</span>
                                <span class="n">signs</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
                                <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;positive&#39;</span> <span class="k">if</span> <span class="n">de</span><span class="p">[</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span> \
                                    <span class="k">else</span> <span class="s1">&#39;negative&#39;</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">signs</span><span class="p">)):</span>
                                    <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">ptm</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span>
                                    <span class="n">new_signs</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Signes set based on phosphorylation-&#39;</span>\
            <span class="s1">&#39;dephosphorylation pairs: </span><span class="si">%u</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">new_signs</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">kinase_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">pcounts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ks_pairs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">psite_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">ks_srcs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;DomainMotif&#39;</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;phosphorylation&#39;</span><span class="p">:</span>
                    <span class="n">ks_srcs</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">sources</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">sources</span>
                    <span class="n">p_srcs</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">sources</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">sources</span>
                    <span class="n">p_srcs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">p_srcs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Swiss-Prot&#39;</span><span class="p">]))</span>
                    <span class="n">p_srcs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                    <span class="n">p_srcs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">p_srcs</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">p_srcs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pcounts</span><span class="p">:</span>
                        <span class="n">pcounts</span><span class="p">[</span><span class="n">p_srcs</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">pcounts</span><span class="p">[</span><span class="n">p_srcs</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">psite_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ks_srcs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ks_srcs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ks_srcs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Swiss-Prot&#39;</span><span class="p">]))</span>
                <span class="n">ks_srcs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="n">ks_srcs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ks_srcs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ks_srcs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
                    <span class="n">counts</span><span class="p">[</span><span class="n">ks_srcs</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">counts</span><span class="p">[</span><span class="n">ks_srcs</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">ks_pairs</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;phosphorylations&#39;</span><span class="p">:</span> <span class="n">pcounts</span><span class="p">,</span> <span class="s1">&#39;kinase_substrate&#39;</span><span class="p">:</span> <span class="n">counts</span><span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">update_db_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">sources_overlap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diagonal</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_db_dict</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;single&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="p">{}</span>
            <span class="p">},</span>
            <span class="s1">&#39;overlap&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="p">{}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">])</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">s1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">diagonal</span> <span class="ow">or</span> <span class="n">s1</span> <span class="o">!=</span> <span class="n">s2</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)]</span> <span class="o">=</span> \
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s2</span><span class="p">])</span>
                    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)]</span> <span class="o">=</span> \
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span> <span class="nf">source_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources_overlap</span><span class="p">()</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="n">bwness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">betweenness</span><span class="p">()</span>
        <span class="n">ebwness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">edge_betweenness</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">source_diagram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outf</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="n">outf</span> <span class="k">if</span> <span class="n">outf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;databases.pdf&#39;</span><span class="p">)</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources_overlap</span><span class="p">(</span><span class="n">diagonal</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">overlaps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">],</span> <span class="bp">None</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">overlaps</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">])}</span>
        <span class="n">diagram</span> <span class="o">=</span> <span class="n">bdrawing</span><span class="o">.</span><span class="n">InterSet</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">overlaps</span><span class="p">,</span> <span class="n">outf</span> <span class="o">=</span> <span class="n">outf</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">diagram</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">get_dirs_signs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">omnipath</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="o">+</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">good</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> \
            <span class="o">+</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">ugly</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">result</span><span class="p">[</span><span class="n">db</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">bool</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">isDirected</span><span class="p">),</span> <span class="nb">bool</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">sign</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">result</span>
    
<div class="viewcode-block" id="PyPath.basic_stats"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.basic_stats">[docs]</a>    <span class="k">def</span> <span class="nf">basic_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latex</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns basic numbers about the network resources, e.g. edge and </span>
<span class="sd">        node counts. </span>
<span class="sd">        </span>
<span class="sd">        latex</span>
<span class="sd">            Return table in a LaTeX document. This can be compiled by</span>
<span class="sd">            PDFLaTeX: </span>
<span class="sd">            latex stats.tex</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;databases-</span><span class="si">%s</span><span class="s1">.tex&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span> \
            <span class="k">if</span> <span class="n">latex</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;databases-</span><span class="si">%s</span><span class="s1">.tsv&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources_overlap</span><span class="p">()</span>
        <span class="n">dirs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dirs_signs</span><span class="p">()</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Database&#39;</span><span class="p">,</span> <span class="s1">&#39;Node count&#39;</span><span class="p">,</span> <span class="s1">&#39;Edge count&#39;</span><span class="p">,</span> <span class="s1">&#39;Directions&#39;</span><span class="p">,</span> <span class="s1">&#39;Signs&#39;</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">],</span> 
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">],</span> 
                <span class="nb">int</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">1</span><span class="p">])]])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">latex</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">out</span><span class="p">])</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outf</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Output written to file `</span><span class="si">%s</span><span class="s1">`</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">outf</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">texnewline</span> <span class="o">=</span> <span class="s1">r&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s1">r&#39;&#39;&#39;\documentclass[12pt,a4paper]{article}</span>
<span class="s1">                \usepackage[T1]{fontenc}</span>
<span class="s1">                \usepackage[utf8]{inputenc}</span>
<span class="s1">                \usepackage[english]{babel}</span>
<span class="s1">                \usepackage[landscape]{geometry}</span>
<span class="s1">                \usepackage{booktabs}</span>
<span class="s1">                \usepackage{microtype}</span>
<span class="s1">                \usepackage{tabularx}</span>
<span class="s1">                \begin{document}</span>
<span class="s1">                \thispagestyle{empty}</span>
<span class="s1">                &#39;&#39;&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s1">r&#39;\begin{table}[h]&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s1">r&#39;\begin{tabularx}{\textwidth}{&#39;</span> \
                <span class="o">+</span> <span class="s1">&#39;X</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s1">r&#39;}&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> \
                <span class="o">+</span> <span class="s1">r&#39;\toprule&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s1">r&#39; &amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="n">texnewline</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s1">r&#39;\midrule&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="n">texnewline</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; &amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> \
                <span class="n">xx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">r&#39;\_&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span> <span class="k">else</span> \
                <span class="s1">&#39;{:,}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span> \
                <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span> <span class="o">+</span> <span class="n">texnewline</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s1">r&#39;\bottomrule&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s1">r&#39;\caption{&#39;</span> <span class="o">+</span> <span class="s1">&#39;Node and edge counts of pathway databases&#39;</span> \
                <span class="o">+</span> <span class="s1">r&#39;}&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s1">r&#39;\end{tabularx}&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s1">r&#39;\end{table}&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s1">r&#39;\end{document}&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outf</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tex</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Output written to file `</span><span class="si">%s</span><span class="s1">`</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">outf</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="PyPath.source_network"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.source_network">[docs]</a>    <span class="k">def</span> <span class="nf">source_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span> <span class="o">=</span> <span class="s1">&#39;HelveticaNeueLTStd&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        For EMBL branding, use Helvetica Neue Linotype Standard light</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources_overlap</span><span class="p">()</span>
        <span class="n">tupleListNodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tupleListEdges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dbs</span><span class="p">,</span> <span class="n">overlap</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">overlap</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tupleListNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dbs</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="n">overlap</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">dbs</span><span class="p">,</span> <span class="n">overlap</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">overlap</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tupleListEdges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dbs</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="n">overlap</span><span class="p">]))</span>
        <span class="n">tupleListNodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tupleListNodes</span><span class="p">))</span>
        <span class="n">tupleListEdges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tupleListEdges</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">TupleList</span><span class="p">(</span><span class="n">tupleListNodes</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">TupleList</span><span class="p">(</span><span class="n">tupleListEdges</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="c1"># edge widths proportional to overlaps in unique nodes/edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;edge_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">][(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])],</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;edge_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;overlap&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">][(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])],</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="c1"># node sizes proportional to number of nodes/edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;vertex_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> 
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;vertex_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> 
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="c1"># numbers in vertex labels:</span>
        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">%u</span><span class="s1">)&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]])</span> \
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">%u</span><span class="s1">)&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]])</span> \
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">plotParamNodes</span> <span class="o">=</span> <span class="n">PlotParam</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="p">,</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;db_net_nodes.pdf&#39;</span><span class="p">,</span> 
            <span class="n">layout</span> <span class="o">=</span> <span class="s1">&#39;circular&#39;</span><span class="p">,</span> <span class="n">vertex_label_color</span> <span class="o">=</span> <span class="s1">&#39;#4d4d4d&#39;</span><span class="p">,</span> 
            <span class="n">vertex_color</span> <span class="o">=</span> <span class="s1">&#39;#73b360&#39;</span><span class="p">,</span> <span class="n">edge_color</span> <span class="o">=</span> <span class="s1">&#39;#006666&#39;</span><span class="p">,</span> 
            <span class="n">vertex_fill_alpha</span> <span class="o">=</span> <span class="s1">&#39;ff&#39;</span><span class="p">,</span>
            <span class="n">vertex_label_font</span> <span class="o">=</span> <span class="n">font</span><span class="p">,</span> 
            <span class="n">vertex_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;vertex_size&#39;</span><span class="p">],</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">994</span><span class="p">,</span> <span class="mi">994</span><span class="p">),</span> 
            <span class="n">dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
        <span class="n">plotParamEdges</span> <span class="o">=</span> <span class="n">PlotParam</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="p">,</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;db_net_nodes.pdf&#39;</span><span class="p">,</span> 
            <span class="n">layout</span> <span class="o">=</span> <span class="s1">&#39;circular&#39;</span><span class="p">,</span> <span class="n">vertex_label_color</span> <span class="o">=</span> <span class="s1">&#39;#4d4d4d&#39;</span><span class="p">,</span> 
            <span class="n">vertex_color</span> <span class="o">=</span> <span class="s1">&#39;#73b360&#39;</span><span class="p">,</span> <span class="n">edge_color</span> <span class="o">=</span> <span class="s1">&#39;#006666&#39;</span><span class="p">,</span> 
            <span class="n">vertex_fill_alpha</span> <span class="o">=</span> <span class="s1">&#39;ff&#39;</span><span class="p">,</span>
            <span class="n">vertex_label_font</span> <span class="o">=</span> <span class="n">font</span><span class="p">,</span> 
            <span class="n">vertex_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;vertex_size&#39;</span><span class="p">],</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">994</span><span class="p">,</span> <span class="mi">994</span><span class="p">),</span> 
            <span class="n">dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">plotParamNodes</span><span class="p">,</span> <span class="n">plotParamEdges</span></div>
    
    <span class="c1">#</span>
    <span class="c1"># Load data from GDSC</span>
    <span class="c1">#</span>
    
<div class="viewcode-block" id="PyPath.load_mutations"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.load_mutations">[docs]</a>    <span class="k">def</span> <span class="nf">load_mutations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">gdsc_datadir</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> 
            <span class="n">mutation_file</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Mutations are listed in vertex attributes. Mutation() objects </span>
<span class="sd">        offers methods to identify residues and look up in Ptm(), Motif() </span>
<span class="sd">        and Domain() objects, to check if those residues are </span>
<span class="sd">        modified, or are in some short motif or domain.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutation_samples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> \
            <span class="p">[</span><span class="s1">&#39;Consequence&#39;</span><span class="p">,</span> <span class="s1">&#39;COSMIC_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLE_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;Tissue_TCGA&#39;</span><span class="p">,</span> <span class="s1">&#39;ZYGOSITY&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">gdsc</span><span class="o">.</span><span class="n">GDSC</span><span class="p">(</span><span class="n">datadir</span> <span class="o">=</span> <span class="n">gdsc_datadir</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">read_mutations</span><span class="p">(</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">infile</span> <span class="o">=</span> <span class="n">mutation_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;mut&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;mut&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;Processing mutations&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">uniprot</span><span class="p">,</span> <span class="n">muts</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">muts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s1">&#39;mut&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s1">&#39;mut&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">if</span> <span class="n">mu</span><span class="o">.</span><span class="n">sample</span> <span class="ow">not</span> <span class="ow">in</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s1">&#39;mut&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s1">&#39;mut&#39;</span><span class="p">]</span>\
                            <span class="p">[</span><span class="n">mu</span><span class="o">.</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s1">&#39;mut&#39;</span><span class="p">]</span>\
                        <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">sample</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mu</span><span class="o">.</span><span class="n">sample</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation_samples</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mutation_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">sample</span><span class="p">))</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span></div>
    
<div class="viewcode-block" id="PyPath.load_expression"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.load_expression">[docs]</a>    <span class="k">def</span> <span class="nf">load_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Expression data can be loaded into vertex attributes, </span>
<span class="sd">        or into a pandas DataFrame – the latter offers faster </span>
<span class="sd">        ways to process and use these huge matrices.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">gdsc</span><span class="o">.</span><span class="n">read_transcriptomics</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;exp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;Processing transcriptomics&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">array</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">gsymb</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">up</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">gsymb</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">up</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">gsymb</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="n">gsymb</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exp</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">gsymb</span><span class="p">,</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="n">uniprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">gsymb</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">up</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">up</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">up</span><span class="p">]][</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="nb">dict</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> \
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">up</span><span class="p">]][</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="PyPath.edges_expression"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.edges_expression">[docs]</a>    <span class="k">def</span> <span class="nf">edges_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Executes function `func` for each pairs of connected proteins in the </span>
<span class="sd">        network, for every expression dataset. By default, `func` simply</span>
<span class="sd">        gives the product the (normalized) expression values.</span>
<span class="sd">        </span>
<span class="sd">        func : callable</span>
<span class="sd">            Function to handle 2 vectors (pandas.Series() objects), should</span>
<span class="sd">            return one vector of the same length.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vindex</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_prod</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[])</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> 
            <span class="s1">&#39;Weigh edges based on protein expression&#39;</span><span class="p">,</span> <span class="mi">37</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_names</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exp_prod</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exp_prod</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">exp_prod</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span></div>
    
    <span class="c1">#</span>
    <span class="c1"># Find and remove edges where mutations disrupt PTMs</span>
    <span class="c1">#</span>
    
<div class="viewcode-block" id="PyPath.mutated_edges"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.mutated_edges">[docs]</a>    <span class="k">def</span> <span class="nf">mutated_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compares the mutated residues and the modified residues in PTMs.</span>
<span class="sd">        Interactions are marked as mutated if the target residue in the </span>
<span class="sd">        underlying PTM is mutated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">disrupted</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">smpl</span><span class="p">,</span> <span class="n">mut</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;mut&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">smpl</span> <span class="o">==</span> <span class="n">sample</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">mut</span><span class="o">.</span><span class="n">original</span> <span class="o">==</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="p">:</span>
                                <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">disrupted</span><span class="p">:</span>
                                    <span class="n">disrupted</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> \
                                        <span class="p">{</span><span class="s1">&#39;ptms&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;ptm&#39;</span><span class="p">]),</span> <span class="s1">&#39;disr&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
                                <span class="n">disrupted</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;disr&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">toDel</span><span class="p">,</span> <span class="n">disrupted</span></div>
    
    <span class="k">def</span> <span class="nf">load_go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aspect</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">]):</span>
        <span class="n">go</span><span class="o">.</span><span class="n">load_go</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">aspect</span> <span class="o">=</span> <span class="n">aspect</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">go_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organism</span> <span class="o">=</span> <span class="mi">9606</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;go&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">go</span><span class="p">[</span><span class="n">organism</span><span class="p">]</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">GOAnnotation</span><span class="p">(</span><span class="n">organism</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">go_enrichment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proteins</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">aspect</span> <span class="o">=</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> 
        <span class="n">correction_method</span> <span class="o">=</span> <span class="s1">&#39;hommel&#39;</span><span class="p">):</span>
        <span class="n">all_proteins</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">annotation</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">up</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="k">for</span> <span class="n">up</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> \
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">go</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">],</span> <span class="n">aspect</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> \
            <span class="k">if</span> <span class="n">up</span> <span class="ow">in</span> <span class="n">all_proteins</span><span class="p">])</span>
        <span class="n">enr</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">GOEnrichmentSet</span><span class="p">(</span><span class="n">aspect</span> <span class="o">=</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">organism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span> 
            <span class="n">basic_set</span> <span class="o">=</span> <span class="n">annotation</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">correction_method</span> <span class="o">=</span> <span class="n">correction_method</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proteins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">enr</span><span class="o">.</span><span class="n">new_set</span><span class="p">(</span><span class="n">set_names</span> <span class="o">=</span> <span class="n">proteins</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">enr</span>
    
<div class="viewcode-block" id="PyPath.find_all_paths"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.find_all_paths">[docs]</a>    <span class="k">def</span> <span class="nf">find_all_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;OUT&#39;</span><span class="p">,</span> 
            <span class="n">maxlen</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Finds all paths up to length `maxlen` between groups of</span>
<span class="sd">        vertices. This function is needed only becaues igraph`s</span>
<span class="sd">        get_all_shortest_paths() finds only the shortest, not any</span>
<span class="sd">        path up to a defined length.</span>
<span class="sd">        </span>
<span class="sd">        @start : int or list</span>
<span class="sd">            Indices of the starting node(s) of the paths.</span>
<span class="sd">        @end : int or list</span>
<span class="sd">            Indices of the target node(s) of the paths.</span>
<span class="sd">        @mode : &#39;IN&#39;, &#39;OUT&#39;, &#39;ALL&#39;</span>
<span class="sd">            Passed to igraph.Graph.neighbors()</span>
<span class="sd">        @maxlen : int</span>
<span class="sd">            Maximum length of paths in steps, i.e. if maxlen = 3, then </span>
<span class="sd">            the longest path may consist of 3 edges and 4 nodes.</span>
<span class="sd">        @graph : igraph.Graph object</span>
<span class="sd">            The graph you want to find paths in. self.graph by default.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">find_all_paths_aux</span><span class="p">(</span><span class="n">adjlist</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">maxlen</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxlen</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">adjlist</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">find_all_paths_aux</span><span class="p">(</span><span class="n">adjlist</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">paths</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">adjlist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">))</span> \
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
        <span class="n">all_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">end</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">end</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">end</span><span class="p">),</span> 
            <span class="s1">&#39;Looking up all paths up to length </span><span class="si">%u</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">maxlen</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">start</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">end</span><span class="p">:</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="n">all_paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">find_all_paths_aux</span><span class="p">(</span><span class="n">adjlist</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="p">[],</span> <span class="n">maxlen</span><span class="p">))</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">all_paths</span></div>
    
    <span class="k">def</span> <span class="nf">find_all_paths2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;OUT&#39;</span><span class="p">,</span> <span class="n">maxlen</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">psize</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">one_step</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">adjlist</span><span class="p">):</span>
            <span class="c1"># extends all paths by one step using all neighbors in adjacency list</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[[</span><span class="n">s</span> <span class="o">+</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">adjlist</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span> \
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ii</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">parts</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">adjlist</span><span class="p">,</span> <span class="n">maxlen</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">psize</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">complete_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">maxlen</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">),</span> <span class="n">psize</span><span class="p">):</span>
                    <span class="n">new_paths</span> <span class="o">=</span> <span class="n">one_step</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">psize</span><span class="p">],</span> <span class="n">adjlist</span><span class="p">)</span>
                    <span class="n">complete_paths</span> <span class="o">+=</span> <span class="n">parts</span><span class="p">(</span><span class="n">new_paths</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">adjlist</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">,</span> <span class="n">psize</span><span class="p">,</span> 
                        <span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">90</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\t</span><span class="s1">Depth: </span><span class="si">%u</span><span class="s1"> :: Paths found: </span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> \
                        <span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_paths</span><span class="p">)))</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">complete_paths</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">all_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">end</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">end</span><span class="p">]</span>
        <span class="n">send</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">adjlist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">))</span> \
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">start</span><span class="p">]</span>
        <span class="n">all_paths</span> <span class="o">=</span> <span class="n">parts</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">adjlist</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">,</span> <span class="n">psize</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_paths</span>
    
    <span class="k">def</span> <span class="nf">transcription_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">uniqList</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">ssl</span> <span class="ow">in</span> \
            <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">sl</span> <span class="ow">in</span> \
                <span class="p">[[</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">src_by_source</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources_by_type&#39;</span><span class="p">][</span><span class="s1">&#39;TF&#39;</span><span class="p">]]</span>\
                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="s1">&#39;TF&#39;</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]]</span> \
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sl</span><span class="p">]</span> \
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ssl</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">neighbourhood_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">second</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">center</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">center</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">second</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_neighbours</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">with_first</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_neighbours</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">induced_subgraph</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">implementation</span> <span class="o">=</span> <span class="s1">&#39;create_from_scratch&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_proteomicsdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">tissues</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">pickle</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proteomicsdb</span> <span class="o">=</span> <span class="n">proteomicsdb</span><span class="o">.</span><span class="n">ProteomicsDB</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proteomicsdb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pfile</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proteomicsdb</span><span class="o">.</span><span class="n">get_tissues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proteomicsdb</span><span class="o">.</span><span class="n">tissues_x_proteins</span><span class="p">(</span><span class="n">tissues</span> <span class="o">=</span> <span class="n">tissues</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteomicsdb</span><span class="o">.</span><span class="n">tissues_loaded</span>
    
    <span class="k">def</span> <span class="nf">prdb_tissue_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tissue</span><span class="p">,</span> <span class="n">prdb</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">occurrence</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
        <span class="n">group_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">prdb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteomicsdb</span> <span class="k">if</span> <span class="n">prdb</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">prdb</span>
        <span class="n">nsamples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prdb</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">tissue</span><span class="p">])</span>
        <span class="n">occurrence</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nsamples</span><span class="p">,</span> <span class="n">occurrence</span><span class="p">)</span> \
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">occurrence</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> \
            <span class="k">else</span> <span class="n">nsamples</span> <span class="o">*</span> <span class="n">occurrence</span>
        <span class="n">proteins_present</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">uniprot</span> <span class="k">for</span> <span class="n">uniprot</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> \
            <span class="n">Counter</span><span class="p">([</span><span class="n">uniprot</span> <span class="k">for</span> <span class="n">uniprots</span> <span class="ow">in</span> \
                <span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> \
                    <span class="p">[</span><span class="n">prdb</span><span class="o">.</span><span class="n">expression</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">prdb</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">tissue</span><span class="p">]]</span> \
                <span class="p">]</span> <span class="k">for</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">])</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> \
            <span class="k">if</span> <span class="n">cnt</span> <span class="o">&gt;=</span> <span class="n">occurrence</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">expressions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">uniprot</span><span class="p">,</span> <span class="n">group_function</span><span class="p">(</span>
            <span class="p">[</span><span class="n">prdb</span><span class="o">.</span><span class="n">expression</span><span class="p">[</span><span class="n">sample</span><span class="p">][</span><span class="n">uniprot</span><span class="p">]</span> \
                <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">prdb</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">tissue</span><span class="p">]</span> \
                <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="n">prdb</span><span class="o">.</span><span class="n">expression</span><span class="p">[</span><span class="n">sample</span><span class="p">]]))</span> \
            <span class="k">for</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="n">proteins_present</span><span class="p">])</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">tissue</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expressions</span> \
            <span class="k">else</span> <span class="n">expressions</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">prdb_tissue_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tissue</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="k">if</span> <span class="n">tissue</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prdb_tissue_expr</span><span class="p">(</span><span class="n">tissue</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">induced_subgraph</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">tissue</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">small_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">arrow_size</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">arrow_width</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">edge_color</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dgraph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_directed</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> 
            <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">toDel</span><span class="p">:</span>
                <span class="n">opp</span> <span class="o">=</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">soure</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">opp</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">opp</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                    <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opp</span><span class="p">)</span>
        <span class="n">dgraph</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">toDel</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">tgt</span> <span class="o">=</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                <span class="n">edge_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#646567&#39;</span><span class="p">)</span>
                <span class="n">arrow_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0001</span><span class="p">)</span>
                <span class="n">arrow_width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0001</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_stimulation</span><span class="p">((</span><span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">)):</span>
                    <span class="n">edge_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#6EA945&#39;</span><span class="p">)</span>
                    <span class="n">arrow_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">arrow_width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_inhibition</span><span class="p">((</span><span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">)):</span>
                    <span class="n">edge_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#DA0025&#39;</span><span class="p">)</span>
                    <span class="n">arrow_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">arrow_width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">edge_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#007B7F&#39;</span><span class="p">)</span>
                    <span class="n">arrow_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">arrow_width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">bdrawing</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">dgraph</span><span class="p">,</span> <span class="n">edge_color</span> <span class="o">=</span> <span class="n">edge_color</span><span class="p">,</span> 
            <span class="n">edge_arrow_size</span> <span class="o">=</span> <span class="n">arrow_size</span><span class="p">,</span> <span class="n">edge_arrow_width</span> <span class="o">=</span> <span class="n">arrow_width</span><span class="p">,</span>
            <span class="n">vertex_label</span> <span class="o">=</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">vertex_color</span> <span class="o">=</span> <span class="s1">&#39;ltp&#39;</span><span class="p">,</span> 
            <span class="n">vertex_alpha</span> <span class="o">=</span> <span class="s1">&#39;FF&#39;</span><span class="p">,</span> <span class="n">edge_alpha</span> <span class="o">=</span> <span class="s1">&#39;FF&#39;</span><span class="p">,</span> 
            <span class="n">edge_label</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">dgraph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">]],</span>
            <span class="n">vertex_label_family</span> <span class="o">=</span> <span class="s1">&#39;HelveticaNeueLT Std Lt&#39;</span><span class="p">,</span> 
            <span class="n">edge_label_family</span> <span class="o">=</span> <span class="s1">&#39;HelveticaNeueLT Std Lt&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">communities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;spinglass&#39;</span><span class="p">:</span>
            <span class="n">giant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_giant</span><span class="p">()</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="n">giant</span>
            <span class="k">if</span> <span class="s1">&#39;spins&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;spins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;fastgreedy&#39;</span><span class="p">:</span>
            <span class="n">undgr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_undirected</span><span class="p">(</span><span class="n">combine_edges</span> <span class="o">=</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="n">undgr</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_community&#39;</span><span class="o">%</span><span class="n">method</span><span class="p">):</span>
            <span class="n">to_call</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_community&#39;</span><span class="o">%</span><span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">to_call</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
                <span class="n">comm</span> <span class="o">=</span> <span class="n">to_call</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;VertexDendrogram&#39;</span><span class="p">:</span>
                <span class="n">comm</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">as_clustering</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">comm</span>
    
<div class="viewcode-block" id="PyPath.set_receptors"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.set_receptors">[docs]</a>    <span class="k">def</span> <span class="nf">set_receptors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a vertex attribute `rec` with value *True* if</span>
<span class="sd">        the protein is a receptor, otherwise *False*.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;rec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">receptors</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_hpmr</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">receptors</span><span class="p">:</span>
            <span class="n">urec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="n">urec</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s1">&#39;rec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span></div>
    
<div class="viewcode-block" id="PyPath.set_kinases"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.set_kinases">[docs]</a>    <span class="k">def</span> <span class="nf">set_kinases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a vertex attribute `kin` with value *True* if</span>
<span class="sd">        the protein is a kinase, otherwise *False*.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;kin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">kinases</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_kinases</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">kin</span> <span class="ow">in</span> <span class="n">kinases</span><span class="p">:</span>
            <span class="n">ukin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">kin</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="n">ukin</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s1">&#39;kin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span></div>
    
<div class="viewcode-block" id="PyPath.set_druggability"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.set_druggability">[docs]</a>    <span class="k">def</span> <span class="nf">set_druggability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a vertex attribute `dgb` with value *True* if</span>
<span class="sd">        the protein is druggable, otherwise *False*.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;dgb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">druggables</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_dgidb</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">dgb</span> <span class="ow">in</span> <span class="n">druggables</span><span class="p">:</span>
            <span class="n">udgb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">dgb</span><span class="p">,</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="n">udgb</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s1">&#39;dgb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span></div>
    
<div class="viewcode-block" id="PyPath.set_drugtargets"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.set_drugtargets">[docs]</a>    <span class="k">def</span> <span class="nf">set_drugtargets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pchembl</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a vertex attribute `dtg` with value *True* if</span>
<span class="sd">        the protein has at least one compound binding with </span>
<span class="sd">        affinity higher than `pchembl`, otherwise *False*.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;dtg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;compounds_data&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compounds_from_chembl</span><span class="p">(</span><span class="n">assay_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="n">pchembl</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;compounds_data&#39;</span><span class="p">]:</span>
                <span class="n">pc</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pchembl&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pchembl</span><span class="p">:</span>
                        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;dtg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span></div>
    
<div class="viewcode-block" id="PyPath.set_transcription_factors"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.set_transcription_factors">[docs]</a>    <span class="k">def</span> <span class="nf">set_transcription_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">]):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a vertex attribute `tf` with value *True* if</span>
<span class="sd">        the protein is a transcription factor, otherwise *False*.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;tf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">tfs</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_tfcensus</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
        <span class="n">uniprots</span> <span class="o">=</span> <span class="n">flatList</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;ensg&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span> \
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">tfs</span><span class="p">[</span><span class="s1">&#39;ensg&#39;</span><span class="p">]])</span>
        <span class="n">uniprots</span> <span class="o">+=</span> <span class="n">flatList</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;hgnc&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span> \
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">tfs</span><span class="p">[</span><span class="s1">&#39;hgnc&#39;</span><span class="p">]])</span>
        <span class="k">for</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s1">&#39;tf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span></div>
    
    <span class="k">def</span> <span class="nf">get_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="n">attrname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_pathways&#39;</span><span class="o">%</span><span class="n">source</span>
        <span class="n">protein_pws</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">interaction_pws</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>
            <span class="n">fun</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">attrname</span><span class="p">)</span>
            <span class="n">proteins_pws</span><span class="p">,</span> <span class="n">interactions_pws</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">mapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">proteins_pws</span><span class="p">,</span> <span class="n">interactions_pws</span>
    
    <span class="k">def</span> <span class="nf">load_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">attrname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_pathways&#39;</span><span class="o">%</span><span class="n">source</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">nodDct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())))</span>
        <span class="n">proteins_pws</span><span class="p">,</span> <span class="n">interactions_pws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pathways</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">proteins_pws</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pw</span><span class="p">,</span> <span class="n">proteins</span> <span class="ow">in</span> <span class="n">proteins_pws</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">protein</span> <span class="ow">in</span> <span class="n">proteins</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">protein</span> <span class="ow">in</span> <span class="n">proteins</span><span class="p">:</span>
                        <span class="n">uniprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">protein</span><span class="p">,</span> 
                            <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">nodDct</span><span class="p">:</span>
                                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">nodDct</span><span class="p">[</span><span class="n">u</span><span class="p">]][</span><span class="n">attrname</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pw</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">interactions_pws</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pw</span><span class="p">,</span> <span class="n">ia</span> <span class="ow">in</span> <span class="n">interactions_pws</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">ia</span><span class="p">:</span>
                    <span class="n">usrcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                    <span class="n">utgts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">usrc</span> <span class="ow">in</span> <span class="n">usrcs</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">utgt</span> <span class="ow">in</span> <span class="n">utgts</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">usrc</span> <span class="ow">in</span> <span class="n">nodDct</span> <span class="ow">and</span> <span class="n">utgt</span> <span class="ow">in</span> <span class="n">nodDct</span><span class="p">:</span>
                                <span class="n">eid</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodDct</span><span class="p">[</span><span class="n">usrc</span><span class="p">],</span> 
                                    <span class="n">nodDct</span><span class="p">[</span><span class="n">utgt</span><span class="p">],</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">eid</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="n">attrname</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pw</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">signor_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pathways</span><span class="p">(</span><span class="s1">&#39;signor&#39;</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">kegg_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pathways</span><span class="p">(</span><span class="s1">&#39;kegg&#39;</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">pathway_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;netpath_pathways&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;netpath_pathways&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;netpath_pathways&#39;</span><span class="p">]</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;netpath_pathways&#39;</span><span class="p">])</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;netpath_pathways&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;netpath_pathways&#39;</span><span class="p">]</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;netpath_pathways&#39;</span><span class="p">])</span>
        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;signalink_pathways&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;slk_pathways&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;atg&#39;</span><span class="p">]:</span>
                <span class="n">v</span><span class="p">[</span><span class="s1">&#39;signalink_pathways&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;autophagy&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">pathways_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;genes_pathways.list&#39;</span><span class="p">,</span> 
        <span class="n">pw_sources</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;signalink&#39;</span><span class="p">,</span> <span class="s1">&#39;signor&#39;</span><span class="p">,</span> <span class="s1">&#39;netpath&#39;</span><span class="p">,</span> <span class="s1">&#39;kegg&#39;</span><span class="p">],</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UniProt&#39;</span><span class="p">,</span> <span class="s1">&#39;GeneSymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;Database&#39;</span><span class="p">,</span> <span class="s1">&#39;Pathway&#39;</span><span class="p">]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">g</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">pw_sources</span><span class="p">:</span>
                <span class="n">pw_attr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_pathways&#39;</span><span class="o">%</span><span class="n">src</span>
                <span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="n">pw_attr</span><span class="p">]:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">src</span><span class="p">,</span> <span class="n">pw</span><span class="p">])</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hdr</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">result</span><span class="p">)))</span>
    
    <span class="k">def</span> <span class="nf">guide2pharma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_guide2pharma</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">ulig</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">urec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;receptor_uniprot&#39;</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ligand_uniprot&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ulig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ligand_uniprot&#39;</span><span class="p">],</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ligand_genesymbol&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ulig</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ligand_genesymbol&#39;</span><span class="p">],</span> 
                    <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ulig</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">urec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ur</span> <span class="ow">in</span> <span class="n">urec</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">ul</span> <span class="ow">in</span> <span class="n">ulig</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ul</span><span class="p">,</span> <span class="n">ur</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;effect&#39;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pubmed&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span> <span class="nf">set_tfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_transcription_factors</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_disgenet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span> <span class="o">=</span> <span class="s1">&#39;curated&#39;</span><span class="p">,</span> <span class="n">score</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_disgenet</span><span class="p">(</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">score</span><span class="p">:</span>
                <span class="n">uniprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;entrez&#39;</span><span class="p">],</span> <span class="s1">&#39;entrez&#39;</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">up</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">up</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">up</span><span class="p">]][</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;disease&#39;</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">curation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">all_refs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flatList</span><span class="p">([[</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]]</span> \
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">])))</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="n">src_edges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]])</span>
            <span class="n">src_edges_pct</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">index</span> \
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]])</span> <span class="o">/</span> \
                    <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())</span> <span class="o">*</span> <span class="mf">100.0</span>
            <span class="n">only_src_edges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> \
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">only_src_edges_pct</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> \
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> \
                <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())</span> <span class="o">*</span> <span class="mf">100.0</span>
            <span class="n">shared_edges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> \
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">src_refs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">uniqList</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">flatList</span><span class="p">([</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> \
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">]])]))</span>
            <span class="n">other_refs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">flatList</span><span class="p">([[</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> \
                <span class="n">flatList</span><span class="p">([</span><span class="n">rr</span> <span class="k">for</span> <span class="n">sr</span><span class="p">,</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">sr</span> <span class="o">!=</span> <span class="n">s</span><span class="p">])]</span> \
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]))</span>
            <span class="n">only_src_refs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_refs</span> <span class="o">-</span> <span class="n">other_refs</span><span class="p">)</span>
            <span class="n">only_src_refs_pct</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_refs</span> <span class="o">-</span> <span class="n">other_refs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">all_refs</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.0</span>
            <span class="n">src_refs_pct</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_refs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">all_refs</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.0</span>
            <span class="n">shared_refs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_refs</span> <span class="o">&amp;</span> <span class="n">other_refs</span><span class="p">)</span>
            <span class="n">shared_curation_effort</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> \
                <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">flatList</span><span class="p">([[(</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rr</span><span class="p">]</span> \
                    <span class="k">for</span> <span class="n">sr</span><span class="p">,</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">sr</span> <span class="o">!=</span> <span class="n">s</span><span class="p">]))</span> <span class="o">&amp;</span> \
                <span class="nb">set</span><span class="p">([(</span><span class="n">rl</span><span class="o">.</span><span class="n">pmid</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">rl</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]])</span> \
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">src_only_curation_effort</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> \
                <span class="p">[</span><span class="nb">set</span><span class="p">([(</span><span class="n">rl</span><span class="o">.</span><span class="n">pmid</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">rl</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]])</span> <span class="o">-</span> \
                <span class="nb">set</span><span class="p">(</span><span class="n">flatList</span><span class="p">([[(</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rr</span><span class="p">]</span> \
                    <span class="k">for</span> <span class="n">sr</span><span class="p">,</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">sr</span> <span class="o">!=</span> <span class="n">s</span><span class="p">]))</span> \
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">src_curation_effort</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> \
                <span class="p">[</span><span class="nb">set</span><span class="p">([(</span><span class="n">rl</span><span class="o">.</span><span class="n">pmid</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">rl</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]])</span> \
                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_refs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">src_edges</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;source_edges&#39;</span><span class="p">:</span> <span class="n">src_edges</span><span class="p">,</span>
                <span class="s1">&#39;source_edges_percentage&#39;</span><span class="p">:</span> <span class="n">src_edges_pct</span><span class="p">,</span>
                <span class="s1">&#39;specific_edges&#39;</span><span class="p">:</span> <span class="n">only_src_edges</span><span class="p">,</span>
                <span class="s1">&#39;specific_edges_percentage&#39;</span><span class="p">:</span> <span class="n">only_src_edges_pct</span><span class="p">,</span>
                <span class="s1">&#39;shared_edges&#39;</span><span class="p">:</span> <span class="n">shared_edges</span><span class="p">,</span>
                <span class="s1">&#39;specific_refs&#39;</span><span class="p">:</span> <span class="n">only_src_refs</span><span class="p">,</span>
                <span class="s1">&#39;specific_refs_percentage&#39;</span><span class="p">:</span> <span class="n">only_src_refs_pct</span><span class="p">,</span>
                <span class="s1">&#39;source_refs&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_refs</span><span class="p">),</span>
                <span class="s1">&#39;source_refs_percentage&#39;</span><span class="p">:</span> <span class="n">src_refs_pct</span><span class="p">,</span>
                <span class="s1">&#39;shared_refs&#39;</span><span class="p">:</span> <span class="n">shared_refs</span><span class="p">,</span>
                <span class="s1">&#39;source_curation_effort&#39;</span><span class="p">:</span> <span class="n">src_curation_effort</span><span class="p">,</span>
                <span class="s1">&#39;source_specific_curation_effort&#39;</span><span class="p">:</span> <span class="n">src_only_curation_effort</span><span class="p">,</span>
                <span class="s1">&#39;shared_curation_effort&#39;</span><span class="p">:</span> <span class="n">shared_curation_effort</span><span class="p">,</span>
                <span class="s1">&#39;refs_edges_ratio&#39;</span><span class="p">:</span> <span class="n">ratio</span><span class="p">,</span>
                <span class="s1">&#39;corrected_curation_effort&#39;</span><span class="p">:</span> <span class="n">src_curation_effort</span> <span class="o">*</span> <span class="n">ratio</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span> <span class="nf">table_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">sum_row</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">row_order</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> 
        <span class="n">latex_hdr</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">caption</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">font</span> <span class="o">=</span> <span class="s1">&#39;HelveticaNeueLTStd-Lt&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">sum_label</span> <span class="o">=</span> <span class="s1">&#39;Total&#39;</span><span class="p">,</span> <span class="n">sum_cols</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">header_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="n">non_digit</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;[^\d.-]+&#39;</span><span class="p">)</span>
        <span class="n">row_order</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> \
            <span class="k">if</span> <span class="n">row_order</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">row_order</span>
        <span class="n">_latex_tab</span> <span class="o">=</span> <span class="s1">r&#39;&#39;&#39;</span><span class="si">%s</span><span class="s1"></span>
<span class="s1">                \begin{tabularx}{\textwidth}{</span><span class="si">%s</span><span class="s1">}</span>
<span class="s1">                \toprule</span>
<span class="s1">                    </span><span class="si">%s</span><span class="s1"></span>
<span class="s1">                \midrule</span>
<span class="s1">                    </span><span class="si">%s</span><span class="s1"></span>
<span class="s1">                </span><span class="si">%s</span><span class="s1">\bottomrule</span>
<span class="s1">                \end{tabularx}</span>
<span class="s1">                </span><span class="si">%s</span><span class="s1"></span>
<span class="s1">            &#39;&#39;&#39;</span>
        <span class="n">_latex_hdr</span> <span class="o">=</span> <span class="s1">r&#39;&#39;&#39;\documentclass[a4paper,</span><span class="si">%u</span><span class="s1">pt]{article}</span>
<span class="s1">                \usepackage{fontspec}</span>
<span class="s1">                \usepackage{xunicode}</span>
<span class="s1">                \usepackage{polyglossia}</span>
<span class="s1">                \setdefaultlanguage{english}</span>
<span class="s1">                \usepackage{xltxtra}</span>
<span class="s1">                \usepackage{microtype}</span>
<span class="s1">                \usepackage[margin=5pt,landscape]{geometry}</span>
<span class="s1">                \usepackage{amsmath}</span>
<span class="s1">                \usepackage{amssymb}</span>
<span class="s1">                \usepackage[usenames,dvipsnames,svgnames,table]{xcolor}</span>
<span class="s1">                \usepackage{color}</span>
<span class="s1">                \usepackage{booktabs}</span>
<span class="s1">                \usepackage{tabularx}</span>
<span class="s1">                \setmainfont{</span><span class="si">%s</span><span class="s1">}</span>
<span class="s1">                \definecolor{grey875}{gray}{0.125}</span>
<span class="s1">                \begin{document}</span>
<span class="s1">                \color{grey875}</span>
<span class="s1">                \thispagestyle{empty}</span>
<span class="s1">                \vfill</span>
<span class="s1">                \begin{table}[h]</span>
<span class="s1">            &#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span> <span class="k">if</span> <span class="n">latex_hdr</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">_latex_end</span> <span class="o">=</span> <span class="s1">r&#39;&#39;&#39;</span>
<span class="s1">                \caption{</span><span class="si">%s</span><span class="s1">}</span>
<span class="s1">                \end{table}</span>
<span class="s1">                \end{document}</span>
<span class="s1">            &#39;&#39;&#39;</span> <span class="o">%</span> <span class="n">caption</span> <span class="k">if</span> <span class="n">latex_hdr</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">_hdr_row</span> <span class="o">=</span> <span class="s1">&#39; &amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">header_format</span><span class="o">%</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">r&#39;%&#39;</span><span class="p">,</span> <span class="s1">r&#39;\%&#39;</span><span class="p">)</span> \
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">header</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\\\\n</span><span class="s1">&#39;</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">locale</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">grouping</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> \
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span> <span class="k">else</span> <span class="n">locale</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">grouping</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">intfloat</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">_rows</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; &amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">formatter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> \
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">header</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">row_order</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\\\\n</span><span class="s1">&#39;</span>
        <span class="n">sum_cols</span> <span class="o">=</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">))</span> <span class="k">if</span> <span class="n">sum_cols</span> <span class="ow">is</span> <span class="bp">None</span> \
            <span class="k">else</span> <span class="n">sum_cols</span>
        <span class="n">_sum_row</span> <span class="o">=</span> <span class="s1">&#39; &amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">sum_label</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sum_cols</span> <span class="k">else</span> <span class="n">formatter</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span> \
            <span class="n">intfloat</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">non_digit</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]])),</span> <span class="s1">&#39;0&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span> \
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()]))</span> \
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">header</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\\\\n</span><span class="s1">&#39;</span>
        <span class="n">_latex_tab</span> <span class="o">=</span> <span class="n">_latex_tab</span> <span class="o">%</span> <span class="p">(</span><span class="n">_latex_hdr</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span> <span class="o">+</span> <span class="s1">&#39;r&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">),</span> <span class="n">_hdr_row</span><span class="p">,</span> <span class="n">_rows</span><span class="p">,</span> 
            <span class="s1">r&#39;\midrule&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">_sum_row</span> <span class="k">if</span> <span class="n">sum_row</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">_latex_end</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_latex_tab</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">curation_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;curation_stats.tex&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;source_edges&#39;</span><span class="p">,</span> <span class="s1">&#39;Edges&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;source_edges_percentage&#39;</span><span class="p">,</span> <span class="s1">r&#39;Edges [%]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;shared_edges&#39;</span><span class="p">,</span> <span class="s1">&#39;Shared edges&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;specific_edges&#39;</span><span class="p">,</span> <span class="s1">&#39;Specific edges&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;specific_edges_percentage&#39;</span><span class="p">,</span> <span class="s1">r&#39;Specific edges [%]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;source_refs&#39;</span><span class="p">,</span> <span class="s1">&#39;References&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;source_refs_percentage&#39;</span><span class="p">,</span> <span class="s1">r&#39;References [%]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;shared_refs&#39;</span><span class="p">,</span> <span class="s1">&#39;Shared references&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;specific_refs&#39;</span><span class="p">,</span> <span class="s1">&#39;Specific references&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;specific_refs_percentage&#39;</span><span class="p">,</span> <span class="s1">r&#39;Specific references [%]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;source_curation_effort&#39;</span><span class="p">,</span> <span class="s1">&#39;Curation effort&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;shared_curation_effort&#39;</span><span class="p">,</span> <span class="s1">&#39;Shared curation effort&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;source_specific_curation_effort&#39;</span><span class="p">,</span> <span class="s1">&#39;Specific curation effort&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;refs_edges_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;References-edges ratio&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;corrected_curation_effort&#39;</span><span class="p">,</span> <span class="s1">&#39;Corrected curation effort&#39;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">header_format</span> <span class="o">=</span> <span class="s1">r&#39;\rotatebox{90}{\footnotesize </span><span class="si">%s</span><span class="s1">}&#39;</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curation_stats</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_latex</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">header_format</span> <span class="o">=</span> <span class="n">header_format</span><span class="p">,</span> 
            <span class="n">sum_row</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">remove_htp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mi">50</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">htp_stats</span><span class="p">()</span>
        <span class="n">vcount_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span>
        <span class="n">ecount_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">()</span>
        <span class="n">htedgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> \
            <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">htp</span><span class="p">[</span><span class="n">threshold</span><span class="p">][</span><span class="s1">&#39;htrefs&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="n">htedgs</span><span class="p">)</span>
        <span class="n">zerodeg</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">zerodeg</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Interactions from only high-throughput resources &#39;</span>\
            <span class="s1">&#39;have been removed.</span><span class="se">\n\t</span><span class="s1">   </span><span class="si">%u</span><span class="s1"> interactions removed.</span><span class="se">\n\t</span><span class="s1">   Number of edges &#39;</span>\
            <span class="s1">&#39;decreased from </span><span class="si">%u</span><span class="s1"> to </span><span class="si">%u</span><span class="s1">, number of vertices from </span><span class="si">%u</span><span class="s1"> to </span><span class="si">%u</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">htedgs</span><span class="p">),</span> <span class="n">ecount_before</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> 
             <span class="n">vcount_before</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">htp_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">htdata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">refc</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">flatList</span><span class="p">((</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">htlim</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">201</span><span class="p">)):</span>
            <span class="n">htrefs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">refc</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">htlim</span><span class="p">])</span>
            <span class="n">htedgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> \
                <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">pmid</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]])</span> <span class="o">-</span> <span class="n">htrefs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">htsrcs</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="n">flatList</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">htedgs</span><span class="p">]))</span>
            <span class="n">htdata</span><span class="p">[</span><span class="n">htlim</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;rnum&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">htrefs</span><span class="p">),</span>
                <span class="s1">&#39;enum&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">htedgs</span><span class="p">),</span>
                <span class="s1">&#39;snum&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">htsrcs</span><span class="p">),</span>
                <span class="s1">&#39;htrefs&#39;</span><span class="p">:</span> <span class="n">htrefs</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">htp</span> <span class="o">=</span> <span class="n">htdata</span>
    
<div class="viewcode-block" id="PyPath.third_source_directions"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.third_source_directions">[docs]</a>    <span class="k">def</span> <span class="nf">third_source_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This method calls a series of methods to get</span>
<span class="sd">        additional direction &amp; effect information</span>
<span class="sd">        from sources having no literature curated references,</span>
<span class="sd">        but giving sufficient evidence about the directionality</span>
<span class="sd">        for interactions already supported by literature </span>
<span class="sd">        evidences from other sources.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kegg_directions</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laudanna_effects</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laudanna_directions</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wang_effects</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acsn_effects</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phosphosite_directions</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phosphopoint_directions</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phosphonetworks_directions</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mimp_directions</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">kegg_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">keggd</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_kegg</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span><span class="n">keggd</span><span class="p">,</span> <span class="s1">&#39;KEGG&#39;</span><span class="p">,</span> <span class="n">stimulation</span> <span class="o">=</span> <span class="s1">&#39;activation&#39;</span><span class="p">,</span> 
            <span class="n">inhibition</span> <span class="o">=</span> <span class="s1">&#39;inhibition&#39;</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">phosphosite_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">psite</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">phosphosite_directions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span><span class="n">psite</span><span class="p">,</span> <span class="s1">&#39;PhosphoSite_dir&#39;</span><span class="p">,</span> <span class="n">dirs_only</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> 
            <span class="n">id_type</span> <span class="o">=</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">phosphopoint_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">ppoint</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">phosphopoint_directions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span><span class="n">ppoint</span><span class="p">,</span> <span class="s1">&#39;PhosphoPoint&#39;</span><span class="p">,</span> <span class="n">dirs_only</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> 
            <span class="n">id_type</span> <span class="o">=</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">phosphonetworks_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">pnet</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">pnetworks_interactions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span><span class="n">pnet</span><span class="p">,</span> <span class="s1">&#39;PhosphoNetworks&#39;</span><span class="p">,</span> <span class="n">dirs_only</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> 
            <span class="n">id_type</span> <span class="o">=</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">mimp_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">mimp</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">mimp_interactions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span><span class="n">mimp</span><span class="p">,</span> <span class="s1">&#39;MIMP&#39;</span><span class="p">,</span> <span class="n">dirs_only</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> 
            <span class="n">id_type</span> <span class="o">=</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">laudanna_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">laud</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_laudanna_directions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span><span class="n">laud</span><span class="p">,</span> <span class="s1">&#39;Laudanna_sigflow&#39;</span><span class="p">,</span> <span class="n">dirs_only</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> 
            <span class="n">id_type</span> <span class="o">=</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">laudanna_effects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">laud</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_laudanna_effects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span><span class="n">laud</span><span class="p">,</span> <span class="s1">&#39;Laudanna_effects&#39;</span><span class="p">,</span> <span class="n">stimulation</span> <span class="o">=</span> <span class="s1">&#39;activation&#39;</span><span class="p">,</span> 
            <span class="n">inhibition</span> <span class="o">=</span> <span class="s1">&#39;inhibition&#39;</span><span class="p">,</span> <span class="n">directed</span> <span class="o">=</span> <span class="s1">&#39;docking&#39;</span><span class="p">,</span> 
            <span class="n">id_type</span> <span class="o">=</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">acsn_effects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">acsnd</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_acsn_effects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span><span class="n">acsnd</span><span class="p">,</span> <span class="s1">&#39;ACSN&#39;</span><span class="p">,</span> <span class="n">stimulation</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span>
            <span class="n">inhibition</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">directed</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
            <span class="n">id_type</span> <span class="o">=</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">wang_effects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">wangd</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_wang_effects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_directions</span><span class="p">(</span><span class="n">wangd</span><span class="p">,</span> <span class="s1">&#39;Wang&#39;</span><span class="p">,</span> <span class="n">stimulation</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> 
            <span class="n">inhibition</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">directed</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> 
            <span class="n">id_type</span> <span class="o">=</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">process_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">directed</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">stimulation</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">inhibition</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">id_type</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">dirs_only</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">sourcedirs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">newdirs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">newsigns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dirs_only</span> <span class="ow">or</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">stimulation</span> <span class="ow">or</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">inhibition</span> <span class="ow">or</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">directed</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">if</span> <span class="n">id_type</span> <span class="ow">is</span> <span class="bp">None</span> \
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">id_type</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="n">tgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="n">id_type</span> <span class="ow">is</span> <span class="bp">None</span> \
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">id_type</span><span class="p">,</span> <span class="s1">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">src</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tgt</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">v1</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">s</span><span class="p">)</span>
                            <span class="n">v2</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">t</span><span class="p">)</span>
                            <span class="n">e</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">sourcedirs</span> <span class="o">+=</span><span class="mi">1</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)):</span>
                                    <span class="n">newdirs</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="k">if</span> <span class="n">dirs_only</span> <span class="ow">or</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">directed</span><span class="p">:</span>
                                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_dir</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">stimulation</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="s1">&#39;positive&#39;</span><span class="p">):</span>
                                        <span class="n">newsigns</span> <span class="o">+=</span> <span class="mi">1</span>
                                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_sign</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="s1">&#39;positive&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">inhibition</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="s1">&#39;negative&#39;</span><span class="p">):</span>
                                        <span class="n">newsigns</span> <span class="o">+=</span> <span class="mi">1</span>
                                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_sign</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="s1">&#39;negative&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">:: Directions and signs set for </span><span class="si">%u</span><span class="s1"> edges based on </span><span class="si">%s</span><span class="s1">,&#39;</span>\
            <span class="s1">&#39; </span><span class="si">%u</span><span class="s1"> new directions, </span><span class="si">%u</span><span class="s1"> new signs.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sourcedirs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">newdirs</span><span class="p">,</span> <span class="n">newsigns</span><span class="p">))</span>
    
<div class="viewcode-block" id="PyPath.curation_effort"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.curation_effort">[docs]</a>    <span class="k">def</span> <span class="nf">curation_effort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sum_by_source</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the total number of reference-interactions pairs.</span>
<span class="sd">        </span>
<span class="sd">        @sum_by_source : bool</span>
<span class="sd">            If True, counts the refrence-interaction pairs by</span>
<span class="sd">            sources, and returns the sum of these values.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">sum_by_source</span><span class="p">:</span>
            <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rs</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">rs</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;refs_by_source&#39;</span><span class="p">])))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]))</span></div>
    
<div class="viewcode-block" id="PyPath.export_dot"><a class="viewcode-back" href="../../index.html#pypath.pypath.PyPath.export_dot">[docs]</a>    <span class="k">def</span> <span class="nf">export_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">directed</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> 
        <span class="n">labels</span> <span class="o">=</span> <span class="s1">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="n">edges_filter</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="n">nodes_filter</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="n">edge_sources</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">dir_sources</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">return_object</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">save_dot</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">save_graphics</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> 
        <span class="n">prog</span> <span class="o">=</span> <span class="s1">&#39;neato&#39;</span><span class="p">,</span> <span class="n">format</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">hide</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> 
        <span class="n">font</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">auto_edges</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">hide_nodes</span> <span class="o">=</span> <span class="p">[],</span> 
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Builds a pygraphviz.AGraph() object with filtering the edges </span>
<span class="sd">        and vertices along arbitrary criteria.</span>
<span class="sd">        Returns the Agraph object if requesred, or exports the dot</span>
<span class="sd">        file, or saves the graphics.</span>
<span class="sd">        </span>
<span class="sd">        @nodes : list</span>
<span class="sd">        List of vertex ids to be included.</span>
<span class="sd">        @edges : list</span>
<span class="sd">        List of edge ids to be included.</span>
<span class="sd">        @directed : bool</span>
<span class="sd">        Create a directed or undirected graph.</span>
<span class="sd">        @labels : str</span>
<span class="sd">        Name type to be used as id/label in the dot format.</span>
<span class="sd">        @edges_filter : function</span>
<span class="sd">        Function to filter edges, accepting igraph.Edge as argument.</span>
<span class="sd">        @nodes_filter : function</span>
<span class="sd">        Function to filter vertices, accepting igraph.Vertex as argument.</span>
<span class="sd">        @edge_sources : list</span>
<span class="sd">        Sources to be included.</span>
<span class="sd">        @dir_sources : list</span>
<span class="sd">        Direction and effect sources to be included.</span>
<span class="sd">        @graph : igraph.Graph</span>
<span class="sd">        The graph object to export.</span>
<span class="sd">        @return_object : bool</span>
<span class="sd">        Whether to return the pygraphviz.AGraph object.</span>
<span class="sd">        @save_dot : str</span>
<span class="sd">        Filename to export the dot file to.</span>
<span class="sd">        @save_graphics : str</span>
<span class="sd">        Filename to export the graphics, the extension defines the format.</span>
<span class="sd">        @prog : str</span>
<span class="sd">        The graphviz layout algorithm to use.</span>
<span class="sd">        @format : str</span>
<span class="sd">        The graphics format passed to pygraphviz.AGrapg().draw().</span>
<span class="sd">        @hide : bool</span>
<span class="sd">        Hide filtered edges instead of omit them.</span>
<span class="sd">        @hide nodes : list</span>
<span class="sd">        Nodes to hide. List of vertex ids.</span>
<span class="sd">        @auto_edges : str</span>
<span class="sd">        Automatic, built-in style for edges. </span>
<span class="sd">        &#39;DIRECTIONS&#39; or &#39;RESOURCE_CATEGORIES&#39; are supported.</span>
<span class="sd">        @font : str</span>
<span class="sd">        Font to use for labels. </span>
<span class="sd">        For using more than one fonts refer to graphviz attributes with constant values </span>
<span class="sd">        or define callbacks or mapping dictionaries.</span>
<span class="sd">        @defaults : dict</span>
<span class="sd">        Default values for graphviz attributes, labeled with the entity, e.g.</span>
<span class="sd">        `{&#39;edge_penwidth&#39;: 0.2}`.</span>
<span class="sd">        @**kwargs : constant, callable or dict</span>
<span class="sd">        Graphviz attributes, labeled by the target entity. E.g. `edge_penwidth`,</span>
<span class="sd">        &#39;vertex_shape` or `graph_label`. </span>
<span class="sd">        If the value is constant, this value will be used.</span>
<span class="sd">        If the value is dict, and has `_name` as key, for every instance of the</span>
<span class="sd">        given entity, the value of the attribute defined by `_name` will be looked</span>
<span class="sd">        up in the dict, and the corresponding value will be given to the graphviz</span>
<span class="sd">        attribute. If the key `_name` is missing from the dict, igraph vertex and</span>
<span class="sd">        edge indices will be looked up among the keys.</span>
<span class="sd">        If the value is callable, it will be called with the current instance of</span>
<span class="sd">        the entity and the returned value will be used for the graphviz attribute.</span>
<span class="sd">        E.g. `edge_arrowhead(edge)` or `vertex_fillcolor(vertex)`</span>
<span class="sd">        Example:</span>
<span class="sd">            import pypath</span>
<span class="sd">            from pypath import data_formats</span>
<span class="sd">            net = pypath.BioGraph()</span>
<span class="sd">            net.init_network(pfile = &#39;cache/default.pickle&#39;)</span>
<span class="sd">            #net.init_network({&#39;arn&#39;: data_formats.omnipath[&#39;arn&#39;]})</span>
<span class="sd">            tgf = [v.index for v in net.graph.vs if &#39;TGF&#39; in v[&#39;slk_pathways&#39;]]</span>
<span class="sd">            dot = net.export_dot(nodes = tgf, save_graphics = &#39;tgf_slk.pdf&#39;, prog = &#39;dot&#39;,</span>
<span class="sd">                main_title = &#39;TGF-beta pathway&#39;, return_object = True,</span>
<span class="sd">                label_font = &#39;HelveticaNeueLTStd Med Cn&#39;, </span>
<span class="sd">                edge_sources = [&#39;SignaLink3&#39;], </span>
<span class="sd">                dir_sources = [&#39;SignaLink3&#39;], hide = True)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">_attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">_custom_attrs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">graph_attrs</span><span class="p">,</span> <span class="n">vertex_attrs</span><span class="p">,</span> <span class="n">edge_attrs</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_graphviz_attrs</span><span class="p">()</span>
        <span class="n">_defaults</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;edge_color&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;undirected&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;unknown&#39;</span><span class="p">:</span> <span class="s1">&#39;#CCCCCC&#39;</span>
                <span class="p">},</span>
                <span class="s1">&#39;directed&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;stimulation&#39;</span><span class="p">:</span> <span class="s1">&#39;#00CC00&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;inhibition&#39;</span><span class="p">:</span> <span class="s1">&#39;#CC0000&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;unknown&#39;</span><span class="p">:</span> <span class="s1">&#39;#0000CC&#39;</span>
                <span class="p">},</span>
                <span class="s1">&#39;pathway&#39;</span><span class="p">:</span> <span class="s1">&#39;#7AA0A177&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ptm&#39;</span><span class="p">:</span> <span class="s1">&#39;#C6909C77&#39;</span><span class="p">,</span>
                <span class="s1">&#39;reaction&#39;</span><span class="p">:</span> <span class="s1">&#39;#C5B26E77&#39;</span><span class="p">,</span>
                <span class="s1">&#39;interaction&#39;</span><span class="p">:</span> <span class="s1">&#39;#9D8BB777&#39;</span>
            <span class="p">},</span>
            <span class="s1">&#39;edge_arrowhead&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;undirected&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;unknown&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span>
                <span class="p">},</span>
                <span class="s1">&#39;directed&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;stimulation&#39;</span><span class="p">:</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;inhibition&#39;</span><span class="p">:</span> <span class="s1">&#39;tee&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;unknown&#39;</span><span class="p">:</span> <span class="s1">&#39;diamond&#39;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s1">&#39;vertex_fillcolor&#39;</span><span class="p">:</span> <span class="s1">&#39;#AAAAAA&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vertex_fontcolor&#39;</span><span class="p">:</span> <span class="s1">&#39;#000000&#39;</span>
        <span class="p">}</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">_defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="c1">#</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span> <span class="k">if</span> <span class="n">labels</span> <span class="o">==</span> <span class="s1">&#39;uniprot&#39;</span> <span class="k">else</span> <span class="s1">&#39;label&#39;</span>
        <span class="n">edge_sources</span> <span class="o">=</span> <span class="n">edge_sources</span> <span class="k">if</span> <span class="n">edge_sources</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="n">edge_sources</span><span class="p">)</span>
        <span class="n">dir_sources</span> <span class="o">=</span> <span class="n">dir_sources</span> <span class="k">if</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="n">dir_sources</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span> <span class="k">if</span> <span class="n">labels</span> <span class="o">==</span> <span class="s1">&#39;uniprot&#39;</span> <span class="k">else</span> <span class="n">labels</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="s1">&#39;label&#39;</span> <span class="k">if</span> <span class="n">labels</span> <span class="o">==</span> <span class="s1">&#39;genesymbol&#39;</span> <span class="k">else</span> <span class="n">labels</span>
        <span class="k">if</span> <span class="n">labels</span> <span class="o">==</span> <span class="s1">&#39;label&#39;</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">edges</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">())</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>
        <span class="n">dNodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">labels</span><span class="p">])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span> \
            <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">)</span>
        <span class="n">hide_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">hide_nodes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">font</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">_custom_attrs</span><span class="p">[</span><span class="s1">&#39;graph_fontname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span>
            <span class="n">_custom_attrs</span><span class="p">[</span><span class="s1">&#39;vertex_fontname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span>
            <span class="n">_custom_attrs</span><span class="p">[</span><span class="s1">&#39;edge_fontname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span>
        <span class="c1"># attribute callbacks</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;graph&#39;</span><span class="p">,</span> <span class="s1">&#39;vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;edge&#39;</span><span class="p">]:</span>
            <span class="n">callbacks_dict</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_callbacks&#39;</span> <span class="o">%</span> <span class="n">entity</span>
            <span class="n">_attrs</span><span class="p">[</span><span class="n">callbacks_dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">callbacks</span> <span class="o">=</span> <span class="n">_attrs</span><span class="p">[</span><span class="n">callbacks_dict</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entity</span> <span class="o">==</span> <span class="s1">&#39;edge&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">auto_edges</span> <span class="o">==</span> <span class="s1">&#39;RESOURCE_CATEGORIES&#39;</span> <span class="ow">or</span> \
                    <span class="n">auto_edges</span> <span class="o">==</span> <span class="s1">&#39;DIRECTIONS&#39;</span><span class="p">)</span> \
                    <span class="ow">and</span> <span class="s1">&#39;edge_color&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_custom_attrs</span> \
                    <span class="ow">and</span> <span class="s1">&#39;edge_arrowhead&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_custom_attrs</span><span class="p">:</span>
                    <span class="n">callbacks</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">AttrHelper</span><span class="p">(</span><span class="n">auto_edges</span><span class="p">,</span> <span class="s1">&#39;edge_color&#39;</span><span class="p">,</span> <span class="n">_defaults</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">auto_edges</span> <span class="o">==</span> <span class="s1">&#39;DIRECTIONS&#39;</span><span class="p">:</span>
                        <span class="n">callbacks</span><span class="p">[</span><span class="s1">&#39;arrowhead&#39;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">AttrHelper</span><span class="p">(</span><span class="n">auto_edges</span><span class="p">,</span> <span class="s1">&#39;edge_arrowhead&#39;</span><span class="p">,</span> <span class="n">_defaults</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">callbacks</span><span class="p">[</span><span class="s1">&#39;arrowhead&#39;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">AttrHelper</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;edge_arrowhead&#39;</span><span class="p">,</span> <span class="n">_defaults</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_attrs&#39;</span><span class="o">%</span><span class="n">entity</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">callback_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">callback_name</span> <span class="ow">in</span> <span class="n">_custom_attrs</span><span class="p">:</span>
                    <span class="n">callback_value</span> <span class="o">=</span> <span class="n">_custom_attrs</span><span class="p">[</span><span class="n">callback_name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">callback_value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;_name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">callback_value</span><span class="p">:</span>
                            <span class="n">callback_value</span><span class="p">[</span><span class="s1">&#39;_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span>
                    <span class="n">callbacks</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">AttrHelper</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">callback_value</span><span class="p">,</span> 
                        <span class="n">name</span> <span class="o">=</span> <span class="n">attr</span><span class="p">,</span> <span class="n">defaults</span> <span class="o">=</span> <span class="n">_defaults</span><span class="p">)</span>
        <span class="c1"># graph</span>
        <span class="n">dot</span> <span class="o">=</span> <span class="n">graphviz</span><span class="o">.</span><span class="n">AGraph</span><span class="p">(</span><span class="n">directed</span> <span class="o">=</span> <span class="n">directed</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">gattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">_attrs</span><span class="p">[</span><span class="s1">&#39;graph_callbacks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">attrs</span><span class="p">[</span><span class="n">gattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">cleanDict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">gattr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">dot</span><span class="o">.</span><span class="n">graph_attr</span><span class="p">[</span><span class="n">gattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1"># vertices</span>
        <span class="k">for</span> <span class="n">vid</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">dNodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">vattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">_attrs</span><span class="p">[</span><span class="s1">&#39;vertex_callbacks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">attrs</span><span class="p">[</span><span class="n">vattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vid</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">vid</span> <span class="ow">in</span> <span class="n">hide_nodes</span><span class="p">:</span>
                <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;invis&#39;</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="n">cleanDict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
            <span class="n">dot</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
        <span class="c1"># edges</span>
        <span class="n">edge_callbacks</span> <span class="o">=</span> <span class="n">_attrs</span><span class="p">[</span><span class="s1">&#39;edge_callbacks&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">eid</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span><span class="o">.</span><span class="n">source</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span><span class="o">.</span><span class="n">target</span>
            <span class="n">sn</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">tn</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">sl</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">labels</span><span class="p">]</span>
            <span class="n">tl</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">labels</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span>
            <span class="c1"># this edge should be visible at all?</span>
            <span class="n">evis</span> <span class="o">=</span> <span class="n">edges_filter</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">])</span> <span class="ow">and</span> \
                <span class="n">nodes_filter</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="ow">and</span> <span class="n">nodes_filter</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="n">edge_sources</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                    <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">edge_sources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span><span class="o">.</span><span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hide_nodes</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span><span class="o">.</span><span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hide_nodes</span>
            <span class="k">if</span> <span class="n">evis</span> <span class="ow">or</span> <span class="n">hide</span><span class="p">:</span>
                <span class="n">drawn_directed</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
                <span class="n">thisDir</span> <span class="o">=</span> <span class="s1">&#39;undirected&#39;</span>
                <span class="n">thisSources</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
                <span class="k">if</span> <span class="n">directed</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">sn</span><span class="p">,</span> <span class="n">tn</span><span class="p">)):</span>
                        <span class="n">sdir</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">sn</span><span class="p">,</span> <span class="n">tn</span><span class="p">),</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                        <span class="n">thisDir</span> <span class="o">=</span> <span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
                        <span class="n">vis</span> <span class="o">=</span> <span class="p">(</span><span class="n">dir_sources</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">sdir</span> <span class="o">&amp;</span> <span class="n">dir_sources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">evis</span>
                        <span class="k">if</span> <span class="n">vis</span> <span class="ow">or</span> <span class="n">hide</span><span class="p">:</span>
                            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="n">sign</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_sign</span><span class="p">((</span><span class="n">sn</span><span class="p">,</span> <span class="n">tn</span><span class="p">))</span>
                            <span class="n">ssign</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_sign</span><span class="p">((</span><span class="n">sn</span><span class="p">,</span> <span class="n">tn</span><span class="p">),</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                            <span class="n">drawn_directed</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="k">if</span> <span class="n">vis</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                                <span class="n">dir_sources</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">ssign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;stimulation&#39;</span>
                                <span class="n">thisSources</span> <span class="o">=</span> <span class="n">ssign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> \
                                    <span class="n">ssign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span>
                                <span class="k">for</span> <span class="n">eattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">edge_callbacks</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                    <span class="n">attrs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">],</span> 
                                        <span class="n">thisDir</span><span class="p">,</span> <span class="n">thisSign</span><span class="p">,</span> <span class="n">thisDirSources</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">]))</span>
                            <span class="k">elif</span> <span class="n">vis</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                                <span class="n">dir_sources</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">ssign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;inhibition&#39;</span>
                                <span class="n">thisSoures</span> <span class="o">=</span> <span class="n">ssign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> \
                                    <span class="n">ssign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span>
                                <span class="k">for</span> <span class="n">eattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">edge_callbacks</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                    <span class="n">attrs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">],</span> 
                                        <span class="n">thisDir</span><span class="p">,</span> <span class="n">thisSign</span><span class="p">,</span> <span class="n">thisSources</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">]))</span>
                            <span class="k">elif</span> <span class="n">vis</span><span class="p">:</span>
                                <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
                                <span class="n">thisSources</span> <span class="o">=</span> <span class="n">sdir</span>
                                <span class="k">for</span> <span class="n">eattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">edge_callbacks</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                    <span class="n">attrs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">],</span> 
                                        <span class="n">thisDir</span><span class="p">,</span> <span class="n">thisSign</span><span class="p">,</span> <span class="n">thisSources</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">]))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;invis&#39;</span>
                                <span class="n">drawn_directed</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="n">attrs</span> <span class="o">=</span> <span class="n">cleanDict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
                            <span class="n">dot</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">tl</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">tn</span><span class="p">,</span> <span class="n">sn</span><span class="p">)):</span>
                        <span class="n">sdir</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">tn</span><span class="p">,</span> <span class="n">sn</span><span class="p">),</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                        <span class="n">thisDir</span> <span class="o">=</span> <span class="p">(</span><span class="n">tn</span><span class="p">,</span> <span class="n">sn</span><span class="p">)</span>
                        <span class="n">vis</span> <span class="o">=</span> <span class="p">(</span><span class="n">dir_sources</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">sdir</span> <span class="o">&amp;</span> <span class="n">dir_sources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">evis</span>
                        <span class="k">if</span> <span class="n">vis</span> <span class="ow">or</span> <span class="n">hide</span><span class="p">:</span>
                            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="n">sign</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_sign</span><span class="p">((</span><span class="n">tn</span><span class="p">,</span> <span class="n">sn</span><span class="p">))</span>
                            <span class="n">ssign</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_sign</span><span class="p">((</span><span class="n">tn</span><span class="p">,</span> <span class="n">sn</span><span class="p">),</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                            <span class="n">drawn_directed</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="k">if</span> <span class="n">vis</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                                <span class="n">dir_sources</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">ssign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;stimulation&#39;</span>
                                <span class="n">thisSources</span> <span class="o">=</span> <span class="n">ssign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> \
                                    <span class="n">ssign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span>
                                <span class="k">for</span> <span class="n">eattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">edge_callbacks</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                    <span class="n">attrs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">],</span> 
                                        <span class="n">thisDir</span><span class="p">,</span> <span class="n">thisSign</span><span class="p">,</span> <span class="n">thisSources</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">]))</span>
                            <span class="k">elif</span> <span class="n">vis</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                                <span class="n">dir_sources</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">ssign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;inhibition&#39;</span>
                                <span class="n">thisSources</span> <span class="o">=</span> <span class="n">ssign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">dir_sources</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> \
                                    <span class="n">ssign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dir_sources</span>
                                <span class="k">for</span> <span class="n">eattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">edge_callbacks</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                    <span class="n">attrs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">],</span> 
                                        <span class="n">thisDir</span><span class="p">,</span> <span class="n">thisSign</span><span class="p">,</span> <span class="n">thisSources</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">]))</span>
                            <span class="k">elif</span> <span class="n">vis</span><span class="p">:</span>
                                <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
                                <span class="n">thisSources</span> <span class="o">=</span> <span class="n">sdir</span>
                                <span class="k">for</span> <span class="n">eattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">edge_callbacks</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                    <span class="n">attrs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">],</span> 
                                        <span class="n">thisDir</span><span class="p">,</span> <span class="n">thisSign</span><span class="p">,</span> <span class="n">thisSources</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">]))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;invis&#39;</span>
                                <span class="n">drawn_directed</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="n">attrs</span> <span class="o">=</span> <span class="n">cleanDict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
                            <span class="n">dot</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">tl</span><span class="p">,</span> <span class="n">sl</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">directed</span> <span class="ow">or</span> <span class="n">d</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">):</span>
                    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">thisDir</span> <span class="o">=</span> <span class="s1">&#39;undirected&#39;</span>
                    <span class="n">thisSign</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
                    <span class="n">thisSources</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s1">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">eattr</span><span class="p">,</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">edge_callbacks</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                        <span class="n">attrs</span><span class="p">[</span><span class="n">eattr</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">],</span> <span class="n">thisDir</span><span class="p">,</span> <span class="n">thisSign</span><span class="p">,</span> 
                            <span class="n">thisSources</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s1">&#39;sources&#39;</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">evis</span> <span class="ow">and</span> <span class="n">hide</span><span class="p">)</span> <span class="ow">or</span> <span class="n">drawn_directed</span><span class="p">:</span>
                        <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;invis&#39;</span>
                    <span class="k">if</span> <span class="n">dot</span><span class="o">.</span><span class="n">has_neighbor</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">tl</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">dot</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">tl</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
                            <span class="s1">&#39;invis&#39;</span> <span class="ow">in</span> <span class="n">dot</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">tl</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]:</span>
                            <span class="n">dot</span><span class="o">.</span><span class="n">delete_edge</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">tl</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">dot</span><span class="o">.</span><span class="n">has_neighbor</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">tl</span><span class="p">):</span>
                        <span class="n">attrs</span> <span class="o">=</span> <span class="n">cleanDict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
                        <span class="n">dot</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">sl</span><span class="p">,</span> <span class="n">tl</span><span class="p">),</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">save_dot</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">]):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_dot</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dot</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">save_graphics</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">]):</span>
            <span class="n">dot</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">save_graphics</span><span class="p">,</span> <span class="n">format</span> <span class="o">=</span> <span class="n">format</span><span class="p">,</span> <span class="n">prog</span> <span class="o">=</span> <span class="n">prog</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_object</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dot</span></div>
    
    <span class="k">def</span> <span class="nf">consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">con</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="p">((</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span>
                        <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">set</span><span class="p">([])</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;edges&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">),</span> \
                            <span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="s1">&#39;major&#39;</span><span class="p">])))</span> \
                        <span class="k">for</span> <span class="n">s1</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">sources</span> <span class="k">for</span> <span class="n">s2</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">sources</span><span class="p">)),</span> \
                <span class="p">[</span><span class="s1">&#39;directions&#39;</span><span class="p">,</span> <span class="s1">&#39;directions_edges&#39;</span><span class="p">,</span> <span class="s1">&#39;signs&#39;</span><span class="p">,</span> <span class="s1">&#39;signs_edges&#39;</span><span class="p">]))),</span> \
            <span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">,</span> <span class="s1">&#39;inconsistency&#39;</span><span class="p">]))</span>
        <span class="c1"># inconsistency #</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Counting inconsistency&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="n">s12</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">()</span> <span class="ow">and</span> \
                        <span class="n">s1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">()</span> <span class="ow">and</span> \
                        <span class="n">s2</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">()</span> <span class="ow">and</span> \
                        <span class="n">s2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">()</span> <span class="ow">or</span> \
                        <span class="n">s2</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">()</span> <span class="ow">and</span> \
                        <span class="n">s2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">()</span> <span class="ow">and</span> \
                        <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">()</span> <span class="ow">and</span> \
                        <span class="n">s1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">()</span> <span class="ow">and</span> <span class="n">s1</span> <span class="o">!=</span> <span class="n">s2</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">()):</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">()):</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">()</span> <span class="ow">and</span> \
                        <span class="n">s2</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">()</span> <span class="ow">or</span> \
                        <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">()</span> <span class="ow">and</span> \
                        <span class="n">s2</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">():</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="o">&gt;</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">()):</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="o">&lt;</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">()):</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">()</span> <span class="ow">and</span> \
                        <span class="n">s2</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">()</span> <span class="ow">or</span> \
                        <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">()</span> <span class="ow">and</span> \
                        <span class="n">s2</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">s1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">():</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="o">&gt;</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">()):</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="o">&lt;</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">()):</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;inconsistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="c1"># consistency #</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Counting consistency&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="n">s12</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;dirs&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">s12</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">())</span> <span class="ow">and</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">())</span> <span class="ow">and</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s12</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">())</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="ow">and</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_reverse</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="ow">and</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;directions&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;directions_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s12</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="ow">and</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="ow">and</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s12</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">())</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">())</span> <span class="ow">and</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">())</span> <span class="ow">and</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s12</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="ow">and</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_reverse</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="ow">and</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">positive_sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s12</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">():</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">())</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">())</span> <span class="ow">and</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;major&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_reverse</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">())</span> <span class="ow">and</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">s12</span> <span class="o">&amp;</span> <span class="n">d</span><span class="o">.</span><span class="n">negative_sources_straight</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">con</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">][</span><span class="s1">&#39;signs&#39;</span><span class="p">][</span><span class="s1">&#39;signs_edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)][</span><span class="s1">&#39;minor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">con</span>
    
    <span class="k">def</span> <span class="nf">_disclaimer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disclaimer</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">licence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disclaimer</span><span class="p">()</span></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Dénes Türei.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1.72',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>