<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>bioigraph.bioigraph &mdash; bioigraph 0.1.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="bioigraph 0.1.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">bioigraph 0.1.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for bioigraph.bioigraph</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python2</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c">#</span>
<span class="c">#  This file is part of the `bioigraph` python module</span>
<span class="c">#</span>
<span class="c">#  Copyright (c) 2014-2015 - EMBL-EBI</span>
<span class="c">#</span>
<span class="c">#  File author(s): Dénes Türei (denes@ebi.ac.uk)</span>
<span class="c">#</span>
<span class="c">#  Distributed under the GPLv3 License.</span>
<span class="c">#  See accompanying file LICENSE.txt or copy at</span>
<span class="c">#      http://www.gnu.org/licenses/gpl-3.0.html</span>
<span class="c">#</span>
<span class="c">#  Website: http://www.ebi.ac.uk/~denes</span>
<span class="c">#</span>

<span class="c"># import main</span>
<span class="kn">import</span> <span class="nn">__main__</span>

<span class="c"># external modules:</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">igraph</span>
<span class="kn">import</span> <span class="nn">cairo</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">import</span> <span class="nn">cPickle</span> <span class="kn">as</span> <span class="nn">pickle</span>

<span class="c"># from this module:</span>
<span class="kn">import</span> <span class="nn">logn</span>
<span class="kn">import</span> <span class="nn">data_formats</span>
<span class="kn">import</span> <span class="nn">mapping</span>
<span class="kn">import</span> <span class="nn">descriptions</span>
<span class="kn">import</span> <span class="nn">chembl</span>
<span class="kn">import</span> <span class="nn">gdsc</span>
<span class="kn">import</span> <span class="nn">mysql</span>
<span class="kn">import</span> <span class="nn">dataio</span>
<span class="kn">import</span> <span class="nn">intera</span>
<span class="kn">import</span> <span class="nn">drawing</span> <span class="kn">as</span> <span class="nn">bdrawing</span>
<span class="kn">from</span> <span class="nn">ig_drawing</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">common</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">colorgen</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">gr_plot</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">progress</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">data_formats</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;PlotParam&#39;</span><span class="p">,</span> <span class="s">&#39;BioGraph&#39;</span><span class="p">,</span> <span class="s">&#39;Direction&#39;</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">PlotParam</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">graphix_dir</span> <span class="o">=</span> <span class="s">&quot;pdf&quot;</span><span class="p">,</span>
        <span class="n">graphix_format</span> <span class="o">=</span> <span class="s">&quot;pdf&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="s">&quot;fruchterman_reingold&quot;</span><span class="p">,</span> <span class="n">vertex_label</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">vertex_size</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">vertex_color</span> <span class="o">=</span> <span class="s">&quot;#87AADEAA&quot;</span><span class="p">,</span> <span class="n">vertex_label_color</span> <span class="o">=</span> <span class="s">&quot;#000033CC&quot;</span><span class="p">,</span>
        <span class="n">vertex_label_size</span> <span class="o">=</span> <span class="s">&quot;degree_label_size&quot;</span><span class="p">,</span> <span class="n">edge_width</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span> 
        <span class="n">edge_color</span> <span class="o">=</span> <span class="s">&quot;#CCCCCCAA&quot;</span><span class="p">,</span> <span class="n">vertex_frame_color</span> <span class="o">=</span> <span class="s">&quot;#FFFFFF00&quot;</span><span class="p">,</span> 
        <span class="n">vertex_frame_width</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vertex_fill_alpha</span> <span class="o">=</span> <span class="s">&quot;AA&quot;</span><span class="p">,</span> 
        <span class="n">vertex_label_font</span> <span class="o">=</span> <span class="s">&quot;sans-serif&quot;</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="s">&quot;rainbow&quot;</span><span class="p">,</span> 
        <span class="n">bbox</span><span class="o">=</span><span class="n">igraph</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1260</span><span class="p">,</span> <span class="mi">1260</span><span class="p">),</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1280</span><span class="p">,</span> <span class="mi">1280</span><span class="p">),</span> <span class="n">grouping</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Direction</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">straight</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s">&#39;undirected&#39;</span><span class="p">:</span> <span class="bp">False</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="p">[],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">&#39;undirected&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positive</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negative</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="p">[],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">:</span> <span class="p">[],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mechanisms</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">methods</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;Directions and signs of interaction between </span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="se">\n\n</span><span class="s">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s"> ===&gt; </span><span class="si">%s</span><span class="s"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s"> &lt;=== </span><span class="si">%s</span><span class="s"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="s">&#39;undirected&#39;</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s"> ==== </span><span class="si">%s</span><span class="s"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s">&#39;undirected&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s"> =+=&gt; </span><span class="si">%s</span><span class="s"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> \
                <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s"> &lt;=+= </span><span class="si">%s</span><span class="s"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> \
                <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s"> =-=&gt; </span><span class="si">%s</span><span class="s"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> \
                <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s"> &lt;=-= </span><span class="si">%s</span><span class="s"> :: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> \
                <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">s</span>
    
    <span class="k">def</span> <span class="nf">check_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">nodes</span><span class="p">)))</span>
    
    <span class="k">def</span> <span class="nf">check_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">di</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">di</span> <span class="o">==</span> <span class="s">&#39;undirected&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">di</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">di</span><span class="p">)))</span>
    
    <span class="k">def</span> <span class="nf">set_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds directionality information with </span>
<span class="sd">        the corresponding data source named.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">+</span> <span class="n">source</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns boolean or list of sources</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sources</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">get_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns all directions with boolean values</span>
<span class="sd">        or list of sources.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">tgt</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sources</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">query</span><span class="p">],</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[(</span><span class="n">query</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">query</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s">&#39;undirected&#39;</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">query</span><span class="p">],</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[(</span><span class="n">query</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">query</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="s">&#39;undirected&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">which_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">!=</span> <span class="s">&#39;undirected&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">unset_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Removes directionality information,</span>
<span class="sd">        or single source.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">check_param</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">direction</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">is_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s">&#39;undirected&#39;</span><span class="p">]))</span>
    
    <span class="k">def</span> <span class="nf">is_stimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">is_inhibition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">has_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">postive</span><span class="p">[</span><span class="n">direction</span><span class="p">]))</span>
    
    <span class="k">def</span> <span class="nf">set_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s">&#39;positive&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">sign</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sources</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s">&#39;positive&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s">&#39;negative&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s">&#39;positive&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s">&#39;negative&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]]</span>
    
    <span class="k">def</span> <span class="nf">unset_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">direction</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s">&#39;positive&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s">&#39;negative&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s">&#39;positive&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s">&#39;negative&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="n">direction</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;Direction&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nodes</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="s">&#39;undirected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="s">&#39;undirected&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">dirs</span><span class="p">[</span><span class="s">&#39;undirected&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="o">+</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="o">+</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s">&#39;undirected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s">&#39;undirected&#39;</span><span class="p">]</span> <span class="o">+</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s">&#39;undirected&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">uniqList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">positive_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">straight</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">uniqList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">]</span> <span class="o">+</span> \
                <span class="n">other</span><span class="o">.</span><span class="n">negative_sources</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">])</span>

<div class="viewcode-block" id="BioGraph"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph">[docs]</a><span class="k">class</span> <span class="nc">BioGraph</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="c">###</span>
    <span class="c">### main network object</span>
    <span class="c">###</span>
    
    <span class="n">default_name_type</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;protein&quot;</span><span class="p">:</span> <span class="s">&quot;uniprot&quot;</span><span class="p">,</span> 
        <span class="s">&quot;mirna&quot;</span><span class="p">:</span> <span class="s">&quot;mirbase&quot;</span><span class="p">,</span> 
        <span class="s">&quot;drug&quot;</span><span class="p">:</span> <span class="s">&quot;chembl&quot;</span>
    <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ncbi_tax_id</span><span class="p">,</span> <span class="n">default_name_type</span><span class="o">=</span><span class="n">default_name_type</span><span class="p">,</span>
                 <span class="n">copy</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">mysql</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;mapping&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;unnamed&#39;</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="s">&#39;results&#39;</span><span class="p">,</span>
                 <span class="n">loglevel</span><span class="o">=</span><span class="s">&#39;INFO&#39;</span><span class="p">):</span>
        <span class="c"># mysql gives the parameters of mysql server, if available</span>
        <span class="c"># it is a dict like this: </span>
            <span class="c">#{</span>
              <span class="c">#&quot;host&quot;: 127.0.0.1, </span>
              <span class="c">#&quot;user&quot;: &quot;somebody&quot;, </span>
              <span class="c">#&quot;passwd&quot;: &quot;xxxx&quot;, </span>
              <span class="c">#&quot;db&quot;: &quot;mydb&quot;</span>
            <span class="c">#}</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;results&#39;</span><span class="p">,</span> <span class="s">&#39;log&#39;</span><span class="p">,</span> <span class="s">&#39;cache&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">copy</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
            <span class="n">g</span><span class="p">[</span><span class="s">&#39;entity_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">g</span><span class="p">[</span><span class="s">&#39;ncbi_tax_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ncbi_tax_id</span>
            <span class="n">g</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">g</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">g</span><span class="p">[</span><span class="s">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">g</span><span class="p">[</span><span class="s">&#39;directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;nameType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;originalNames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;ncbi_tax_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;refs_by_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;negative_refs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;negative&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">g</span><span class="p">[</span><span class="s">&#39;layout_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">g</span><span class="p">[</span><span class="s">&#39;layout_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">g</span><span class="p">[</span><span class="s">&#39;only_directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">failed_edges</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edges_depod</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uniprot_mapped</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mysql_conf</span> <span class="o">=</span> <span class="n">mysql</span>
            <span class="c"># self.mysql = mysql.MysqlRunner(self.mysql_conf)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unmapped</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="o">=</span> <span class="n">outdir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">ncbi_tax_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">negatives</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lists</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plots</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathway_types</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathways</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">gen_session_id</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session_name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span> <span class="o">=</span> <span class="n">loglevel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span> <span class="o">=</span> <span class="n">logn</span><span class="o">.</span><span class="n">logw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">Mapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span> 
                                         <span class="n">mysql_conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mysql_conf</span><span class="p">,</span> <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;bioIgraph has been initialized&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Beginning session &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;\t» New session started,\n\tsession ID: &#39;%s&#39;\n\tlogfile: &#39;./%s&#39;.\n&quot;&quot;&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">logfile</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">__dict__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Reinitialized&quot;</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">init_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_mappings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_reflists</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_resources</span><span class="p">()</span>
    
    <span class="c">###</span>
    <span class="c">### functions to read networks from text files or mysql</span>
    <span class="c">###</span>
    
    <span class="k">def</span> <span class="nf">get_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attrList</span><span class="p">):</span>
        <span class="n">maxC</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attrList</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">maxC</span><span class="p">:</span>
                <span class="n">maxC</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">maxC</span>
    
    <span class="k">def</span> <span class="nf">get_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">line</span><span class="p">,</span><span class="n">spec</span><span class="p">,</span><span class="n">lnum</span><span class="p">):</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
            <span class="c"># extraEdgeAttrs and extraNodeAttrs are dicts </span>
            <span class="c"># of additional parameters assigned to edges and nodes respectively;</span>
            <span class="c"># key is the name of the parameter, value is the col number, </span>
            <span class="c"># or a tuple of col number and the separator, </span>
            <span class="c"># if the column contains additional subfields e.g. (5, &quot;;&quot;)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                    <span class="n">fieldVal</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fieldVal</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">]]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;&quot;&quot;Wrong column index (</span><span class="si">%s</span><span class="s">) in extra attributes? </span>
<span class="s">                    Line #</span><span class="si">%u</span><span class="se">\n</span><span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> <span class="n">lnum</span><span class="p">)),</span> <span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">readError</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>
            <span class="n">fieldName</span> <span class="o">=</span> <span class="n">col</span>
            <span class="n">attrs</span><span class="p">[</span><span class="n">fieldName</span><span class="p">]</span> <span class="o">=</span> <span class="n">fieldVal</span>
        <span class="k">return</span> <span class="n">attrs</span>
    
    <span class="k">def</span> <span class="nf">get_taxon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tax_dict</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;A&#39;</span> <span class="ow">in</span> <span class="n">tax_dict</span> <span class="ow">and</span> <span class="s">&#39;B&#39;</span> <span class="ow">in</span> <span class="n">tax_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_taxon</span><span class="p">(</span><span class="n">tax_dict</span><span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">),</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_taxon</span><span class="p">(</span><span class="n">tax_dict</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fields</span><span class="p">[</span><span class="n">tax_dict</span><span class="p">[</span><span class="s">&#39;col&#39;</span><span class="p">]]</span> <span class="ow">in</span> <span class="n">tax_dict</span><span class="p">[</span><span class="s">&#39;dict&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">tax_dict</span><span class="p">[</span><span class="s">&#39;dict&#39;</span><span class="p">][</span><span class="n">fields</span><span class="p">[</span><span class="n">tax_dict</span><span class="p">[</span><span class="s">&#39;col&#39;</span><span class="p">]]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
    
<div class="viewcode-block" id="BioGraph.get_giant"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph.get_giant">[docs]</a>    <span class="k">def</span> <span class="nf">get_giant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the giant component of the graph, or </span>
<span class="sd">        replaces the igraph object with only the giant </span>
<span class="sd">        component.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">gg</span> <span class="o">=</span> <span class="n">g</span> <span class="k">if</span> <span class="n">replace</span> <span class="k">else</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">cl</span> <span class="o">=</span> <span class="n">gg</span><span class="o">.</span><span class="n">components</span><span class="p">()</span>
        <span class="n">cl_sizes</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">sizes</span><span class="p">()</span>
        <span class="n">giant_component_index</span> <span class="o">=</span> <span class="n">cl_sizes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cl_sizes</span><span class="p">))</span>
        <span class="n">in_giant</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">==</span> <span class="n">giant_component_index</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cl</span><span class="o">.</span><span class="n">membership</span><span class="p">]</span>
        <span class="n">console</span><span class="p">(</span><span class="s">&#39;:: Nodes in giant component: </span><span class="si">%u</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">in_giant</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">gg</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">in_giant</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">gg</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span>
        <span class="n">console</span><span class="p">(</span><span class="s">&#39;:: Giant component size: </span><span class="si">%u</span><span class="s"> edges, </span><span class="si">%u</span><span class="s"> nodes&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="n">gg</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> <span class="n">gg</span><span class="o">.</span><span class="n">vcount</span><span class="p">()))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">replace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gg</span>
    </div>
    <span class="k">def</span> <span class="nf">update_vname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())))</span>
    
    <span class="k">def</span> <span class="nf">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">keep_raw</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">edgeList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nodeList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s">&quot;ReadSettings&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;&quot;&quot;No proper input file definition!</span><span class="se">\n\&#39;</span><span class="s">settings</span><span class="se">\&#39;</span><span class="s"></span>
<span class="s">                should be a </span><span class="se">\&#39;</span><span class="s">ReadSettings</span><span class="se">\&#39;</span><span class="s"> instance</span><span class="se">\n</span><span class="s">&quot;&quot;&quot;</span><span class="p">),</span> <span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: No such file or dataio function! :(</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fromA</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameTypeA</span>
            <span class="n">toA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">typeA</span><span class="p">]</span>
            <span class="n">fromB</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameTypeB</span>
            <span class="n">toB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">typeB</span><span class="p">]</span>
            <span class="n">mapOne</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fromA</span><span class="p">,</span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="n">toA</span><span class="p">])</span>
            <span class="n">mapTwo</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fromB</span><span class="p">,</span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="n">toB</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">mapOne</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">tables</span> <span class="ow">and</span> <span class="n">fromA</span> <span class="o">!=</span> <span class="n">toA</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_table_error</span><span class="p">(</span><span class="n">fromA</span><span class="p">,</span> <span class="n">toA</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">mapTwo</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">tables</span> <span class="ow">and</span> <span class="n">fromB</span> <span class="o">!=</span> <span class="n">toB</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_table_error</span><span class="p">(</span><span class="n">fromB</span><span class="p">,</span> <span class="n">toB</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">toA</span> <span class="o">==</span> <span class="s">&quot;uniprot&quot;</span> <span class="ow">or</span> <span class="n">toB</span> <span class="o">==</span> <span class="s">&quot;uniprot&quot;</span><span class="p">)</span> 
                <span class="ow">and</span> <span class="s">&quot;uniprot-sec_uniprot-pri&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">tables</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_table_error</span><span class="p">(</span><span class="s">&quot;uniprot-sec&quot;</span><span class="p">,</span> <span class="s">&quot;uniprot-pri&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="c"># reading from local file, or executing import function:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">):</span>
                <span class="n">toCall</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">]</span>
                <span class="n">infile</span> <span class="o">=</span> <span class="n">toCall</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="o">.</span><span class="n">inputArgs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;Retrieving data by dataio.</span><span class="si">%s</span><span class="s">() ...&quot;</span> <span class="o">%</span> \
                    <span class="n">toCall</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">infile</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> opened...&quot;</span> <span class="o">%</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span>
            <span class="c"># finding the largest referred column number, </span>
            <span class="c"># to avoid references out of range</span>
            <span class="n">isDir</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">isDirected</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">sign</span>
            <span class="n">refCol</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">refs</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sigCol</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dirCol</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">isDir</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="n">isDir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dirVal</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">isDir</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="n">isDir</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">refs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">maxCol</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="p">[</span> 
                    <span class="n">settings</span><span class="o">.</span><span class="n">nameColA</span><span class="p">,</span> 
                    <span class="n">settings</span><span class="o">.</span><span class="n">nameColB</span><span class="p">,</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_max</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">extraEdgeAttrs</span><span class="p">),</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_max</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">extraNodeAttrsA</span><span class="p">),</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_max</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">extraNodeAttrsB</span><span class="p">),</span>
                    <span class="n">refCol</span><span class="p">,</span><span class="n">dirCol</span><span class="p">,</span><span class="n">sigCol</span>
                <span class="p">])</span>
            <span class="c"># iterating lines from input file</span>
            <span class="n">lnum</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">readError</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lnum</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">header</span><span class="p">):</span>
                    <span class="c"># empty lines</span>
                    <span class="c"># or header row</span>
                    <span class="n">lnum</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">separator</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>
                <span class="c"># in case line has less fields than needed</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxCol</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span>
                        <span class="s">&quot;Line #</span><span class="si">%u</span><span class="s"> has less than </span><span class="si">%u</span><span class="s"> fields! :(</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">maxCol</span><span class="p">)),</span>
                        <span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="n">readError</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># reading names and attributes</span>
                    <span class="c"># try:</span>
                    <span class="k">if</span> <span class="n">isDir</span> <span class="o">!=</span> <span class="bp">True</span><span class="p">:</span>
                        <span class="n">isDir</span> <span class="o">=</span> <span class="p">(</span><span class="bp">False</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">isDir</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span> <span class="k">else</span> 
                            <span class="bp">True</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="n">isDir</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="ow">in</span> <span class="n">isDir</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="bp">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">refCol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">refs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">refCol</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
                    <span class="c"># to give an easy way:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                        <span class="n">taxA</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span>
                        <span class="n">taxB</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span>
                    <span class="c"># to enable more sophisticated inputs:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                        <span class="n">taxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_taxon</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">ncbiTaxId</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">taxx</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                            <span class="n">taxA</span> <span class="o">=</span> <span class="n">taxx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">taxB</span> <span class="o">=</span> <span class="n">taxx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">taxA</span> <span class="o">=</span> <span class="n">taxB</span> <span class="o">=</span> <span class="n">taxx</span>
                    <span class="k">if</span> <span class="n">taxA</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">taxB</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">stim</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">inh</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">sign</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">sign</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span> \
                            <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]]):</span>
                            <span class="n">stim</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">sign</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">sign</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span> \
                            <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="n">sign</span><span class="p">[</span><span class="mi">2</span><span class="p">]]):</span>
                            <span class="n">inh</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">newEdge</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s">&quot;nameA&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">nameColA</span><span class="p">],</span> 
                        <span class="s">&quot;nameB&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">nameColB</span><span class="p">],</span> 
                        <span class="s">&quot;nameTypeA&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameTypeA</span><span class="p">,</span> 
                        <span class="s">&quot;nameTypeB&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameTypeB</span><span class="p">,</span> 
                        <span class="s">&quot;typeA&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">typeA</span><span class="p">,</span> 
                        <span class="s">&quot;typeB&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">typeB</span><span class="p">,</span> 
                        <span class="s">&quot;source&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
                        <span class="s">&quot;isDirected&quot;</span><span class="p">:</span> <span class="n">isDir</span><span class="p">,</span>
                        <span class="s">&quot;references&quot;</span><span class="p">:</span> <span class="n">refs</span><span class="p">,</span>
                        <span class="s">&quot;stim&quot;</span><span class="p">:</span> <span class="n">stim</span><span class="p">,</span>
                        <span class="s">&quot;inh&quot;</span><span class="p">:</span> <span class="n">inh</span><span class="p">,</span>
                        <span class="s">&quot;taxA&quot;</span><span class="p">:</span> <span class="n">taxA</span><span class="p">,</span>
                        <span class="s">&quot;taxB&quot;</span><span class="p">:</span> <span class="n">taxB</span><span class="p">,</span>
                        <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">intType</span><span class="p">}</span>
                    <span class="c">#except:</span>
                        <span class="c">#self.ownlog.msg(2,(&quot;&quot;&quot;Wrong name column indexes (%u and %u), </span>
                            <span class="c">#or wrong separator (%s)? Line #%u\n&quot;&quot;&quot; </span>
                            <span class="c">#% (</span>
                                <span class="c">#settings.nameColA, settings.nameColB, </span>
                                <span class="c">#settings.separator, lnum)), &#39;ERROR&#39;)</span>
                        <span class="c">#readError = 1</span>
                        <span class="c">#break</span>
                    <span class="c"># getting additional edge and node attributes</span>
                    <span class="n">attrsEdge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">extraEdgeAttrs</span><span class="p">,</span> <span class="n">lnum</span><span class="p">)</span>
                    <span class="n">attrsNodeA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">extraNodeAttrsA</span><span class="p">,</span> <span class="n">lnum</span><span class="p">)</span>
                    <span class="n">attrsNodeB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">extraNodeAttrsB</span><span class="p">,</span> <span class="n">lnum</span><span class="p">)</span>
                    <span class="c"># merging dictionaries</span>
                    <span class="n">nodeAttrs</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s">&quot;attrsNodeA&quot;</span><span class="p">:</span> <span class="n">attrsNodeA</span><span class="p">,</span> 
                        <span class="s">&quot;attrsNodeB&quot;</span><span class="p">:</span> <span class="n">attrsNodeB</span><span class="p">,</span> 
                        <span class="s">&quot;attrsEdge&quot;</span><span class="p">:</span> <span class="n">attrsEdge</span><span class="p">}</span>
                    <span class="n">newEdge</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="n">newEdge</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(),</span> <span class="n">nodeAttrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="p">))</span>
                <span class="k">if</span> <span class="n">readError</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">edgeList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newEdge</span><span class="p">)</span>
                <span class="n">lnum</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">file</span><span class="p">:</span>
                <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c">### !!!! ##</span>
            <span class="n">edgeListMapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_list</span><span class="p">(</span><span class="n">edgeList</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%u</span><span class="s"> lines have been read from </span><span class="si">%s</span><span class="s">, </span><span class="si">%u</span><span class="s"> links after mapping&quot;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="n">lnum</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgeListMapped</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">keep_raw</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">edgeListMapped</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">edgeListMapped</span>
    
    <span class="k">def</span> <span class="nf">read_list_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s">&quot;ReadList&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;&quot;&quot;No proper input file definition!</span><span class="se">\n\&#39;</span><span class="s">settings</span><span class="se">\&#39;</span><span class="s"></span>
<span class="s">                should be a </span><span class="se">\&#39;</span><span class="s">readList</span><span class="se">\&#39;</span><span class="s"> instance</span><span class="se">\n</span><span class="s">&quot;&quot;&quot;</span><span class="p">),</span> <span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: No such file! :(</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">),</span> <span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">originalNameType</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameType</span>
            <span class="n">defaultNameType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">typ</span><span class="p">]</span>
            <span class="n">mapTbl</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">originalNameType</span><span class="p">,</span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="n">defaultNameType</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">mapTbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">tables</span> <span class="ow">and</span> <span class="n">originalNameType</span> <span class="o">!=</span> <span class="n">defaultNameType</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_table_error</span><span class="p">(</span><span class="n">originalNameType</span><span class="p">,</span> <span class="n">defaultNameType</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">defaultNameType</span> <span class="o">==</span> <span class="s">&quot;uniprot&quot;</span> <span class="ow">and</span> 
                <span class="s">&quot;uniprot-sec_uniprot-pri&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">tables</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_table_error</span><span class="p">(</span><span class="s">&quot;uniprot-sec&quot;</span><span class="p">,</span> <span class="s">&quot;uniprot-pri&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="n">infile</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> opened...&quot;</span> <span class="o">%</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">)</span>
            <span class="c"># finding the largest referred column number, </span>
            <span class="c"># to avoid references out of index</span>
            <span class="n">maxCol</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="p">[</span>   <span class="n">settings</span><span class="o">.</span><span class="n">nameCol</span><span class="p">,</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_max</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">extraAttrs</span><span class="p">)</span> <span class="p">])</span>
            <span class="c"># iterating lines from input file</span>
            <span class="n">lnum</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">readError</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">itemList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lnum</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">header</span><span class="p">):</span>
                    <span class="c"># empty lines</span>
                    <span class="c"># or header row</span>
                    <span class="n">lnum</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">separator</span><span class="p">)</span>
                <span class="c"># in case line has less fields than needed</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxCol</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span>
                        <span class="s">&quot;Line #</span><span class="si">%u</span><span class="s"> has less than </span><span class="si">%u</span><span class="s"> fields! :(</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> \
                            <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">maxCol</span><span class="p">)),</span> <span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="n">readError</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># reading names and attributes</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">newItem</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="n">line</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">nameCol</span><span class="p">],</span> 
                            <span class="s">&quot;nameType&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameType</span><span class="p">,</span> 
                            <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">typ</span><span class="p">,</span> 
                            <span class="s">&quot;source&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">}</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;&quot;&quot;Wrong name column indexes (</span><span class="si">%u</span><span class="s"> and </span><span class="si">%u</span><span class="s">), </span>
<span class="s">                            or wrong separator (</span><span class="si">%s</span><span class="s">)? Line #</span><span class="si">%u</span><span class="se">\n</span><span class="s">&quot;&quot;&quot;</span> 
                            <span class="o">%</span> <span class="p">(</span> <span class="n">settings</span><span class="o">.</span><span class="n">nameCol</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">separator</span><span class="p">,</span> <span class="n">lnum</span><span class="p">)),</span> <span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
                        <span class="n">readError</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">break</span>
                    <span class="c"># getting additional attributes</span>
                    <span class="n">attrsItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attrs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">extraAttrs</span><span class="p">,</span> <span class="n">lnum</span><span class="p">)</span>
                    <span class="c"># merging dictionaries</span>
                    <span class="n">newItem</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="n">newItem</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(),</span> <span class="n">attrsItem</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="p">))</span>
                <span class="k">if</span> <span class="n">readError</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">itemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newItem</span><span class="p">)</span>
                <span class="n">lnum</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">itemListMapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_list</span><span class="p">(</span><span class="n">itemList</span><span class="p">,</span><span class="n">singleList</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">itemListMapped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itemListMapped</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="s">&quot;unmapped&quot;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%u</span><span class="s"> lines have been read from </span><span class="si">%s</span><span class="s">, </span><span class="si">%u</span><span class="s"> items after mapping&quot;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">inFile</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">itemListMapped</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">itemListMapped</span>
    
    <span class="k">def</span> <span class="nf">map_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lst</span><span class="p">,</span><span class="n">singleList</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="c"># only a wrapper for map_edge()</span>
        <span class="n">listMapped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">singleList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
                <span class="n">listMapped</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_item</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
                <span class="n">listMapped</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">listMapped</span>
    
    <span class="k">def</span> <span class="nf">map_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
        <span class="n">defaultNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
            <span class="n">item</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">item</span><span class="p">[</span><span class="s">&#39;nameType&#39;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">defaultNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;unmapped&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unmapped</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">defaultNames</span>
    
    <span class="k">def</span> <span class="nf">map_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">edge</span><span class="p">):</span>
        <span class="n">edgeStack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">defaultNameA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
            <span class="n">edge</span><span class="p">[</span><span class="s">&#39;nameA&#39;</span><span class="p">],</span> 
            <span class="n">edge</span><span class="p">[</span><span class="s">&#39;nameTypeA&#39;</span><span class="p">],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s">&#39;typeA&#39;</span><span class="p">]])</span>
        <span class="n">defaultNameB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
            <span class="n">edge</span><span class="p">[</span><span class="s">&#39;nameB&#39;</span><span class="p">],</span> 
            <span class="n">edge</span><span class="p">[</span><span class="s">&#39;nameTypeB&#39;</span><span class="p">],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s">&#39;typeB&#39;</span><span class="p">]])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s">&#39;typeA&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="s">&#39;uniprot&#39;</span><span class="p">:</span>
            <span class="n">defaultNameA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">get_primary_uniprot</span><span class="p">(</span><span class="n">defaultNameA</span><span class="p">)</span>
            <span class="n">defaultNameA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">trembl_swissprot</span><span class="p">(</span><span class="n">defaultNameA</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s">&#39;typeB&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="s">&#39;uniprot&#39;</span><span class="p">:</span>
            <span class="n">defaultNameB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">get_primary_uniprot</span><span class="p">(</span><span class="n">defaultNameB</span><span class="p">)</span>
            <span class="n">defaultNameB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">trembl_swissprot</span><span class="p">(</span><span class="n">defaultNameB</span><span class="p">)</span>
        <span class="c"># this is needed because the possibility ambigous mapping</span>
        <span class="c"># one name can be mapped to multiple ones</span>
        <span class="c"># this multiplies the nodes and edges</span>
        <span class="c"># in case of proteins this does not happen too often</span>
        <span class="k">for</span> <span class="n">dnA</span> <span class="ow">in</span> <span class="n">defaultNameA</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dnB</span> <span class="ow">in</span> <span class="n">defaultNameB</span><span class="p">:</span>
                <span class="n">edge</span><span class="p">[</span><span class="s">&#39;defaultNameA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dnA</span>
                <span class="n">edge</span><span class="p">[</span><span class="s">&#39;defaultNameTypeA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s">&#39;typeA&#39;</span><span class="p">]]</span>
                <span class="n">edge</span><span class="p">[</span><span class="s">&#39;defaultNameB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dnB</span>
                <span class="n">edge</span><span class="p">[</span><span class="s">&#39;defaultNameTypeB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="s">&#39;typeB&#39;</span><span class="p">]]</span>
                <span class="n">edgeStack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">edgeStack</span>
    
    <span class="k">def</span> <span class="nf">merge_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">exc</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;signs&#39;</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_signs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;directions&#39;</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_dirs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;dirs_by_source&#39;</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_dirsrc</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">([</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">val</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">combine_signs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigA</span><span class="p">,</span><span class="n">sigB</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">inn</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">sigA</span><span class="p">[</span><span class="n">out</span><span class="p">][</span><span class="n">inn</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="n">sigA</span><span class="p">[</span><span class="n">out</span><span class="p">][</span><span class="n">inn</span><span class="p">]</span><span class="o">+</span><span class="n">sigB</span><span class="p">[</span><span class="n">out</span><span class="p">][</span><span class="n">inn</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">sigA</span>
    
    <span class="k">def</span> <span class="nf">combine_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dirA</span><span class="p">,</span><span class="n">dirB</span><span class="p">):</span>
        <span class="n">newDir</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">newDir</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dirA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="n">dirB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">newDir</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">combine_dirsrc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dirsA</span><span class="p">,</span><span class="n">dirsB</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">dirsA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="n">dirsA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">dirsB</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">dirsA</span>
    
    <span class="k">def</span> <span class="nf">combine_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lst</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> 
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">))):</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">unicode</span><span class="p">)</span> 
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">unicode</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="n">simpleTypes</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">addToList</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="n">simpleTypes</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">addToList</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;Direction&#39;</span> <span class="ow">and</span> \
            <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;Direction&#39;</span><span class="p">:</span>
            <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">uniq_node_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lst</span><span class="p">):</span>
        <span class="n">uniqLst</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uniqLst</span><span class="p">:</span>
                <span class="n">uniqLst</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">uniqLst</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_attrs</span><span class="p">(</span><span class="n">uniqLst</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">uniqLst</span>
    
    <span class="k">def</span> <span class="nf">map_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mapping</span><span class="o">=</span><span class="s">&quot;trembl_swissprot&quot;</span><span class="p">):</span>
        <span class="c"># in the whole network changes every uniprot id to primary</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">has_mapping_table</span><span class="p">(</span><span class="s">&quot;uniprot-sec&quot;</span><span class="p">,</span> <span class="s">&quot;uniprot-pri&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Mapping network by </span><span class="si">%s</span><span class="s">...&quot;</span> <span class="o">%</span> <span class="n">mapping</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;Num of edges: </span><span class="si">%u</span><span class="s">, num of vertices: </span><span class="si">%u</span><span class="s">&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())),</span> <span class="s">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="n">fun</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mapping</span><span class="p">)</span>
        <span class="n">primNodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">secNodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">delNodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Mapping nodes&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;protein&quot;</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="s">&quot;nameType&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;uniprot&quot;</span><span class="p">:</span>
                <span class="n">prim</span> <span class="o">=</span> <span class="n">fun</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prim</span><span class="p">:</span>
                    <span class="n">delNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">prim</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">u</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">primNodes</span><span class="p">:</span>
                            <span class="n">primNodes</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">primNodes</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">secNodes</span><span class="p">:</span>
                            <span class="n">secNodes</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">secNodes</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">newNodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">primNodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_nodes</span><span class="p">(</span><span class="n">newNodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;New nodes have been created (</span><span class="si">%u</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">newNodes</span><span class="p">),</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="n">primEdges</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">newEdges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Processing edges&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">uA</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">uB</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&quot;name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">uA</span> <span class="ow">in</span> <span class="n">secNodes</span> <span class="ow">or</span> <span class="n">uB</span> <span class="ow">in</span> <span class="n">secNodes</span><span class="p">:</span>
                <span class="n">uAlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">uA</span><span class="p">]</span> <span class="k">if</span> <span class="n">uA</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">secNodes</span> <span class="k">else</span> <span class="n">secNodes</span><span class="p">[</span><span class="n">uA</span><span class="p">]</span>
                <span class="n">uBlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">uB</span><span class="p">]</span> <span class="k">if</span> <span class="n">uB</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">secNodes</span> <span class="k">else</span> <span class="n">secNodes</span><span class="p">[</span><span class="n">uB</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">uAlist</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">uBlist</span><span class="p">:</span>
                        <span class="n">ab</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>
                        <span class="n">ab</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">primEdges</span><span class="p">:</span>
                            <span class="n">primEdges</span><span class="p">[</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">if</span> <span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">primEdges</span><span class="p">[</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                            <span class="n">primEdges</span><span class="p">[</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">primEdges</span><span class="p">[</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">uA</span><span class="p">,</span><span class="n">uB</span><span class="p">))</span>
                        <span class="n">abEdge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">abEdge</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                            <span class="n">newEdges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">abEdge</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">newEdges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">newEdges</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_edges</span><span class="p">(</span><span class="n">newEdges</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;New edges have been created (</span><span class="si">%u</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">newEdges</span><span class="p">),</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="c"># copying node attributes</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">primNodes</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Processing node attributes&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">primNodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">prim</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">sec</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">merge_attrs</span><span class="p">(</span><span class="n">prim</span><span class="p">,</span><span class="n">sec</span><span class="p">,</span><span class="n">exc</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">])</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="c"># copying edge attributes</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">primEdges</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Processing edge attributes&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">bdict</span> <span class="ow">in</span> <span class="n">primEdges</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">primA</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
            <span class="k">for</span> <span class="n">b</span><span class="p">,</span><span class="n">originals</span> <span class="ow">in</span> <span class="n">bdict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">primB</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
                <span class="n">prim</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">_between</span><span class="o">=</span><span class="p">((</span><span class="n">primA</span><span class="p">,),(</span><span class="n">primB</span><span class="p">,)))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">originals</span><span class="p">:</span>
                    <span class="n">secA</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">index</span>
                    <span class="n">secB</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">index</span>
                    <span class="n">sec</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">_between</span><span class="o">=</span><span class="p">((</span><span class="n">secA</span><span class="p">,),(</span><span class="n">secB</span><span class="p">,)))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">merge_attrs</span><span class="p">(</span><span class="n">prim</span><span class="p">,</span><span class="n">sec</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="c"># deleting old nodes</span>
        <span class="n">delNodeInd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">delNodes</span><span class="p">:</span>
            <span class="n">delNodeInd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;Removing old nodes (</span><span class="si">%u</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">delNodeInd</span><span class="p">),</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">delNodeInd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">delNodeInd</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean_graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;Network has been mapped.&quot;</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;Num of edges: </span><span class="si">%u</span><span class="s">, num of vertices: </span><span class="si">%u</span><span class="s">&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())),</span> <span class="s">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">delete_by_taxon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tax</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;ncbi_tax_id&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tax</span><span class="p">:</span>
                <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">delete_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tax</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;protein&#39;</span><span class="p">,</span><span class="n">defaultNameType</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">defaultNameType</span><span class="p">:</span>
            <span class="n">defaultNameType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">reflists</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tax</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">defaultNameType</span><span class="p">,</span><span class="n">typ</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">:</span>
                <span class="n">reflists</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">lst</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Missing reference list for </span><span class="si">%s</span><span class="s"> (default name type: </span><span class="si">%s</span><span class="s">), in taxon </span><span class="si">%u</span><span class="s">&#39;</span>
                    <span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">t</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">]))</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; :: Comparing with reference lists...&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tax</span><span class="p">:</span>
            <span class="n">nt</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;nameType&#39;</span><span class="p">]</span>
            <span class="n">nt</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">defaultNameType</span><span class="p">]</span>
            <span class="n">ty</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span>
            <span class="n">ty</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ty</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">typ</span><span class="p">]</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;ncbi_tax_id&#39;</span><span class="p">]</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="nb">set</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">ty</span><span class="p">))</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">tx</span><span class="p">))</span>
            <span class="n">vn</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">]</span>
            <span class="n">toDelNames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vn</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">reflists</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
            <span class="n">toDel</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">toDelNames</span><span class="p">]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; done.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">clean_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Removing duplicate edges...&quot;</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">is_simple</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">loops</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">combine_edges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_unmapped</span><span class="p">()</span>
        <span class="c">## TODO: multispec ##</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_by_taxon</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_unknown</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="n">zeroDeg</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">zeroDeg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
    
    <span class="c">###</span>
    <span class="c">### functions to integrate new data into the main igraph network object</span>
    <span class="c">###</span>
    
    <span class="k">def</span> <span class="nf">count_sol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">s</span>
    
    <span class="k">def</span> <span class="nf">add_update_vertex</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">defAttrs</span><span class="p">,</span> <span class="n">originalName</span><span class="p">,</span> 
            <span class="n">originalNameType</span><span class="p">,</span> <span class="n">extraAttrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">add</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">defAttrs</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">add</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Failed to add some vertices&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span>
            <span class="n">g</span><span class="o">.</span><span class="n">add_vertices</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">originalNames</span> <span class="o">=</span> <span class="p">{</span><span class="n">originalName</span><span class="p">:</span> <span class="n">originalNameType</span><span class="p">}</span>
            <span class="n">thisNode</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">defAttrs</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thisNode</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">defAttrs</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">thisNode</span><span class="p">[</span><span class="s">&quot;originalNames&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">thisNode</span><span class="p">[</span><span class="s">&quot;originalNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">thisNode</span><span class="p">[</span><span class="s">&quot;originalNames&quot;</span><span class="p">][</span><span class="n">originalName</span><span class="p">]</span> <span class="o">=</span> <span class="n">originalNameType</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defAttrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">thisNode</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">extraAttrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span> \
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">thisNode</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">([</span><span class="n">thisNode</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">value</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">add_update_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> 
                        <span class="n">isDir</span><span class="p">,</span> <span class="n">refs</span><span class="p">,</span> <span class="n">stim</span><span class="p">,</span> <span class="n">inh</span><span class="p">,</span> <span class="n">taxA</span><span class="p">,</span> <span class="n">taxB</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span>
                        <span class="n">extraAttrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">add</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;nodDct&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span><span class="p">)</span> <span class="o">!=</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">add</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">ERROR: Failed to add some edges</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Failed to add some edges&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">aid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span>
                <span class="n">bid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nameB</span><span class="p">]</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">aid</span><span class="p">,</span><span class="n">bid</span><span class="p">,</span><span class="n">error</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">aid</span><span class="p">,</span><span class="n">bid</span><span class="p">,</span><span class="n">error</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">failed_edges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">edge</span><span class="p">,</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">bid</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">])</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">)</span>
        <span class="c"># assigning source:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&quot;sources&quot;</span><span class="p">]:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&quot;sources&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&quot;sources&quot;</span><span class="p">]:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&quot;sources&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="c"># adding references:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&quot;references&quot;</span><span class="p">]:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&quot;references&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&quot;references&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">refs</span>
        <span class="c"># setting directions:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;dirs&#39;</span><span class="p">]:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">(</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isDir</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_dir</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">),</span><span class="n">source</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_dir</span><span class="p">(</span><span class="s">&#39;undirected&#39;</span><span class="p">,</span><span class="n">source</span><span class="p">)</span>
        <span class="c"># setting signs:</span>
        <span class="k">if</span> <span class="n">stim</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_sign</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">),</span><span class="s">&#39;positive&#39;</span><span class="p">,</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inh</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_sign</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">),</span><span class="s">&#39;negative&#39;</span><span class="p">,</span><span class="n">source</span><span class="p">)</span>
        <span class="c"># updating references-by-source dict:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;refs_by_source&#39;</span><span class="p">]:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;refs_by_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;refs_by_source&#39;</span><span class="p">]:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;refs_by_source&#39;</span><span class="p">][</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;refs_by_source&#39;</span><span class="p">][</span><span class="n">source</span><span class="p">]</span> <span class="o">+=</span> <span class="n">refs</span>
        <span class="c"># adding type:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="c"># adding extra attributes:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">extraAttrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span> \
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">([</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">get_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">conv_edges</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ret</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">graph</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">graph</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">as_directed</span><span class="p">(</span><span class="n">mutual</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;directed_sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
        <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
        <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">())]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Setting directions&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            This works because in directed graphs get_eid() defaults to </span>
<span class="sd">            directed = True, so the source -&gt; target edge is returned.</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">dir_one</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">],</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">])</span>
            <span class="n">dir_two</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">],</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">])</span>
            <span class="n">dir_edge_one</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]),</span>
                                 <span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]))</span>
            <span class="n">dir_edge_two</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]),</span>
                                 <span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_one</span><span class="p">):</span>
                <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dir_edge_one</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_one</span><span class="p">][</span><span class="s">&#39;directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_one</span><span class="p">][</span><span class="s">&#39;directed_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_one</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_one</span><span class="p">][</span><span class="s">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_two</span><span class="p">):</span>
                <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dir_edge_two</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_two</span><span class="p">][</span><span class="s">&#39;directed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_two</span><span class="p">][</span><span class="s">&#39;directed_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_two</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_two</span><span class="p">][</span><span class="s">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s">&#39;undirected&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_one</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">dir_two</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">conv_edges</span><span class="p">:</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_one</span><span class="p">][</span><span class="s">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                        <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">dir_edge_two</span><span class="p">][</span><span class="s">&#39;undirected_sources&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                        <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s">&#39;undirected&#39;</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">toDel</span> <span class="o">+=</span> <span class="p">[</span><span class="n">dir_edge_one</span><span class="p">,</span> <span class="n">dir_edge_two</span><span class="p">]</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">d</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">toDel</span><span class="p">)))</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">deg</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toDel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">toDel</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">graph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dgraph</span> <span class="o">=</span> <span class="n">d</span>
        <span class="k">if</span> <span class="n">graph</span> <span class="ow">or</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">d</span>
    
    <span class="k">def</span> <span class="nf">new_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edges</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">new_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_vertices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
    
<div class="viewcode-block" id="BioGraph.edge_exists"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph.edge_exists">[docs]</a>    <span class="k">def</span> <span class="nf">edge_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a tuple of vertice indices if edge doesn&#39;t exists, </span>
<span class="sd">        otherwise edge id. Not sensitive to direction.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;nodDct&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nameA</span><span class="p">],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nameB</span><span class="p">]]</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edge</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">edge</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">nodes</span>
    </div>
    <span class="k">def</span> <span class="nf">node_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;nodInd&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodInd</span>
    
<div class="viewcode-block" id="BioGraph.get_edge"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph.get_edge">[docs]</a>    <span class="k">def</span> <span class="nf">get_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nodes</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the edge id only if there is an edge from nodes[0] to nodes[1],</span>
<span class="sd">        returns False if edge exists in opposite direction, or no edge exists </span>
<span class="sd">        between the two vertices, or any of the vertice ids doesn&#39;t exist.</span>
<span class="sd">        To find edges without regarding their direction, see edge_exists().</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">e</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    </div>
<div class="viewcode-block" id="BioGraph.straight_between"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph.straight_between">[docs]</a>    <span class="k">def</span> <span class="nf">straight_between</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This does actually the same as get_edge(), but by names</span>
<span class="sd">        instead of vertex ids.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nodNm</span> <span class="o">=</span> <span class="p">[</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">]</span>
        <span class="n">nodNm</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nodNm</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nodNm</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">edge</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nodes</span>
    </div>
<div class="viewcode-block" id="BioGraph.all_between"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph.all_between">[docs]</a>    <span class="k">def</span> <span class="nf">all_between</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns all edges between two given vertex names. Similar to </span>
<span class="sd">        straight_between(), but checks both directions, and returns </span>
<span class="sd">        list of edge ids in [undirected, straight, reveresed] format,</span>
<span class="sd">        for both nameA -&gt; nameB and nameB -&gt; nameA edges.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;ab&#39;</span><span class="p">:</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span> <span class="s">&#39;ba&#39;</span><span class="p">:</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]}</span>
        <span class="n">eid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">eid</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s">&#39;undirected&#39;</span><span class="p">):</span>
                <span class="n">edges</span><span class="p">[</span><span class="s">&#39;ab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
                <span class="n">edges</span><span class="p">[</span><span class="s">&#39;ba&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">)):</span>
                <span class="n">edges</span><span class="p">[</span><span class="s">&#39;ab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
                <span class="n">edges</span><span class="p">[</span><span class="s">&#39;ba&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">nameB</span><span class="p">,</span><span class="n">nameA</span><span class="p">)):</span>
                <span class="n">edges</span><span class="p">[</span><span class="s">&#39;ab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
                <span class="n">edges</span><span class="p">[</span><span class="s">&#39;ba&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">eid</span>
        <span class="k">return</span> <span class="n">edges</span>
     </div>
    <span class="k">def</span> <span class="nf">get_node_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;nodDct&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">nameA</span><span class="p">,</span> <span class="n">nameB</span><span class="p">]</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nodeA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">nodeB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">nodeA</span><span class="p">,</span> <span class="n">nodeB</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">update_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Vertex attribute `</span><span class="si">%s</span><span class="s">` has multiple types of&#39;</span>\
                    <span class="s">&#39; values: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">types</span><span class="p">])),</span>
                    <span class="s">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Vertex attribute `</span><span class="si">%s</span><span class="s">` has only None values&#39;</span>\
                <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">),</span> <span class="s">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">list</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">init_vertex_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;dirs&#39;</span><span class="p">])):</span>
            <span class="n">types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Edge attribute `</span><span class="si">%s</span><span class="s">` has multiple types of&#39;</span>\
                    <span class="s">&#39; values: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">types</span><span class="p">])),</span>
                    <span class="s">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Edge attribute `</span><span class="si">%s</span><span class="s">` has only None values&#39;</span>\
                <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">),</span> <span class="s">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">list</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">init_edge_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">init_vertex_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="ow">in</span> <span class="n">simpleTypes</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">init_edge_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edgeAttrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="ow">in</span> <span class="n">simpleTypes</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">attach_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edgeList</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">regulator</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">edgeList</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">edgeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;attach_network(): No data, nothing to do.&quot;</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edgeList</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">edgeList</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="n">edgeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">edgeList</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                    <span class="s">&quot;`</span><span class="si">%s</span><span class="s">&#39; looks like a source name, but no data&quot;</span>\
                    <span class="s">&quot;available under this name.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">edgeList</span><span class="p">),</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># add nodes and edges first in bunch, </span>
        <span class="c"># to avoid multiple reindexing by igraph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">edgeList</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Processing nodes&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edgeList</span><span class="p">:</span>
            <span class="n">aexists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameA&quot;</span><span class="p">])</span>
            <span class="n">bexists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameB&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">aexists</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">regulator</span> <span class="ow">or</span> <span class="n">bexists</span><span class="p">):</span>
                <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameA&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bexists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">regulator</span><span class="p">:</span>
                <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameB&quot;</span><span class="p">])</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_nodes</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;New nodes have been created&#39;</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">edgeList</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Processing edges&#39;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edgeList</span><span class="p">:</span>
            <span class="n">aexists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameA&quot;</span><span class="p">])</span>
            <span class="n">bexists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameB&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">aexists</span> <span class="ow">and</span> <span class="n">bexists</span><span class="p">:</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameA&quot;</span><span class="p">],</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameB&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">edge</span><span class="p">))</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;DEPOD&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edges_depod</span> <span class="o">=</span> <span class="n">edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_edges</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">edges</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;New edges have been created&quot;</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;&quot;&quot;Introducing new node and edge attributes...&quot;&quot;&quot;</span><span class="p">),</span> <span class="s">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">edgeList</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Processing attributes&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">nodes_updated</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edgeList</span><span class="p">:</span>
            <span class="c"># adding new node attributes</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameA&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes_updated</span><span class="p">:</span>
                <span class="n">defAttrs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameA&quot;</span><span class="p">],</span> 
                    <span class="s">&quot;label&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameA&quot;</span><span class="p">],</span> 
                    <span class="s">&quot;nameType&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameTypeA&quot;</span><span class="p">],</span> 
                    <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;typeA&quot;</span><span class="p">],</span>
                    <span class="s">&quot;ncbi_tax_id&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;taxA&quot;</span><span class="p">]}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_update_vertex</span><span class="p">(</span>
                    <span class="n">defAttrs</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;nameA&quot;</span><span class="p">],</span> 
                    <span class="n">e</span><span class="p">[</span><span class="s">&quot;nameTypeA&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;attrsNodeA&quot;</span><span class="p">])</span>
                <span class="n">nodes_updated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameA&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameB&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes_updated</span><span class="p">:</span>
                <span class="n">defAttrs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameB&quot;</span><span class="p">],</span> 
                    <span class="s">&quot;label&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameB&quot;</span><span class="p">],</span> 
                    <span class="s">&quot;nameType&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameTypeB&quot;</span><span class="p">],</span> 
                    <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;typeB&quot;</span><span class="p">],</span>
                    <span class="s">&quot;ncbi_tax_id&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;taxB&quot;</span><span class="p">]}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_update_vertex</span><span class="p">(</span>
                    <span class="n">defAttrs</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;nameB&quot;</span><span class="p">],</span> 
                    <span class="n">e</span><span class="p">[</span><span class="s">&quot;nameTypeB&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;attrsNodeB&quot;</span><span class="p">])</span>
                <span class="n">nodes_updated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameB&quot;</span><span class="p">])</span>
            <span class="c"># adding new edge attributes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_update_edge</span><span class="p">(</span>
                <span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameA&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;defaultNameB&quot;</span><span class="p">],</span> 
                <span class="n">e</span><span class="p">[</span><span class="s">&quot;source&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;isDirected&quot;</span><span class="p">],</span> 
                <span class="n">e</span><span class="p">[</span><span class="s">&quot;references&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;stim&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;inh&quot;</span><span class="p">],</span> 
                <span class="n">e</span><span class="p">[</span><span class="s">&quot;taxA&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;taxB&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;type&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;attrsEdge&quot;</span><span class="p">])</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_attrs</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">apply_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">node_or_edge</span><span class="o">=</span><span class="s">&quot;node&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="s">&quot;&quot;&quot;No such list: </span><span class="si">%s</span><span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">),</span> <span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="n">node_or_edge</span> <span class="o">==</span> <span class="s">&quot;edge&quot;</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node_or_edge</span> <span class="o">==</span> <span class="s">&quot;edge&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&quot;name&quot;</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&quot;name&quot;</span><span class="p">])</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">e</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&quot;name&quot;</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&quot;name&quot;</span><span class="p">])]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&quot;name&quot;</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&quot;name&quot;</span><span class="p">])</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">e</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&quot;name&quot;</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&quot;name&quot;</span><span class="p">])]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node_or_edge</span> <span class="o">==</span> <span class="s">&quot;edge&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&quot;name&quot;</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&quot;name&quot;</span><span class="p">])</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">e</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">e</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">merge_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">and_or</span><span class="o">=</span><span class="s">&quot;and&quot;</span><span class="p">,</span><span class="n">delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">func</span><span class="o">=</span><span class="s">&quot;max&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nameA</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="s">&quot;&quot;&quot;No such list: </span><span class="si">%s</span><span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">nameA</span><span class="p">),</span> <span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">nameB</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="s">&quot;&quot;&quot;No such list: </span><span class="si">%s</span><span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">nameB</span><span class="p">),</span> <span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">])</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">name</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">and_or</span> <span class="o">==</span> <span class="s">&quot;and&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">])</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">and_or</span> <span class="o">==</span> <span class="s">&quot;or&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">and_or</span> <span class="o">==</span> <span class="s">&quot;and&quot;</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">][</span><span class="n">k</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">and_or</span> <span class="o">==</span> <span class="s">&quot;or&quot;</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_attr</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">][</span><span class="n">k</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameA</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">nameB</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">save_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pickleFile</span> <span class="o">=</span> <span class="s">&quot;pwnet-&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">+</span><span class="s">&quot;.pickle&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="s">&quot;&quot;&quot;Saving session to </span><span class="si">%s</span><span class="s">... &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">pickleFile</span><span class="p">),</span> <span class="s">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">pickleFile</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    
    <span class="c">###</span>
    <span class="c">### functions for plotting // with custom typeface ;)</span>
    <span class="c">###</span>
    
    <span class="k">def</span> <span class="nf">make_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">layout_type</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">graph</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="s">&quot;layout_type&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">layout_type</span> <span class="o">!=</span> <span class="n">layout_type</span> <span class="ow">or</span> <span class="ow">not</span>
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="s">&quot;layout_data&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">layout_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;&quot;&quot;Calculating </span><span class="si">%s</span><span class="s"> layout... (numof nodes/edges: </span><span class="si">%u</span><span class="s">/</span><span class="si">%u</span><span class="s">)&quot;&quot;&quot;</span> <span class="o">%</span> 
                <span class="p">(</span><span class="n">layout_type</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span> <span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">())),</span> <span class="s">&#39;INFO&#39;</span><span class="p">)</span>
            <span class="n">g</span><span class="p">[</span><span class="s">&#39;layout_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="n">layout_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">g</span><span class="p">[</span><span class="s">&#39;layout_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layout_type</span>
    
    <span class="k">def</span> <span class="nf">basic_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s">&quot;PlotParam&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;&quot;&quot;No proper graphical parameters definition!</span><span class="se">\n\&#39;</span><span class="s">param</span><span class="se">\&#39;</span><span class="s"></span>
<span class="s">                should be a </span><span class="se">\&#39;</span><span class="s">PlotParam</span><span class="se">\&#39;</span><span class="s"> instance</span><span class="se">\n</span><span class="s">&quot;&quot;&quot;</span><span class="p">),</span> <span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
            <span class="n">gl</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">graph</span>
            <span class="n">gl</span> <span class="o">=</span> <span class="n">g</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">vertex_label</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">param</span><span class="o">.</span><span class="n">vertex_label</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">vertex_label</span><span class="p">]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">vertex_label_font</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;plot&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">param</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="s">&#39;network-&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="n">param</span><span class="o">.</span><span class="n">graphix_format</span>
                <span class="p">])</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">graphix_dir</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">filename</span>
        <span class="c"># ## layout ## #</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">grouping</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;&quot;&quot;Calculating </span><span class="si">%s</span><span class="s"> layout... (numof nodes/edges: </span><span class="si">%u</span><span class="s">/</span><span class="si">%u</span><span class="s">)&quot;&quot;&quot;</span> <span class="o">%</span> 
                <span class="p">(</span><span class="n">layout_type</span><span class="o">+</span><span class="s">&#39; grouped&#39;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span> <span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">())),</span> <span class="s">&#39;INFO&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">layout</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="s">&quot;intergroup&quot;</span><span class="p">,</span><span class="s">&quot;modular_fr&quot;</span><span class="p">,</span><span class="s">&quot;modular_circle&quot;</span><span class="p">]):</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">gr_plot</span><span class="p">,</span><span class="s">&quot;layout_&quot;</span><span class="o">+</span><span class="n">param</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
                <span class="n">f</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">param</span><span class="o">.</span><span class="n">grouping</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">layout</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="s">&quot;fruchterman_reingold&quot;</span><span class="p">,</span><span class="s">&quot;fr&quot;</span><span class="p">,</span><span class="s">&quot;circle&quot;</span><span class="p">]):</span>
                    <span class="n">param</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="s">&quot;fr&quot;</span>
                <span class="n">g</span><span class="p">[</span><span class="s">&#39;layout_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layout_intergroup</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">param</span><span class="o">.</span><span class="n">grouping</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">g</span><span class="p">[</span><span class="s">&#39;layout_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;layout_intergroup&quot;</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">vertex_color</span> <span class="o">==</span> <span class="s">&quot;groups&quot;</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_colors</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">param</span><span class="o">.</span><span class="n">grouping</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_layout</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">layout</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">gl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># ## layout ready ## #</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;&quot;&quot;Plotting </span><span class="si">%s</span><span class="s"> to file </span><span class="si">%s</span><span class="s">...&quot;&quot;&quot;</span> <span class="o">%</span> 
            <span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">graphix_format</span><span class="p">,</span><span class="n">filename</span><span class="p">)),</span> <span class="s">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">graphix_format</span> <span class="o">==</span> <span class="s">&quot;pdf&quot;</span><span class="p">:</span>
            <span class="n">sf</span> <span class="o">=</span> <span class="n">cairo</span><span class="o">.</span><span class="n">PDFSurface</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># currently doing only pdf</span>
            <span class="n">sf</span> <span class="o">=</span> <span class="n">cairo</span><span class="o">.</span><span class="n">PDFSurface</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">vertex_label_color</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">vColAlpha</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">param</span><span class="o">.</span><span class="n">vertex_label_color</span><span class="p">:</span>
                <span class="n">vColAlpha</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">],</span><span class="n">param</span><span class="o">.</span><span class="n">vertex_fill_alpha</span><span class="p">]))</span>
            <span class="n">param</span><span class="o">.</span><span class="n">vertex_label_color</span> <span class="o">=</span> <span class="n">vColAlpha</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">vertex_label_color</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">vertex_label_color</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="n">param</span><span class="o">.</span><span class="n">vertex_label_color</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">],</span>
                <span class="n">param</span><span class="o">.</span><span class="n">vertex_fill_alpha</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">vertex_label_size</span> <span class="o">==</span> <span class="s">&quot;degree_label_size&quot;</span><span class="p">:</span>
            <span class="c"># TODO</span>
            <span class="n">dgr</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
            <span class="n">maxDgr</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">dgr</span><span class="p">))</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&quot;label_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="s">&quot;label_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">degree</span><span class="p">())</span> <span class="o">/</span> <span class="n">maxDgr</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="mf">9.0</span> <span class="o">+</span> <span class="mf">1.7</span>
            <span class="n">param</span><span class="o">.</span><span class="n">vertex_label_size</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&quot;label_size&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">vertex_label_size</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">param</span><span class="o">.</span><span class="n">vertex_label_size</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">layout</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="s">&#39;layout_data&#39;</span><span class="p">],</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="n">sf</span><span class="p">,</span>
                    <span class="n">bbox</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">bbox</span><span class="p">,</span>
                    <span class="n">drawer_factory</span> <span class="o">=</span> <span class="n">DefaultGraphDrawerFFsupport</span><span class="p">,</span>
                    <span class="n">vertex_size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">vertex_size</span><span class="p">,</span>
                    <span class="n">vertex_color</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">vertex_color</span><span class="p">,</span>
                    <span class="n">vertex_frame_color</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">vertex_frame_color</span><span class="p">,</span>
                    <span class="n">vertex_frame_width</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">vertex_frame_width</span><span class="p">,</span>
                    <span class="n">vertex_label</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">vertex_label</span><span class="p">,</span>
                    <span class="n">vertex_label_color</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">vertex_label_color</span><span class="p">,</span>
                    <span class="n">vertex_label_size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">vertex_label_size</span><span class="p">,</span>
                    <span class="n">edge_color</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">edge_color</span><span class="p">,</span>
                    <span class="n">edge_width</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">edge_width</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">param</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">redraw</span><span class="p">()</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;&quot;&quot;Plot saved to </span><span class="si">%s</span><span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">),</span> <span class="s">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
    
    <span class="c">#</span>
    <span class="c"># functions to compare networks and pathways</span>
    <span class="c">#</span>
    
    <span class="k">def</span> <span class="nf">sorensen_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;sources&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                    <span class="n">edges</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                    <span class="n">nodes</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">edges</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">nodes</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
                <span class="n">nodes</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="n">sNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_groups</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">sEdges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_groups</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&quot;nodes&quot;</span><span class="p">:</span> <span class="n">sNodes</span><span class="p">,</span> <span class="s">&quot;edges&quot;</span><span class="p">:</span> <span class="n">sEdges</span><span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">sorensen_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">groups</span><span class="p">):</span>
        <span class="n">grs</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">sor</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">grs</span><span class="p">:</span>
            <span class="n">sor</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">g1</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">grs</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">g2</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">grs</span><span class="p">)):</span>
                <span class="n">sor</span><span class="p">[</span><span class="n">grs</span><span class="p">[</span><span class="n">g1</span><span class="p">]][</span><span class="n">grs</span><span class="p">[</span><span class="n">g2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sorensen_index</span><span class="p">(</span><span class="n">grs</span><span class="p">[</span><span class="n">g1</span><span class="p">],</span><span class="n">grs</span><span class="p">[</span><span class="n">g2</span><span class="p">])</span>
                <span class="n">sor</span><span class="p">[</span><span class="n">grs</span><span class="p">[</span><span class="n">g2</span><span class="p">]][</span><span class="n">grs</span><span class="p">[</span><span class="n">g1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sor</span><span class="p">[</span><span class="n">grs</span><span class="p">[</span><span class="n">g1</span><span class="p">]][</span><span class="n">grs</span><span class="p">[</span><span class="n">g2</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">sor</span>
    
    <span class="k">def</span> <span class="nf">sorensen_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pwlist</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="n">pwlist</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pwlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathway_types</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pwlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;No such vertex attribute: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="p">),</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">indA</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span>
            <span class="n">indB</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span>
            <span class="n">pwsA</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pwsB</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pwlist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">indA</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">indA</span><span class="p">][</span><span class="n">p</span><span class="p">]:</span>
                        <span class="n">thisPw</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;_pathways&quot;</span><span class="p">,</span><span class="s">&quot;__&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pw</span>
                        <span class="k">if</span> <span class="n">thisPw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">nodes</span><span class="p">[</span><span class="n">thisPw</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">nodes</span><span class="p">[</span><span class="n">thisPw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indA</span><span class="p">)</span>
                        <span class="n">pwsA</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisPw</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">indB</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">indB</span><span class="p">][</span><span class="n">p</span><span class="p">]:</span>
                        <span class="n">thisPw</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;_pathways&quot;</span><span class="p">,</span><span class="s">&quot;__&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pw</span>
                        <span class="k">if</span> <span class="n">thisPw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">nodes</span><span class="p">[</span><span class="n">thisPw</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">nodes</span><span class="p">[</span><span class="n">thisPw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indB</span><span class="p">)</span>
                        <span class="n">pwsB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisPw</span><span class="p">)</span>
            <span class="n">pwsE</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">pwsA</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">pwsB</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">pwsE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                    <span class="n">edges</span><span class="p">[</span><span class="n">pw</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">edges</span><span class="p">[</span><span class="n">pw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">sNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_groups</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">sEdges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_groups</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&quot;nodes&quot;</span><span class="p">:</span> <span class="n">sNodes</span><span class="p">,</span> <span class="s">&quot;edges&quot;</span><span class="p">:</span> <span class="n">sEdges</span><span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">write_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tbl</span><span class="p">,</span><span class="n">outfile</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span><span class="n">cut</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">colnames</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">rownames</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">rn</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&quot;header&quot;</span> <span class="ow">in</span> <span class="n">rn</span><span class="p">:</span>
            <span class="n">cn</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">[</span><span class="s">&quot;header&quot;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">tbl</span><span class="p">[</span><span class="s">&quot;header&quot;</span><span class="p">]</span>
            <span class="n">rn</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;header&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cn</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">rn</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))]</span>
        <span class="k">if</span> <span class="n">colnames</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rownames</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">sep</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rn</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rownames</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">cut</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span>
            <span class="n">thisRow</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tbl</span><span class="p">[</span><span class="n">r</span><span class="p">]]</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">thisRow</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="o">+</span><span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">search_attr_or</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">lst</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">a</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span> <span class="ow">and</span> <span class="n">obj</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">search_attr_and</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">lst</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">a</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span> <span class="ow">and</span> <span class="n">obj</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">!=</span> <span class="n">v</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
    
    <span class="k">def</span> <span class="nf">get_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">crit</span><span class="p">,</span><span class="n">andor</span><span class="o">=</span><span class="s">&quot;or&quot;</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">keepV</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">delE</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">andor</span> <span class="o">==</span> <span class="s">&quot;and&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">keepThis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_and</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">crit</span><span class="p">[</span><span class="s">&quot;edge&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">keepThis</span><span class="p">:</span>
                    <span class="n">keepA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_and</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">],</span><span class="n">crit</span><span class="p">[</span><span class="s">&quot;node&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">keepA</span><span class="p">:</span>
                        <span class="n">keepV</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]</span>
                    <span class="n">keepB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_and</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">],</span><span class="n">crit</span><span class="p">[</span><span class="s">&quot;node&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">keepB</span><span class="p">:</span>
                        <span class="n">keepV</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">keepA</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">keepB</span><span class="p">:</span>
                        <span class="n">delE</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">delE</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">keepThis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_or</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">crit</span><span class="p">[</span><span class="s">&quot;edge&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">keepThis</span><span class="p">:</span>
                    <span class="n">keepV</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">delE</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crit</span><span class="p">[</span><span class="s">&quot;node&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">keepA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_or</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">],</span><span class="n">crit</span><span class="p">[</span><span class="s">&quot;node&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">keepA</span><span class="p">:</span>
                        <span class="n">keep</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]</span>
                    <span class="n">keepB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_attr_or</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">],</span><span class="n">crit</span><span class="p">[</span><span class="s">&quot;node&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">keepB</span><span class="p">:</span>
                        <span class="n">keep</span> <span class="o">+=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&quot;nodes&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keepV</span><span class="p">)),</span> <span class="s">&quot;edges&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">delE</span><span class="p">))}</span>
    
    <span class="k">def</span> <span class="nf">edgeseq_inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">edges</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
                <span class="n">inv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inv</span>
    
    <span class="k">def</span> <span class="nf">get_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">crit</span><span class="p">,</span><span class="n">andor</span><span class="o">=</span><span class="s">&quot;or&quot;</span><span class="p">):</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sub</span><span class="p">(</span><span class="n">crit</span><span class="p">,</span><span class="n">andor</span><span class="o">=</span><span class="n">andor</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="s">&quot;edges&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">new</span><span class="o">.</span><span class="n">induced_subgraph</span><span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="s">&quot;nodes&quot;</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">update_pathway_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">pwTyp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;_pathways&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">pwTyp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathway_types</span> <span class="o">=</span> <span class="n">pwTyp</span>
    
    <span class="k">def</span> <span class="nf">source_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outfile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;pwnet-&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span><span class="s">&quot;-sim-src&quot;</span><span class="p">])</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_databases</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&quot;nodes&quot;</span><span class="p">],</span><span class="n">outfile</span><span class="o">+</span><span class="s">&quot;-nodes&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&quot;edges&quot;</span><span class="p">],</span><span class="n">outfile</span><span class="o">+</span><span class="s">&quot;-edges&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">pathway_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outfile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;pwnet-&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span><span class="s">&quot;-sim-pw&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_pathway_types</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_pathways</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&quot;nodes&quot;</span><span class="p">],</span><span class="n">outfile</span><span class="o">+</span><span class="s">&quot;-nodes&quot;</span><span class="p">,</span><span class="n">cut</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&quot;edges&quot;</span><span class="p">],</span><span class="n">outfile</span><span class="o">+</span><span class="s">&quot;-edges&quot;</span><span class="p">,</span><span class="n">cut</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">update_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">src</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">+=</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;sources&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">src</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">update_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">pws</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;_pathways&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pws</span><span class="p">:</span>
                        <span class="n">pws</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">pws</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                                <span class="n">pws</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathways</span> <span class="o">=</span> <span class="n">pws</span>
    
    <span class="k">def</span> <span class="nf">delete_unmapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&quot;unmapped&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;unmapped&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">genesymbol_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">defaultNameType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_type</span><span class="p">[</span><span class="s">&quot;protein&quot;</span><span class="p">]</span>
        <span class="n">geneSymbol</span> <span class="o">=</span> <span class="s">&quot;genesymbol&quot;</span>
        <span class="n">mapTbl</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">defaultNameType</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">,</span><span class="n">geneSymbol</span><span class="p">])</span>
        <span class="n">mapTblRev</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">geneSymbol</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">,</span><span class="n">defaultNameType</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">((</span><span class="n">mapTbl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">tables</span> <span class="ow">and</span> 
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">mapTbl</span><span class="p">]</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;to&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> 
               <span class="p">(</span><span class="n">mapTblRev</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">tables</span> <span class="ow">and</span> 
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">mapTblRev</span><span class="p">]</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;from&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;Missing mapping table: </span><span class="si">%s</span><span class="s"> or </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> 
                        <span class="p">(</span><span class="n">mapTbl</span><span class="p">,</span><span class="n">mapTblRev</span><span class="p">)),</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">False</span>
        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;protein&quot;</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">],</span><span class="n">defaultNameType</span><span class="p">,</span><span class="n">geneSymbol</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;unmapped&quot;</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">network_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outfile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;pwnet&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span><span class="s">&quot;stats&quot;</span><span class="p">])</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">stats</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;vnum&quot;</span><span class="p">,</span> <span class="s">&quot;enum&quot;</span><span class="p">,</span> <span class="s">&quot;deg_avg&quot;</span><span class="p">,</span> <span class="s">&quot;diam&quot;</span><span class="p">,</span> 
                           <span class="s">&quot;trans&quot;</span><span class="p">,</span> <span class="s">&quot;adh&quot;</span><span class="p">,</span> <span class="s">&quot;coh&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;All&quot;</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">({</span>
                <span class="s">&quot;edge&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;sources&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">]},</span> <span class="s">&quot;node&quot;</span><span class="p">:</span> <span class="p">{}})</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">stats</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span> <span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">())</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">),</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">diameter</span><span class="p">(),</span> <span class="n">g</span><span class="o">.</span><span class="n">transitivity_undirected</span><span class="p">(),</span> <span class="n">g</span><span class="o">.</span><span class="n">adhesion</span><span class="p">(),</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">cohesion</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span><span class="n">outfile</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">degree_dists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dds</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">({</span><span class="s">&quot;edge&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;sources&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">]},</span> <span class="s">&quot;node&quot;</span><span class="p">:</span> <span class="p">{}})</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dds</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">degree_distribution</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">dds</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s">&quot;pwnet-&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span><span class="s">&quot;-degdist-&quot;</span><span class="p">,</span><span class="n">k</span><span class="p">])</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">bins</span><span class="p">():</span>
                <span class="n">bins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">),</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                           <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">),</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">])</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">intergroup_shortest_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">groupA</span><span class="p">,</span><span class="n">groupB</span><span class="p">,</span><span class="n">random</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">groupA</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;No such attribute: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">groupA</span><span class="p">),</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">groupB</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;No such attribute: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">groupB</span><span class="p">),</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">deg_pathlen</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">rat_pathlen</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">rand_pathlen</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">diam_pathlen</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;All&quot;</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span><span class="p">,</span><span class="n">groupA</span><span class="p">,</span><span class="n">groupB</span><span class="p">,</span><span class="s">&quot;paths&quot;</span><span class="p">])</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">({</span>
                <span class="s">&quot;edge&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;sources&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">]},</span> <span class="s">&quot;node&quot;</span><span class="p">:</span> <span class="p">{}})</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">grA</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">grB</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupA</span><span class="p">]:</span>
                    <span class="n">grA</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupB</span><span class="p">]:</span>
                    <span class="n">grB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupB</span><span class="p">]:</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_shortest_paths</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">grA</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s">&quot;epath&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pt</span><span class="p">:</span>
                        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> 
                        <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">grA</span><span class="p">):</span>
                        <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">({</span><span class="s">&quot;paths&quot;</span><span class="p">:</span> <span class="n">paths</span><span class="p">},</span> <span class="n">outfile</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;;&quot;</span><span class="p">,</span><span class="n">colnames</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">rownames</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">deg</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
            <span class="n">mean_pathlen</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">))</span>
            <span class="n">deg_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_pathlen</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">deg</span><span class="p">))]</span>
            <span class="n">rat_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_pathlen</span><span class="p">,</span>
                                <span class="n">f</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">grA</span><span class="o">+</span><span class="n">grB</span><span class="p">))))]</span>
            <span class="n">diam_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_pathlen</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">diameter</span><span class="p">()]</span>
            <span class="k">if</span> <span class="n">random</span><span class="p">:</span>
                <span class="n">groupA_random</span> <span class="o">=</span> <span class="n">groupA</span><span class="o">+</span><span class="s">&quot;_random&quot;</span>
                <span class="n">groupB_random</span> <span class="o">=</span> <span class="n">groupB</span><span class="o">+</span><span class="s">&quot;_random&quot;</span>
                <span class="n">random_pathlen</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupA_random</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupA</span><span class="p">])</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupB_random</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupB</span><span class="p">])</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupA_random</span><span class="p">])</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">groupB_random</span><span class="p">])</span>
                    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">grA</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">grB</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupA_random</span><span class="p">]:</span>
                            <span class="n">grA</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupB_random</span><span class="p">]:</span>
                            <span class="n">grB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">groupB_random</span><span class="p">]:</span>
                            <span class="n">pt</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_shortest_paths</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">grA</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s">&quot;epath&quot;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pt</span><span class="p">:</span>
                                <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> 
                                <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">grA</span><span class="p">):</span>
                                <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">random_pathlen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">random_pathlen</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rand_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_pathlen</span><span class="p">,</span>
                                        <span class="nb">sum</span><span class="p">(</span><span class="n">random_pathlen</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">random_pathlen</span><span class="p">))]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rand_pathlen</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_pathlen</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
        <span class="n">deg_pathlen</span><span class="p">[</span><span class="s">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;path_len&quot;</span><span class="p">,</span><span class="s">&quot;degree&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">deg_pathlen</span><span class="p">,</span><span class="s">&quot;deg_pathlen&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;;&quot;</span><span class="p">)</span>
        <span class="n">diam_pathlen</span><span class="p">[</span><span class="s">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;path_len&quot;</span><span class="p">,</span><span class="s">&quot;diam&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">diam_pathlen</span><span class="p">,</span><span class="s">&quot;diam_pathlen&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;;&quot;</span><span class="p">)</span>
        <span class="n">rat_pathlen</span><span class="p">[</span><span class="s">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;path_len&quot;</span><span class="p">,</span><span class="s">&quot;ratio&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">rat_pathlen</span><span class="p">,</span><span class="s">&quot;rat_pathlen&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">:</span>
            <span class="n">rand_pathlen</span><span class="p">[</span><span class="s">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;path_len&quot;</span><span class="p">,</span><span class="s">&quot;random&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">rand_pathlen</span><span class="p">,</span><span class="s">&quot;rand_pathlen&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;;&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">update_vertex_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">v</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]))</span>
    
    <span class="k">def</span> <span class="nf">basic_stats_intergroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">groupA</span><span class="p">,</span><span class="n">groupB</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;All&quot;</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">(</span>
                <span class="p">{</span><span class="s">&quot;edge&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;sources&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">]},</span> <span class="s">&quot;node&quot;</span><span class="p">:</span> <span class="p">{}})</span>
            <span class="n">deg</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
            <span class="n">bw</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">betweenness</span><span class="p">()</span>
            <span class="n">vnum</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span>
            <span class="n">enum</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ecount</span><span class="p">()</span>
            <span class="n">cancerg</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">drugt</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">cdeg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tdeg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ddeg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cbw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tbw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dbw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="n">tdeg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deg</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                <span class="n">tbw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bw</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">groupA</span><span class="p">]:</span>
                    <span class="n">cg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
                    <span class="n">cancerg</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">cdeg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deg</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                    <span class="n">cbw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bw</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">groupB</span><span class="p">]:</span>
                    <span class="n">dt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
                    <span class="n">drugt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">ddeg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deg</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                    <span class="n">dbw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bw</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
            <span class="n">cpct</span> <span class="o">=</span> <span class="n">cancerg</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">groupA</span><span class="p">]))</span>
            <span class="n">dpct</span> <span class="o">=</span> <span class="n">drugt</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lists</span><span class="p">[</span><span class="n">groupB</span><span class="p">]))</span>
            <span class="n">tdgr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tdeg</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tdeg</span><span class="p">))</span>
            <span class="n">cdgr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cdeg</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cdeg</span><span class="p">))</span>
            <span class="n">ddgr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ddeg</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ddeg</span><span class="p">))</span>
            <span class="n">tbwn</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tbw</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tbw</span><span class="p">))</span>
            <span class="n">cbwn</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cbw</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cbw</span><span class="p">))</span>
            <span class="n">dbwn</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dbw</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dbw</span><span class="p">))</span>
            <span class="n">src</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">csrc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dsrc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">src</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;sources&quot;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="n">groupA</span><span class="p">]</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="n">groupA</span><span class="p">]:</span>
                    <span class="n">csrc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;sources&quot;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="n">groupB</span><span class="p">]</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="n">groupB</span><span class="p">]:</span>
                    <span class="n">dsrc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;sources&quot;</span><span class="p">]))</span>
            <span class="n">snum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">src</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">src</span><span class="p">))</span>
            <span class="n">csnum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">csrc</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csrc</span><span class="p">))</span>
            <span class="n">dsnum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dsrc</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dsrc</span><span class="p">))</span>
            <span class="n">result</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">vnum</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">enum</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">cancerg</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">drugt</span><span class="p">),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">cpct</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">dpct</span><span class="p">),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">tdgr</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">cdgr</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">ddgr</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">tbwn</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">cbwn</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">dbwn</span><span class="p">),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">snum</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">csnum</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">dsnum</span><span class="p">)]</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">groupA</span><span class="p">,</span><span class="n">groupB</span><span class="p">,</span><span class="s">&quot;stats&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">header</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">outfile</span><span class="p">,</span><span class="n">colnames</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">outfile</span><span class="p">,</span><span class="n">colnames</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">sources_venn_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="n">ini</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">inj</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;sources&quot;</span><span class="p">]:</span>
                        <span class="n">ini</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;sources&quot;</span><span class="p">]:</span>
                        <span class="n">inj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">onlyi</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ini</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">inj</span><span class="p">))))</span>
                <span class="n">onlyj</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">inj</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">ini</span><span class="p">))))</span>
                <span class="n">inter</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ini</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">inj</span><span class="p">))))</span>
                <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="s">&quot;-&quot;</span><span class="o">+</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">onlyi</span><span class="p">,</span><span class="n">onlyj</span><span class="p">,</span><span class="n">inter</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="s">&quot;sources-venn-data.csv&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">sources_hist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">srcnum</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">srcnum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;sources&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span>
            <span class="p">{</span><span class="s">&quot;srcnum&quot;</span><span class="p">:</span> <span class="n">srcnum</span><span class="p">},</span><span class="s">&quot;source_num&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;;&quot;</span><span class="p">,</span><span class="n">rownames</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">colnames</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">degree_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">group</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">({</span><span class="s">&quot;deg&quot;</span><span class="p">:</span> <span class="n">deg</span><span class="p">},</span> <span class="n">prefix</span><span class="o">+</span><span class="s">&quot;-whole-degdist&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;;&quot;</span><span class="p">,</span>
                         <span class="n">rownames</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">colnames</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">group</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="s">&quot;Missing vertex attribute!&quot;</span><span class="p">),</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">gr</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                <span class="n">dgr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">gr</span><span class="p">]:</span>
                        <span class="n">dgr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_table</span><span class="p">({</span><span class="s">&quot;deg&quot;</span><span class="p">:</span> <span class="n">dgr</span><span class="p">},</span> <span class="n">prefix</span><span class="o">+</span><span class="s">&quot;-&quot;</span><span class="o">+</span><span class="n">gr</span><span class="o">+</span><span class="s">&quot;-degdist&quot;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;;&quot;</span><span class="p">,</span>
                                 <span class="n">rownames</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">colnames</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">delete_by_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">source</span><span class="p">,</span><span class="n">vertexAttrsToDel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">edgeAttrsToDel</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">verticesToDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">source</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">verticesToDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">verticesToDel</span><span class="p">)</span>
        <span class="n">edgesToDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">source</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">edgesToDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">source</span><span class="p">]))</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_edges</span><span class="p">(</span><span class="n">edgesToDel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vertexAttrsToDel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vAttr</span> <span class="ow">in</span> <span class="n">vertexAttrsToDel</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">vAttr</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                    <span class="k">del</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">vAttr</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">edgeAttrsToDel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">eAttr</span> <span class="ow">in</span> <span class="n">edgeAttrsToDel</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">eAttr</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                    <span class="k">del</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">eAttr</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">reference_hist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">tbl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">tbl</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span>
                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span>
                <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;references&#39;</span><span class="p">])),</span>
                <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]))</span>
            <span class="p">))</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">+</span><span class="s">&quot;-refs-hist&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tbl</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lst</span><span class="o">=</span><span class="n">best</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_resource</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">clean</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean_graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="sd">&#39;&#39;&#39;\n » %u interactions between %u nodes\n from %u resources have been loaded,\n for details see the log: ./%s\n&#39;&#39;&#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">logfile</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">load_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">load_mappings</span><span class="p">(</span><span class="n">maps</span><span class="o">=</span><span class="n">data_formats</span><span class="o">.</span><span class="n">mapList</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">clean</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; » &#39;</span><span class="o">+</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attach_network</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">clean</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_reflists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reflists</span> <span class="o">=</span> <span class="n">refLists</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rl</span> <span class="ow">in</span> <span class="n">reflists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_reflist</span><span class="p">(</span><span class="n">rl</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_reflist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">reflist</span><span class="p">):</span>
        <span class="n">reflist</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">reflist</span><span class="o">.</span><span class="n">nameType</span><span class="p">,</span><span class="n">reflist</span><span class="o">.</span><span class="n">typ</span><span class="p">,</span><span class="n">reflist</span><span class="o">.</span><span class="n">tax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">reflist</span>
    
    <span class="k">def</span> <span class="nf">load_negatives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">negative</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; » &#39;</span><span class="o">+</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_negative</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">list_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; » best</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">best</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">:: </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; » good</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">good</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">:: </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">descriptions</span><span class="o">.</span><span class="n">descriptions</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; :: Sorry, no description available about </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n\t</span><span class="s">::: </span><span class="si">%s</span><span class="s"> :::</span><span class="se">\n\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">name</span>
        <span class="k">if</span> <span class="s">&#39;urls&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;webpages&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">[</span><span class="s">&#39;urls&#39;</span><span class="p">]:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">:: Webpages:</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">[</span><span class="s">&#39;urls&#39;</span><span class="p">][</span><span class="s">&#39;webpages&#39;</span><span class="p">]:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">    » </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">w</span>
            <span class="k">if</span> <span class="s">&#39;articles&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">[</span><span class="s">&#39;urls&#39;</span><span class="p">]:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">:: Articles:</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">[</span><span class="s">&#39;urls&#39;</span><span class="p">][</span><span class="s">&#39;articles&#39;</span><span class="p">]:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">    » </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">w</span>
        <span class="k">if</span> <span class="s">&#39;taxons&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">:: Taxons: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s">&#39;taxons&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s">&#39;descriptions&#39;</span> <span class="ow">in</span> <span class="n">dd</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s">&#39;descriptions&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n\t</span><span class="s">:: From the authors:</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s">&#39;descriptions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="se">\n\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t\t</span><span class="s"> </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t\t</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">    &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;notes&#39;</span> <span class="ow">in</span> <span class="n">dd</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s">&#39;notes&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n\t</span><span class="s">:: Notes:</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s">&#39;notes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="se">\n\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t\t</span><span class="s"> </span><span class="si">%s</span><span class="se">\n\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t\t</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">    &#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    
    <span class="c">#</span>
    <span class="c"># functions to make topological analysis on the graph</span>
    <span class="c">#</span>
    
    <span class="k">def</span> <span class="nf">first_neighbours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">indices</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">neighborhood</span><span class="p">(</span><span class="n">node</span><span class="p">))</span><span class="o">-</span><span class="nb">set</span><span class="p">([</span><span class="n">node</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">indices</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lst</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nlst</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
                <span class="n">nlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">nlst</span>
    
    <span class="k">def</span> <span class="nf">second_neighbours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">indices</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">with_first</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">node_i</span> <span class="o">=</span> <span class="n">node</span> 
            <span class="n">node_n</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">node_i</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node_i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">node_i</span> <span class="o">=</span> <span class="n">node_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                <span class="n">node_n</span> <span class="o">=</span> <span class="n">node</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lst</span>
        <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_neighbours</span><span class="p">(</span><span class="n">node_i</span><span class="p">,</span><span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">first</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_neighbours</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">with_first</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">+=</span> <span class="n">first</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">first</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">indices</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">([</span><span class="n">node_i</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">([</span><span class="n">node_n</span><span class="p">]))</span>
    
    <span class="k">def</span> <span class="nf">all_neighbours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">indices</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;neighbours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Searching neighbours&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="n">v</span><span class="p">[</span><span class="s">&#39;neighbours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_neighbours</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">jaccard_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_neighbours</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">metaEdges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Calculating Jaccard-indices&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()):</span>
                <span class="n">vv</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="n">vw</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
                <span class="n">ja</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vv</span><span class="p">[</span><span class="s">&#39;neighbours&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">vw</span><span class="p">[</span><span class="s">&#39;neighbours&#39;</span><span class="p">]))</span>
                <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vv</span><span class="p">[</span><span class="s">&#39;neighbours&#39;</span><span class="p">])</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">vw</span><span class="p">[</span><span class="s">&#39;neighbours&#39;</span><span class="p">])))</span>
                <span class="n">metaEdges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vv</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span><span class="n">vw</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span><span class="n">ja</span><span class="p">))</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">metaEdges</span>
    
    <span class="k">def</span> <span class="nf">jaccard_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">jedges</span><span class="p">,</span><span class="n">critical</span><span class="p">):</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">jedges</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">critical</span><span class="p">:</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">TupleList</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">apply_negative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">settings</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">negatives</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">negatives</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span>
        <span class="n">neg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">negatives</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
        <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">neg</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Matching interactions&quot;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">e</span><span class="p">[</span><span class="s">&#39;negative&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;negative&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;negative&#39;</span><span class="p">]</span>
            <span class="n">e</span><span class="p">[</span><span class="s">&#39;negative_refs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;negative_refs&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;negative_refs&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">neg</span><span class="p">:</span>
            <span class="n">aexists</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="s">&quot;defaultNameA&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">bexists</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="s">&quot;defaultNameB&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">aexists</span> <span class="ow">and</span> <span class="n">bexists</span><span class="p">:</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="s">&quot;defaultNameA&quot;</span><span class="p">],</span><span class="n">n</span><span class="p">[</span><span class="s">&quot;defaultNameB&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;negative&#39;</span><span class="p">]:</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;negative&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;negative_refs&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">n</span><span class="p">[</span><span class="s">&#39;attrsEdge&#39;</span><span class="p">][</span><span class="s">&#39;references&#39;</span><span class="p">]</span>
                    <span class="n">matches</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="si">%u</span><span class="s"> matches found with negative set</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">matches</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">negative_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lst</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">outFile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outFile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">+</span> <span class="s">&#39;-negatives&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">neg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;negative&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">outFile</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">],</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">],</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]),</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;references&#39;</span><span class="p">]),</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;negative&#39;</span><span class="p">]),</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;negative_refs&#39;</span><span class="p">])])</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="k">if</span> <span class="n">lst</span><span class="p">:</span>
                    <span class="n">neg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">lst</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">neg</span>
    
    <span class="k">def</span> <span class="nf">export_ptms_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s">&#39;network-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">+</span><span class="s">&#39;.tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="s">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;UniProt_A&#39;</span><span class="p">,</span> <span class="s">&#39;UniProt_B&#39;</span><span class="p">,</span> <span class="s">&#39;GeneSymbol_B&#39;</span><span class="p">,</span> <span class="s">&#39;GeneSymbol_A&#39;</span><span class="p">,</span> <span class="s">&#39;Databases&#39;</span><span class="p">,</span>
                  <span class="s">&#39;PubMed_IDs&#39;</span><span class="p">,</span> <span class="s">&#39;Stimulation&#39;</span><span class="p">,</span> <span class="s">&#39;Inhibition&#39;</span><span class="p">,</span> <span class="s">&#39;PTM&#39;</span><span class="p">]</span>
        <span class="n">stripJson</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;[\[\]{}\&quot;]&#39;</span><span class="p">)</span>
        <span class="c"># first row is header</span>
        <span class="n">outl</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;Writing table&#39;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
            <span class="n">uniqedges</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="c"># only directed</span>
                <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">which_dirs</span><span class="p">():</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">tgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="c"># uniprot names</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">di</span><span class="p">)</span>
                    <span class="c"># genesymbols</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">tgt</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">]]</span>
                    <span class="c"># sources</span>
                    <span class="n">dbs</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbs</span><span class="p">))</span>
                    <span class="c"># references</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">rs</span> <span class="ow">in</span> \
                        <span class="p">[</span><span class="n">refs</span> <span class="k">for</span> <span class="n">db</span><span class="p">,</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;refs_by_source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> \
                            <span class="k">if</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">dbs</span><span class="p">]</span> \
                        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">]))</span>
                    <span class="c"># signs</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">di</span><span class="p">)]</span>
                    <span class="c"># domain-motif</span>
                    <span class="c"># row.append(&#39;#&#39;.join([x.print_residues() for x in e[&#39;ptm&#39;] \</span>
                    <span class="c">#    if x.__class__.__name__ == &#39;DomainMotif&#39;]))</span>
                    <span class="k">for</span> <span class="n">dmi</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">dmi</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;DomainMotif&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">identifier</span> <span class="o">==</span> <span class="n">di</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                    <span class="n">uniqedges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                    <span class="n">r</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="p">[</span>
                                        <span class="s">&#39;</span><span class="si">%s</span><span class="s">-</span><span class="si">%u</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> 
                                            <span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">isoform</span><span class="p">),</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">number</span><span class="p">),</span> <span class="n">dmi</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span><span class="p">]</span>
                                    <span class="c"># here each ptm in separate row:</span>
                                    <span class="n">outl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                    <span class="c"># row complete, appending to main list</span>
                    <span class="c"># outl.append(row)</span>
            <span class="c"># tabular text from list of lists; writing to file</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">outl</span><span class="p">])</span>
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">console</span><span class="p">(</span><span class="s">&#39;:: Data has been written to </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">outfile</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">uniqedges</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">export_struct_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s">&#39;network-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">+</span><span class="s">&#39;.tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="s">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;UniProt_A&#39;</span><span class="p">,</span> <span class="s">&#39;UniProt_B&#39;</span><span class="p">,</span> <span class="s">&#39;GeneSymbol_B&#39;</span><span class="p">,</span> <span class="s">&#39;GeneSymbol_A&#39;</span><span class="p">,</span> <span class="s">&#39;Databases&#39;</span><span class="p">,</span>
                  <span class="s">&#39;PubMed_IDs&#39;</span><span class="p">,</span> <span class="s">&#39;Stimulation&#39;</span><span class="p">,</span> <span class="s">&#39;Inhibition&#39;</span><span class="p">,</span> <span class="s">&#39;Domain-domain&#39;</span><span class="p">,</span> 
                  <span class="s">&#39;Domain-motif-PTM&#39;</span><span class="p">,</span> <span class="s">&#39;PTM-regulation&#39;</span><span class="p">]</span>
        <span class="n">stripJson</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;[\[\]{}\&quot;]&#39;</span><span class="p">)</span>
        <span class="c"># first row is header</span>
        <span class="n">outl</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;Writing table&#39;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="c"># only directed</span>
                <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">which_dirs</span><span class="p">():</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">tgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="c"># uniprot names</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">di</span><span class="p">)</span>
                    <span class="c"># genesymbols</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">tgt</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">]]</span>
                    <span class="c"># sources</span>
                    <span class="n">dbs</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbs</span><span class="p">))</span>
                    <span class="c"># references</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">rs</span> <span class="ow">in</span> \
                        <span class="p">[</span><span class="n">refs</span> <span class="k">for</span> <span class="n">db</span><span class="p">,</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;refs_by_source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> \
                            <span class="k">if</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">dbs</span><span class="p">]</span> \
                        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">]))</span>
                    <span class="c"># signs</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">di</span><span class="p">)]</span>
                    <span class="c"># domain-domain</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;ddi&#39;</span><span class="p">]]))</span>
                    <span class="c"># domain-motif</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> \
                        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;Ptm&#39;</span><span class="p">]))</span>
                    <span class="c"># domain-motif</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> \
                        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;Regulation&#39;</span><span class="p">]))</span>
                    <span class="c"># row complete, appending to main list</span>
                    <span class="n">outl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="c"># tabular text from list of lists; writing to file</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">outl</span><span class="p">])</span>
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">console</span><span class="p">(</span><span class="s">&#39;:: Data has been written to </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">outfile</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">export_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">extraNodeAttrs</span><span class="o">=</span><span class="p">{},</span><span class="n">extraEdgeAttrs</span><span class="o">=</span><span class="p">{},</span><span class="n">outfile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s">&#39;network-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">+</span><span class="s">&#39;.tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;UniProt_A&#39;</span><span class="p">,</span><span class="s">&#39;GeneSymbol_A&#39;</span><span class="p">,</span><span class="s">&#39;UniProt_B&#39;</span><span class="p">,</span><span class="s">&#39;GeneSymbol_B&#39;</span><span class="p">,</span><span class="s">&#39;Databases&#39;</span><span class="p">,</span>
                  <span class="s">&#39;PubMed_IDs&#39;</span><span class="p">,</span><span class="s">&#39;Undirected&#39;</span><span class="p">,</span><span class="s">&#39;Direction_A-B&#39;</span><span class="p">,</span>
                  <span class="s">&#39;Direction_B-A&#39;</span><span class="p">,</span> <span class="s">&#39;Stimulatory_A-B&#39;</span><span class="p">,</span><span class="s">&#39;Inhibitory_A-B&#39;</span><span class="p">,</span>
                  <span class="s">&#39;Stimulatory_B-A&#39;</span><span class="p">,</span><span class="s">&#39;Inhibitory_B-A&#39;</span><span class="p">,</span><span class="s">&#39;Category&#39;</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="n">extraEdgeAttrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="s">&#39;_A&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">extraNodeAttrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="s">&#39;_B&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">extraNodeAttrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">stripJson</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;[\[\]{}\&quot;]&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;Writing table&#39;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">nameA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">nameB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">thisEdge</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">thisEdge</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nameA</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)]</span>
                <span class="n">thisEdge</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nameB</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">]]</span>
                <span class="n">thisEdge</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">])),</span>
                             <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;references&#39;</span><span class="p">]))]</span>
                <span class="n">thisEdge</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="s">&#39;undirected&#39;</span><span class="p">,</span><span class="n">sources</span><span class="o">=</span><span class="bp">True</span><span class="p">)),</span>
                             <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">),</span><span class="n">sources</span><span class="o">=</span><span class="bp">True</span><span class="p">)),</span>
                             <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dir</span><span class="p">((</span><span class="n">nameB</span><span class="p">,</span><span class="n">nameA</span><span class="p">),</span><span class="n">sources</span><span class="o">=</span><span class="bp">True</span><span class="p">))]</span>
                <span class="n">thisEdge</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> \
                            <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">((</span><span class="n">nameA</span><span class="p">,</span><span class="n">nameB</span><span class="p">),</span><span class="n">sources</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">((</span><span class="n">nameB</span><span class="p">,</span><span class="n">nameA</span><span class="p">),</span><span class="n">sources</span><span class="o">=</span><span class="bp">True</span><span class="p">)]</span>
                <span class="n">thisEdge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">extraEdgeAttrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">thisEdge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> 
                            <span class="n">stripJson</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">v</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)])</span>
                    <span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">extraNodeAttrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">thisEdge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> 
                            <span class="n">stripJson</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="n">v</span><span class="p">])</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)])</span>
                    <span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">extraNodeAttrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">thisEdge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> 
                            <span class="n">stripJson</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="n">v</span><span class="p">])</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)])</span>
                    <span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">thisEdge</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">export_graphml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;main&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genesymbol_labels</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">graph</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s">&#39;network-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">+</span><span class="s">&#39;.graphml&#39;</span><span class="p">)</span>
        <span class="n">isDir</span> <span class="o">=</span> <span class="s">&#39;directed&#39;</span> <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span> <span class="k">else</span> <span class="s">&#39;undirected&#39;</span>
        <span class="n">isDirB</span> <span class="o">=</span> <span class="s">&#39;true&#39;</span> <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span> <span class="k">else</span> <span class="s">&#39;false&#39;</span>
        <span class="n">nodeAttrs</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;UniProt&#39;</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;GeneSymbol&#39;</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;Type&#39;</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">)]</span>
        <span class="n">edgeAttrs</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;Databases&#39;</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;PubMedIDs&#39;</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;Undirected&#39;</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;DirectionAB&#39;</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;DirectionBA&#39;</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;StimulatoryAB&#39;</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;InhibitoryAB&#39;</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;StimulatoryBA&#39;</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;InhibitoryBA&#39;</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;Category&#39;</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">)]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="s">                    &lt;graphml xmlns=&quot;http://graphml.graphdrawing.org/xmlns&quot; </span>
<span class="s">                    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="s">                    xsi:schemaLocation=&quot;http://graphml.graphdrawing.org/xmlns </span>
<span class="s">                    http://graphml.graphdrawing.org/xmlns/1.0/graphml.xsd&quot;&gt;</span><span class="se">\n\n</span><span class="s"></span>
<span class="s">                &#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">nodeAttrs</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;key id=&quot;</span><span class="si">%s</span><span class="s">&quot; for=&quot;node&quot; attr.name=&quot;</span><span class="si">%s</span><span class="s">&quot; attr.type=&quot;</span><span class="si">%s</span><span class="s">&quot; /&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">edgeAttrs</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;key id=&quot;</span><span class="si">%s</span><span class="s">&quot; for=&quot;edge&quot; attr.name=&quot;</span><span class="si">%s</span><span class="s">&quot; attr.type=&quot;</span><span class="si">%s</span><span class="s">&quot; /&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span><span class="se">\n</span><span class="s">&lt;graph id=&quot;</span><span class="si">%s</span><span class="s">&quot; edgedefault=&quot;</span><span class="si">%s</span><span class="s">&quot; </span>
<span class="s">                        parse.nodeids=&quot;free&quot; parse.edgeids=&quot;canonical&quot; </span>
<span class="s">                        parse.order=&quot;nodesfirst&quot;&gt;</span><span class="se">\n\n</span><span class="s">&#39;&#39;&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">isDir</span><span class="p">))</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;Writing nodes&#39;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\t</span><span class="s">&lt;!-- graph properties --&gt;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\t</span><span class="s">&lt;!-- vertices --&gt;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;node id=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;data key=&quot;UniProt&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/data&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;data key=&quot;GeneSymbol&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/data&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">v</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;data key=&quot;Type&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/data&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;/node&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;Writing edges&#39;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\t</span><span class="s">&lt;!-- edges --&gt;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;edge id=&quot;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&quot; source=&quot;</span><span class="si">%s</span><span class="s">&quot; target=&quot;</span><span class="si">%s</span><span class="s">&quot; directed=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="se">\n</span><span class="s">&#39;</span> \
                    <span class="o">%</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span>
                       <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span>
                       <span class="n">isDirB</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;data key=&quot;Databases&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/data&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;data key=&quot;PubMedIDs&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/data&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;references&#39;</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;data key=&quot;Undirected&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/data&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs_by_source&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;data key=&quot;DirectionAB&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/data&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs_by_source&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;data key=&quot;DirectionBA&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/data&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs_by_source&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;data key=&quot;StimulatoryAB&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/data&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;signs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;data key=&quot;InhibitoryAB&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/data&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;signs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;data key=&quot;StimulatoryBA&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/data&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;signs&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;data key=&quot;InhibitoryBA&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/data&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniqList</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;signs&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&lt;data key=&quot;InhibitoryBA&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/data&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">e</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;/edge&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\t</span><span class="s">&lt;/graph&gt;</span><span class="se">\n</span><span class="s">&lt;/graphml&gt;&#39;</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">compounds_from_chembl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chembl_mysql</span><span class="p">,</span><span class="n">nodes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">crit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">andor</span><span class="o">=</span><span class="s">&quot;or&quot;</span><span class="p">,</span>
                              <span class="n">assay_types</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="s">&#39;F&#39;</span><span class="p">],</span><span class="n">relationship_types</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;D&#39;</span><span class="p">,</span><span class="s">&#39;H&#39;</span><span class="p">],</span>
                              <span class="n">multi_query</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chembl</span> <span class="o">=</span> <span class="n">chembl</span><span class="o">.</span><span class="n">Chembl</span><span class="p">(</span><span class="n">chembl_mysql</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span><span class="n">mapper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">crit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sub</span><span class="p">(</span><span class="n">crit</span><span class="o">=</span><span class="n">crit</span><span class="p">,</span><span class="n">andor</span><span class="o">=</span><span class="n">andor</span><span class="p">)</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="n">sub</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span>
        <span class="n">uniprots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;nameType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;uniprot&#39;</span><span class="p">:</span>
                <span class="n">uniprots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">multi_query</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chembl</span><span class="o">.</span><span class="n">compounds_targets_1b1</span><span class="p">(</span><span class="n">uniprots</span><span class="p">,</span><span class="n">assay_types</span><span class="o">=</span><span class="n">assay_types</span><span class="p">,</span>
                            <span class="n">relationship_types</span><span class="o">=</span><span class="n">relationship_types</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chembl</span><span class="o">.</span><span class="n">compounds_targets</span><span class="p">(</span><span class="n">uniprots</span><span class="p">,</span><span class="n">assay_types</span><span class="o">=</span><span class="n">assay_types</span><span class="p">,</span>
                                <span class="n">relationship_types</span><span class="o">=</span><span class="n">relationship_types</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chembl</span><span class="o">.</span><span class="n">compounds_by_target</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;compounds_chembl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;compounds_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;compounds_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chembl</span><span class="o">.</span><span class="n">compounds</span><span class="p">)</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">num</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Adding compounds&#39;</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">hascomp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">target</span><span class="p">,</span><span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chembl</span><span class="o">.</span><span class="n">compounds</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                <span class="n">hascomp</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">target</span><span class="p">)]</span>
                <span class="n">node</span><span class="p">[</span><span class="s">&#39;compounds_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">node</span><span class="p">[</span><span class="s">&#39;compounds_chembl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="s">&#39;chembl&#39;</span><span class="p">])</span>
                    <span class="n">node</span><span class="p">[</span><span class="s">&#39;compounds_names&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">comp</span><span class="p">[</span><span class="s">&#39;compound_names&#39;</span><span class="p">]</span>
                <span class="n">node</span><span class="p">[</span><span class="s">&#39;compounds_chembl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s">&#39;compounds_chembl&#39;</span><span class="p">])</span>
                <span class="n">node</span><span class="p">[</span><span class="s">&#39;compounds_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqList</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s">&#39;compounds_names&#39;</span><span class="p">])</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">percent</span> <span class="o">=</span> <span class="n">hascomp</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">())</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\t</span><span class="s">Compounds found for </span><span class="si">%u</span><span class="s"> targets, (</span><span class="si">%.2f%%</span><span class="s"> of all proteins).</span><span class="se">\n\n</span><span class="s">&#39;</span>\
            <span class="o">%</span> <span class="p">(</span><span class="n">hascomp</span><span class="p">,</span><span class="n">percent</span><span class="o">*</span><span class="mf">100.0</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">html_descriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span><span class="s">&#39;resources.html&#39;</span><span class="p">)</span> \
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">filename</span>
        <span class="n">head</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;&lt;!DOCTYPE HTML&gt;</span>
<span class="s">        &lt;html&gt;</span>
<span class="s">            &lt;head&gt;</span>
<span class="s">                &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot;&gt;</span>
<span class="s">                &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;</span>
<span class="s">                &lt;meta http-equiv=&quot;Content-Language&quot; content=&quot;en&quot;&gt;</span>
<span class="s">                &lt;meta name=&quot;dc.language&quot; content=&quot;en&quot;&gt;</span>
<span class="s">                &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, </span>
<span class="s">                initial-scale=1.0&quot;&gt;</span>
<span class="s">                &lt;style type=&quot;text/css&quot;&gt;</span>
<span class="s">                    .quotebox {</span>
<span class="s">                        border-color: #7AADBD;</span>
<span class="s">                        border-style: solid;</span>
<span class="s">                        border-width: 1px 1px 1px 3px;</span>
<span class="s">                        margin: 0.75em 1em;</span>
<span class="s">                        padding: 0px 0.75em;</span>
<span class="s">                        background-color: #F6F9FC;</span>
<span class="s">                        color: #444444;</span>
<span class="s">                    }</span>
<span class="s">                &lt;/style&gt;</span>
<span class="s">            &lt;/head&gt;</span>
<span class="s">            &lt;body&gt;</span>
<span class="s">            &lt;h1&gt;PPI resources&#39;&#39;&#39;</span>
        <span class="n">foot</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\t</span><span class="s">&lt;/body&gt;</span><span class="se">\n</span><span class="s"></span>
<span class="s">        &lt;/html&gt;</span><span class="se">\n</span><span class="s">&#39;&#39;&#39;</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">descriptions</span><span class="o">.</span><span class="n">descriptions</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">doc</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t\t</span><span class="s">&lt;h2&gt;</span><span class="si">%s</span><span class="s">&lt;/h2&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">k</span>
            <span class="k">for</span> <span class="n">uk</span><span class="p">,</span><span class="n">uv</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;urls&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">doc</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t\t\t</span><span class="s">&lt;h3&gt;</span><span class="si">%s</span><span class="s">&lt;/h3&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">uk</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">uv</span><span class="p">:</span>
                    <span class="n">doc</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t\t\t\t</span><span class="s">&lt;a href=&quot;</span><span class="si">%s</span><span class="s">&quot; target=&quot;_blank&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">&#39;taxons&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">doc</span> <span class="o">+=</span> <span class="s">&#39;&lt;p&gt;&lt;b&gt;Taxons: &lt;/b&gt;</span><span class="si">%s</span><span class="s">&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;taxons&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s">&#39;size&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">doc</span> <span class="o">+=</span> <span class="s">&#39;&lt;p&gt;&lt;b&gt;Nodes: &lt;/b&gt;</span><span class="si">%s</span><span class="s">, &lt;b&gt;Edges:&lt;/b&gt;</span><span class="si">%s</span><span class="s">&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">v</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">][</span><span class="s">&#39;edges&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s">&#39;descriptions&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">doc</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t\t\t\t</span><span class="s">&lt;div class=&quot;quotebox&quot;&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="n">pars</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;descriptions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">doc</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t\t\t\t</span><span class="s">&lt;p&gt;</span><span class="si">%s</span><span class="s">&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">p</span>
                <span class="n">doc</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t\t\t\t</span><span class="s">&lt;/div&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="k">if</span> <span class="s">&#39;notes&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">doc</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t\t\t\t</span><span class="s">&lt;div class=&quot;quotebox&quot;&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="n">pars</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;notes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">doc</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t\t\t\t</span><span class="s">&lt;p&gt;</span><span class="si">%s</span><span class="s">&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">p</span>
                <span class="n">doc</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t\t\t\t</span><span class="s">&lt;/div&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">head</span> <span class="o">+</span> <span class="n">doc</span> <span class="o">+</span> <span class="n">foot</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    
<div class="viewcode-block" id="BioGraph.network_filter"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph.network_filter">[docs]</a>    <span class="k">def</span> <span class="nf">network_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function aims to cut the number of edges in the network, </span>
<span class="sd">        without loosing nodes, to make the network less connected, </span>
<span class="sd">        less hairball-like, more usable for analysis.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ref_freq</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;refs_by_source&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">]:</span>
                            <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="n">avdeg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ecount</span><span class="p">(),</span><span class="s">&#39;Calculating scores&#39;</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">rs</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;refs_by_source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">:</span>
                    <span class="n">score</span> <span class="o">+=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">ref_freq</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r</span><span class="p">]</span>
            <span class="n">mindeg</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">degree</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">degree</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">mindeg</span> <span class="o">&lt;</span> <span class="n">avdeg</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">*=</span> <span class="nb">pow</span><span class="p">((</span><span class="n">mindeg</span> <span class="o">-</span> <span class="n">avdeg</span><span class="p">),</span><span class="n">p</span><span class="p">)</span>
            <span class="n">e</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="BioGraph.shortest_path_dist"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph.shortest_path_dist">[docs]</a>    <span class="k">def</span> <span class="nf">shortest_path_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">subset</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">outfile</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        subset is a tuple of two lists if you wish to look for</span>
<span class="sd">        paths between elements of two groups, or a list if you </span>
<span class="sd">        wish to look for shortest paths within this group</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">shortest_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="ow">or</span> <span class="n">subset</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">subset</span><span class="p">,</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">(),</span><span class="s">&#39;Calculating paths&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">subset</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">paths</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_shortest_paths</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">graph</span><span class="o">.</span><span class="n">vcount</span><span class="p">()),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">subset</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> \
                                            <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">shortest_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shortest_paths</span><span class="p">])</span>
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">shortest_paths</span>
    </div>
    <span class="k">def</span> <span class="nf">load_pdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">u_pdb</span><span class="p">,</span><span class="n">pdb_u</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pdb</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">u_pdb</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Failed to download UniProt-PDB dictionary&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;pdb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="s">&#39;pdb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">u_pdb</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pdb</span> <span class="ow">in</span> <span class="n">u_pdb</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]:</span>
                        <span class="n">v</span><span class="p">[</span><span class="s">&#39;pdb&#39;</span><span class="p">][</span><span class="n">pdb</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pdb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pdb</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;PDB IDs for proteins has been retrieved.&#39;</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_pfam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">u_pfam</span><span class="p">,</span> <span class="n">pfam_u</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pfam</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">pfams</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Failed to download Pfam data from UniProt&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="s">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">u_pfam</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">u_pfam</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Pfam domains has been retrieved.&#39;</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_pfam2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfam_regions</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Failed to download data from Pfam&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s">&#39;pfam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Pfam domains has been retrieved.&#39;</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_pfam3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfam_regions</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Failed to download data from Pfam&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;doms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pfam</span><span class="p">,</span> <span class="n">regions</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
                            <span class="n">v</span><span class="p">[</span><span class="s">&#39;doms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> 
                                <span class="n">domain</span> <span class="o">=</span> <span class="n">pfam</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">],</span> 
                                <span class="n">end</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">],</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s">&#39;isoform&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Pfam domains has been retrieved.&#39;</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_corum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">complexes</span><span class="p">,</span><span class="n">members</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_corum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">complexes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Failed to download data from CORUM&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_complex_attr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="s">&#39;corum&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">cs</span> <span class="ow">in</span> <span class="n">members</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">sw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="s">&#39;uniprot&#39;</span><span class="p">,</span><span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sw</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cs</span><span class="p">:</span>
                            <span class="n">others</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">memb</span> <span class="ow">in</span> <span class="n">complexes</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]:</span>
                                <span class="n">others</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">memb</span><span class="p">,</span><span class="s">&#39;uniprot&#39;</span><span class="p">,</span><span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;complexes&#39;</span><span class="p">][</span><span class="s">&#39;corum&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s">&#39;full_name&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="s">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">others</span><span class="p">,</span>
                                <span class="s">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">complexes</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                                <span class="s">&#39;references&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                <span class="s">&#39;functions&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                <span class="s">&#39;diseases&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Complexes from CORUM have been retrieved.&#39;</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">init_complex_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;complexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">]:</span>
                <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">load_havugimana</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">complexes</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">read_complexes_havugimana</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">complexes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Failed to read data from Havugimana&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_complex_attr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="s">&#39;havugimana&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">complexes</span><span class="p">:</span>
                <span class="n">membs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">memb</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">membs</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">memb</span><span class="p">,</span><span class="s">&#39;uniprot&#39;</span><span class="p">,</span><span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">membs</span><span class="p">:</span>
                    <span class="n">names</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="s">&#39;uniprot&#39;</span><span class="p">,</span><span class="s">&#39;genesymbol&#39;</span><span class="p">)</span>
                <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
                <span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">membs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">u</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;complexes&#39;</span><span class="p">][</span><span class="s">&#39;havugimana&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s">&#39;full_name&#39;</span><span class="p">:</span> <span class="s">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; complex&#39;</span><span class="p">,</span>
                            <span class="s">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">membs</span><span class="p">,</span>
                            <span class="s">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">c</span>
                        <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Complexes from Havugimana have been retrieved.&#39;</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_compleat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">complexes</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_compleat</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">complexes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Failed to load data from COMPLEAT&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_complex_attr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="s">&#39;compleat&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">complexes</span><span class="p">:</span>
                <span class="n">c</span><span class="p">[</span><span class="s">&#39;uniprots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">c</span><span class="p">[</span><span class="s">&#39;gsymbols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;entrez&#39;</span><span class="p">]:</span>
                    <span class="n">c</span><span class="p">[</span><span class="s">&#39;uniprots&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="s">&#39;entrez&#39;</span><span class="p">,</span><span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;uniprots&#39;</span><span class="p">]:</span>
                    <span class="n">c</span><span class="p">[</span><span class="s">&#39;gsymbols&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="s">&#39;uniprot&#39;</span><span class="p">,</span><span class="s">&#39;genesymbol&#39;</span><span class="p">)</span>
                <span class="n">c</span><span class="p">[</span><span class="s">&#39;gsymbols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">gs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">gs</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;gsymbols&#39;</span><span class="p">]]))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;uniprots&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s">&#39;unmapped&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;uniprots&#39;</span><span class="p">]:</span>
                        <span class="n">c</span><span class="p">[</span><span class="s">&#39;uniprots&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;unmapped&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;uniprots&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]:</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;gsymbols&#39;</span><span class="p">])</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">u</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;complexes&#39;</span><span class="p">][</span><span class="s">&#39;compleat&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s">&#39;full_name&#39;</span><span class="p">:</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39; complex&#39;</span><span class="p">,</span>
                            <span class="s">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;uniprots&#39;</span><span class="p">],</span>
                            <span class="s">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;entrez&#39;</span><span class="p">],</span>
                            <span class="s">&#39;source&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;source&#39;</span><span class="p">],</span>
                            <span class="s">&#39;references&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pubmeds&#39;</span><span class="p">]</span>
                        <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Complexes from COMPLEAT have been retrieved.&#39;</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_complexportal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="c">## TODO: handling species</span>
        <span class="n">complexes</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_complexportal</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">complexes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Failed to read data from Havugimana&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;complexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="s">&#39;complexportal&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">]:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">][</span><span class="s">&#39;complexportal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">complexes</span><span class="p">:</span>
                <span class="n">swprots</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="s">&#39;complex recommended name&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;names&#39;</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;names&#39;</span><span class="p">][</span><span class="s">&#39;complex recommended name&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;fullname&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;uniprots&#39;</span><span class="p">]:</span>
                    <span class="n">swprots</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="s">&#39;uniprot&#39;</span><span class="p">,</span><span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="n">swprots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">swprots</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">sw</span> <span class="ow">in</span> <span class="n">swprots</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sw</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">sw</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">][</span><span class="s">&#39;complexportal&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s">&#39;full_name&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;fullname&#39;</span><span class="p">],</span>
                            <span class="s">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">swprots</span><span class="p">,</span>
                            <span class="s">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;uniprots&#39;</span><span class="p">],</span>
                            <span class="s">&#39;pdbs&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pdbs&#39;</span><span class="p">],</span>
                            <span class="s">&#39;references&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pubmeds&#39;</span><span class="p">],</span>
                            <span class="s">&#39;synonyms&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;names&#39;</span><span class="p">],</span>
                            <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">]</span>
                        <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Complexes from Complex Portal have been retrieved.&#39;</span><span class="p">,</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_3dcomplexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">c3d</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_3dcomplexes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">c3d</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Failed to download data from 3DComplexes and PDB&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;complexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="s">&#39;3dcomplexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">]:</span>
                    <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">][</span><span class="s">&#39;3dcomplexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s">&#39;3dstructure&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;3dstructure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;3dstructure&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">e</span><span class="p">[</span><span class="s">&#39;3dstructure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="s">&#39;3dcomplexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;3dstructure&#39;</span><span class="p">]:</span>
                    <span class="n">e</span><span class="p">[</span><span class="s">&#39;3dstructure&#39;</span><span class="p">][</span><span class="s">&#39;3dcomplexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">compl_names</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">compl_membs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">compl_links</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c3d</span><span class="p">),</span><span class="s">&#39;Processing complexes&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cname</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">c3d</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">swprots</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">uprots</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ups</span><span class="p">,</span><span class="n">contact</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">uprots</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ups</span><span class="p">)</span>
                    <span class="n">up1s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">ups</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;uniprot&#39;</span><span class="p">,</span><span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">up1</span> <span class="ow">in</span> <span class="n">up1s</span><span class="p">:</span>
                        <span class="n">inRefLists</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">for</span> <span class="n">tax</span><span class="p">,</span><span class="n">lst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">up1</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">lst</span><span class="p">:</span>
                                <span class="n">up2s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">ups</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;uniprot&#39;</span><span class="p">,</span><span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">up2</span> <span class="ow">in</span> <span class="n">up2s</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">tax</span><span class="p">,</span><span class="n">lst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflists</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                        <span class="k">if</span> <span class="n">up2</span> <span class="ow">in</span> <span class="n">lst</span><span class="o">.</span><span class="n">lst</span><span class="p">:</span>
                                            <span class="n">inRefLists</span> <span class="o">=</span> <span class="bp">True</span>
                                            <span class="n">thisPair</span> <span class="o">=</span> <span class="p">[</span><span class="n">up1</span><span class="p">,</span><span class="n">up2</span><span class="p">]</span>
                                            <span class="n">thisPair</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                                            <span class="n">swprots</span> <span class="o">+=</span> <span class="n">thisPair</span>
                                            <span class="n">compl_links</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
                                                <span class="n">thisPair</span><span class="p">,</span>
                                                <span class="n">contact</span><span class="p">,</span>
                                                <span class="n">cname</span>
                                                <span class="p">))</span>
                                            <span class="k">break</span>
                <span class="n">swprots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">swprots</span><span class="p">))</span>
                <span class="n">uprots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">uprots</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">swprots</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">swprots</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span><span class="s">&#39;uniprot&#39;</span><span class="p">,</span><span class="s">&#39;genesymbol&#39;</span><span class="p">)</span>
                    <span class="n">compl_names</span><span class="p">[</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; complex&#39;</span>
                    <span class="n">compl_membs</span><span class="p">[</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">swprots</span><span class="p">,</span><span class="n">uprots</span><span class="p">)</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">compl_membs</span><span class="p">),</span><span class="s">&#39;Processing nodes&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cname</span><span class="p">,</span><span class="n">uniprots</span> <span class="ow">in</span> <span class="n">compl_membs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">sp</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;complexes&#39;</span><span class="p">][</span><span class="s">&#39;3dcomplexes&#39;</span><span class="p">][</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s">&#39;full_name&#39;</span><span class="p">:</span> <span class="n">compl_names</span><span class="p">[</span><span class="n">cname</span><span class="p">],</span>
                            <span class="s">&#39;all_members&#39;</span><span class="p">:</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s">&#39;all_members_original&#39;</span><span class="p">:</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">}</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">compl_links</span><span class="p">),</span><span class="s">&#39;Processing edges&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">links</span> <span class="ow">in</span> <span class="n">compl_links</span><span class="p">:</span>
                <span class="n">one</span> <span class="o">=</span> <span class="n">links</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">two</span> <span class="o">=</span> <span class="n">links</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">two</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]:</span>
                    <span class="n">nodeOne</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">one</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                    <span class="n">nodeTwo</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">two</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">edge</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">_between</span><span class="o">=</span><span class="p">((</span><span class="n">nodeOne</span><span class="p">,),(</span><span class="n">nodeTwo</span><span class="p">,)))[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">edge</span><span class="p">[</span><span class="s">&#39;3dstructure&#39;</span><span class="p">][</span><span class="s">&#39;3dcomplexes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s">&#39;pdb&#39;</span><span class="p">:</span> <span class="n">links</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s">&#39;numof_residues&#39;</span><span class="p">:</span> <span class="n">links</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="p">})</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_pisa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="s">&#39;complexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span> \
            <span class="ow">or</span> <span class="s">&#39;3dcomplexes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;complexes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_3dcomplexes</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;complexportal&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;complexes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_complexportal</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="n">pdblist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">][</span><span class="s">&#39;3dcomplexes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">pdblist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">][</span><span class="s">&#39;complexportal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">pdblist</span> <span class="o">+=</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;pdbs&#39;</span><span class="p">]</span>
        <span class="n">pdblist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">pdblist</span><span class="p">))</span>
        <span class="n">pisa</span><span class="p">,</span> <span class="n">unmapped</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pisa</span><span class="p">(</span><span class="n">pdblist</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;interfaces&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;interfaces&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="s">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s">&#39;pisa&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;interfaces&#39;</span><span class="p">]:</span>
                <span class="n">e</span><span class="p">[</span><span class="s">&#39;interfaces&#39;</span><span class="p">][</span><span class="s">&#39;pisa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pdb</span><span class="p">,</span><span class="n">iflist</span> <span class="ow">in</span> <span class="n">pisa</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">uniprots</span><span class="p">,</span><span class="n">intf</span> <span class="ow">in</span> <span class="n">iflist</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">pdb</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;interfaces&#39;</span><span class="p">][</span><span class="s">&#39;pisa&#39;</span><span class="p">]:</span>
                            <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;interfaces&#39;</span><span class="p">][</span><span class="s">&#39;pisa&#39;</span><span class="p">][</span><span class="n">pdb</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;interfaces&#39;</span><span class="p">][</span><span class="s">&#39;pisa&#39;</span><span class="p">][</span><span class="n">pdb</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unmapped</span>
    
    <span class="k">def</span> <span class="nf">complex_comembership_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">resources</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">if</span> <span class="n">resources</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;complexes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">cnet</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="n">cdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">src</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cdict</span><span class="p">:</span>
                    <span class="n">cdict</span><span class="p">[</span><span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">cname</span><span class="p">,</span><span class="n">cannot</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;complexes&#39;</span><span class="p">][</span><span class="n">src</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">cname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cdict</span><span class="p">[</span><span class="n">src</span><span class="p">]:</span>
                            <span class="n">cdict</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">cdict</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="n">cname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">in_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">get_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="s">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">fun</span>
        <span class="n">fun</span> <span class="o">=</span> <span class="n">fun</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">fun0</span> <span class="o">=</span> <span class="n">fun</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">toCall</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">fun0</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">fun0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">fun0</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">fun0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">fun0</span> <span class="o">==</span> <span class="n">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="n">__main__</span>
        <span class="k">elif</span> <span class="n">fun0</span> <span class="o">==</span> <span class="s">&#39;self&#39;</span> <span class="ow">or</span> <span class="n">fun0</span> <span class="o">==</span> <span class="n">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">elif</span> <span class="n">fun0</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subm</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="n">subm</span><span class="p">],</span> <span class="s">&#39;__name__&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="nb">globals</span><span class="p">()[</span><span class="n">subm</span><span class="p">]</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="n">subm</span><span class="p">],</span> <span class="n">fun0</span><span class="p">):</span>
                        <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="n">subm</span><span class="p">],</span> <span class="n">fun0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">toCall</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">fun0</span> <span class="ow">in</span> <span class="n">fun</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="n">fun0</span><span class="p">):</span>
                <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="n">fun0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="s">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">toCall</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">edges_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;dataio.get_instruct&#39;</span><span class="p">,</span> <span class="s">&#39;dataio.get_i3d&#39;</span><span class="p">]):</span>
        <span class="n">all_3d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">all_3d</span> <span class="o">+=</span> <span class="n">fun</span><span class="p">()</span>
        <span class="c"># initializing edge attributes:</span>
        <span class="k">if</span> <span class="s">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;ddi&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="s">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># assigning annotations:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_3d</span><span class="p">:</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s">&#39;uniprots&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s">&#39;uniprots&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">u1</span> <span class="o">!=</span> <span class="n">u2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u2</span><span class="p">):</span>
                    <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">seq1</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="n">u1</span><span class="p">][</span><span class="s">&#39;seq&#39;</span><span class="p">]:</span>
                            <span class="k">for</span> <span class="n">seq2</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="n">u2</span><span class="p">][</span><span class="s">&#39;seq&#39;</span><span class="p">]:</span>
                                <span class="n">dom1</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">u1</span><span class="p">,</span> 
                                    <span class="n">domain</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">u1</span><span class="p">][</span><span class="s">&#39;pfam&#39;</span><span class="p">],</span> 
                                    <span class="n">start</span> <span class="o">=</span> <span class="n">seq1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                    <span class="n">end</span> <span class="o">=</span> <span class="n">seq1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                    <span class="n">chains</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">[</span><span class="s">&#39;pdb&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="n">i</span><span class="p">[</span><span class="n">u1</span><span class="p">][</span><span class="s">&#39;chain&#39;</span><span class="p">]})</span>
                                <span class="n">dom2</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">u2</span><span class="p">,</span> 
                                    <span class="n">domain</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">u2</span><span class="p">][</span><span class="s">&#39;pfam&#39;</span><span class="p">],</span> 
                                    <span class="n">start</span> <span class="o">=</span> <span class="n">seq2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">end</span> <span class="o">=</span> <span class="n">seq2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">chains</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">[</span><span class="s">&#39;pdb&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="n">i</span><span class="p">[</span><span class="n">u2</span><span class="p">][</span><span class="s">&#39;chain&#39;</span><span class="p">]})</span>
                                <span class="n">domdom</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">DomainDomain</span><span class="p">(</span><span class="n">dom1</span><span class="p">,</span> <span class="n">dom2</span><span class="p">,</span> 
                                    <span class="n">refs</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s">&#39;references&#39;</span><span class="p">],</span> 
                                    <span class="n">sources</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s">&#39;source&#39;</span><span class="p">],</span> <span class="n">pdbs</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s">&#39;pdb&#39;</span><span class="p">])</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s">&#39;ddi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">domdom</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">edges_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfam_regions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pepcyber</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_psite_reg</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_ielm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_phosphoelm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_elm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_3did_dmi</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">pfam_regions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pfam_regions</span><span class="p">(</span>
                <span class="n">uniprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> 
                <span class="n">dicts</span> <span class="o">=</span> <span class="s">&#39;uniprot&#39;</span><span class="p">,</span>
                <span class="n">keepfile</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">complexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;3dcomplexes&#39;</span><span class="p">,</span> <span class="s">&#39;havugimana&#39;</span><span class="p">,</span> <span class="s">&#39;corum&#39;</span><span class="p">,</span>
                                <span class="s">&#39;complexportal&#39;</span><span class="p">,</span><span class="s">&#39;compleat&#39;</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;load_&#39;</span> <span class="o">+</span> <span class="n">m</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
                <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="s">&#39;__call__&#39;</span><span class="p">):</span>
                    <span class="n">toCall</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_domino_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organism</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">organism</span> <span class="o">=</span> <span class="n">organism</span> <span class="k">if</span> <span class="n">organism</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span>
        <span class="c">#all_unip = dataio.all_uniprots(organism)</span>
        <span class="n">domi</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_domino_ptms</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">domi</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                <span class="s">&#39;Failed to load domain-motif interaction data from DOMINO&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">domi</span><span class="p">[</span><span class="s">&#39;dmi&#39;</span><span class="p">]),</span> <span class="s">&#39;Loading domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dm</span> <span class="ow">in</span> <span class="n">domi</span><span class="p">[</span><span class="s">&#39;dmi&#39;</span><span class="p">]:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">uniprot1</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">protein</span>
            <span class="n">uniprot2</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot2</span><span class="p">):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">,</span> <span class="n">uniprot2</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_3did_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dmi</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">process_3did_dmi</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dmi</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                <span class="s">&#39;Failed to load domain-motif interaction data from 3DID&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dmi</span><span class="p">),</span> <span class="s">&#39;Loading domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">uniprots</span><span class="p">,</span> <span class="n">dmi_list</span> <span class="ow">in</span> <span class="n">dmi</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dmi_list</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
<div class="viewcode-block" id="BioGraph.load_ddi"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph.load_ddi">[docs]</a>    <span class="k">def</span> <span class="nf">load_ddi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ddi</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        ddi is either a list of intera.DomainDomain objects, </span>
<span class="sd">        or a function resulting this list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ddi</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ddi</span><span class="p">,</span> <span class="s">&#39;__call__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">ddi</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ddi</span><span class="o">.</span><span class="n">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;dataio&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                    <span class="s">&#39;Function </span><span class="si">%s</span><span class="s">() failed&#39;</span><span class="o">%</span><span class="n">ddi</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="s">&#39;Loading domain-domain interactions&#39;</span><span class="p">,</span><span class="mi">99</span><span class="p">)</span>
        <span class="n">in_network</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">uniprot1</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">protein</span>
            <span class="n">uniprot2</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">protein</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot2</span><span class="p">):</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">,</span> <span class="n">uniprot2</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ddi&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">in_network</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ddi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="BioGraph.load_dmi"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph.load_dmi">[docs]</a>    <span class="k">def</span> <span class="nf">load_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dmi</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        dmi is either a list of intera.DomainMotif objects, </span>
<span class="sd">        or a function resulting this list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">dmi</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dmi</span><span class="p">,</span> <span class="s">&#39;__call__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">dmi</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dmi</span><span class="o">.</span><span class="n">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;dataio&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                    <span class="s">&#39;Function </span><span class="si">%s</span><span class="s">() failed&#39;</span><span class="o">%</span><span class="n">dmi</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
    </div>
    <span class="k">def</span> <span class="nf">run_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methods</span><span class="p">,</span> <span class="n">toCall</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">toCall</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">toCall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">toCall</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">toCall</span><span class="p">,</span> <span class="s">&#39;__call__&#39;</span><span class="p">):</span>
                    <span class="n">toCall</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fun</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_ddis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;dataio.get_3dc_ddi&#39;</span><span class="p">,</span> <span class="s">&#39;dataio.get_domino_ddi&#39;</span><span class="p">,</span>
            <span class="s">&#39;self.load_3did_ddi2&#39;</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_batch</span><span class="p">(</span><span class="n">methods</span><span class="p">,</span> <span class="n">toCall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_ddi</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_dmis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
        <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;self.pfam_regions&#39;</span><span class="p">,</span>
        <span class="s">&#39;self.load_depod_dmi&#39;</span><span class="p">,</span>
        <span class="s">&#39;self.load_dbptm&#39;</span><span class="p">,</span>
        <span class="s">&#39;self.load_mimp_dmi&#39;</span><span class="p">,</span>
        <span class="s">&#39;self.load_pnetworks_dmi&#39;</span><span class="p">,</span>
        <span class="s">&#39;self.load_domino_dmi&#39;</span><span class="p">,</span>
        <span class="s">&#39;self.load_pepcyber&#39;</span><span class="p">,</span>
        <span class="s">&#39;self.load_psite_reg&#39;</span><span class="p">,</span>
        <span class="s">&#39;self.load_psite_phos&#39;</span><span class="p">,</span>
        <span class="s">&#39;self.load_ielm&#39;</span><span class="p">,</span>
        <span class="s">&#39;self.load_phosphoelm&#39;</span><span class="p">,</span>
        <span class="s">&#39;self.load_elm&#39;</span><span class="p">,</span>
        <span class="s">&#39;self.load_3did_dmi&#39;</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_batch</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniq_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phosphorylation_directions</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_3did_ddi2</span><span class="p">(</span><span class="n">ddi</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">unm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_pisa</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_3did_ddi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
        <span class="n">ddi</span><span class="p">,</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_3did_ddi</span><span class="p">(</span><span class="n">residues</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ddi</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">interfaces</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                <span class="s">&#39;Failed to load domain-domain interaction data from 3DID&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s">&#39;ddi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;ddi&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="s">&#39;ddi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s">&#39;3did&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;ddi&#39;</span><span class="p">]:</span>
                <span class="n">e</span><span class="p">[</span><span class="s">&#39;ddi&#39;</span><span class="p">][</span><span class="s">&#39;3did&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ddi</span><span class="p">),</span><span class="s">&#39;Loading domain-domain interactions&#39;</span><span class="p">,</span><span class="mi">99</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">ddi</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">uniprot1</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">uniprot2</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">swprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">swissprots</span><span class="p">([</span><span class="n">uniprot1</span><span class="p">,</span><span class="n">uniprot2</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">swprot1</span> <span class="ow">in</span> <span class="n">swprots</span><span class="p">[</span><span class="n">uniprot1</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">swprot2</span> <span class="ow">in</span> <span class="n">swprots</span><span class="p">[</span><span class="n">uniprot2</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">swprot1</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">swprot2</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">swprot1</span><span class="p">,</span><span class="n">swprot2</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span><span class="n">structures</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                <span class="k">for</span> <span class="n">pdb</span><span class="p">,</span><span class="n">pdb_uniprot_pairs</span> <span class="ow">in</span> \
                                        <span class="n">structures</span><span class="p">[</span><span class="s">&#39;pdbs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                    <span class="k">for</span> <span class="n">pdbuniprots</span> <span class="ow">in</span> <span class="n">pdb_uniprot_pairs</span><span class="p">:</span>
                                        <span class="n">pdbswprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">swissprots</span><span class="p">(</span><span class="n">pdbuniprots</span><span class="p">)</span>
                                        <span class="k">for</span> <span class="n">pdbswprot1</span> <span class="ow">in</span> <span class="n">pdbswprots</span><span class="p">[</span><span class="n">pdbuniprots</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                                            <span class="k">for</span> <span class="n">pdbswprot2</span> <span class="ow">in</span> <span class="n">pdbswprots</span><span class="p">[</span><span class="n">pdbuniprots</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
                                                <span class="n">this_ddi</span> <span class="o">=</span> <span class="p">{}</span>
                                                <span class="n">this_ddi</span><span class="p">[</span><span class="n">swprot1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                                    <span class="s">&#39;pfam&#39;</span><span class="p">:</span> <span class="n">domains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                                <span class="p">}</span>
                                                <span class="n">this_ddi</span><span class="p">[</span><span class="n">swprot2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                                    <span class="s">&#39;pfam&#39;</span><span class="p">:</span> <span class="n">domains</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                                <span class="p">}</span>
                                                <span class="n">this_ddi</span><span class="p">[</span><span class="s">&#39;uniprots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">swprot1</span><span class="p">,</span><span class="n">swprot2</span><span class="p">]</span>
                                                <span class="n">this_ddi</span><span class="p">[</span><span class="s">&#39;uniprots_original&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
                                                <span class="n">this_ddi</span><span class="p">[</span><span class="s">&#39;pdb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                                    <span class="n">swprot1</span><span class="p">:</span> <span class="n">pdbswprot1</span><span class="p">,</span>
                                                    <span class="n">swprot2</span><span class="p">:</span> <span class="n">pdbswprot2</span><span class="p">,</span>
                                                    <span class="s">&#39;pdb&#39;</span><span class="p">:</span> <span class="n">pdb</span>
                                                <span class="p">}</span>
                                                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ddi&#39;</span><span class="p">][</span><span class="s">&#39;3did&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_ddi</span><span class="p">)</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_3did_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_3did_ddi2</span><span class="p">(</span><span class="n">ddi</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_3did_ddi2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ddi</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">ddi</span><span class="p">,</span> <span class="n">intfs</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_3did</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ddi</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">interfaces</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ownlog</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                <span class="s">&#39;Failed to load domain-domain interaction data from 3DID&#39;</span><span class="p">,</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="c">#### ERROR</span>
        <span class="k">if</span> <span class="n">interfaces</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;interfaces&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">intf</span> <span class="ow">in</span> <span class="n">intfs</span><span class="p">:</span>
                <span class="n">uniprot1</span> <span class="o">=</span> <span class="n">intf</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">protein</span>
                <span class="n">uniprot2</span> <span class="o">=</span> <span class="n">intf</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">protein</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot2</span><span class="p">):</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_exists</span><span class="p">(</span><span class="n">uniprot1</span><span class="p">,</span> <span class="n">uniprot2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;interfaces&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;interfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;interfaces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ddi</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ddi</span>
    
    <span class="k">def</span> <span class="nf">load_ielm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">ppi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">ppi</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]))</span>
        <span class="n">ielm</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_ielm</span><span class="p">(</span><span class="n">ppi</span><span class="p">)</span>
        <span class="n">elm</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_elm_classes</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ielm</span><span class="p">),</span> <span class="s">&#39;Processing domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="n">noelm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ielm</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">elm</span><span class="p">:</span>
                        <span class="n">noelm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">motif</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">elm</span> <span class="k">else</span> <span class="n">elm</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                    <span class="n">mot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Motif</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="n">regex</span> <span class="o">=</span> <span class="n">motif</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> 
                        <span class="n">prob</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">motif</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">motif</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> 
                        <span class="n">description</span> <span class="o">=</span> <span class="n">motif</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">elm</span> <span class="o">=</span> <span class="n">motif</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">motif_name</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">dom</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">11</span><span class="p">]),</span> 
                        <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">]),</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">domain_id_type</span> <span class="o">=</span> <span class="s">&#39;ielm_hmm&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">pfam</span><span class="p">,</span> <span class="n">regions</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">]]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span> <span class="o">==</span> <span class="n">region</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                                    <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">==</span> <span class="n">region</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">]:</span>
                                    <span class="n">dom</span><span class="o">.</span><span class="n">pfam</span> <span class="o">=</span> <span class="n">pfam</span>
                                    <span class="n">dom</span><span class="o">.</span><span class="n">isoform</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s">&#39;isoform&#39;</span><span class="p">]</span>
                    <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">motif</span> <span class="o">=</span> <span class="n">mot</span><span class="p">,</span> 
                        <span class="n">typ</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">domMot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">DomainMotif</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">ptm</span><span class="p">,</span> <span class="s">&#39;iELM&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">domMot</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="c"># find deprecated elm classes:</span>
        <span class="c"># list(set(noelm))</span>
    
    <span class="k">def</span> <span class="nf">load_elm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">elm</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_elm_interactions</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elm</span><span class="p">),</span> <span class="s">&#39;Processing domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">elm</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">uniprot_elm</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">uniprot_dom</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot_elm</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">uniprot_dom</span><span class="p">):</span>
                    <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">mot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Motif</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">uniprot_elm</span><span class="p">,</span> <span class="n">motif_name</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
                            <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">uniprot_elm</span><span class="p">,</span> <span class="n">motif</span> <span class="o">=</span> <span class="n">mot</span><span class="p">)</span>
                            <span class="n">dstart</span> <span class="o">=</span> <span class="n">start</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;None&#39;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                            <span class="n">dend</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;None&#39;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">uniprot_dom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">uniprot_dom</span><span class="p">]:</span>
                                    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pfam</span><span class="p">[</span><span class="n">uniprot_dom</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
                                        <span class="k">if</span> <span class="n">dstart</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">dend</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                                            <span class="p">(</span><span class="n">dstart</span> <span class="o">==</span> <span class="n">region</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                                            <span class="n">dend</span> <span class="o">==</span> <span class="n">region</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">]):</span>
                                            <span class="n">doms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                                <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span>
                                                    <span class="n">protein</span> <span class="o">=</span> <span class="n">uniprot_dom</span><span class="p">,</span> 
                                                    <span class="n">domain</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                                    <span class="n">start</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">],</span> 
                                                    <span class="n">end</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">],</span>
                                                    <span class="n">isoform</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="s">&#39;isoform&#39;</span><span class="p">]</span>
                                                <span class="p">)</span>
                                            <span class="p">)</span>
                            <span class="k">for</span> <span class="n">dom</span> <span class="ow">in</span> <span class="n">doms</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="n">intera</span><span class="o">.</span><span class="n">DomainMotif</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">ptm</span><span class="p">,</span> <span class="s">&#39;ELM&#39;</span><span class="p">))</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_pepcyber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">pepc</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_pepcyber</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pepc</span><span class="p">),</span> <span class="s">&#39;Processing domain-motif interactions&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">pepc</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">uniprot1</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">uniprot1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="s">&#39;refseq&#39;</span><span class="p">,</span> <span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="n">uniprot2</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">11</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="c"># ptm on u2, </span>
            <span class="c"># u1 interacts with u2 depending on ptm</span>
            <span class="k">for</span> <span class="n">u1</span> <span class="ow">in</span> <span class="n">uniprot1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">u2</span> <span class="ow">in</span> <span class="n">uniprot2</span><span class="p">:</span>
                    <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">res</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Residue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="n">l</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">u2</span><span class="p">)</span>
                            <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">u2</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="n">res</span><span class="p">,</span> 
                                <span class="n">typ</span> <span class="o">=</span> <span class="s">&#39;phosphorylation&#39;</span><span class="p">)</span>
                            <span class="n">reg</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Regulation</span><span class="p">(</span>
                                <span class="n">source</span> <span class="o">=</span> <span class="n">u2</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">u1</span><span class="p">,</span> 
                                <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;PepCyber&#39;</span><span class="p">],</span>
                                <span class="n">effect</span> <span class="o">=</span> <span class="s">&#39;induces&#39;</span><span class="p">,</span> <span class="n">ptm</span> <span class="o">=</span> <span class="n">ptm</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_psite_reg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">modtyp</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;p&#39;</span><span class="p">:</span> <span class="s">&#39;phosphorylation&#39;</span><span class="p">,</span>
            <span class="s">&#39;ac&#39;</span><span class="p">:</span> <span class="s">&#39;acetylation&#39;</span><span class="p">,</span>
            <span class="s">&#39;ub&#39;</span><span class="p">:</span> <span class="s">&#39;ubiquitination&#39;</span><span class="p">,</span>
            <span class="s">&#39;me&#39;</span><span class="p">:</span> <span class="s">&#39;methylation&#39;</span><span class="p">,</span>
            <span class="s">&#39;sm&#39;</span><span class="p">:</span> <span class="s">&#39;sumoylation&#39;</span><span class="p">,</span>
            <span class="s">&#39;ga&#39;</span><span class="p">:</span> <span class="s">&#39;o-galnac&#39;</span><span class="p">,</span>
            <span class="s">&#39;gl&#39;</span><span class="p">:</span> <span class="s">&#39;o-glcnac&#39;</span><span class="p">,</span>
            <span class="s">&#39;sc&#39;</span><span class="p">:</span> <span class="s">&#39;succinylation&#39;</span><span class="p">,</span>
            <span class="s">&#39;m3&#39;</span><span class="p">:</span> <span class="s">&#39;tri-methylation&#39;</span><span class="p">,</span>
            <span class="s">&#39;m1&#39;</span><span class="p">:</span> <span class="s">&#39;mono-methylation&#39;</span><span class="p">,</span>
            <span class="s">&#39;m2&#39;</span><span class="p">:</span> <span class="s">&#39;di-methylation&#39;</span><span class="p">,</span>
            <span class="s">&#39;pa&#39;</span><span class="p">:</span> <span class="s">&#39;palmitoylation&#39;</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">preg</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_psite_reg</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">preg</span><span class="p">),</span> <span class="s">&#39;Processing regulatory effects&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">tgts</span> <span class="ow">in</span> <span class="n">preg</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="c"># ptm on src</span>
            <span class="c"># tgt: interactor of src, depending on ptm</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">tgt</span> <span class="ow">in</span> <span class="n">tgts</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">effect</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;induces&#39;</span><span class="p">,</span> <span class="s">&#39;disrupts&#39;</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">tgt</span><span class="p">[</span><span class="n">effect</span><span class="p">]:</span>
                            <span class="n">uniprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="s">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
                                    <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                                        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                            <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                                        <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                            <span class="n">res</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Residue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tgt</span><span class="p">[</span><span class="s">&#39;res&#39;</span><span class="p">]),</span> 
                                                <span class="n">tgt</span><span class="p">[</span><span class="s">&#39;aa&#39;</span><span class="p">],</span> <span class="n">src</span><span class="p">)</span>
                                            <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">src</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="n">res</span><span class="p">,</span> 
                                                <span class="n">typ</span> <span class="o">=</span> <span class="n">modtyp</span><span class="p">[</span><span class="n">tgt</span><span class="p">[</span><span class="s">&#39;modt&#39;</span><span class="p">]])</span>
                                            <span class="n">reg</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Regulation</span><span class="p">(</span>
                                                <span class="n">source</span> <span class="o">=</span> <span class="n">src</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span> 
                                                <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;PhosphoSite&#39;</span><span class="p">],</span> 
                                                <span class="n">refs</span> <span class="o">=</span> <span class="n">tgt</span><span class="p">[</span><span class="s">&#39;pmids&#39;</span><span class="p">],</span>
                                                <span class="n">effect</span> <span class="o">=</span> <span class="n">effect</span><span class="p">,</span> <span class="n">ptm</span> <span class="o">=</span> <span class="n">ptm</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_comppi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&#39;comppi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;comppi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;comppi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;comppi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">comppi</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_comppi</span><span class="p">()</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comppi</span><span class="p">),</span> <span class="s">&#39;Processing localizations&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">comppi</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">uniprots1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;uniprot1&#39;</span><span class="p">],</span> <span class="s">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="n">uniprots2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;uniprot2&#39;</span><span class="p">],</span> <span class="s">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">u1</span> <span class="ow">in</span> <span class="n">uniprots1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u1</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;loc1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">)]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">u1</span><span class="p">]]</span>\
                            <span class="p">[</span><span class="s">&#39;comppi&#39;</span><span class="p">][</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">u2</span> <span class="ow">in</span> <span class="n">uniprots1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u2</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;loc2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">)]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">u2</span><span class="p">]]</span>\
                            <span class="p">[</span><span class="s">&#39;comppi&#39;</span><span class="p">][</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">u1</span> <span class="ow">in</span> <span class="n">uniprots1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">u2</span> <span class="ow">in</span> <span class="n">uniprots2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_exists</span><span class="p">(</span><span class="n">u2</span><span class="p">):</span>
                        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;comppi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;loc_score&#39;</span><span class="p">])</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isoforms</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">swissprot_seq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span> <span class="n">isoforms</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_mimp_dmi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pnetworks_dmi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_phosphoelm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_dbptm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_psite_phos</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniq_ptms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phosphorylation_directions</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">load_mimp_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_matching</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="s">&#39;MIMP&#39;</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>
    
    <span class="k">def</span> <span class="nf">load_pnetworks_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="s">&#39;PhosphoNetworks&#39;</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>
    
    <span class="k">def</span> <span class="nf">load_phosphoelm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">ltp_only</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="s">&#39;phosphoELM&#39;</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="p">,</span> 
            <span class="n">ltp_only</span> <span class="o">=</span> <span class="n">ltp_only</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>
    
    <span class="k">def</span> <span class="nf">load_dbptm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_matching</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="s">&#39;dbPTM&#39;</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>
    
    <span class="k">def</span> <span class="nf">load_psite_phos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_phospho_dmi</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="s">&#39;PhosphoSite&#39;</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trace</span>
    
    <span class="k">def</span> <span class="nf">load_phospho_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">functions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;MIMP&#39;</span><span class="p">:</span> <span class="s">&#39;get_mimp&#39;</span><span class="p">,</span>
            <span class="s">&#39;PhosphoNetworks&#39;</span><span class="p">:</span> <span class="s">&#39;get_phosphonetworks&#39;</span><span class="p">,</span>
            <span class="s">&#39;phosphoELM&#39;</span><span class="p">:</span> <span class="s">&#39;get_phosphoelm&#39;</span><span class="p">,</span>
            <span class="s">&#39;dbPTM&#39;</span><span class="p">:</span> <span class="s">&#39;get_dbptm&#39;</span><span class="p">,</span>
            <span class="s">&#39;PhosphoSite&#39;</span><span class="p">:</span> <span class="s">&#39;get_psite_phos&#39;</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">toCall</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dataio</span><span class="p">,</span> <span class="n">functions</span><span class="p">[</span><span class="n">source</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">toCall</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">nomatch</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kin_ambig</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">sub_ambig</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s">&#39;Processing PTMs from </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">source</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;kinase&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;kinase&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># database specific id conversions</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;PhosphoSite&#39;</span><span class="p">,</span> <span class="s">&#39;phosphoELM&#39;</span><span class="p">]:</span>
                    <span class="n">kinase_ups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;kinase&#39;</span><span class="p">],</span> <span class="s">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;kinase&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="n">p</span><span class="p">[</span><span class="s">&#39;kinase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;kinase&#39;</span><span class="p">]]</span>
                    <span class="n">kinase_ups</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> \
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s">&#39;uniprot&#39;</span><span class="p">)</span> \
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;kinase&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ii</span><span class="p">]</span>
                    <span class="n">kinase_ups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">kinase_ups</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;kinase&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="n">p</span><span class="p">[</span><span class="s">&#39;kinase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;kinase&#39;</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;substrate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;HLA&#39;</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;MIMP&#39;</span><span class="p">,</span> <span class="s">&#39;PhosphoNetworks&#39;</span><span class="p">]:</span>
                    <span class="n">substrate_ups_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;substrate&#39;</span><span class="p">],</span> 
                        <span class="s">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;MIMP&#39;</span><span class="p">:</span>
                    <span class="n">substrate_ups_all</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;substrate_refseq&#39;</span><span class="p">],</span> 
                        <span class="s">&#39;refseq&#39;</span><span class="p">,</span> <span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                    <span class="n">substrate_ups_all</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">substrate_ups_all</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;phosphoELM&#39;</span><span class="p">,</span> <span class="s">&#39;dbPTM&#39;</span><span class="p">,</span> <span class="s">&#39;PhosphoSite&#39;</span><span class="p">]:</span>
                    <span class="n">substrate_ups_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;substrate&#39;</span><span class="p">],</span> 
                        <span class="s">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;kinase&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kin_ambig</span><span class="p">:</span>
                        <span class="n">kin_ambig</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinase_ups</span>
                <span class="c"># looking up sequences in all isoforms:</span>
                <span class="n">substrate_ups</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrate_ups_all</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">isof</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">isoforms</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;instance&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;instance&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">],</span> 
                                    <span class="n">p</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">],</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">isof</span><span class="p">):</span>
                                    <span class="n">substrate_ups</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">isof</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;resaa&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;resnum&#39;</span><span class="p">],</span> 
                                    <span class="n">isoform</span> <span class="o">=</span> <span class="n">isof</span><span class="p">):</span>
                                    <span class="n">substrate_ups</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">isof</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;substrate&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sub_ambig</span><span class="p">:</span>
                    <span class="n">sub_ambig</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;substrate&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">substrate_ups</span>
                <span class="c"># generating report on non matching substrates</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">substrate_ups</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrate_ups_all</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">:</span>
                            <span class="n">nomatch</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                <span class="n">p</span><span class="p">[</span><span class="s">&#39;substrate_refseq&#39;</span><span class="p">],</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;instance&#39;</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">])))</span>
                <span class="c"># adding kinase-substrate interactions</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kinase_ups</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrate_ups</span><span class="p">:</span>
                        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">res</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Residue</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;resnum&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;resaa&#39;</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                    <span class="n">isoform</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;instance&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                                    <span class="n">reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">get_region</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;resnum&#39;</span><span class="p">],</span> 
                                        <span class="n">p</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">],</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                    <span class="k">if</span> <span class="n">reg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s">&#39;instance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="n">p</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                <span class="k">if</span> <span class="s">&#39;typ&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                                    <span class="n">p</span><span class="p">[</span><span class="s">&#39;typ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;phosphorylation&#39;</span>
                                <span class="n">mot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Motif</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">],</span> 
                                    <span class="n">instance</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;instance&#39;</span><span class="p">],</span> <span class="n">isoform</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">motif</span> <span class="o">=</span> <span class="n">mot</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="n">res</span><span class="p">,</span> 
                                    <span class="n">typ</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;typ&#39;</span><span class="p">],</span> <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">],</span> 
                                    <span class="n">isoform</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="n">dom</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">k</span><span class="p">)</span>
                                <span class="k">if</span> <span class="s">&#39;references&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                                    <span class="n">p</span><span class="p">[</span><span class="s">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                <span class="n">dommot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">DomainMotif</span><span class="p">(</span><span class="n">domain</span> <span class="o">=</span> <span class="n">dom</span><span class="p">,</span> <span class="n">ptm</span> <span class="o">=</span> <span class="n">ptm</span><span class="p">,</span> 
                                    <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">],</span> <span class="n">refs</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;references&#39;</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;MIMP&#39;</span><span class="p">:</span>
                                    <span class="n">dommot</span><span class="o">.</span><span class="n">mimp_sources</span> <span class="o">=</span> <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;databases&#39;</span><span class="p">])</span>
                                    <span class="n">dommot</span><span class="o">.</span><span class="n">npmid</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;npmid&#39;</span><span class="p">]</span>
                                <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;PhosphoNetworks&#39;</span><span class="p">:</span>
                                    <span class="n">dommot</span><span class="o">.</span><span class="n">pnetw_score</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span>
                                <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;dbPTM&#39;</span><span class="p">:</span>
                                    <span class="n">dommot</span><span class="o">.</span><span class="n">dbptm_sources</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;source&#39;</span><span class="p">]]</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dommot</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s">&#39;non_matching&#39;</span><span class="p">:</span> <span class="n">nomatch</span><span class="p">,</span> <span class="s">&#39;kinase_ambiguousity&#39;</span><span class="p">:</span> <span class="n">kin_ambig</span><span class="p">,</span>
                <span class="s">&#39;substrate_ambiguousity&#39;</span><span class="p">:</span> <span class="n">sub_ambig</span><span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">load_depod_dmi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reres</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;([A-Z][a-z]+)-([0-9]+)&#39;</span><span class="p">)</span>
        <span class="n">non_digit</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;[^\d.-]+&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">dataio</span><span class="o">.</span><span class="n">get_depod</span><span class="p">()</span>
        <span class="n">aadict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aaletters</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
            <span class="n">aaletters</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&#39;ptm&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s">&#39;Loading dephosphorylation data from DEPOD&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="n">mapp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">reslist</span> <span class="o">=</span> <span class="p">[(</span><span class="n">aadict</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="nb">int</span><span class="p">(</span><span class="n">non_digit</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span> \
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reres</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> \
                <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">aadict</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">enzymes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="n">substrates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;uniprot&#39;</span><span class="p">,</span> <span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="n">substrates</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrates</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">]</span>
                <span class="n">mapp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">enzymes</span><span class="p">,</span> <span class="n">substrates</span><span class="p">,</span> <span class="n">reslist</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reslist</span><span class="p">:</span>
                    <span class="n">substrates</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrates</span> \
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                <span class="n">mapp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">substrates</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">enzymes</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrates</span><span class="p">:</span>
                        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_pair</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reslist</span><span class="p">:</span>
                                    <span class="n">res</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Residue</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">)</span>
                                    <span class="n">ptm</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Ptm</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">residue</span> <span class="o">=</span> <span class="n">res</span><span class="p">,</span> 
                                        <span class="n">typ</span> <span class="o">=</span> <span class="s">&#39;dephosphorylation&#39;</span><span class="p">,</span> 
                                        <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;DEPOD&#39;</span><span class="p">])</span>
                                    <span class="n">dom</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">protein</span> <span class="o">=</span> <span class="n">d</span><span class="p">)</span>
                                    <span class="n">dommot</span> <span class="o">=</span> <span class="n">intera</span><span class="o">.</span><span class="n">DomainMotif</span><span class="p">(</span><span class="n">domain</span> <span class="o">=</span> <span class="n">dom</span><span class="p">,</span> <span class="n">ptm</span> <span class="o">=</span> <span class="n">ptm</span><span class="p">,</span> 
                                        <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;DEPOD&#39;</span><span class="p">],</span> 
                                        <span class="n">refs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)])</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dommot</span><span class="p">)</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="c"># return mapp</span>
    
    <span class="k">def</span> <span class="nf">uniq_ptms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;ptm&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uniq_ptm</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">uniq_ptm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ptms</span><span class="p">):</span>
        <span class="n">ptms_uniq</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">ptms</span><span class="p">:</span>
            <span class="n">merged</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ptmu</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ptms_uniq</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ptm</span> <span class="o">==</span> <span class="n">ptmu</span><span class="p">:</span>
                    <span class="n">ptms_uniq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ptm</span><span class="p">)</span>
                    <span class="n">merged</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">merged</span><span class="p">:</span>
                <span class="n">ptms_uniq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptm</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ptms_uniq</span>
    
    <span class="k">def</span> <span class="nf">phosphorylation_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniq_ptms</span><span class="p">()</span>
        <span class="n">isdir</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                <span class="n">isdir</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;DomainMotif&#39;</span> <span class="ow">and</span> \
                    <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;phosphorylation&#39;</span><span class="p">,</span> <span class="s">&#39;dephosphorylation&#39;</span><span class="p">]:</span>
                    <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_dir</span><span class="p">((</span><span class="n">ptm</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">),</span> 
                        <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span>
        <span class="n">isdir2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>
                <span class="n">isdir2</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">:: Directionality set for </span><span class="si">%u</span><span class="s"> interactions</span><span class="se">\n</span><span class="s">&#39;</span>\
            <span class="s">&#39;</span><span class="se">\t</span><span class="s">   based on known (de)phosphorylation events.</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">isdir2</span> <span class="o">-</span> <span class="n">isdir</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">phosphorylation_signs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">new_signs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dephos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c"># looking up effects of dephosphorylations:</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]:</span>
                <span class="n">sign</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;dephosphorylation&#39;</span><span class="p">:</span>
                    <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">ptm</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">)</span>
                    <span class="n">signs</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">signs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">signs</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">sign</span> <span class="o">=</span> <span class="s">&#39;positive&#39;</span>
                    <span class="k">elif</span> <span class="n">signs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">signs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">sign</span> <span class="o">=</span> <span class="s">&#39;negative&#39;</span>
                    <span class="k">if</span> <span class="n">sign</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dephos</span><span class="p">:</span>
                            <span class="n">dephos</span><span class="p">[</span><span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">dephos</span><span class="p">[</span><span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s">&#39;protein&#39;</span><span class="p">:</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span>
                            <span class="s">&#39;resaa&#39;</span><span class="p">:</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="s">&#39;resnum&#39;</span><span class="p">:</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">number</span><span class="p">,</span>
                            <span class="s">&#39;sign&#39;</span><span class="p">:</span> <span class="n">sign</span><span class="p">})</span>
        <span class="c"># set the opposite sign for posphorylations as it is </span>
        <span class="c"># at corresponding dephosphorylations:</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;phosphorylation&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span> <span class="ow">in</span> <span class="n">dephos</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">de</span> <span class="ow">in</span> <span class="n">dephos</span><span class="p">[</span><span class="n">protein</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">de</span><span class="p">[</span><span class="s">&#39;resnum&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                                <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">de</span><span class="p">[</span><span class="s">&#39;resaa&#39;</span><span class="p">]:</span>
                                <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">ptm</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">protein</span><span class="p">)</span>
                                <span class="n">signs</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
                                <span class="n">sign</span> <span class="o">=</span> <span class="s">&#39;positive&#39;</span> <span class="k">if</span> <span class="n">de</span><span class="p">[</span><span class="s">&#39;sign&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;negative&#39;</span> \
                                    <span class="k">else</span> <span class="s">&#39;negative&#39;</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">signs</span><span class="p">)):</span>
                                    <span class="n">e</span><span class="p">[</span><span class="s">&#39;dirs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_sign</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">ptm</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span>
                                    <span class="n">new_signs</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">:: Signes set based on phosphorylation-&#39;</span>\
            <span class="s">&#39;dephosphorylation pairs: </span><span class="si">%u</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="n">new_signs</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">kinase_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">pcounts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ks_pairs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">psite_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="n">ks_srcs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;DomainMotif&#39;</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;phosphorylation&#39;</span><span class="p">:</span>
                    <span class="n">ks_srcs</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">sources</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">sources</span>
                    <span class="n">p_srcs</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">sources</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">sources</span>
                    <span class="n">p_srcs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">p_srcs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;Swiss-Prot&#39;</span><span class="p">]))</span>
                    <span class="n">p_srcs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                    <span class="n">p_srcs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">p_srcs</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">p_srcs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pcounts</span><span class="p">:</span>
                        <span class="n">pcounts</span><span class="p">[</span><span class="n">p_srcs</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">pcounts</span><span class="p">[</span><span class="n">p_srcs</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">psite_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ks_srcs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ks_srcs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ks_srcs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;Swiss-Prot&#39;</span><span class="p">]))</span>
                <span class="n">ks_srcs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="n">ks_srcs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ks_srcs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ks_srcs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
                    <span class="n">counts</span><span class="p">[</span><span class="n">ks_srcs</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">counts</span><span class="p">[</span><span class="n">ks_srcs</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">ks_pairs</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;phosphorylations&#39;</span><span class="p">:</span> <span class="n">pcounts</span><span class="p">,</span> <span class="s">&#39;kinase_substrate&#39;</span><span class="p">:</span> <span class="n">counts</span><span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">update_db_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;nodes&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s">&#39;edges&#39;</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vertex_sources</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sources</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">sources_overlap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diagonal</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_db_dict</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;single&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&#39;nodes&#39;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="s">&#39;edges&#39;</span><span class="p">:</span> <span class="p">{}</span>
            <span class="p">},</span>
            <span class="s">&#39;overlap&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&#39;nodes&#39;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="s">&#39;edges&#39;</span><span class="p">:</span> <span class="p">{}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">])</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">][</span><span class="s">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">s1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">diagonal</span> <span class="ow">or</span> <span class="n">s1</span> <span class="o">!=</span> <span class="n">s2</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="s">&#39;overlap&#39;</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)]</span> <span class="o">=</span> \
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s2</span><span class="p">])</span>
                    <span class="n">result</span><span class="p">[</span><span class="s">&#39;overlap&#39;</span><span class="p">][</span><span class="s">&#39;edges&#39;</span><span class="p">][(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)]</span> <span class="o">=</span> \
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">][</span><span class="n">s1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">][</span><span class="n">s2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span> <span class="nf">source_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources_overlap</span><span class="p">()</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
        <span class="n">bwness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">betweenness</span><span class="p">()</span>
        <span class="n">ebwness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">edge_betweenness</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">source_diagram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outf</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="n">outf</span> <span class="k">if</span> <span class="n">outf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;pdf&#39;</span><span class="p">,</span> <span class="s">&#39;databases.pdf&#39;</span><span class="p">)</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources_overlap</span><span class="p">(</span><span class="n">diagonal</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">overlaps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">][</span><span class="s">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">],</span> <span class="bp">None</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s">&#39;overlap&#39;</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">overlaps</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s">&#39;overlap&#39;</span><span class="p">][</span><span class="s">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">])}</span>
        <span class="n">diagram</span> <span class="o">=</span> <span class="n">bdrawing</span><span class="o">.</span><span class="n">InterSet</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">overlaps</span><span class="p">,</span> <span class="n">outf</span> <span class="o">=</span> <span class="n">outf</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">diagram</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">get_dirs_signs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">best</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="o">+</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">good</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> \
            <span class="o">+</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">ugly</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">result</span><span class="p">[</span><span class="n">db</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">bool</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">isDirected</span><span class="p">),</span> <span class="nb">bool</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">sign</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">result</span>
    
<div class="viewcode-block" id="BioGraph.basic_stats"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph.basic_stats">[docs]</a>    <span class="k">def</span> <span class="nf">basic_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latex</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns basic numbers about the network resources, e.g. edge and </span>
<span class="sd">        node counts. </span>
<span class="sd">        </span>
<span class="sd">        latex</span>
<span class="sd">            Return table in a LaTeX document. This can be compiled by</span>
<span class="sd">            PDFLaTeX: </span>
<span class="sd">            latex stats.tex</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;results&#39;</span><span class="p">,</span> <span class="s">&#39;databases-</span><span class="si">%s</span><span class="s">.tex&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span> \
            <span class="k">if</span> <span class="n">latex</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;results&#39;</span><span class="p">,</span> <span class="s">&#39;databases-</span><span class="si">%s</span><span class="s">.tsv&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources_overlap</span><span class="p">()</span>
        <span class="n">dirs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dirs_signs</span><span class="p">()</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Database&#39;</span><span class="p">,</span> <span class="s">&#39;Node count&#39;</span><span class="p">,</span> <span class="s">&#39;Edge count&#39;</span><span class="p">,</span> <span class="s">&#39;Directions&#39;</span><span class="p">,</span> <span class="s">&#39;Signs&#39;</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">],</span> 
            <span class="n">stats</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">][</span><span class="s">&#39;edges&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">],</span> 
                <span class="nb">int</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">1</span><span class="p">])]])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">latex</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">out</span><span class="p">])</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outf</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">:: Output written to file `</span><span class="si">%s</span><span class="s">`</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="n">outf</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">texnewline</span> <span class="o">=</span> <span class="s">r&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&#39;&#39;&#39;\documentclass[12pt,a4paper]{article}</span>
<span class="s">                \usepackage[T1]{fontenc}</span>
<span class="s">                \usepackage[utf8]{inputenc}</span>
<span class="s">                \usepackage[english]{babel}</span>
<span class="s">                \usepackage[landscape]{geometry}</span>
<span class="s">                \usepackage{booktabs}</span>
<span class="s">                \usepackage{microtype}</span>
<span class="s">                \usepackage{tabularx}</span>
<span class="s">                \begin{document}</span>
<span class="s">                \thispagestyle{empty}</span>
<span class="s">                &#39;&#39;&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&#39;\begin{table}[h]&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&#39;\begin{tabularx}{\textwidth}{&#39;</span> \
                <span class="o">+</span> <span class="s">&#39;X</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;r&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s">r&#39;}&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> \
                <span class="o">+</span> <span class="s">r&#39;\toprule&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&#39; &amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="n">texnewline</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&#39;\midrule&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="n">texnewline</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39; &amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> \
                <span class="n">xx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="s">r&#39;\_&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span> <span class="k">else</span> \
                <span class="s">&#39;{:,}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span> \
                <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span> <span class="o">+</span> <span class="n">texnewline</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&#39;\bottomrule&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&#39;\caption{&#39;</span> <span class="o">+</span> <span class="s">&#39;Node and edge counts of pathway databases&#39;</span> \
                <span class="o">+</span> <span class="s">r&#39;}&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&#39;\end{tabularx}&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&#39;\end{table}&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&#39;\end{document}&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outf</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tex</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">:: Output written to file `</span><span class="si">%s</span><span class="s">`</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="n">outf</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="BioGraph.source_network"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph.source_network">[docs]</a>    <span class="k">def</span> <span class="nf">source_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span> <span class="o">=</span> <span class="s">&#39;HelveticaNeueLTStd&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        For EMBL branding, use Helvetica Neue Linotype Standard light</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources_overlap</span><span class="p">()</span>
        <span class="n">tupleListNodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tupleListEdges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dbs</span><span class="p">,</span> <span class="n">overlap</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s">&#39;overlap&#39;</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">overlap</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tupleListNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dbs</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="n">overlap</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">dbs</span><span class="p">,</span> <span class="n">overlap</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s">&#39;overlap&#39;</span><span class="p">][</span><span class="s">&#39;edges&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">overlap</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tupleListEdges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dbs</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="n">overlap</span><span class="p">]))</span>
        <span class="n">tupleListNodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tupleListNodes</span><span class="p">))</span>
        <span class="n">tupleListEdges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tupleListEdges</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">TupleList</span><span class="p">(</span><span class="n">tupleListNodes</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">TupleList</span><span class="p">(</span><span class="n">tupleListEdges</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="c"># edge widths proportional to overlaps in unique nodes/edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;edge_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="n">stats</span><span class="p">[</span><span class="s">&#39;overlap&#39;</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">][(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])],</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s">&#39;edge_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="n">stats</span><span class="p">[</span><span class="s">&#39;overlap&#39;</span><span class="p">][</span><span class="s">&#39;edges&#39;</span><span class="p">][(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">source</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">target</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])],</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">es</span><span class="p">]</span>
        <span class="c"># node sizes proportional to number of nodes/edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;vertex_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> 
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;vertex_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> 
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="c"># numbers in vertex labels:</span>
        <span class="n">v</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39; (</span><span class="si">%u</span><span class="s">)&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]])</span> \
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">v</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39; (</span><span class="si">%u</span><span class="s">)&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]])</span> \
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">plotParamNodes</span> <span class="o">=</span> <span class="n">PlotParam</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="p">,</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;db_net_nodes.pdf&#39;</span><span class="p">,</span> 
            <span class="n">layout</span> <span class="o">=</span> <span class="s">&#39;circular&#39;</span><span class="p">,</span> <span class="n">vertex_label_color</span> <span class="o">=</span> <span class="s">&#39;#4d4d4d&#39;</span><span class="p">,</span> 
            <span class="n">vertex_color</span> <span class="o">=</span> <span class="s">&#39;#73b360&#39;</span><span class="p">,</span> <span class="n">edge_color</span> <span class="o">=</span> <span class="s">&#39;#006666&#39;</span><span class="p">,</span> 
            <span class="n">vertex_fill_alpha</span> <span class="o">=</span> <span class="s">&#39;ff&#39;</span><span class="p">,</span>
            <span class="n">vertex_label_font</span> <span class="o">=</span> <span class="n">font</span><span class="p">,</span> 
            <span class="n">vertex_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetNodes</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;vertex_size&#39;</span><span class="p">],</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">994</span><span class="p">,</span> <span class="mi">994</span><span class="p">),</span> 
            <span class="n">dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
        <span class="n">plotParamEdges</span> <span class="o">=</span> <span class="n">PlotParam</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="p">,</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;db_net_nodes.pdf&#39;</span><span class="p">,</span> 
            <span class="n">layout</span> <span class="o">=</span> <span class="s">&#39;circular&#39;</span><span class="p">,</span> <span class="n">vertex_label_color</span> <span class="o">=</span> <span class="s">&#39;#4d4d4d&#39;</span><span class="p">,</span> 
            <span class="n">vertex_color</span> <span class="o">=</span> <span class="s">&#39;#73b360&#39;</span><span class="p">,</span> <span class="n">edge_color</span> <span class="o">=</span> <span class="s">&#39;#006666&#39;</span><span class="p">,</span> 
            <span class="n">vertex_fill_alpha</span> <span class="o">=</span> <span class="s">&#39;ff&#39;</span><span class="p">,</span>
            <span class="n">vertex_label_font</span> <span class="o">=</span> <span class="n">font</span><span class="p">,</span> 
            <span class="n">vertex_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceNetEdges</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;vertex_size&#39;</span><span class="p">],</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">994</span><span class="p">,</span> <span class="mi">994</span><span class="p">),</span> 
            <span class="n">dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">plotParamNodes</span><span class="p">,</span> <span class="n">plotParamEdges</span>
    
    <span class="c">#</span>
    <span class="c"># Load data from GDSC</span>
    <span class="c">#</span>
    </div>
<div class="viewcode-block" id="BioGraph.load_mutations"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph.load_mutations">[docs]</a>    <span class="k">def</span> <span class="nf">load_mutations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Mutations are listed in vertex attributes. Mutation() objects </span>
<span class="sd">        offers methods to identify residues and look up in Ptm(), Motif() </span>
<span class="sd">        and Domain() objects, to check if those residues are </span>
<span class="sd">        modified, or are in some short motif or domain.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutation_samples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> \
            <span class="p">[</span><span class="s">&#39;Consequence&#39;</span><span class="p">,</span> <span class="s">&#39;COSMIC_ID&#39;</span><span class="p">,</span> <span class="s">&#39;SAMPLE_NAME&#39;</span><span class="p">,</span> <span class="s">&#39;Tissue_TCGA&#39;</span><span class="p">,</span> <span class="s">&#39;ZYGOSITY&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">gdsc</span><span class="o">.</span><span class="n">read_mutations</span><span class="p">(</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;mut&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;mut&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s">&#39;Processing mutations&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">uniprot</span><span class="p">,</span> <span class="n">muts</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">uniprot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">muts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s">&#39;mut&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s">&#39;mut&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">if</span> <span class="n">mu</span><span class="o">.</span><span class="n">sample</span> <span class="ow">not</span> <span class="ow">in</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s">&#39;mut&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s">&#39;mut&#39;</span><span class="p">]</span>\
                            <span class="p">[</span><span class="n">mu</span><span class="o">.</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]][</span><span class="s">&#39;mut&#39;</span><span class="p">]</span>\
                        <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">sample</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mu</span><span class="o">.</span><span class="n">sample</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation_samples</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mutation_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">sample</span><span class="p">))</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
    </div>
<div class="viewcode-block" id="BioGraph.load_expression"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph.load_expression">[docs]</a>    <span class="k">def</span> <span class="nf">load_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Expression data can be loaded into vertex attributes, </span>
<span class="sd">        or into a pandas DataFrame – the latter offers faster </span>
<span class="sd">        ways to process and use these huge matrices.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_vname</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">gdsc</span><span class="o">.</span><span class="n">read_transcriptomics</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&#39;exp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">attributes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s">&#39;exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">]</span>
        <span class="n">prg</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s">&#39;Processing transcriptomics&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">array</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">gsymb</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">up</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">gsymb</span><span class="p">,</span> <span class="s">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s">&#39;uniprot&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">up</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">gsymb</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="n">gsymb</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exp</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">gsymb</span><span class="p">,</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="n">uniprots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span><span class="n">gsymb</span><span class="p">,</span> <span class="s">&#39;genesymbol&#39;</span><span class="p">,</span> <span class="s">&#39;uniprot&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">up</span> <span class="ow">in</span> <span class="n">uniprots</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">up</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">up</span><span class="p">]][</span><span class="s">&#39;exp&#39;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="nb">dict</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> \
                                <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodDct</span><span class="p">[</span><span class="n">up</span><span class="p">]][</span><span class="s">&#39;exp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    
    <span class="c">#</span>
    <span class="c"># Find and remove edges where mutations disrupt PTMs</span>
    <span class="c">#</span>
    </div>
<div class="viewcode-block" id="BioGraph.mutated_edges"><a class="viewcode-back" href="../../index.html#bioigraph.bioigraph.BioGraph.mutated_edges">[docs]</a>    <span class="k">def</span> <span class="nf">mutated_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compares the mutated residues and the modified residues in PTMs.</span>
<span class="sd">        Interactions are marked as mutated if the target residue in the </span>
<span class="sd">        underlying PTM is mutated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">disrupted</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">smpl</span><span class="p">,</span> <span class="n">mut</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s">&#39;mut&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">smpl</span> <span class="o">==</span> <span class="n">sample</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">mut</span><span class="o">.</span><span class="n">original</span> <span class="o">==</span> <span class="n">ptm</span><span class="o">.</span><span class="n">ptm</span><span class="o">.</span><span class="n">residue</span><span class="p">:</span>
                                <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">disrupted</span><span class="p">:</span>
                                    <span class="n">disrupted</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> \
                                        <span class="p">{</span><span class="s">&#39;ptms&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&#39;ptm&#39;</span><span class="p">]),</span> <span class="s">&#39;disr&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
                                <span class="n">disrupted</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="s">&#39;disr&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">toDel</span><span class="p">,</span> <span class="n">disrupted</span>
    </div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">bioigraph 0.1.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Dénes Türei.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>